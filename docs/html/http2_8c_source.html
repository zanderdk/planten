<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/http2.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('http2_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">http2.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="http2_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;nghttp2/nghttp2.h&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="http2_8h.html">http2.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="http_8h.html">http.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__base64_8h.html">curl_base64.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="multiif_8h.html">multiif.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="url_8h.html">url.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strtoofft_8h.html">strtoofft.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strdup_8h.html">strdup.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#define H2_BUFSIZE 32768</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#if (NGHTTP2_VERSION_NUM &lt; 0x010000)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#error too old nghttp2 version, upgrade!</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#if (NGHTTP2_VERSION_NUM &gt; 0x010800)</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#define NGHTTP2_HAS_HTTP2_STRERROR 1</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#if (NGHTTP2_VERSION_NUM &gt;= 0x010900)</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/* nghttp2_session_callbacks_set_error_callback is present in nghttp2 1.9.0 or</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">   later */</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#define NGHTTP2_HAS_ERROR_CALLBACK 1</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#define nghttp2_session_callbacks_set_error_callback(x,y)</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#if (NGHTTP2_VERSION_NUM &gt;= 0x010c00)</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#define NGHTTP2_HAS_SET_LOCAL_WINDOW_SIZE 1</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#define HTTP2_HUGE_WINDOW_SIZE (1 &lt;&lt; 30)</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#ifdef DEBUG_HTTP2</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#define H2BUGF(x) x</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#define H2BUGF(x) do { } WHILE_FALSE</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> http2_recv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                          <span class="keywordtype">char</span> *mem, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> http2_connisdead(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> h2_session_send(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                           nghttp2_session *h2);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> h2_process_pending_input(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                    <span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *httpc,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * Curl_http2_init_state() is called when the easy handle is created and</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * allows for HTTP/2 specific init of state.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#af65fa81e85022ee9b2ca5b8c46664f10">Curl_http2_init_state</a>(<span class="keyword">struct</span> <a class="code" href="struct_url_state.html">UrlState</a> *<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;{</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;stream_weight = NGHTTP2_DEFAULT_WEIGHT;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * Curl_http2_init_userset() is called when the easy handle is created and</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * allows for HTTP/2 specific user-set fields.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#ab44413d5f5cf5d245165f53c86b8bcb1">Curl_http2_init_userset</a>(<span class="keyword">struct</span> <a class="code" href="struct_user_defined.html">UserDefined</a> *<span class="keyword">set</span>)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keyword">set</span>-&gt;stream_weight = NGHTTP2_DEFAULT_WEIGHT;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> http2_perform_getsock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                 <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *sock, <span class="comment">/* points to</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">                                                         numsocks</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">                                                         number of</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">                                                         sockets */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                 <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *c = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_single_request.html">SingleRequest</a> *k = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">int</span> bitmap = <a class="code" href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  (void)numsocks;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">/* TODO We should check underlying socket state if it is SSL socket</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">     because of renegotiation. */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  sock[0] = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">/* in a HTTP/2 connection we can basically always get a frame so we should</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">     always be ready for one */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  bitmap |= <a class="code" href="multiif_8h.html#a4ae1fb64a27264765b6a2fe5aca78830">GETSOCK_READSOCK</a>(<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">/* we&#39;re still uploading or the HTTP/2 layer wants to send data */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span>(((k-&gt;<a class="code" href="struct_single_request.html#a6ca30fe8e465c2b5be16ee98769120b8">keepon</a> &amp; (<a class="code" href="urldata_8h.html#a93237a6ee2f27182bb966487a03bce44">KEEP_SEND</a>|<a class="code" href="urldata_8h.html#a4a561967b6a40f1b5cbec45beeff78a6">KEEP_SEND_PAUSE</a>)) == <a class="code" href="urldata_8h.html#a93237a6ee2f27182bb966487a03bce44">KEEP_SEND</a>) ||</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;     nghttp2_session_want_write(c-&gt;h2))</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    bitmap |= <a class="code" href="multiif_8h.html#a9aabda59f0ff87c1db3a2d306a410713">GETSOCK_WRITESOCK</a>(<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> bitmap;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> http2_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                         <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *sock, <span class="comment">/* points to numsocks</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">                                                 number of sockets */</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                         <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">return</span> http2_perform_getsock(conn, sock, numsocks);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> * http2_stream_free() free HTTP2 stream related data</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> http2_stream_free(<span class="keyword">struct</span> <a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;header_recvbuf);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;trailer_recvbuf);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">for</span>(; <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used &gt; 0; --<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers[<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used - 1]);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers = NULL;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> * Disconnects *a* connection used for HTTP/2. It might be an old one from the</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"> * connection cache and not the &quot;main&quot; one. Don&#39;t touch the easy handle!</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> http2_disconnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                 <span class="keywordtype">bool</span> dead_connection)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *c = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  (void)dead_connection;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;HTTP/2 DISCONNECT starts now\n&quot;</span>));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  nghttp2_session_del(c-&gt;h2);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(c-&gt;inbuf);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;HTTP/2 DISCONNECT done\n&quot;</span>));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"> * The server may send us data at any point (e.g. PING frames). Therefore,</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"> * we cannot assume that an HTTP/2 socket is dead just because it is readable.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"> * Instead, if it is readable, run Curl_connalive() to peek at the socket</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"> * and distinguish between closed and data.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> http2_connisdead(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">int</span> sval;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">bool</span> dead = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aaf15319fba965e2d87ac0ac839ae8351">close</a>)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  sval = <a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>], 0);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span>(sval == 0) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">/* timeout */</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    dead = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sval &amp; <a class="code" href="multi_8h.html#ac2f6404b4a34b0b43b61315b3c214912">CURL_CSELECT_ERR</a>) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">/* socket is in an error state */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    dead = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sval &amp; <a class="code" href="multi_8h.html#ac9841bc853b2a1874c9b5528b2ad3e5b">CURL_CSELECT_IN</a>) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">/* readable with no error. could still be closed */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    dead = !<a class="code" href="connect_8c.html#a74c23cda76889e03be9b701cfde158c7">Curl_connalive</a>(conn);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span>(!dead) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="comment">/* This happens before we&#39;ve sent off a request and the connection is</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">         not in use by any other transfer, there shouldn&#39;t be any data here,</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">         only &quot;protocol frames&quot; */</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread = -1;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span>(httpc-&gt;recv_underlying)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">/* if called &quot;too early&quot;, this pointer isn&#39;t setup yet! */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        nread = ((<a class="code" href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a> *)httpc-&gt;recv_underlying)(</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          conn, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, httpc-&gt;inbuf, H2_BUFSIZE, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">if</span>(nread != -1) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;              <span class="stringliteral">&quot;%d bytes stray data read before trying h2 connection\n&quot;</span>,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;              (<span class="keywordtype">int</span>)nread);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        httpc-&gt;nread_inbuf = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        httpc-&gt;inbuflen = nread;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        (void)h2_process_pending_input(conn, httpc, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">/* the read failed so let&#39;s say this is dead anyway */</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        dead = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">return</span> dead;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> http2_conncheck(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *check,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> checks_to_perform)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ret_val = <a class="code" href="urldata_8h.html#a32206d460719cde6f2783b5f86f82acc">CONNRESULT_NONE</a>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *c = &amp;check-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordtype">bool</span> send_frames = <span class="keyword">false</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span>(checks_to_perform &amp; <a class="code" href="urldata_8h.html#ad2a0f1a29b96ea2623d2015598f21328">CONNCHECK_ISDEAD</a>) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span>(http2_connisdead(check))</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      ret_val |= <a class="code" href="urldata_8h.html#a27e0e4c009c7bae409b32e148d923658">CONNRESULT_DEAD</a>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">if</span>(checks_to_perform &amp; <a class="code" href="urldata_8h.html#ad7ac61834c3bfb1a509fdb5d4d7edc17">CONNCHECK_KEEPALIVE</a>) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcurltime.html">curltime</a> <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a> = <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>();</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    time_t <a class="code" href="test1_8c.html#a373722f946bf9680abb4de0dfb11fa22">elapsed</a> = <a class="code" href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a>(<a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>, check-&gt;<a class="code" href="structconnectdata.html#ab967c5853e0ed2e2f5ea9ead35d450eb">keepalive</a>);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="test1_8c.html#a373722f946bf9680abb4de0dfb11fa22">elapsed</a> &gt; check-&gt;<a class="code" href="structconnectdata.html#ad0d28904779f8613d113aa4c0c38337a">upkeep_interval_ms</a>) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="comment">/* Perform an HTTP/2 PING */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = nghttp2_submit_ping(c-&gt;h2, 0, <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">/* Successfully added a PING frame to the session. Need to flag this</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">           so the frame is sent. */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        send_frames = <span class="keyword">true</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;       <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(check-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;nghttp2_submit_ping() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;             nghttp2_strerror(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      check-&gt;<a class="code" href="structconnectdata.html#ab967c5853e0ed2e2f5ea9ead35d450eb">keepalive</a> = <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">if</span>(send_frames) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = nghttp2_session_send(c-&gt;h2);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(check-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;nghttp2_session_send() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            nghttp2_strerror(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">return</span> ret_val;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">/* called from Curl_http_setup_conn */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#a5bdef737723c68dff0e4bde069b428ec">Curl_http2_setup_req</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;{</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a> = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;nread_header_recvbuf = 0;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;bodystarted = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;status_code = -1;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;pausedata = NULL;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;pauselen = 0;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;closed = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;close_handled = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;mem = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;len = <a class="code" href="structdata.html">data</a>-&gt;set.buffer_size;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;memlen = 0;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">/* called from Curl_http_setup_conn */</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#a2295b843d76aeb06631566bfebc73be8">Curl_http2_setup_conn</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;{</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.settings.max_concurrent_streams =</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    DEFAULT_MAX_CONCURRENT_STREAMS;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.error_code = NGHTTP2_NO_ERROR;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"> * HTTP2 handler interface. This isn&#39;t added to the general list of protocols</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"> * but will be used at run-time when the protocol is dynamically switched from</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"> * HTTP to HTTP2.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> Curl_handler_http2 = {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="stringliteral">&quot;HTTP&quot;</span>,                               <span class="comment">/* scheme */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <a class="code" href="http_8c.html#ac009a02368ec5154996b23065aa85a28">Curl_http</a>,                            <span class="comment">/* do_it */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <a class="code" href="http_8c.html#ae3dc4a63f791cddc2b843736433a6c62">Curl_http_done</a>,                       <span class="comment">/* done */</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* do_more */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* connecting */</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* doing */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  http2_getsock,                        <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  http2_getsock,                        <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  http2_perform_getsock,                <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  http2_disconnect,                     <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  http2_conncheck,                      <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="urldata_8h.html#a5158b1e31a4e7aa84de308e3d792a1de">PORT_HTTP</a>,                            <span class="comment">/* defport */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="curl_8h.html#a4c4a3046bce0da437f299072f489bc02">CURLPROTO_HTTP</a>,                       <span class="comment">/* protocol */</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="urldata_8h.html#a81a92a35e60e84d80aa4d2b5a6959722">PROTOPT_STREAM</a>                        <span class="comment">/* flags */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;};</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> Curl_handler_http2_ssl = {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="stringliteral">&quot;HTTPS&quot;</span>,                              <span class="comment">/* scheme */</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="http_8c.html#ac009a02368ec5154996b23065aa85a28">Curl_http</a>,                            <span class="comment">/* do_it */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <a class="code" href="http_8c.html#ae3dc4a63f791cddc2b843736433a6c62">Curl_http_done</a>,                       <span class="comment">/* done */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* do_more */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* connecting */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* doing */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  http2_getsock,                        <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  http2_getsock,                        <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  http2_perform_getsock,                <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  http2_disconnect,                     <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                            <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  http2_conncheck,                      <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="urldata_8h.html#a5158b1e31a4e7aa84de308e3d792a1de">PORT_HTTP</a>,                            <span class="comment">/* defport */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="curl_8h.html#a83d34123b66749720352af4bcb17a8e4">CURLPROTO_HTTPS</a>,                      <span class="comment">/* protocol */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a> | <a class="code" href="urldata_8h.html#a81a92a35e60e84d80aa4d2b5a6959722">PROTOPT_STREAM</a>          <span class="comment">/* flags */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;};</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"> * Store nghttp2 version info in this buffer, Prefix with a space.  Return</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"> * total length written.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordtype">int</span> Curl_http2_ver(<span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  nghttp2_info *h2 = nghttp2_version(0);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot; nghttp2/%s&quot;</span>, h2-&gt;version_str);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">/* HTTP/2 error code to name based on the Error Code Registry.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">https://tools.ietf.org/html/rfc7540#page-77</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">nghttp2_error_code enums are identical.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *Curl_http2_strerror(uint32_t err)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#ifndef NGHTTP2_HAS_HTTP2_STRERROR</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[] = {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="stringliteral">&quot;NO_ERROR&quot;</span>,             <span class="comment">/* 0x0 */</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="stringliteral">&quot;PROTOCOL_ERROR&quot;</span>,       <span class="comment">/* 0x1 */</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="stringliteral">&quot;INTERNAL_ERROR&quot;</span>,       <span class="comment">/* 0x2 */</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="stringliteral">&quot;FLOW_CONTROL_ERROR&quot;</span>,   <span class="comment">/* 0x3 */</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="stringliteral">&quot;SETTINGS_TIMEOUT&quot;</span>,     <span class="comment">/* 0x4 */</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="stringliteral">&quot;STREAM_CLOSED&quot;</span>,        <span class="comment">/* 0x5 */</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="stringliteral">&quot;FRAME_SIZE_ERROR&quot;</span>,     <span class="comment">/* 0x6 */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="stringliteral">&quot;REFUSED_STREAM&quot;</span>,       <span class="comment">/* 0x7 */</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="stringliteral">&quot;CANCEL&quot;</span>,               <span class="comment">/* 0x8 */</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="stringliteral">&quot;COMPRESSION_ERROR&quot;</span>,    <span class="comment">/* 0x9 */</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="stringliteral">&quot;CONNECT_ERROR&quot;</span>,        <span class="comment">/* 0xA */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="stringliteral">&quot;ENHANCE_YOUR_CALM&quot;</span>,    <span class="comment">/* 0xB */</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="stringliteral">&quot;INADEQUATE_SECURITY&quot;</span>,  <span class="comment">/* 0xC */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="stringliteral">&quot;HTTP_1_1_REQUIRED&quot;</span>     <span class="comment">/* 0xD */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  };</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">return</span> (err &lt; <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) / <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[0])) ? <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[err] : <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">return</span> nghttp2_http2_strerror(err);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> * The implementation of nghttp2_send_callback type. Here we write |data| with</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> * size |length| to the network and return the number of bytes actually</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> * written. See the documentation of nghttp2_send_callback for the details.</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> send_callback(nghttp2_session *h2,</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                             <span class="keyword">const</span> uint8_t *<a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> length, <span class="keywordtype">int</span> <a class="code" href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">flags</a>,</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                             <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *c = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  (void)h2;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  (void)flags;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordflow">if</span>(!c-&gt;send_underlying)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">/* called before setup properly! */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> = ((<a class="code" href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a>*)c-&gt;send_underlying)(conn, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>,</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                             <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>, length, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_WOULDBLOCK;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> == -1) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed sending HTTP2 data&quot;</span>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_WOULDBLOCK;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/* We pass a pointer to this struct in the push callback, but the contents of</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">   the struct are hidden from the user. */</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keyword">struct </span>curl_pushheaders {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keyword">const</span> nghttp2_push_promise *frame;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;};</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * push header access function. Only to be used from within the push callback</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="http2_8c.html#a2831dc8e8f07f63432a1c1854b761905">curl_pushheader_bynum</a>(<span class="keyword">struct</span> curl_pushheaders *h, <span class="keywordtype">size_t</span> num)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">/* Verify that we got a good easy handle in the push header struct, mostly to</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">     detect rubbish input fast(er). */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">if</span>(!h || !<a class="code" href="urldata_8h.html#a1107f8f3c79ed6d630958c8363ee37da">GOOD_EASY_HANDLE</a>(h-&gt;data))</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = h-&gt;data-&gt;req.protop;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span>(num &lt; stream-&gt;push_headers_used)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[num];</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> * push header access function. Only to be used from within the push callback</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordtype">char</span> *<a class="code" href="http2_8c.html#a328fa8276b84a9e9b1391ca60f1f262c">curl_pushheader_byname</a>(<span class="keyword">struct</span> curl_pushheaders *h, <span class="keyword">const</span> <span class="keywordtype">char</span> *header)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">/* Verify that we got a good easy handle in the push header struct,</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">     mostly to detect rubbish input fast(er). Also empty header name</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">     is just a rubbish too. We have to allow &quot;:&quot; at the beginning of</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">     the header, but header == &quot;:&quot; must be rejected. If we have &#39;:&#39; in</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">     the middle of header, it could be matched in middle of the value,</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">     this is because we do prefix match.*/</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span>(!h || !<a class="code" href="urldata_8h.html#a1107f8f3c79ed6d630958c8363ee37da">GOOD_EASY_HANDLE</a>(h-&gt;data) || !header || !header[0] ||</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;     !strcmp(header, <span class="stringliteral">&quot;:&quot;</span>) || strchr(header + 1, <span class="charliteral">&#39;:&#39;</span>))</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = h-&gt;data-&gt;req.protop;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = strlen(header);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">if</span>(!strncmp(header, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">/* sub-match, make sure that it is followed by a colon */</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] != <span class="charliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">return</span> &amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> + 1];</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> * This specific transfer on this connection has been &quot;drained&quot;.</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> drained_transfer(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                             <span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *httpc)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;{</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(httpc-&gt;drain_total &gt;= <a class="code" href="structdata.html">data</a>-&gt;state.drain);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  httpc-&gt;drain_total -= <a class="code" href="structdata.html">data</a>-&gt;state.drain;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.drain = 0;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"> * Mark this transfer to get &quot;drained&quot;.</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> drain_this(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                       <span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *httpc)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.drain++;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  httpc-&gt;drain_total++;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(httpc-&gt;drain_total &gt;= <a class="code" href="structdata.html">data</a>-&gt;state.drain);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;}</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *duphandle(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;{</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *second = <a class="code" href="easy_8h.html#ad613e7dceae0af83071d800255004421">curl_easy_duphandle</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">if</span>(second) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">/* setup the request struct */</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_h_t_t_p.html">HTTP</a>));</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      (void)<a class="code" href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a>(second);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      second = NULL;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      second-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a> = <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;header_recvbuf = <a class="code" href="http_8c.html#a8439073425968002da46c16791460fba">Curl_add_buffer_init</a>();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;header_recvbuf) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        (void)<a class="code" href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a>(second);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        second = NULL;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="http2_8h.html#a5bdef737723c68dff0e4bde069b428ec">Curl_http2_setup_req</a>(second);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        second-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a5e24def154336ca61efb33aa446ed4e1">stream_weight</a> = <a class="code" href="structdata.html">data</a>-&gt;state.stream_weight;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">return</span> second;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> push_promise(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                        <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                        <span class="keyword">const</span> nghttp2_push_promise *frame)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;PUSH_PROMISE received, stream %u!\n&quot;</span>,</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;               frame-&gt;promised_stream_id));</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;multi-&gt;push_cb) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *newstream;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">struct </span>curl_pushheaders heads;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="multi_8h.html#a92acc8d3a23eaae72955b8a8b22c83e3">CURLMcode</a> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">/* clone the parent */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *newhandle = duphandle(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span>(!newhandle) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to duplicate handle\n&quot;</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      rv = 1; <span class="comment">/* FAIL HARD */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    heads.data = <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    heads.frame = frame;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/* ask the application */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Got PUSH_PROMISE, ask application!\n&quot;</span>));</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Internal NULL stream!\n&quot;</span>);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      (void)<a class="code" href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a>(newhandle);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      rv = 1;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    rv = <a class="code" href="structdata.html">data</a>-&gt;multi-&gt;push_cb(<a class="code" href="structdata.html">data</a>, newhandle,</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                              <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used, &amp;heads,</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                              <a class="code" href="structdata.html">data</a>-&gt;multi-&gt;push_userp);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">/* free the headers again */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers = NULL;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used = 0;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span>(rv) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">/* denied, kill off the new handle again */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      http2_stream_free(newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a> = NULL;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      (void)<a class="code" href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a>(newhandle);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    newstream = newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    newstream-&gt;stream_id = frame-&gt;promised_stream_id;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a8516340c7835dfd47166418da27c40a0">maxdownload</a> = -1;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a7b830d1607062193706245f7f4512ac9">size</a> = -1;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">/* approved, add to the multi handle and immediately switch to PERFORM</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">       state with the given connection !*/</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="multi_8c.html#a20ed1fa1c4fc98dd0a9dbf5b84e020dc">Curl_multi_add_perform</a>(<a class="code" href="structdata.html">data</a>-&gt;multi, newhandle, conn);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to add handle to multi\n&quot;</span>);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      http2_stream_free(newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      newhandle-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a> = NULL;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <a class="code" href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a>(newhandle);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      rv = 1;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    rv = nghttp2_session_set_stream_user_data(httpc-&gt;h2,</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                              frame-&gt;promised_stream_id,</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                              newhandle);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span>(rv) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to set user_data for stream %d\n&quot;</span>,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            frame-&gt;promised_stream_id);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Got PUSH_PROMISE, ignore it!\n&quot;</span>));</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    rv = 1;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>:</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> on_frame_recv(nghttp2_session *session, <span class="keyword">const</span> nghttp2_frame *frame,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                         <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;{</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s = NULL;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = NULL;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordtype">size_t</span> left, ncopy;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  int32_t stream_id = frame-&gt;hd.stream_id;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span>(!stream_id) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">/* stream ID zero is for connection-oriented stuff */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span>(frame-&gt;hd.type == NGHTTP2_SETTINGS) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      uint32_t max_conn = httpc-&gt;settings.max_concurrent_streams;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Got SETTINGS\n&quot;</span>));</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      httpc-&gt;settings.max_concurrent_streams =</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        nghttp2_session_get_remote_settings(</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          session, NGHTTP2_SETTINGS_MAX_CONCURRENT_STREAMS);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      httpc-&gt;settings.enable_push =</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        nghttp2_session_get_remote_settings(</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          session, NGHTTP2_SETTINGS_ENABLE_PUSH);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;MAX_CONCURRENT_STREAMS == %d\n&quot;</span>,</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                   httpc-&gt;settings.max_concurrent_streams));</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;ENABLE_PUSH == %s\n&quot;</span>,</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                   httpc-&gt;settings.enable_push?<span class="stringliteral">&quot;TRUE&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>));</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">if</span>(max_conn != httpc-&gt;settings.max_concurrent_streams) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">/* only signal change if the value actually changed */</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>,</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;              <span class="stringliteral">&quot;Connection state changed (MAX_CONCURRENT_STREAMS == %u)!\n&quot;</span>,</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;              httpc-&gt;settings.max_concurrent_streams);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <a class="code" href="multi_8c.html#a72515384372577e4134d210261290c09">Curl_multi_connchanged</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae50ee3c1668aaed84ae0338046f4f737">multi</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  data_s = nghttp2_session_get_stream_user_data(session, stream_id);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keywordflow">if</span>(!data_s) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>,</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                 <span class="stringliteral">&quot;No Curl_easy associated with stream: %x\n&quot;</span>,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                 stream_id));</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;No proto pointer for stream: %x\n&quot;</span>,</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                 stream_id));</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;on_frame_recv() header %x stream %x\n&quot;</span>,</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;               frame-&gt;hd.type, stream_id));</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">switch</span>(frame-&gt;hd.type) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">case</span> NGHTTP2_DATA:</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">/* If body started on this stream, then receiving DATA is illegal. */</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      rv = nghttp2_submit_rst_stream(session, NGHTTP2_FLAG_NONE,</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                     stream_id, NGHTTP2_PROTOCOL_ERROR);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span>(nghttp2_is_fatal(rv)) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordflow">case</span> NGHTTP2_HEADERS:</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">/* Only valid HEADERS after body started is trailer HEADERS.  We</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">         buffer them in on_header callback. */</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">/* nghttp2 guarantees that :status is received, and we store it to</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">       stream-&gt;status_code. Fuzzing has proven this can still be reached</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">       without status code having been set. */</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code == -1)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">/* Only final status code signals the end of header */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code / 100 != 1) {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code = -1;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    left = <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf-&gt;size_used - <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    ncopy = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len, left);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem[<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen],</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;           <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf-&gt;buffer + <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf,</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;           ncopy);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf += ncopy;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;Store %zu bytes headers from stream %u at %p\n&quot;</span>,</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                 ncopy, stream_id, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem));</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len -= ncopy;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen += ncopy;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    drain_this(data_s, httpc);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="comment">/* get the pointer from userp again since it was re-assigned above */</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn_s = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="comment">/* if we receive data for another handle, wake that up */</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">if</span>(conn_s-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> != data_s)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a>(data_s, 0, <a class="code" href="urldata_8h.html#aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4">EXPIRE_RUN_NOW</a>);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordflow">case</span> NGHTTP2_PUSH_PROMISE:</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    rv = push_promise(data_s, conn, &amp;frame-&gt;push_promise);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">if</span>(rv) { <span class="comment">/* deny! */</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      rv = nghttp2_submit_rst_stream(session, NGHTTP2_FLAG_NONE,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                                     frame-&gt;push_promise.promised_stream_id,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                     NGHTTP2_CANCEL);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">if</span>(nghttp2_is_fatal(rv)) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;Got frame type %x for stream %u!\n&quot;</span>,</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                 frame-&gt;hd.type, stream_id));</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> on_data_chunk_recv(nghttp2_session *session, uint8_t flags,</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                              int32_t stream_id,</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                              <span class="keyword">const</span> uint8_t *<a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;{</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordtype">size_t</span> nread;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  (void)session;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  (void)flags;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  (void)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(stream_id); <span class="comment">/* should never be a zero stream ID here */</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="comment">/* get the stream from the hash based on Stream ID */</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  data_s = nghttp2_session_get_stream_user_data(session, stream_id);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordflow">if</span>(!data_s)</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">/* Receiving a Stream ID not in the hash should not happen, this is an</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">       internal error more than anything else! */</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>)</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  nread = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem[<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen], <a class="code" href="structdata.html">data</a>, nread);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len -= nread;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen += nread;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  drain_this(data_s, &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">/* if we receive data for another handle, wake that up */</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> != data_s)</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <a class="code" href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a>(data_s, 0, <a class="code" href="urldata_8h.html#aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4">EXPIRE_RUN_NOW</a>);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;%zu data received for stream %u &quot;</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;               <span class="stringliteral">&quot;(%zu left in buffer %p, total %zu)\n&quot;</span>,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;               nread, stream_id,</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;               <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem,</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;               <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen));</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordflow">if</span>(nread &lt; <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata = <a class="code" href="structdata.html">data</a> + nread;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pauselen = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - nread;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;NGHTTP2_ERR_PAUSE - %zu bytes out of buffer&quot;</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                 <span class="stringliteral">&quot;, stream %u\n&quot;</span>,</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                 <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - nread, stream_id));</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    data_s-&gt;<a class="code" href="struct_curl__easy.html#ad7bc19a27cd3de5d0d72e9221dde5ef7">easy_conn</a>-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.pause_stream_id = stream_id;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_PAUSE;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">/* pause execution of nghttp2 if we received data for another handle</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">     in order to process them first. */</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> != data_s) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    data_s-&gt;<a class="code" href="struct_curl__easy.html#ad7bc19a27cd3de5d0d72e9221dde5ef7">easy_conn</a>-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.pause_stream_id = stream_id;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_PAUSE;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> on_stream_close(nghttp2_session *session, int32_t stream_id,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                           uint32_t error_code, <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;{</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  (void)session;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  (void)stream_id;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">if</span>(stream_id) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">/* get the stream from the hash based on Stream ID, stream ID zero is for</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">       connection-oriented stuff */</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    data_s = nghttp2_session_get_stream_user_data(session, stream_id);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span>(!data_s) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">/* We could get stream ID not in the hash.  For example, if we</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">         decided to reject stream (e.g., PUSH_PROMISE). */</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    }</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;on_stream_close(), %s (err %d), stream %u\n&quot;</span>,</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                 Curl_http2_strerror(error_code), error_code, stream_id));</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    drain_this(data_s, httpc);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    httpc-&gt;error_code = error_code;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">/* remove the entry from the hash as the stream is now gone */</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    rv = nghttp2_session_set_stream_user_data(session, stream_id, 0);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">if</span>(rv) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;http/2: failed to clear user_data for stream %d!\n&quot;</span>,</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            stream_id);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;Removed stream %u hash!\n&quot;</span>, stream_id));</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id = 0; <span class="comment">/* cleared */</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> on_begin_headers(nghttp2_session *session,</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                            <span class="keyword">const</span> nghttp2_frame *frame, <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;{</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s = NULL;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  (void)userp;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  data_s = nghttp2_session_get_stream_user_data(session, frame-&gt;hd.stream_id);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">if</span>(!data_s) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;on_begin_headers() was called\n&quot;</span>));</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">if</span>(frame-&gt;hd.type != NGHTTP2_HEADERS) {</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> || !<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf = <a class="code" href="http_8c.html#a8439073425968002da46c16791460fba">Curl_add_buffer_init</a>();</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  }</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;}</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">/* Decode HTTP status code.  Returns -1 if no valid status code was</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">   decoded. */</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> decode_status_code(<span class="keyword">const</span> uint8_t *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;{</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> != 3) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  res = 0;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 3; ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordtype">char</span> c = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span>(c &lt; &#39;0&#39; || c &gt; <span class="charliteral">&#39;9&#39;</span>) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    res *= 10;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    res += c - <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">/* frame-&gt;hd.type is either NGHTTP2_HEADERS or NGHTTP2_PUSH_PROMISE */</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> on_header(nghttp2_session *session, <span class="keyword">const</span> nghttp2_frame *frame,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                     <span class="keyword">const</span> uint8_t *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="keywordtype">size_t</span> namelen,</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                     <span class="keyword">const</span> uint8_t *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keywordtype">size_t</span> valuelen,</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                     uint8_t flags,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                     <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;{</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  int32_t stream_id = frame-&gt;hd.stream_id;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  (void)flags;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(stream_id); <span class="comment">/* should never be a zero stream ID here */</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="comment">/* get the stream from the hash based on Stream ID */</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  data_s = nghttp2_session_get_stream_user_data(session, stream_id);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">if</span>(!data_s)</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">/* Receiving a Stream ID not in the hash should not happen, this is an</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">       internal error more than anything else! */</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(data_s, <span class="stringliteral">&quot;Internal NULL stream! 5\n&quot;</span>);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">/* Store received PUSH_PROMISE headers to be used when the subsequent</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">     PUSH_PROMISE callback comes */</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">if</span>(frame-&gt;hd.type == NGHTTP2_PUSH_PROMISE) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordtype">char</span> *h;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_alloc = 10;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_alloc *</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                    <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">return</span> NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used = 0;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used ==</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_alloc) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordtype">char</span> **headp;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_alloc *= 2;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      headp = <a class="code" href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers,</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                               <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_alloc * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">if</span>(!headp) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers = NULL;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">return</span> NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      }</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers = headp;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    h = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s:%s&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">if</span>(h)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers[<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;push_headers_used++] = h;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted) {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">/* This is trailer fields. */</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">/* 4 is for &quot;: &quot; and &quot;\r\n&quot;. */</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    uint32_t <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = (uint32_t)(namelen + valuelen + 4);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;h2 trailer: %.*s: %.*s\n&quot;</span>, namelen, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, valuelen,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                 <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>));</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf, &amp;<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, <span class="keyword">sizeof</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>));</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf, <span class="stringliteral">&quot;: &quot;</span>, 2);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, valuelen);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf, <span class="stringliteral">&quot;\r\n\0&quot;</span>, 3);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  }</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordflow">if</span>(namelen == <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;:status&quot;</span>) - 1 &amp;&amp;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;     memcmp(<span class="stringliteral">&quot;:status&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen) == 0) {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">/* nghttp2 guarantees :status is received first and only once, and</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">       value is 3 digits status code, and decode_status_code always</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">       succeeds. */</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code = decode_status_code(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, valuelen);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code != -1);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <span class="stringliteral">&quot;HTTP/2 &quot;</span>, 7);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, valuelen);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">/* the space character after the status code is mandatory */</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <span class="stringliteral">&quot; \r\n&quot;</span>, 3);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="comment">/* if we receive data for another handle, wake that up */</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> != data_s)</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <a class="code" href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a>(data_s, 0, <a class="code" href="urldata_8h.html#aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4">EXPIRE_RUN_NOW</a>);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;h2 status: HTTP/2 %03d (easy %p)\n&quot;</span>,</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;status_code, data_s));</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="comment">/* nghttp2 guarantees that namelen &gt; 0, and :status was already</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">     received, and this is not pseudo-header field . */</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="comment">/* convert to a HTTP1-style header */</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <span class="stringliteral">&quot;: &quot;</span>, 2);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, valuelen);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="comment">/* if we receive data for another handle, wake that up */</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> != data_s)</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a>(data_s, 0, <a class="code" href="urldata_8h.html#aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4">EXPIRE_RUN_NOW</a>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;h2 header: %.*s: %.*s\n&quot;</span>, namelen, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, valuelen,</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;               <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>));</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keywordflow">return</span> 0; <span class="comment">/* 0 is successful */</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> data_source_read_callback(nghttp2_session *session,</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                                         int32_t stream_id,</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                                         uint8_t *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> length,</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                                         uint32_t *data_flags,</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                                         nghttp2_data_source *source,</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                                         <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;{</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *data_s;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = NULL;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keywordtype">size_t</span> nread;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  (void)source;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  (void)userp;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordflow">if</span>(stream_id) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">/* get the stream from the hash based on Stream ID, stream ID zero is for</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">       connection-oriented stuff */</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    data_s = nghttp2_session_get_stream_user_data(session, stream_id);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span>(!data_s)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="comment">/* Receiving a Stream ID not in the hash should not happen, this is an</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">         internal error more than anything else! */</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = data_s-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>)</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">return</span> NGHTTP2_ERR_CALLBACK_FAILURE;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_INVALID_ARGUMENT;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  nread = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len, length);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordflow">if</span>(nread &gt; 0) {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem, nread);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem += nread;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len -= nread;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">if</span>(data_s-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0f0f58db836aa9ead3a2fe24e0a3169f">infilesize</a> != -1)</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left -= nread;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  }</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left == 0)</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    *data_flags = NGHTTP2_DATA_FLAG_EOF;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nread == 0)</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">return</span> NGHTTP2_ERR_DEFERRED;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(data_s, <span class="stringliteral">&quot;data_source_read_callback: &quot;</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;               <span class="stringliteral">&quot;returns %zu bytes stream %u\n&quot;</span>,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;               nread, stream_id));</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keywordflow">return</span> nread;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;}</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor">#if defined(NGHTTP2_HAS_ERROR_CALLBACK) &amp;&amp;      \</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="preprocessor">  !defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> error_callback(nghttp2_session *session,</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">char</span> *msg,</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                          <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                          <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;{</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *)userp;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  (void)session;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2 error: %.*s\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, msg);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;}</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> populate_settings(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                              <span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>)</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;{</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  nghttp2_settings_entry *iv = <a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>-&gt;local_settings;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  iv[0].settings_id = NGHTTP2_SETTINGS_MAX_CONCURRENT_STREAMS;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  iv[0].value = 100;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  iv[1].settings_id = NGHTTP2_SETTINGS_INITIAL_WINDOW_SIZE;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  iv[1].value = HTTP2_HUGE_WINDOW_SIZE;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  iv[2].settings_id = NGHTTP2_SETTINGS_ENABLE_PUSH;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  iv[2].value = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae50ee3c1668aaed84ae0338046f4f737">multi</a>-&gt;<a class="code" href="struct_curl__multi.html#a131a1103a9be433eaad9733f9944eedc">push_cb</a> != NULL;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>-&gt;local_settings_num = 3;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#aa085257d64dd169d466fb80802114c9a">Curl_http2_done</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> premature)</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;{</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a> = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="comment">/* there might be allocated resources done before this got the &#39;h2&#39; pointer</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">     setup */</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;header_recvbuf) {</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;header_recvbuf);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;trailer_recvbuf);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="comment">/* if they weren&#39;t used and then freed before */</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordflow">for</span>(; <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used &gt; 0; --<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used) {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers[<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers_used - 1]);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;push_headers = NULL;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    }</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  }</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordflow">if</span>(!httpc-&gt;h2) <span class="comment">/* not HTTP/2 ? */</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.drain)</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    drained_transfer(<a class="code" href="structdata.html">data</a>, httpc);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordflow">if</span>(premature) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">/* RST_STREAM */</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span>(!nghttp2_submit_rst_stream(httpc-&gt;h2, NGHTTP2_FLAG_NONE,</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id, NGHTTP2_STREAM_CLOSED))</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      (void)nghttp2_session_send(httpc-&gt;h2);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id == httpc-&gt;pause_stream_id) {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;stopped the pause stream!\n&quot;</span>);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      httpc-&gt;pause_stream_id = 0;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    }</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  }</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="comment">/* -1 means unassigned and 0 means cleared */</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id &gt; 0) {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordtype">int</span> rv = nghttp2_session_set_stream_user_data(httpc-&gt;h2,</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                                                  <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id, 0);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordflow">if</span>(rv) {</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http/2: failed to clear user_data for stream %d!\n&quot;</span>,</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a>-&gt;stream_id = 0;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;}</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment"> * Initialize nghttp2 for a Curl connection</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#a5a58f0975d3aa18fff0aa1d7f4d6781e">Curl_http2_init</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;{</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.h2) {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    nghttp2_session_callbacks *callbacks;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.inbuf = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(H2_BUFSIZE);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.inbuf == NULL)</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = nghttp2_session_callbacks_new(&amp;callbacks);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Couldn&#39;t initialize nghttp2 callbacks!&quot;</span>);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>; <span class="comment">/* most likely at least */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">/* nghttp2_send_callback */</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    nghttp2_session_callbacks_set_send_callback(callbacks, send_callback);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="comment">/* nghttp2_on_frame_recv_callback */</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    nghttp2_session_callbacks_set_on_frame_recv_callback</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      (callbacks, on_frame_recv);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">/* nghttp2_on_data_chunk_recv_callback */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    nghttp2_session_callbacks_set_on_data_chunk_recv_callback</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      (callbacks, on_data_chunk_recv);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">/* nghttp2_on_stream_close_callback */</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    nghttp2_session_callbacks_set_on_stream_close_callback</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      (callbacks, on_stream_close);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">/* nghttp2_on_begin_headers_callback */</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    nghttp2_session_callbacks_set_on_begin_headers_callback</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      (callbacks, on_begin_headers);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">/* nghttp2_on_header_callback */</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    nghttp2_session_callbacks_set_on_header_callback(callbacks, on_header);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    nghttp2_session_callbacks_set_error_callback(callbacks, error_callback);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="comment">/* The nghttp2 session is not yet setup, do it */</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = nghttp2_session_client_new(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.h2, callbacks, conn);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    nghttp2_session_callbacks_del(callbacks);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Couldn&#39;t initialize nghttp2!&quot;</span>);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>; <span class="comment">/* most likely at least */</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  }</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;}</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment"> * Append headers to ask for a HTTP1.1 to HTTP2 upgrade.</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#a6e4353e22d54047ab6052b3a8fb49886">Curl_http2_request_upgrade</a>(<a class="code" href="struct_curl__send__buffer.html">Curl_send_buffer</a> *req,</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                    <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;{</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> binlen;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordtype">char</span> *base64;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordtype">size_t</span> blen;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_single_request.html">SingleRequest</a> *k = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  uint8_t *binsettings = conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.binsettings;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  populate_settings(conn, httpc);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="comment">/* this returns number of bytes it wrote */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  binlen = nghttp2_pack_settings_payload(binsettings, H2_BINSETTINGS_LEN,</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                                         httpc-&gt;local_settings,</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                         httpc-&gt;local_settings_num);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">if</span>(!binlen) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;nghttp2 unexpectedly failed on pack_settings_payload&quot;</span>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;req);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>.binlen = binlen;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="base64_8c.html#ac297f79b5b4e0198d361139720027dc8">Curl_base64url_encode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)binsettings, binlen,</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                                 &amp;base64, &amp;blen);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;req);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  }</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http_8c.html#a93b36c38666b0081c09b3638f4b2c8f2">Curl_add_bufferf</a>(&amp;req,</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                            <span class="stringliteral">&quot;Connection: Upgrade, HTTP2-Settings\r\n&quot;</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                            <span class="stringliteral">&quot;Upgrade: %s\r\n&quot;</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                            <span class="stringliteral">&quot;HTTP2-Settings: %s\r\n&quot;</span>,</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                            NGHTTP2_CLEARTEXT_PROTO_VERSION_ID, base64);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(base64);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  k-&gt;<a class="code" href="struct_single_request.html#aedc2a164dd5fddd6e7420472035424ef">upgr101</a> = <a class="code" href="urldata_8h.html#a7d475a6687b678c11cce8221797e46ddaa9c52d61737ee3b48ca077b1f408e8d8">UPGR101_REQUESTED</a>;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;}</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment"> * Returns nonzero if current HTTP/2 session should be closed.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> should_close_session(<span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *httpc)</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;{</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keywordflow">return</span> httpc-&gt;drain_total == 0 &amp;&amp; !nghttp2_session_want_read(httpc-&gt;h2) &amp;&amp;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    !nghttp2_session_want_write(httpc-&gt;h2);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;}</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment"> * h2_process_pending_input() processes pending input left in</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment"> * httpc-&gt;inbuf.  Then, call h2_session_send() to send pending data.</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"> * This function returns 0 if it succeeds, or -1 and error code will</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment"> * be assigned to *err.</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> h2_process_pending_input(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                                    <span class="keyword">struct</span> <a class="code" href="structhttp__conn.html">http_conn</a> *httpc,</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                                    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;{</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordtype">char</span> *inbuf;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> rv;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  nread = httpc-&gt;inbuflen - httpc-&gt;nread_inbuf;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  inbuf = httpc-&gt;inbuf + httpc-&gt;nread_inbuf;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  rv = nghttp2_session_mem_recv(httpc-&gt;h2, (<span class="keyword">const</span> uint8_t *)inbuf, nread);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">if</span>(rv &lt; 0) {</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;          <span class="stringliteral">&quot;h2_process_pending_input: nghttp2_session_mem_recv() returned &quot;</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          <span class="stringliteral">&quot;%zd:%s\n&quot;</span>, rv, nghttp2_strerror((<span class="keywordtype">int</span>)rv));</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  }</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keywordflow">if</span>(nread == rv) {</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                 <span class="stringliteral">&quot;h2_process_pending_input: All data in connection buffer &quot;</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                 <span class="stringliteral">&quot;processed\n&quot;</span>));</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    httpc-&gt;inbuflen = 0;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    httpc-&gt;nread_inbuf = 0;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  }</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    httpc-&gt;nread_inbuf += rv;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                 <span class="stringliteral">&quot;h2_process_pending_input: %zu bytes left in connection &quot;</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                 <span class="stringliteral">&quot;buffer\n&quot;</span>,</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                 httpc-&gt;inbuflen - httpc-&gt;nread_inbuf));</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  rv = h2_session_send(<a class="code" href="structdata.html">data</a>, httpc-&gt;h2);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  }</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                 <span class="stringliteral">&quot;h2_process_pending_input: nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">if</span>(httpc-&gt;error_code)</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <span class="comment">/* not an error per se, but should still close the connection */</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(conn, <span class="stringliteral">&quot;GOAWAY received&quot;</span>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    }</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;}</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> * Called from transfer.c:done_sending when we stop uploading.</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#acc13c28304b7e874ac61ea2816c5a2ae">Curl_http2_done_sending</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;{</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">if</span>((conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> == &amp;Curl_handler_http2_ssl) ||</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;     (conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> == &amp;Curl_handler_http2)) {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">/* make sure this is only attempted for HTTP/2 transfers */</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left) {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="comment">/* If the stream still thinks there&#39;s data left to upload. */</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      nghttp2_session *h2 = httpc-&gt;h2;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left = 0; <span class="comment">/* DONE! */</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <span class="comment">/* resume sending here to trigger the callback to get called again so</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">         that it can signal EOF to nghttp2 */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      (void)nghttp2_session_resume_data(h2, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      (void)h2_process_pending_input(conn, httpc, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    }</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;}</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> http2_handle_stream_close(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                         <span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                                         <span class="keyword">struct</span> <a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;{</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="keywordtype">char</span> *trailer_pos, *trailer_end;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keywordflow">if</span>(httpc-&gt;pause_stream_id == <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id) {</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    httpc-&gt;pause_stream_id = 0;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  drained_transfer(<a class="code" href="structdata.html">data</a>, httpc);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keywordflow">if</span>(httpc-&gt;pause_stream_id == 0) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">if</span>(h2_process_pending_input(conn, httpc, err) != 0) {</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    }</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="structdata.html">data</a>-&gt;state.drain == 0);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">/* Reset to FALSE to prevent infinite loop in readwrite_data function. */</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordflow">if</span>(httpc-&gt;error_code == NGHTTP2_REFUSED_STREAM) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;REFUSED_STREAM (%d), try again on a new connection!\n&quot;</span>,</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(conn, <span class="stringliteral">&quot;REFUSED_STREAM&quot;</span>); <span class="comment">/* don&#39;t use this anymore */</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.refused_stream = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>; <span class="comment">/* trigger Curl_retry_request() later */</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(httpc-&gt;error_code != NGHTTP2_NO_ERROR) {</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;HTTP/2 stream %d was not closed cleanly: %s (err %u)&quot;</span>,</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;          <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id, Curl_http2_strerror(httpc-&gt;error_code),</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;          httpc-&gt;error_code);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3fc9cf5326ee71f9c205ebfd42f221f9">CURLE_HTTP2_STREAM</a>;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted) {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;HTTP/2 stream %d was closed cleanly, but before getting &quot;</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;          <span class="stringliteral">&quot; all response header fields, treated as error&quot;</span>,</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;          <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3fc9cf5326ee71f9c205ebfd42f221f9">CURLE_HTTP2_STREAM</a>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf &amp;&amp; <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf-&gt;buffer) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    trailer_pos = <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf-&gt;buffer;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    trailer_end = trailer_pos + <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;trailer_recvbuf-&gt;size_used;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">for</span>(; trailer_pos &lt; trailer_end;) {</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      uint32_t <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, trailer_pos, <span class="keyword">sizeof</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>));</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      trailer_pos += <span class="keyword">sizeof</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(conn, <a class="code" href="sendf_8h.html#a5b56d764844bff170a6721d5e33dca34">CLIENTWRITE_HEADER</a>, trailer_pos, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>);</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        *err = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      trailer_pos += <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> + 1;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;close_handled = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv returns 0, http2_handle_stream_close\n&quot;</span>));</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;}</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment"> * h2_pri_spec() fills in the pri_spec struct, used by nghttp2 to send weight</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment"> * and dependency to the peer. It also stores the updated values in the state</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment"> * struct.</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> h2_pri_spec(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                        nghttp2_priority_spec *pri_spec)</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;{</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *depstream = (<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on?</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                            <a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on-&gt;req.protop:NULL);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  int32_t depstream_id = depstream? depstream-&gt;stream_id:0;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  nghttp2_priority_spec_init(pri_spec, depstream_id, <a class="code" href="structdata.html">data</a>-&gt;set.stream_weight,</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                             <a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_e);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.stream_weight = <a class="code" href="structdata.html">data</a>-&gt;set.stream_weight;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.stream_depends_e = <a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_e;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.stream_depends_on = <a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;}</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment"> * h2_session_send() checks if there&#39;s been an update in the priority /</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment"> * dependency settings and if so it submits a PRIORITY frame with the updated</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment"> * info.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> h2_session_send(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                           nghttp2_session *h2)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;{</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;set.stream_weight != <a class="code" href="structdata.html">data</a>-&gt;state.stream_weight) ||</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;     (<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_e != <a class="code" href="structdata.html">data</a>-&gt;state.stream_depends_e) ||</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;     (<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on != <a class="code" href="structdata.html">data</a>-&gt;state.stream_depends_on) ) {</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="comment">/* send new weight and/or dependency */</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    nghttp2_priority_spec pri_spec;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    h2_pri_spec(<a class="code" href="structdata.html">data</a>, &amp;pri_spec);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Queuing PRIORITY on stream %u (easy %p)\n&quot;</span>,</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id, <a class="code" href="structdata.html">data</a>));</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    rv = nghttp2_submit_priority(h2, NGHTTP2_FLAG_NONE, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id,</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                                 &amp;pri_spec);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span>(rv)</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  }</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="keywordflow">return</span> nghttp2_session_send(h2);</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;}</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> http2_recv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                          <span class="keywordtype">char</span> *mem, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;{</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> rv;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  (void)sockindex; <span class="comment">/* we always do HTTP2 on sockindex 0 */</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                 <span class="stringliteral">&quot;http2_recv: nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  }</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">/* Nullify here because we call nghttp2_session_send() and they</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">     might refer to the old buffer. */</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem = NULL;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len = 0;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">   * At this point &#39;stream&#39; is just in the Curl_easy the connection</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">   * identifies as its owner at this time.</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;bodystarted &amp;&amp;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;     <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf &lt; <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf-&gt;size_used) {</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="comment">/* If there is body data pending for this stream to return, do that */</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordtype">size_t</span> left =</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf-&gt;size_used - <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordtype">size_t</span> ncopy = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, left);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(mem, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf-&gt;buffer + <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf,</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;           ncopy);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;nread_header_recvbuf += ncopy;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: Got %d bytes from header_recvbuf\n&quot;</span>,</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                 (<span class="keywordtype">int</span>)ncopy));</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">return</span> ncopy;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: easy %p (stream %u)\n&quot;</span>,</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;               <a class="code" href="structdata.html">data</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;state.drain) &amp;&amp; <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: DRAIN %zu bytes stream %u!! (%p =&gt; %p)\n&quot;</span>,</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id,</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem, mem));</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span>(mem != <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="comment">/* if we didn&#39;t get the same buffer this time, we must move the data to</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">         the beginning */</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      memmove(mem, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen);</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem = mem;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    }</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">if</span>(httpc-&gt;pause_stream_id == <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id &amp;&amp; !<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata) {</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      <span class="comment">/* We have paused nghttp2, but we have no pause data (see</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">         on_data_chunk_recv). */</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      httpc-&gt;pause_stream_id = 0;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <span class="keywordflow">if</span>(h2_process_pending_input(conn, httpc, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) != 0) {</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        *err = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    }</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata) {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(httpc-&gt;pause_stream_id == <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    nread = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pauselen);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(mem, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata, nread);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata += nread;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pauselen -= nread;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;%zd data bytes written\n&quot;</span>, nread);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pauselen == 0) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unpaused by stream %u\n&quot;</span>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(httpc-&gt;pause_stream_id == <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      httpc-&gt;pause_stream_id = 0;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pausedata = NULL;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;pauselen = 0;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="comment">/* When NGHTTP2_ERR_PAUSE is returned from</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">         data_source_read_callback, we might not process DATA frame</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">         fully.  Calling nghttp2_session_mem_recv() again will</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">         continue to process DATA frame, but if there is no incoming</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">         frames, then we have to call it again with 0-length data.</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">         Without this, on_stream_close callback will not be called,</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">         and stream could be hanged. */</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">if</span>(h2_process_pending_input(conn, httpc, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) != 0) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        *err = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    }</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: returns unpaused %zd bytes on stream %u\n&quot;</span>,</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                 nread, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keywordflow">return</span> nread;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  }</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(httpc-&gt;pause_stream_id) {</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="comment">/* If a stream paused nghttp2_session_mem_recv previously, and has</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">       not processed all data, it still refers to the buffer in</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">       nghttp2_session.  If we call nghttp2_session_mem_recv(), we may</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">       overwrite that buffer.  To avoid that situation, just return</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">       here with CURLE_AGAIN.  This could be busy loop since data in</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">       socket is not read.  But it seems that usually streams are</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">       notified with its drain property, and socket is read again</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">       quickly. */</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;stream %x is paused, pause id: %x\n&quot;</span>,</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id, httpc-&gt;pause_stream_id));</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  }</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordtype">char</span> *inbuf;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="comment">/* remember where to store incoming data for this stream and how big the</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">       buffer is */</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;mem = mem;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;len = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen = 0;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">if</span>(httpc-&gt;inbuflen == 0) {</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      nread = ((<a class="code" href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a> *)httpc-&gt;recv_underlying)(</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;          conn, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, httpc-&gt;inbuf, H2_BUFSIZE, &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keywordflow">if</span>(nread == -1) {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>)</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed receiving HTTP2 data&quot;</span>);</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed)</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <span class="comment">/* received when the stream was already closed! */</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          <span class="keywordflow">return</span> http2_handle_stream_close(conn, <a class="code" href="structdata.html">data</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>, err);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        *err = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <span class="keywordflow">if</span>(nread == 0) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;end of stream\n&quot;</span>));</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      }</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nread=%zd\n&quot;</span>, nread));</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      httpc-&gt;inbuflen = nread;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      inbuf = httpc-&gt;inbuf;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      nread = httpc-&gt;inbuflen - httpc-&gt;nread_inbuf;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      inbuf = httpc-&gt;inbuf + httpc-&gt;nread_inbuf;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Use data left in connection buffer, nread=%zd\n&quot;</span>,</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                   nread));</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    }</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    rv = nghttp2_session_mem_recv(httpc-&gt;h2, (<span class="keyword">const</span> uint8_t *)inbuf, nread);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">if</span>(nghttp2_is_fatal((<span class="keywordtype">int</span>)rv)) {</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_mem_recv() returned %zd:%s\n&quot;</span>,</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            rv, nghttp2_strerror((<span class="keywordtype">int</span>)rv));</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_mem_recv() returns %zd\n&quot;</span>, rv));</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordflow">if</span>(nread == rv) {</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;All data in connection buffer processed\n&quot;</span>));</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      httpc-&gt;inbuflen = 0;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      httpc-&gt;nread_inbuf = 0;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      httpc-&gt;nread_inbuf += rv;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;%zu bytes left in connection buffer\n&quot;</span>,</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                   httpc-&gt;inbuflen - httpc-&gt;nread_inbuf));</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    }</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="comment">/* Always send pending frames in nghttp2 session, because</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">       nghttp2_session_mem_recv() may queue new frame */</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    rv = h2_session_send(<a class="code" href="structdata.html">data</a>, httpc-&gt;h2);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    }</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  }</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen) {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> retlen = <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv: returns %zd for stream %u\n&quot;</span>,</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                 retlen, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;memlen = 0;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keywordflow">if</span>(httpc-&gt;pause_stream_id == <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id) {</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="comment">/* data for this stream is returned now, but this stream caused a pause</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">         already so we need it called again asap */</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Data returned for PAUSED stream %u\n&quot;</span>,</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                   <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    }</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed) {</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      drained_transfer(<a class="code" href="structdata.html">data</a>, httpc);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    }</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">return</span> retlen;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  }</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="comment">/* If stream is closed, return 0 to signal the http routine to close</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">     the connection */</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">return</span> http2_handle_stream_close(conn, <a class="code" href="structdata.html">data</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>, err);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  }</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http2_recv returns AGAIN for stream %u\n&quot;</span>,</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;               <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;}</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment">/* Index where :authority header field will appear in request header</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">   field list. */</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="preprocessor">#define AUTHORITY_DST_IDX 3</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="preprocessor">#define HEADER_OVERFLOW(x) \</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="preprocessor">  (x.namelen &gt; (uint16_t)-1 || x.valuelen &gt; (uint16_t)-1 - x.namelen)</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment"> * Check header memory for the token &quot;trailers&quot;.</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment"> * Parse the tokens as separated by comma and surrounded by whitespace.</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment"> * Returns TRUE if found or FALSE if not.</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> contains_trailers(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;{</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *end = <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> + <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordflow">for</span>(; <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> != end &amp;&amp; (*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39; &#39;</span> || *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39;\t&#39;</span>); ++<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>)</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      ;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == end || (<span class="keywordtype">size_t</span>)(end - <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>) &lt; <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;trailers&quot;</span>) - 1)</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;trailers&quot;</span>, <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;trailers&quot;</span>) - 1)) {</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> += <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;trailers&quot;</span>) - 1;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      <span class="keywordflow">for</span>(; <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> != end &amp;&amp; (*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39; &#39;</span> || *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39;\t&#39;</span>); ++<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        ;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == end || *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39;,&#39;</span>)</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="comment">/* skip to next token */</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">for</span>(; <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> != end &amp;&amp; *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> != <span class="charliteral">&#39;,&#39;</span>; ++<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>)</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      ;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == end)</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    ++<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  }</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="comment">/* Send header to server */</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  HEADERINST_FORWARD,</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">/* Don&#39;t send header to server */</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  HEADERINST_IGNORE,</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="comment">/* Discard header, and replace it with &quot;te: trailers&quot; */</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  HEADERINST_TE_TRAILERS</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;} header_instruction;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">/* Decides how to treat given header field. */</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="keyword">static</span> header_instruction inspect_header(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="keywordtype">size_t</span> namelen,</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keywordtype">size_t</span> valuelen) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordflow">switch</span>(namelen) {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;te&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen))</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <span class="keywordflow">return</span> HEADERINST_FORWARD;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keywordflow">return</span> contains_trailers(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, valuelen) ?</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;           HEADERINST_TE_TRAILERS : HEADERINST_IGNORE;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordflow">case</span> 7:</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;upgrade&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen) ?</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;           HEADERINST_IGNORE : HEADERINST_FORWARD;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordflow">case</span> 10:</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;connection&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen) ||</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;keep-alive&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen)) ?</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;           HEADERINST_IGNORE : HEADERINST_FORWARD;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordflow">case</span> 16:</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;proxy-connection&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen) ?</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;           HEADERINST_IGNORE : HEADERINST_FORWARD;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="keywordflow">case</span> 17:</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;transfer-encoding&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, namelen) ?</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;           HEADERINST_IGNORE : HEADERINST_FORWARD;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">return</span> HEADERINST_FORWARD;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  }</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;}</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> http2_send(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">void</span> *mem, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;{</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">   * BIG TODO: Currently, we send request in this function, but this</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">   * function is also used to send request body. It would be nice to</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">   * add dedicated function for request.</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  nghttp2_nv *nva = NULL;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="keywordtype">size_t</span> nheader;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keywordtype">size_t</span> authority_idx;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="keywordtype">char</span> *hdbuf = (<span class="keywordtype">char</span> *)mem;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="keywordtype">char</span> *end, *line_end;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  nghttp2_data_provider data_prd;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  int32_t stream_id;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  nghttp2_session *h2 = httpc-&gt;h2;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  nghttp2_priority_spec pri_spec;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  (void)sockindex;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send len=%zu\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>));</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id != -1) {</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;close_handled) {</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;stream %d closed\n&quot;</span>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3fc9cf5326ee71f9c205ebfd42f221f9">CURLE_HTTP2_STREAM</a>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    }</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;closed) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">return</span> http2_handle_stream_close(conn, conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>, err);</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    }</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="comment">/* If stream_id != -1, we have dispatched request HEADERS, and now</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">       are going to send or sending request body in DATA frame */</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem = mem;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    nghttp2_session_resume_data(h2, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    rv = h2_session_send(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, h2);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keywordflow">if</span>(nghttp2_is_fatal(rv)) {</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    }</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="comment">/* Nullify here because we call nghttp2_session_send() and they</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">       might refer to the old buffer. */</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem = NULL;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len = 0;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send: nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    }</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left) {</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="comment">/* we are sure that we have more data to send here.  Calling the</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">         following API will make nghttp2_session_want_write() return</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">         nonzero if remote window allows it, which then libcurl checks</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">         socket is writable or not.  See http2_perform_getsock(). */</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      nghttp2_session_resume_data(h2, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    }</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send returns %zu for stream %u\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                 <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id));</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;  }</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="comment">/* Calculate number of headers contained in [mem, mem + len) */</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="comment">/* Here, we assume the curl http code generate *correct* HTTP header</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">     field block */</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  nheader = 0;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>; ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">if</span>(hdbuf[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] == <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; hdbuf[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> - 1] == <span class="charliteral">&#39;\r&#39;</span>) {</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      ++nheader;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    }</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  }</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="keywordflow">if</span>(nheader &lt; 2)</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="comment">/* We counted additional 2 \r\n in the first and last line. We need 3</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     new headers: :method, :path and :scheme. Therefore we need one</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     more space. */</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  nheader += 1;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  nva = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<span class="keyword">sizeof</span>(nghttp2_nv) * nheader);</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="keywordflow">if</span>(nva == NULL) {</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  }</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="comment">/* Extract :method, :path from request line</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">     We do line endings with CRLF so checking for CR is enough */</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  line_end = memchr(hdbuf, <span class="charliteral">&#39;\r&#39;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span>(!line_end)</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="comment">/* Method does not contain spaces */</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  end = memchr(hdbuf, <span class="charliteral">&#39; &#39;</span>, line_end - hdbuf);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="keywordflow">if</span>(!end || end == hdbuf)</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  nva[0].name = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;:method&quot;</span>;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  nva[0].namelen = strlen((<span class="keywordtype">char</span> *)nva[0].<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  nva[0].value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)hdbuf;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  nva[0].valuelen = (size_t)(end - hdbuf);</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  nva[0].flags = NGHTTP2_NV_FLAG_NONE;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keywordflow">if</span>(HEADER_OVERFLOW(nva[0])) {</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed sending HTTP request: Header overflow&quot;</span>);</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  }</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  hdbuf = end + 1;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="comment">/* Path may contain spaces so scan backwards */</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  end = NULL;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = (<span class="keywordtype">size_t</span>)(line_end - hdbuf); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>; --<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span>(hdbuf[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> - 1] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      end = &amp;hdbuf[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> - 1];</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    }</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  }</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="keywordflow">if</span>(!end || end == hdbuf)</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  nva[1].name = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;:path&quot;</span>;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  nva[1].namelen = strlen((<span class="keywordtype">char</span> *)nva[1].<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  nva[1].value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)hdbuf;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  nva[1].valuelen = (size_t)(end - hdbuf);</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  nva[1].flags = NGHTTP2_NV_FLAG_NONE;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <span class="keywordflow">if</span>(HEADER_OVERFLOW(nva[1])) {</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed sending HTTP request: Header overflow&quot;</span>);</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  }</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  nva[2].name = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;:scheme&quot;</span>;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  nva[2].namelen = strlen((<span class="keywordtype">char</span> *)nva[2].<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a>-&gt;<a class="code" href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">flags</a> &amp; <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a>)</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    nva[2].value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;https&quot;</span>;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    nva[2].value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;http&quot;</span>;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  nva[2].valuelen = strlen((<span class="keywordtype">char</span> *)nva[2].<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  nva[2].flags = NGHTTP2_NV_FLAG_NONE;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">if</span>(HEADER_OVERFLOW(nva[2])) {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed sending HTTP request: Header overflow&quot;</span>);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  authority_idx = 0;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 3;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; nheader) {</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordtype">size_t</span> hlen;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    hdbuf = line_end + 2;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="comment">/* check for next CR, but only within the piece of data left in the given</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">       buffer */</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    line_end = memchr(hdbuf, <span class="charliteral">&#39;\r&#39;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - (hdbuf - (<span class="keywordtype">char</span> *)mem));</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keywordflow">if</span>(!line_end || (line_end == hdbuf))</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="comment">/* header continuation lines are not supported */</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="keywordflow">if</span>(*hdbuf == <span class="charliteral">&#39; &#39;</span> || *hdbuf == <span class="charliteral">&#39;\t&#39;</span>)</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">for</span>(end = hdbuf; end &lt; line_end &amp;&amp; *end != <span class="charliteral">&#39;:&#39;</span>; ++end)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      ;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">if</span>(end == hdbuf || end == line_end)</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    hlen = end - hdbuf;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordflow">if</span>(hlen == 4 &amp;&amp; <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;host&quot;</span>, hdbuf, 4)) {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      authority_idx = <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;:authority&quot;</span>;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].namelen = strlen((<span class="keywordtype">char</span> *)nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    }</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)hdbuf;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].namelen = (size_t)(end - hdbuf);</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    }</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    hdbuf = end + 1;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">while</span>(*hdbuf == <span class="charliteral">&#39; &#39;</span> || *hdbuf == <span class="charliteral">&#39;\t&#39;</span>)</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      ++hdbuf;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    end = line_end;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keywordflow">switch</span>(inspect_header((<span class="keyword">const</span> <span class="keywordtype">char</span> *)nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name, nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].namelen, hdbuf,</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                          end - hdbuf)) {</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">case</span> HEADERINST_IGNORE:</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="comment">/* skip header fields prohibited by HTTP/2 specification. */</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      --nheader;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">case</span> HEADERINST_TE_TRAILERS:</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value = (uint8_t*)<span class="stringliteral">&quot;trailers&quot;</span>;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].valuelen = <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;trailers&quot;</span>) - 1;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)hdbuf;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].valuelen = (size_t)(end - hdbuf);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    }</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].flags = NGHTTP2_NV_FLAG_NONE;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordflow">if</span>(HEADER_OVERFLOW(nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>])) {</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed sending HTTP request: Header overflow&quot;</span>);</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    }</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  }</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <span class="comment">/* :authority must come before non-pseudo header fields */</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <span class="keywordflow">if</span>(authority_idx != 0 &amp;&amp; authority_idx != AUTHORITY_DST_IDX) {</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    nghttp2_nv authority = nva[authority_idx];</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = authority_idx; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt; AUTHORITY_DST_IDX; --<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> - 1];</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    }</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = authority;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <span class="comment">/* Warn stream may be rejected if cumulative length of headers is too large.</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">     It appears nghttp2 will not send a header frame larger than 64KB. */</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="preprocessor">#define MAX_ACC 60000  </span><span class="comment">/* &lt;64KB to account for some overhead */</span><span class="preprocessor"></span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  {</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <span class="keywordtype">size_t</span> acc = 0;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; nheader; ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      acc += nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].namelen + nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].valuelen;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;h2 header: %.*s:%.*s\n&quot;</span>,</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                   nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].namelen, nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name,</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                   nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].valuelen, nva[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value));</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    }</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span>(acc &gt; MAX_ACC) {</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send: Warning: The cumulative length of all &quot;</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            <span class="stringliteral">&quot;headers exceeds %zu bytes and that could cause the &quot;</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            <span class="stringliteral">&quot;stream to be rejected.\n&quot;</span>, MAX_ACC);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  }</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  h2_pri_spec(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, &amp;pri_spec);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <span class="keywordflow">switch</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#acea22e26cd3f89feab66b25fc9fe9ffe">httpreq</a>) {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8aae19a0f63b68ec93cabbd9f3074fb496">HTTPREQ_POST</a>:</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8ae11eeb30f15276332563390b730fd389">HTTPREQ_POST_FORM</a>:</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8a34d2478b945364d0d1bc6cb5f2845f71">HTTPREQ_POST_MIME</a>:</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8a4b328e0aa83f04505b21057059a9715f">HTTPREQ_PUT</a>:</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0f0f58db836aa9ead3a2fe24e0a3169f">infilesize</a> != -1)</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0f0f58db836aa9ead3a2fe24e0a3169f">infilesize</a>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="comment">/* data sending without specifying the data amount up front */</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left = -1; <span class="comment">/* unknown, but not zero */</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    data_prd.read_callback = data_source_read_callback;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    data_prd.source.ptr = NULL;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    stream_id = nghttp2_submit_request(h2, &amp;pri_spec, nva, nheader,</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                                       &amp;data_prd, conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>);</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    stream_id = nghttp2_submit_request(h2, &amp;pri_spec, nva, nheader,</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                                       NULL, conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>);</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  }</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(nva);</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordflow">if</span>(stream_id &lt; 0) {</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send() send error\n&quot;</span>));</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  }</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Using Stream ID: %x (easy handle %p)\n&quot;</span>,</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        stream_id, (<span class="keywordtype">void</span> *)conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>);</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id = stream_id;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="comment">/* this does not call h2_session_send() since there can not have been any</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">   * priority upodate since the nghttp2_submit_request() call above */</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  rv = nghttp2_session_send(h2);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  }</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;http2_send: nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  }</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id != -1) {</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="comment">/* If whole HEADERS frame was sent off to the underlying socket,</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">       the nghttp2 library calls data_source_read_callback. But only</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">       it found that no data available, so it deferred the DATA</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">       transmission. Which means that nghttp2_session_want_write()</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment">       returns 0 on http2_perform_getsock(), which results that no</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">       writable socket check is performed. To workaround this, we</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">       issue nghttp2_session_resume_data() here to bring back DATA</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">       transmission from deferred state. */</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    nghttp2_session_resume_data(h2, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  }</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>:</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(nva);</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;}</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#aad8497d84887a3deea025eb5c06cc5f9">Curl_http2_setup</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;{</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id = -1;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf) {</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf = <a class="code" href="http_8c.html#a8439073425968002da46c16791460fba">Curl_add_buffer_init</a>();</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf)</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;  }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  <span class="keywordflow">if</span>((conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> == &amp;Curl_handler_http2_ssl) ||</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;     (conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> == &amp;Curl_handler_http2))</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>; <span class="comment">/* already done */</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a>-&gt;<a class="code" href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">flags</a> &amp; <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a>)</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> = &amp;Curl_handler_http2_ssl;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> = &amp;Curl_handler_http2;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http2_8h.html#a5a58f0975d3aa18fff0aa1d7f4d6781e">Curl_http2_init</a>(conn);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <a class="code" href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a>(&amp;<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;header_recvbuf);</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  }</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Using HTTP2, server supports multi-use\n&quot;</span>);</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_left = 0;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_mem = NULL;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;upload_len = 0;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  httpc-&gt;inbuflen = 0;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  httpc-&gt;nread_inbuf = 0;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  httpc-&gt;pause_stream_id = 0;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  httpc-&gt;drain_total = 0;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a72ceb38665fe6374e78ebb8ca8d5e33a">multiplex</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* at least potentially multiplexed */</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a8c6daf7fa40e95c75eac915b7496a32a">httpversion</a> = 20;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a2bb9cb7096c4799e15ed1b449c5c7f1b">bundle</a>-&gt;<a class="code" href="structconnectbundle.html#a22977226b49d058b284fe58643165d8b">multiuse</a> = <a class="code" href="conncache_8h.html#ac54a8f8827585a80d5bd688c05e2c6ad">BUNDLE_MULTIPLEX</a>;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Connection state changed (HTTP/2 confirmed)\n&quot;</span>);</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <a class="code" href="multi_8c.html#a72515384372577e4134d210261290c09">Curl_multi_connchanged</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae50ee3c1668aaed84ae0338046f4f737">multi</a>);</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;}</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#a2c3310e8f1eb576e38f798fb9dd2b951">Curl_http2_switched</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                             <span class="keyword">const</span> <span class="keywordtype">char</span> *mem, <span class="keywordtype">size_t</span> nread)</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;{</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  <span class="keywordtype">int</span> rv;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nproc;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_h_t_t_p.html">HTTP</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http2_8h.html#aad8497d84887a3deea025eb5c06cc5f9">Curl_http2_setup</a>(conn);</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;  httpc-&gt;recv_underlying = conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  httpc-&gt;send_underlying = conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>] = http2_recv;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>] = http2_send;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#aedc2a164dd5fddd6e7420472035424ef">upgr101</a> == <a class="code" href="urldata_8h.html#a7d475a6687b678c11cce8221797e46dda5438320c9e5960ae04acfd8d213faa57">UPGR101_RECEIVED</a>) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="comment">/* stream 1 is opened implicitly on upgrade */</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id = 1;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="comment">/* queue SETTINGS frame (again) */</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    rv = nghttp2_session_upgrade(httpc-&gt;h2, httpc-&gt;binsettings,</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                                 httpc-&gt;binlen, NULL);</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_upgrade() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            nghttp2_strerror(rv), rv);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    }</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    rv = nghttp2_session_set_stream_user_data(httpc-&gt;h2,</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                                              <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id,</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                                              <a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keywordflow">if</span>(rv) {</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;http/2: failed to set user_data for stream %d!\n&quot;</span>,</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0);</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    }</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    populate_settings(conn, httpc);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="comment">/* stream ID is unknown at this point */</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>-&gt;stream_id = -1;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    rv = nghttp2_submit_settings(httpc-&gt;h2, NGHTTP2_FLAG_NONE,</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                                 httpc-&gt;local_settings,</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                                 httpc-&gt;local_settings_num);</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_submit_settings() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            nghttp2_strerror(rv), rv);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    }</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  }</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="preprocessor">#ifdef NGHTTP2_HAS_SET_LOCAL_WINDOW_SIZE</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  rv = nghttp2_session_set_local_window_size(httpc-&gt;h2, NGHTTP2_FLAG_NONE, 0,</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                                             HTTP2_HUGE_WINDOW_SIZE);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_set_local_window_size() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;          nghttp2_strerror(rv), rv);</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <span class="comment">/* we are going to copy mem to httpc-&gt;inbuf.  This is required since</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="comment">     mem is part of buffer pointed by stream-&gt;mem, and callbacks</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="comment">     called by nghttp2_session_mem_recv() will write stream specific</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="comment">     data into stream-&gt;mem, overwriting data already there. */</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  <span class="keywordflow">if</span>(H2_BUFSIZE &lt; nread) {</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;connection buffer size is too small to store data following &quot;</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                <span class="stringliteral">&quot;HTTP Upgrade response header: buflen=%zu, datalen=%zu&quot;</span>,</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;          H2_BUFSIZE, nread);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Copying HTTP/2 data in stream buffer to connection buffer&quot;</span></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                    <span class="stringliteral">&quot; after upgrade: len=%zu\n&quot;</span>,</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        nread);</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="keywordflow">if</span>(nread)</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(httpc-&gt;inbuf, mem, nread);</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  httpc-&gt;inbuflen = nread;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  nproc = nghttp2_session_mem_recv(httpc-&gt;h2, (<span class="keyword">const</span> uint8_t *)httpc-&gt;inbuf,</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                                   httpc-&gt;inbuflen);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="keywordflow">if</span>(nghttp2_is_fatal((<span class="keywordtype">int</span>)nproc)) {</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_mem_recv() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;          nghttp2_strerror((<span class="keywordtype">int</span>)nproc), (<span class="keywordtype">int</span>)nproc);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  }</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_mem_recv() returns %zd\n&quot;</span>, nproc));</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)nread == nproc) {</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    httpc-&gt;inbuflen = 0;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    httpc-&gt;nread_inbuf = 0;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  }</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    httpc-&gt;nread_inbuf += nproc;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  }</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="comment">/* Try to send some frames since we may read SETTINGS already. */</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  rv = h2_session_send(<a class="code" href="structdata.html">data</a>, httpc-&gt;h2);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="keywordflow">if</span>(rv != 0) {</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;nghttp2_session_send() failed: %s(%d)&quot;</span>,</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          nghttp2_strerror(rv), rv);</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  }</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="keywordflow">if</span>(should_close_session(httpc)) {</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    H2BUGF(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                 <span class="stringliteral">&quot;nghttp2_session_send(): nothing to do in this session\n&quot;</span>));</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a>;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;}</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="http2_8h.html#abb49749220f69b7a4274d49c6b1f59c1">Curl_http2_add_child</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *parent,</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                              <span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *child,</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                              <span class="keywordtype">bool</span> exclusive)</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;{</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="keywordflow">if</span>(parent) {</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a> **tail;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a> *dep = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a>));</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="keywordflow">if</span>(!dep)</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    dep-&gt;<a class="code" href="struct_curl__http2__dep.html#aaa987cfaa08612a15ae5a43f635fd19b">data</a> = child;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="keywordflow">if</span>(parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a> &amp;&amp; exclusive) {</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <span class="keyword">struct </span><a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a> *node = parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a>;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="keywordflow">while</span>(node) {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        node-&gt;<a class="code" href="struct_curl__http2__dep.html#aaa987cfaa08612a15ae5a43f635fd19b">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a3fcdcd68ee5b73de16f05af7dd7a8b05">stream_depends_on</a> = child;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        node = node-&gt;<a class="code" href="struct_curl__http2__dep.html#a9528e1a0cd8788c60180b3fe886ce36e">next</a>;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      }</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      tail = &amp;child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a>;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">while</span>(*tail)</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        tail = &amp;(*tail)-&gt;<a class="code" href="struct_curl__http2__dep.html#a9528e1a0cd8788c60180b3fe886ce36e">next</a>;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(!*tail);</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      *tail = parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a>;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a> = 0;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    }</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    tail = &amp;parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a>;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="keywordflow">while</span>(*tail) {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      (*tail)-&gt;<a class="code" href="struct_curl__http2__dep.html#aaa987cfaa08612a15ae5a43f635fd19b">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a6f9205a0db6b068d49e548a9a65c212d">stream_depends_e</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      tail = &amp;(*tail)-&gt;<a class="code" href="struct_curl__http2__dep.html#a9528e1a0cd8788c60180b3fe886ce36e">next</a>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(!*tail);</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    *tail = dep;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  }</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a3fcdcd68ee5b73de16f05af7dd7a8b05">stream_depends_on</a> = parent;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a6f9205a0db6b068d49e548a9a65c212d">stream_depends_e</a> = exclusive;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;}</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#a8b6e1fdb20f29a378ded56ad2f05c133">Curl_http2_remove_child</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *parent, <span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *child)</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;{</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a> *<a class="code" href="unit1308_8c.html#a2f29226077aaea62db6864d9b291eadc">last</a> = 0;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__http2__dep.html">Curl_http2_dep</a> *<a class="code" href="structdata.html">data</a> = parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a>;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a3fcdcd68ee5b73de16f05af7dd7a8b05">stream_depends_on</a> == parent);</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="structdata.html">data</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;data != child) {</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    <a class="code" href="unit1308_8c.html#a2f29226077aaea62db6864d9b291eadc">last</a> = <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <a class="code" href="structdata.html">data</a> = <a class="code" href="structdata.html">data</a>-&gt;next;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  }</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1308_8c.html#a2f29226077aaea62db6864d9b291eadc">last</a>) {</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <a class="code" href="unit1308_8c.html#a2f29226077aaea62db6864d9b291eadc">last</a>-&gt;<a class="code" href="structcurl__httppost.html#a09be6ec2bb379d4580f5022be3fa65d7">next</a> = <a class="code" href="structdata.html">data</a>-&gt;next;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    }</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      parent-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">stream_dependents</a> = <a class="code" href="structdata.html">data</a>-&gt;next;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    }</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  }</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a3fcdcd68ee5b73de16f05af7dd7a8b05">stream_depends_on</a> = 0;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  child-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a6f9205a0db6b068d49e548a9a65c212d">stream_depends_e</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;}</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="keywordtype">void</span> <a class="code" href="http2_8h.html#a0f9179032800ff43d64d1be68c1e67cd">Curl_http2_cleanup_dependencies</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;{</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="structdata.html">data</a>-&gt;set.stream_dependents) {</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *tmp = <a class="code" href="structdata.html">data</a>-&gt;set.stream_dependents-&gt;data;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <a class="code" href="http2_8h.html#a8b6e1fdb20f29a378ded56ad2f05c133">Curl_http2_remove_child</a>(<a class="code" href="structdata.html">data</a>, tmp);</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <a class="code" href="http2_8h.html#abb49749220f69b7a4274d49c6b1f59c1">Curl_http2_add_child</a>(<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on, tmp, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  }</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on)</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    <a class="code" href="http2_8h.html#a8b6e1fdb20f29a378ded56ad2f05c133">Curl_http2_remove_child</a>(<a class="code" href="structdata.html">data</a>-&gt;set.stream_depends_on, <a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;}</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment">/* Only call this function for a transfer that already got a HTTP/2</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">   CURLE_HTTP2_STREAM error! */</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="http2_8h.html#a5bc470e00220b08aad997d4f56a15948">Curl_h2_http_1_1_error</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;{</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttp__conn.html">http_conn</a> *httpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">httpc</a>;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;  <span class="keywordflow">return</span> (httpc-&gt;error_code == NGHTTP2_HTTP_1_1_REQUIRED);</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;}</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* !USE_NGHTTP2 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">/* Satisfy external references even if http2 is not compiled in. */</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"><a class="line" href="http2_8c.html#a74a298e1d8694faa3d53a4126d0a34e9"> 2382</a></span>&#160;<span class="preprocessor">#define CURL_DISABLE_TYPECHECK</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="curl_8h.html">curl/curl.h</a>&gt;</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div><div class="line"><a name="l02385"></a><span class="lineno"><a class="line" href="http2_8c.html#a2831dc8e8f07f63432a1c1854b761905"> 2385</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="http2_8c.html#a2831dc8e8f07f63432a1c1854b761905">curl_pushheader_bynum</a>(<span class="keyword">struct</span> curl_pushheaders *h, <span class="keywordtype">size_t</span> num)</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;{</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  (void) h;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  (void) num;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;}</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div><div class="line"><a name="l02392"></a><span class="lineno"><a class="line" href="http2_8c.html#a328fa8276b84a9e9b1391ca60f1f262c"> 2392</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="http2_8c.html#a328fa8276b84a9e9b1391ca60f1f262c">curl_pushheader_byname</a>(<span class="keyword">struct</span> curl_pushheaders *h, <span class="keyword">const</span> <span class="keywordtype">char</span> *header)</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;{</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  (void) h;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  (void) header;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;}</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_NGHTTP2 */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a15aced4a015c44ff454787debee23520"><div class="ttname"><a href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">Curl_easy::state</a></div><div class="ttdeci">struct UrlState state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01795">urldata.h:1795</a></div></div>
<div class="ttc" id="url_8d_html_a1bc9666de113dffcfaf5d5c84eac6469"><div class="ttname"><a href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a></div><div class="ttdeci">Long POP3 or SMTP then that protocol will be otherwise HTTP will be used.Since..guessing can be disabled by setting a default see proto default for details.This option may be used any number of times.To control where this URL is written</div><div class="ttdef"><b>Definition:</b> <a href="url_8d_source.html#l00010">url.d:10</a></div></div>
<div class="ttc" id="ftp_8c_html_a77812d4945cd21094debbd06962f0f01"><div class="ttname"><a href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a></div><div class="ttdeci">#define state(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00101">ftp.c:101</a></div></div>
<div class="ttc" id="curl_8h_html_a4c4a3046bce0da437f299072f489bc02"><div class="ttname"><a href="curl_8h.html#a4c4a3046bce0da437f299072f489bc02">CURLPROTO_HTTP</a></div><div class="ttdeci">#define CURLPROTO_HTTP</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00865">curl.h:865</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00527">curl.h:527</a></div></div>
<div class="ttc" id="struct_curl__send__buffer_html"><div class="ttname"><a href="struct_curl__send__buffer.html">Curl_send_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="http_8h_source.html#l00053">http.h:53</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a090207c607d64b223413bac4406e7e34">CURLE_HTTP2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00480">curl.h:480</a></div></div>
<div class="ttc" id="http_8c_html_aff2e5d77b1c52a19bb70081af429bda2"><div class="ttname"><a href="http_8c.html#aff2e5d77b1c52a19bb70081af429bda2">Curl_add_buffer</a></div><div class="ttdeci">CURLcode Curl_add_buffer(Curl_send_buffer **inp, const void *inptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01299">http.c:1299</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="structconnectdata_html_aec2de2220c36ec447f6101e85bf0a52b"><div class="ttname"><a href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">connectdata::recv</a></div><div class="ttdeci">Curl_recv * recv[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00879">urldata.h:879</a></div></div>
<div class="ttc" id="http2_8h_html_ab44413d5f5cf5d245165f53c86b8bcb1"><div class="ttname"><a href="http2_8h.html#ab44413d5f5cf5d245165f53c86b8bcb1">Curl_http2_init_userset</a></div><div class="ttdeci">#define Curl_http2_init_userset(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00074">http2.h:74</a></div></div>
<div class="ttc" id="connect_8h_html_a0f98be540dd5a5f56c9ec98dc2489661"><div class="ttname"><a href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a></div><div class="ttdeci">#define connclose(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00145">connect.h:145</a></div></div>
<div class="ttc" id="urldata_8h_html_aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4"><div class="ttname"><a href="urldata_8h.html#aabb7db968656c3ee0555ea3d8784310da325bcbe2ebf7e3de886d9af307372ca4">EXPIRE_RUN_NOW</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01212">urldata.h:1212</a></div></div>
<div class="ttc" id="struct_single_request_html_aedc2a164dd5fddd6e7420472035424ef"><div class="ttname"><a href="struct_single_request.html#aedc2a164dd5fddd6e7420472035424ef">SingleRequest::upgr101</a></div><div class="ttdeci">enum upgrade101 upgr101</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00576">urldata.h:576</a></div></div>
<div class="ttc" id="struct_url_state_html_a5e24def154336ca61efb33aa446ed4e1"><div class="ttname"><a href="struct_url_state.html#a5e24def154336ca61efb33aa446ed4e1">UrlState::stream_weight</a></div><div class="ttdeci">int stream_weight</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01359">urldata.h:1359</a></div></div>
<div class="ttc" id="struct_single_request_html_a8516340c7835dfd47166418da27c40a0"><div class="ttname"><a href="struct_single_request.html#a8516340c7835dfd47166418da27c40a0">SingleRequest::maxdownload</a></div><div class="ttdeci">curl_off_t maxdownload</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00537">urldata.h:537</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a3fc9cf5326ee71f9c205ebfd42f221f9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a3fc9cf5326ee71f9c205ebfd42f221f9">CURLE_HTTP2_STREAM</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00581">curl.h:581</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="multi_8c_html_a20ed1fa1c4fc98dd0a9dbf5b84e020dc"><div class="ttname"><a href="multi_8c.html#a20ed1fa1c4fc98dd0a9dbf5b84e020dc">Curl_multi_add_perform</a></div><div class="ttdeci">CURLMcode Curl_multi_add_perform(struct Curl_multi *multi, struct Curl_easy *data, struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l01186">multi.c:1186</a></div></div>
<div class="ttc" id="struct_curl__handler_html"><div class="ttname"><a href="struct_curl__handler.html">Curl_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00628">urldata.h:628</a></div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="http2_8c_html_a328fa8276b84a9e9b1391ca60f1f262c"><div class="ttname"><a href="http2_8c.html#a328fa8276b84a9e9b1391ca60f1f262c">curl_pushheader_byname</a></div><div class="ttdeci">char * curl_pushheader_byname(struct curl_pushheaders *h, const char *header)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8c_source.html#l02392">http2.c:2392</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="struct_single_request_html_a6ca30fe8e465c2b5be16ee98769120b8"><div class="ttname"><a href="struct_single_request.html#a6ca30fe8e465c2b5be16ee98769120b8">SingleRequest::keepon</a></div><div class="ttdeci">int keepon</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00586">urldata.h:586</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="http2_8h_html_a5bc470e00220b08aad997d4f56a15948"><div class="ttname"><a href="http2_8h.html#a5bc470e00220b08aad997d4f56a15948">Curl_h2_http_1_1_error</a></div><div class="ttdeci">#define Curl_h2_http_1_1_error(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00080">http2.h:80</a></div></div>
<div class="ttc" id="structconnectdata_html_ae7924587f916593e1fb682086f298ce8"><div class="ttname"><a href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">connectdata::handler</a></div><div class="ttdeci">const struct Curl_handler * handler</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00905">urldata.h:905</a></div></div>
<div class="ttc" id="proto-redir_8d_html_a3663ac2460793e505561ad6c89686402"><div class="ttname"><a href="proto-redir_8d.html#a3663ac2460793e505561ad6c89686402">http</a></div><div class="ttdeci">Long allow only HTTP and HTTPS on http</div><div class="ttdef"><b>Definition:</b> <a href="proto-redir_8d_source.html#l00010">proto-redir.d:10</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="struct_curl__multi_html_a131a1103a9be433eaad9733f9944eedc"><div class="ttname"><a href="struct_curl__multi.html#a131a1103a9be433eaad9733f9944eedc">Curl_multi::push_cb</a></div><div class="ttdeci">curl_push_callback push_cb</div><div class="ttdef"><b>Definition:</b> <a href="multihandle_8h_source.html#l00095">multihandle.h:95</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="multiif_8h_html_a4ae1fb64a27264765b6a2fe5aca78830"><div class="ttname"><a href="multiif_8h.html#a4ae1fb64a27264765b6a2fe5aca78830">GETSOCK_READSOCK</a></div><div class="ttdeci">#define GETSOCK_READSOCK(x)</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00051">multiif.h:51</a></div></div>
<div class="ttc" id="struct_user_defined_html_a3fcdcd68ee5b73de16f05af7dd7a8b05"><div class="ttname"><a href="struct_user_defined.html#a3fcdcd68ee5b73de16f05af7dd7a8b05">UserDefined::stream_depends_on</a></div><div class="ttdeci">struct Curl_easy * stream_depends_on</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01713">urldata.h:1713</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00526">curl.h:526</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="unit1399_8c_html_acf1e931ffa73126ce876102dc2186895"><div class="ttname"><a href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a></div><div class="ttdeci">struct curltime now</div><div class="ttdef"><b>Definition:</b> <a href="unit1399_8c_source.html#l00083">unit1399.c:83</a></div></div>
<div class="ttc" id="http2_8h_html_a6e4353e22d54047ab6052b3a8fb49886"><div class="ttname"><a href="http2_8h.html#a6e4353e22d54047ab6052b3a8fb49886">Curl_http2_request_upgrade</a></div><div class="ttdeci">#define Curl_http2_request_upgrade(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00068">http2.h:68</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00564">curl.h:564</a></div></div>
<div class="ttc" id="struct_user_defined_html_ae778843cf6aa7c1a62d67e4ced8732e6"><div class="ttname"><a href="struct_user_defined.html#ae778843cf6aa7c1a62d67e4ced8732e6">UserDefined::stream_dependents</a></div><div class="ttdeci">struct Curl_http2_dep * stream_dependents</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01719">urldata.h:1719</a></div></div>
<div class="ttc" id="multi_8c_html_af60eeb6175f9a25baeee40253c56330e"><div class="ttname"><a href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a></div><div class="ttdeci">void Curl_set_in_callback(struct Curl_easy *data, bool value)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l03174">multi.c:3174</a></div></div>
<div class="ttc" id="urldata_8h_html_ac67e77846b7b67d5808da8f1dfa2eab8a34d2478b945364d0d1bc6cb5f2845f71"><div class="ttname"><a href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8a34d2478b945364d0d1bc6cb5f2845f71">HTTPREQ_POST_MIME</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01137">urldata.h:1137</a></div></div>
<div class="ttc" id="struct_curl__http2__dep_html"><div class="ttname"><a href="struct_curl__http2__dep.html">Curl_http2_dep</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01186">urldata.h:1186</a></div></div>
<div class="ttc" id="urldata_8h_html_a32206d460719cde6f2783b5f86f82acc"><div class="ttname"><a href="urldata_8h.html#a32206d460719cde6f2783b5f86f82acc">CONNRESULT_NONE</a></div><div class="ttdeci">#define CONNRESULT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00734">urldata.h:734</a></div></div>
<div class="ttc" id="test1_8c_html_a373722f946bf9680abb4de0dfb11fa22"><div class="ttname"><a href="test1_8c.html#a373722f946bf9680abb4de0dfb11fa22">elapsed</a></div><div class="ttdeci">long elapsed(START_TIME_TYPE start_time)</div><div class="ttdef"><b>Definition:</b> <a href="test1_8c_source.html#l00191">test1.c:191</a></div></div>
<div class="ttc" id="curl_8h_html"><div class="ttname"><a href="curl_8h.html">curl.h</a></div></div>
<div class="ttc" id="http2_8h_html_aa085257d64dd169d466fb80802114c9a"><div class="ttname"><a href="http2_8h.html#aa085257d64dd169d466fb80802114c9a">Curl_http2_done</a></div><div class="ttdeci">#define Curl_http2_done(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00075">http2.h:75</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="structconnectdata_html_ad0d28904779f8613d113aa4c0c38337a"><div class="ttname"><a href="structconnectdata.html#ad0d28904779f8613d113aa4c0c38337a">connectdata::upkeep_interval_ms</a></div><div class="ttdeci">long upkeep_interval_ms</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00915">urldata.h:915</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="struct_url_state_html"><div class="ttname"><a href="struct_url_state.html">UrlState</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01240">urldata.h:1240</a></div></div>
<div class="ttc" id="unit1394_8c_html_a0fb9c3165f64b5b79f3928b404818be9"><div class="ttname"><a href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a></div><div class="ttdeci">const char ** p</div><div class="ttdef"><b>Definition:</b> <a href="unit1394_8c_source.html#l00079">unit1394.c:79</a></div></div>
<div class="ttc" id="struct_url_state_html_a0f0f58db836aa9ead3a2fe24e0a3169f"><div class="ttname"><a href="struct_url_state.html#a0f0f58db836aa9ead3a2fe24e0a3169f">UrlState::infilesize</a></div><div class="ttdeci">curl_off_t infilesize</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01344">urldata.h:1344</a></div></div>
<div class="ttc" id="urldata_8h_html_a4a561967b6a40f1b5cbec45beeff78a6"><div class="ttname"><a href="urldata_8h.html#a4a561967b6a40f1b5cbec45beeff78a6">KEEP_SEND_PAUSE</a></div><div class="ttdeci">#define KEEP_SEND_PAUSE</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00465">urldata.h:465</a></div></div>
<div class="ttc" id="struct_curl__easy_html_ae50ee3c1668aaed84ae0338046f4f737"><div class="ttname"><a href="struct_curl__easy.html#ae50ee3c1668aaed84ae0338046f4f737">Curl_easy::multi</a></div><div class="ttdeci">struct Curl_multi * multi</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01777">urldata.h:1777</a></div></div>
<div class="ttc" id="struct_curl__easy_html_ad7bc19a27cd3de5d0d72e9221dde5ef7"><div class="ttname"><a href="struct_curl__easy.html#ad7bc19a27cd3de5d0d72e9221dde5ef7">Curl_easy::easy_conn</a></div><div class="ttdeci">struct connectdata * easy_conn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01760">urldata.h:1760</a></div></div>
<div class="ttc" id="easy_8h_html_ad613e7dceae0af83071d800255004421"><div class="ttname"><a href="easy_8h.html#ad613e7dceae0af83071d800255004421">curl_easy_duphandle</a></div><div class="ttdeci">CURL_EXTERN CURL * curl_easy_duphandle(CURL *curl)</div></div>
<div class="ttc" id="http2_8c_html_a2831dc8e8f07f63432a1c1854b761905"><div class="ttname"><a href="http2_8c.html#a2831dc8e8f07f63432a1c1854b761905">curl_pushheader_bynum</a></div><div class="ttdeci">char * curl_pushheader_bynum(struct curl_pushheaders *h, size_t num)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8c_source.html#l02385">http2.c:2385</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="structconnectdata_html_ab967c5853e0ed2e2f5ea9ead35d450eb"><div class="ttname"><a href="structconnectdata.html#ab967c5853e0ed2e2f5ea9ead35d450eb">connectdata::keepalive</a></div><div class="ttdeci">struct curltime keepalive</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00913">urldata.h:913</a></div></div>
<div class="ttc" id="struct_user_defined_html"><div class="ttname"><a href="struct_user_defined.html">UserDefined</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01492">urldata.h:1492</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="http_8h_html"><div class="ttname"><a href="http_8h.html">http.h</a></div></div>
<div class="ttc" id="timeval_8c_html_ae736e803680e1b7fa2b2868317b4b91f"><div class="ttname"><a href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a></div><div class="ttdeci">struct curltime Curl_now(void)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00154">timeval.c:154</a></div></div>
<div class="ttc" id="urldata_8h_html_ad851f566879d5b859ec9181a21318b64"><div class="ttname"><a href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a></div><div class="ttdeci">#define PROTOPT_SSL</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00706">urldata.h:706</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="http2_8h_html_a0f9179032800ff43d64d1be68c1e67cd"><div class="ttname"><a href="http2_8h.html#a0f9179032800ff43d64d1be68c1e67cd">Curl_http2_cleanup_dependencies</a></div><div class="ttdeci">#define Curl_http2_cleanup_dependencies(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00079">http2.h:79</a></div></div>
<div class="ttc" id="curl__setup_8h_html_a5dd6efb91a5151f2bb4e4fff1b386582"><div class="ttname"><a href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a></div><div class="ttdeci">#define CURLMIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00810">curl_setup.h:810</a></div></div>
<div class="ttc" id="base64_8c_html_ac297f79b5b4e0198d361139720027dc8"><div class="ttname"><a href="base64_8c.html#ac297f79b5b4e0198d361139720027dc8">Curl_base64url_encode</a></div><div class="ttdeci">CURLcode Curl_base64url_encode(struct Curl_easy *data, const char *inputbuff, size_t insize, char **outptr, size_t *outlen)</div><div class="ttdef"><b>Definition:</b> <a href="base64_8c_source.html#l00314">base64.c:314</a></div></div>
<div class="ttc" id="struct_single_request_html_a7b830d1607062193706245f7f4512ac9"><div class="ttname"><a href="struct_single_request.html#a7b830d1607062193706245f7f4512ac9">SingleRequest::size</a></div><div class="ttdeci">curl_off_t size</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00534">urldata.h:534</a></div></div>
<div class="ttc" id="conncache_8h_html_ac54a8f8827585a80d5bd688c05e2c6ad"><div class="ttname"><a href="conncache_8h.html#ac54a8f8827585a80d5bd688c05e2c6ad">BUNDLE_MULTIPLEX</a></div><div class="ttdeci">#define BUNDLE_MULTIPLEX</div><div class="ttdef"><b>Definition:</b> <a href="conncache_8h_source.html#l00044">conncache.h:44</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="multi_8h_html_ac2f6404b4a34b0b43b61315b3c214912"><div class="ttname"><a href="multi_8h.html#ac2f6404b4a34b0b43b61315b3c214912">CURL_CSELECT_ERR</a></div><div class="ttdeci">#define CURL_CSELECT_ERR</div><div class="ttdef"><b>Definition:</b> <a href="multi_8h_source.html#l00268">multi.h:268</a></div></div>
<div class="ttc" id="http2_8h_html_a2c3310e8f1eb576e38f798fb9dd2b951"><div class="ttname"><a href="http2_8h.html#a2c3310e8f1eb576e38f798fb9dd2b951">Curl_http2_switched</a></div><div class="ttdeci">#define Curl_http2_switched(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00070">http2.h:70</a></div></div>
<div class="ttc" id="unit1308_8c_html_a2f29226077aaea62db6864d9b291eadc"><div class="ttname"><a href="unit1308_8c.html#a2f29226077aaea62db6864d9b291eadc">last</a></div><div class="ttdeci">struct curl_httppost * last</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00046">unit1308.c:46</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="structconnectdata_html_a8c6daf7fa40e95c75eac915b7496a32a"><div class="ttname"><a href="structconnectdata.html#a8c6daf7fa40e95c75eac915b7496a32a">connectdata::httpversion</a></div><div class="ttdeci">int httpversion</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00869">urldata.h:869</a></div></div>
<div class="ttc" id="curlx_8c_html_af6458f5d187f1d7c82fb9ea7ef634b44"><div class="ttname"><a href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a></div><div class="ttdeci">#define ZERO_NULL</div><div class="ttdef"><b>Definition:</b> <a href="curlx_8c_source.html#l00131">curlx.c:131</a></div></div>
<div class="ttc" id="struct_curl__http2__dep_html_aaa987cfaa08612a15ae5a43f635fd19b"><div class="ttname"><a href="struct_curl__http2__dep.html#aaa987cfaa08612a15ae5a43f635fd19b">Curl_http2_dep::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01188">urldata.h:1188</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a8a13221afd448ab0b91f021b4f5ec7c7"><div class="ttname"><a href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">Curl_easy::req</a></div><div class="ttdeci">struct SingleRequest req</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01787">urldata.h:1787</a></div></div>
<div class="ttc" id="curl_8h_html_a83d34123b66749720352af4bcb17a8e4"><div class="ttname"><a href="curl_8h.html#a83d34123b66749720352af4bcb17a8e4">CURLPROTO_HTTPS</a></div><div class="ttdeci">#define CURLPROTO_HTTPS</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00866">curl.h:866</a></div></div>
<div class="ttc" id="unit1398_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00033">unit1398.c:33</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="multi_8h_html_ac9841bc853b2a1874c9b5528b2ad3e5b"><div class="ttname"><a href="multi_8h.html#ac9841bc853b2a1874c9b5528b2ad3e5b">CURL_CSELECT_IN</a></div><div class="ttdeci">#define CURL_CSELECT_IN</div><div class="ttdef"><b>Definition:</b> <a href="multi_8h_source.html#l00266">multi.h:266</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="urldata_8h_html_ad2a0f1a29b96ea2623d2015598f21328"><div class="ttname"><a href="urldata_8h.html#ad2a0f1a29b96ea2623d2015598f21328">CONNCHECK_ISDEAD</a></div><div class="ttdeci">#define CONNCHECK_ISDEAD</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00731">urldata.h:731</a></div></div>
<div class="ttc" id="select_8h_html_a7e89e8a851eb27402914a0d5beb58d99"><div class="ttname"><a href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a></div><div class="ttdeci">#define SOCKET_READABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00079">select.h:79</a></div></div>
<div class="ttc" id="strcase_8h_html_a48c605aaef9b3681c41d91096b6baad0"><div class="ttname"><a href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a></div><div class="ttdeci">#define strncasecompare(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00036">strcase.h:36</a></div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="data-binary_8d_html_a3ac969eb89029f16e1971dc874d41dab"><div class="ttname"><a href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a></div><div class="ttdeci">Long the rest should be a filename.Data is posted in a similar manner as data except that newlines and carriage returns are preserved and conversions are never done.Like data the default content type sent to the server is application x www form urlencoded.If you want the data to be treated as arbitrary binary data by the server then set the content type to octet stream</div><div class="ttdef"><b>Definition:</b> <a href="data-binary_8d_source.html#l00008">data-binary.d:8</a></div></div>
<div class="ttc" id="strdup_8c_html_a3a3f98ad97deebcb223f165b377f3879"><div class="ttname"><a href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a></div><div class="ttdeci">void * Curl_saferealloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="strdup_8c_source.html#l00093">strdup.c:93</a></div></div>
<div class="ttc" id="remote-name_8d_html_aa335f8bb20424b03700f57b150bf0aa6"><div class="ttname"><a href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a></div><div class="ttdeci">Long the path is cut off.The file will be saved in the current working directory.If you want the file saved in a different make sure you change the current working directory before invoking curl with this option.The remote file name to use for saving is extracted from the given nothing and if it already exists it will be overwritten.If you want the server to be able to choose the file name refer to remote header name which can be used in addition to this option.If the server chooses a file name and that name already exists it will not be overwritten.There is no URL decoding done on the file name.If it has or other URL encoded parts of the name</div><div class="ttdef"><b>Definition:</b> <a href="remote-name_8d_source.html#l00006">remote-name.d:6</a></div></div>
<div class="ttc" id="urldata_8h_html_ac67e77846b7b67d5808da8f1dfa2eab8aae19a0f63b68ec93cabbd9f3074fb496"><div class="ttname"><a href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8aae19a0f63b68ec93cabbd9f3074fb496">HTTPREQ_POST</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01135">urldata.h:1135</a></div></div>
<div class="ttc" id="multi_8c_html_a72515384372577e4134d210261290c09"><div class="ttname"><a href="multi_8c.html#a72515384372577e4134d210261290c09">Curl_multi_connchanged</a></div><div class="ttdeci">void Curl_multi_connchanged(struct Curl_multi *multi)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l01165">multi.c:1165</a></div></div>
<div class="ttc" id="multiif_8h_html_ad755633cd6d4e90c3df49fefd1052bad"><div class="ttname"><a href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a></div><div class="ttdeci">#define GETSOCK_BLANK</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00045">multiif.h:45</a></div></div>
<div class="ttc" id="strtoofft_8h_html"><div class="ttname"><a href="strtoofft_8h.html">strtoofft.h</a></div></div>
<div class="ttc" id="sendf_8h_html_a5b56d764844bff170a6721d5e33dca34"><div class="ttname"><a href="sendf_8h.html#a5b56d764844bff170a6721d5e33dca34">CLIENTWRITE_HEADER</a></div><div class="ttdeci">#define CLIENTWRITE_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00051">sendf.h:51</a></div></div>
<div class="ttc" id="urldata_8h_html_a93237a6ee2f27182bb966487a03bce44"><div class="ttname"><a href="urldata_8h.html#a93237a6ee2f27182bb966487a03bce44">KEEP_SEND</a></div><div class="ttdeci">#define KEEP_SEND</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00459">urldata.h:459</a></div></div>
<div class="ttc" id="structhttp__conn_html"><div class="ttname"><a href="structhttp__conn.html">http_conn</a></div><div class="ttdef"><b>Definition:</b> <a href="http_8h_source.html#l00201">http.h:201</a></div></div>
<div class="ttc" id="structconnectdata_html_ada83cbd7d295b87033b7ea635c0a5dd5"><div class="ttname"><a href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">connectdata::send</a></div><div class="ttdeci">Curl_send * send[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00880">urldata.h:880</a></div></div>
<div class="ttc" id="multiif_8h_html_a9aabda59f0ff87c1db3a2d306a410713"><div class="ttname"><a href="multiif_8h.html#a9aabda59f0ff87c1db3a2d306a410713">GETSOCK_WRITESOCK</a></div><div class="ttdeci">#define GETSOCK_WRITESOCK(x)</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00048">multiif.h:48</a></div></div>
<div class="ttc" id="structconnectbundle_html_a22977226b49d058b284fe58643165d8b"><div class="ttname"><a href="structconnectbundle.html#a22977226b49d058b284fe58643165d8b">connectbundle::multiuse</a></div><div class="ttdeci">int multiuse</div><div class="ttdef"><b>Definition:</b> <a href="conncache_8h_source.html#l00047">conncache.h:47</a></div></div>
<div class="ttc" id="fail-early_8d_html_a2b978ebca1e6cb7fcbcb9a6b51701ce3"><div class="ttname"><a href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply fail</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="structcurltime_html"><div class="ttname"><a href="structcurltime.html">curltime</a></div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00033">timeval.h:33</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="urldata_8h_html_a7d475a6687b678c11cce8221797e46dda5438320c9e5960ae04acfd8d213faa57"><div class="ttname"><a href="urldata_8h.html#a7d475a6687b678c11cce8221797e46dda5438320c9e5960ae04acfd8d213faa57">UPGR101_RECEIVED</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00500">urldata.h:500</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="urldata_8h_html_a7d475a6687b678c11cce8221797e46ddaa9c52d61737ee3b48ca077b1f408e8d8"><div class="ttname"><a href="urldata_8h.html#a7d475a6687b678c11cce8221797e46ddaa9c52d61737ee3b48ca077b1f408e8d8">UPGR101_REQUESTED</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00499">urldata.h:499</a></div></div>
<div class="ttc" id="strdup_8h_html"><div class="ttname"><a href="strdup_8h.html">strdup.h</a></div></div>
<div class="ttc" id="structconnectdata_html_aa5f47898ac300afb3ebdb21478f4074d"><div class="ttname"><a href="structconnectdata.html#aa5f47898ac300afb3ebdb21478f4074d">connectdata::httpc</a></div><div class="ttdeci">struct http_conn httpc</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01004">urldata.h:1004</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="multiif_8h_html"><div class="ttname"><a href="multiif_8h.html">multiif.h</a></div></div>
<div class="ttc" id="sendf_8c_html_ad59954133649b7538b387f940b86024f"><div class="ttname"><a href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a></div><div class="ttdeci">CURLcode Curl_client_write(struct connectdata *conn, int type, char *ptr, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00651">sendf.c:651</a></div></div>
<div class="ttc" id="http2_8h_html_a5a58f0975d3aa18fff0aa1d7f4d6781e"><div class="ttname"><a href="http2_8h.html#a5a58f0975d3aa18fff0aa1d7f4d6781e">Curl_http2_init</a></div><div class="ttdeci">#define Curl_http2_init(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00066">http2.h:66</a></div></div>
<div class="ttc" id="timeval_8c_html_a93ce3158c8838916ed817489c98e37c4"><div class="ttname"><a href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a></div><div class="ttdeci">timediff_t Curl_timediff(struct curltime newer, struct curltime older)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00181">timeval.c:181</a></div></div>
<div class="ttc" id="struct_connect_bits_html_aaf15319fba965e2d87ac0ac839ae8351"><div class="ttname"><a href="struct_connect_bits.html#aaf15319fba965e2d87ac0ac839ae8351">ConnectBits::close</a></div><div class="ttdeci">bool close</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00381">urldata.h:381</a></div></div>
<div class="ttc" id="memdebug_8h_html_a795660f73c902cc80ac0fe6cda0dbd1c"><div class="ttname"><a href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a></div><div class="ttdeci">#define Curl_safefree(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="memdebug_8h_source.html#l00176">memdebug.h:176</a></div></div>
<div class="ttc" id="connect_8c_html_a74c23cda76889e03be9b701cfde158c7"><div class="ttname"><a href="connect_8c.html#a74c23cda76889e03be9b701cfde158c7">Curl_connalive</a></div><div class="ttdeci">bool Curl_connalive(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l01276">connect.c:1276</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="http2_8h_html_abb49749220f69b7a4274d49c6b1f59c1"><div class="ttname"><a href="http2_8h.html#abb49749220f69b7a4274d49c6b1f59c1">Curl_http2_add_child</a></div><div class="ttdeci">#define Curl_http2_add_child(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00077">http2.h:77</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3e3dfee99c81f563d18ef4626d8886e1"><div class="ttname"><a href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a></div><div class="ttdeci">#define aprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00046">curl_printf.h:46</a></div></div>
<div class="ttc" id="struct_single_request_html_a5803af0f75195ad74badb6ced9b24b16"><div class="ttname"><a href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">SingleRequest::protop</a></div><div class="ttdeci">void * protop</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00619">urldata.h:619</a></div></div>
<div class="ttc" id="http2_8h_html_af65fa81e85022ee9b2ca5b8c46664f10"><div class="ttname"><a href="http2_8h.html#af65fa81e85022ee9b2ca5b8c46664f10">Curl_http2_init_state</a></div><div class="ttdeci">#define Curl_http2_init_state(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00073">http2.h:73</a></div></div>
<div class="ttc" id="urldata_8h_html_ac67e77846b7b67d5808da8f1dfa2eab8a4b328e0aa83f04505b21057059a9715f"><div class="ttname"><a href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8a4b328e0aa83f04505b21057059a9715f">HTTPREQ_PUT</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01138">urldata.h:1138</a></div></div>
<div class="ttc" id="multi_8h_html_a92acc8d3a23eaae72955b8a8b22c83e3"><div class="ttname"><a href="multi_8h.html#a92acc8d3a23eaae72955b8a8b22c83e3">CURLMcode</a></div><div class="ttdeci">CURLMcode</div><div class="ttdef"><b>Definition:</b> <a href="multi_8h_source.html#l00061">multi.h:61</a></div></div>
<div class="ttc" id="http2_8h_html_a5bdef737723c68dff0e4bde069b428ec"><div class="ttname"><a href="http2_8h.html#a5bdef737723c68dff0e4bde069b428ec">Curl_http2_setup_req</a></div><div class="ttdeci">#define Curl_http2_setup_req(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00072">http2.h:72</a></div></div>
<div class="ttc" id="http2_8h_html"><div class="ttname"><a href="http2_8h.html">http2.h</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00460">curl.h:460</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="http2_8h_html_acc13c28304b7e874ac61ea2816c5a2ae"><div class="ttname"><a href="http2_8h.html#acc13c28304b7e874ac61ea2816c5a2ae">Curl_http2_done_sending</a></div><div class="ttdeci">#define Curl_http2_done_sending(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00076">http2.h:76</a></div></div>
<div class="ttc" id="urldata_8h_html_ad073adb2b5b8a2f9ab8eb0dcae415efc"><div class="ttname"><a href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a></div><div class="ttdeci">ssize_t() Curl_recv(struct connectdata *conn, int sockindex, char *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00110">urldata.h:110</a></div></div>
<div class="ttc" id="http_8c_html_a93b36c38666b0081c09b3638f4b2c8f2"><div class="ttname"><a href="http_8c.html#a93b36c38666b0081c09b3638f4b2c8f2">Curl_add_bufferf</a></div><div class="ttdeci">CURLcode Curl_add_bufferf(Curl_send_buffer **inp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01275">http.c:1275</a></div></div>
<div class="ttc" id="struct_user_defined_html_a6f9205a0db6b068d49e548a9a65c212d"><div class="ttname"><a href="struct_user_defined.html#a6f9205a0db6b068d49e548a9a65c212d">UserDefined::stream_depends_e</a></div><div class="ttdeci">bool stream_depends_e</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01714">urldata.h:1714</a></div></div>
<div class="ttc" id="urldata_8h_html_a9f02ef6c16f171ef6fd36b7903e91b41"><div class="ttname"><a href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a></div><div class="ttdeci">ssize_t() Curl_send(struct connectdata *conn, int sockindex, const void *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00103">urldata.h:103</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="structconnectdata_html_a2bb9cb7096c4799e15ed1b449c5c7f1b"><div class="ttname"><a href="structconnectdata.html#a2bb9cb7096c4799e15ed1b449c5c7f1b">connectdata::bundle</a></div><div class="ttdeci">struct connectbundle * bundle</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01031">urldata.h:1031</a></div></div>
<div class="ttc" id="struct_curl__handler_html_a2fc887b2697c63980406a19108b82a24"><div class="ttname"><a href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">Curl_handler::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00702">urldata.h:702</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="http_8c_html_ae3dc4a63f791cddc2b843736433a6c62"><div class="ttname"><a href="http_8c.html#ae3dc4a63f791cddc2b843736433a6c62">Curl_http_done</a></div><div class="ttdeci">CURLcode Curl_http_done(struct connectdata *conn, CURLcode status, bool premature)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01542">http.c:1542</a></div></div>
<div class="ttc" id="http2_8h_html_a2295b843d76aeb06631566bfebc73be8"><div class="ttname"><a href="http2_8h.html#a2295b843d76aeb06631566bfebc73be8">Curl_http2_setup_conn</a></div><div class="ttdeci">#define Curl_http2_setup_conn(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00071">http2.h:71</a></div></div>
<div class="ttc" id="structcurl__httppost_html_a09be6ec2bb379d4580f5022be3fa65d7"><div class="ttname"><a href="structcurl__httppost.html#a09be6ec2bb379d4580f5022be3fa65d7">curl_httppost::next</a></div><div class="ttdeci">struct curl_httppost * next</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00159">curl.h:159</a></div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="http_8c_html_ac009a02368ec5154996b23065aa85a28"><div class="ttname"><a href="http_8c.html#ac009a02368ec5154996b23065aa85a28">Curl_http</a></div><div class="ttdeci">CURLcode Curl_http(struct connectdata *conn, bool *done)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01879">http.c:1879</a></div></div>
<div class="ttc" id="structconnectdata_html_a347307932d5d64be48527b2f3ed666ca"><div class="ttname"><a href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">connectdata::proto</a></div><div class="ttdeci">union connectdata::@45 proto</div></div>
<div class="ttc" id="urldata_8h_html_a27e0e4c009c7bae409b32e148d923658"><div class="ttname"><a href="urldata_8h.html#a27e0e4c009c7bae409b32e148d923658">CONNRESULT_DEAD</a></div><div class="ttdeci">#define CONNRESULT_DEAD</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00735">urldata.h:735</a></div></div>
<div class="ttc" id="http_8c_html_a8439073425968002da46c16791460fba"><div class="ttname"><a href="http_8c.html#a8439073425968002da46c16791460fba">Curl_add_buffer_init</a></div><div class="ttdeci">Curl_send_buffer * Curl_add_buffer_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01093">http.c:1093</a></div></div>
<div class="ttc" id="urldata_8h_html_ac67e77846b7b67d5808da8f1dfa2eab8ae11eeb30f15276332563390b730fd389"><div class="ttname"><a href="urldata_8h.html#ac67e77846b7b67d5808da8f1dfa2eab8ae11eeb30f15276332563390b730fd389">HTTPREQ_POST_FORM</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01136">urldata.h:1136</a></div></div>
<div class="ttc" id="struct_curl__http2__dep_html_a9528e1a0cd8788c60180b3fe886ce36e"><div class="ttname"><a href="struct_curl__http2__dep.html#a9528e1a0cd8788c60180b3fe886ce36e">Curl_http2_dep::next</a></div><div class="ttdeci">struct Curl_http2_dep * next</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01187">urldata.h:1187</a></div></div>
<div class="ttc" id="urldata_8h_html_a5158b1e31a4e7aa84de308e3d792a1de"><div class="ttname"><a href="urldata_8h.html#a5158b1e31a4e7aa84de308e3d792a1de">PORT_HTTP</a></div><div class="ttdeci">#define PORT_HTTP</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00032">urldata.h:32</a></div></div>
<div class="ttc" id="multi_8c_html_a759a3f675165554a5f5d6e784afa7fe0"><div class="ttname"><a href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a></div><div class="ttdeci">void Curl_expire(struct Curl_easy *data, time_t milli, expire_id id)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l02994">multi.c:2994</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="struct_h_t_t_p_html"><div class="ttname"><a href="struct_h_t_t_p.html">HTTP</a></div><div class="ttdef"><b>Definition:</b> <a href="http_8h_source.html#l00132">http.h:132</a></div></div>
<div class="ttc" id="url_8c_html_a557d55610156477514fe6dc5a178789e"><div class="ttname"><a href="url_8c.html#a557d55610156477514fe6dc5a178789e">Curl_close</a></div><div class="ttdeci">CURLcode Curl_close(struct Curl_easy *data)</div><div class="ttdef"><b>Definition:</b> <a href="url_8c_source.html#l00319">url.c:319</a></div></div>
<div class="ttc" id="urldata_8h_html_a1107f8f3c79ed6d630958c8363ee37da"><div class="ttname"><a href="urldata_8h.html#a1107f8f3c79ed6d630958c8363ee37da">GOOD_EASY_HANDLE</a></div><div class="ttdeci">#define GOOD_EASY_HANDLE(x)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00154">urldata.h:154</a></div></div>
<div class="ttc" id="urldata_8h_html_a81a92a35e60e84d80aa4d2b5a6959722"><div class="ttname"><a href="urldata_8h.html#a81a92a35e60e84d80aa4d2b5a6959722">PROTOPT_STREAM</a></div><div class="ttdeci">#define PROTOPT_STREAM</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00722">urldata.h:722</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="urldata_8h_html_ad7ac61834c3bfb1a509fdb5d4d7edc17"><div class="ttname"><a href="urldata_8h.html#ad7ac61834c3bfb1a509fdb5d4d7edc17">CONNCHECK_KEEPALIVE</a></div><div class="ttdeci">#define CONNCHECK_KEEPALIVE</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00732">urldata.h:732</a></div></div>
<div class="ttc" id="http2_8h_html_aad8497d84887a3deea025eb5c06cc5f9"><div class="ttname"><a href="http2_8h.html#aad8497d84887a3deea025eb5c06cc5f9">Curl_http2_setup</a></div><div class="ttdeci">#define Curl_http2_setup(x)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00069">http2.h:69</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a72ceb38665fe6374e78ebb8ca8d5e33a"><div class="ttname"><a href="struct_connect_bits.html#a72ceb38665fe6374e78ebb8ca8d5e33a">ConnectBits::multiplex</a></div><div class="ttdeci">bool multiplex</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00436">urldata.h:436</a></div></div>
<div class="ttc" id="struct_user_defined_html_acea22e26cd3f89feab66b25fc9fe9ffe"><div class="ttname"><a href="struct_user_defined.html#acea22e26cd3f89feab66b25fc9fe9ffe">UserDefined::httpreq</a></div><div class="ttdeci">Curl_HttpReq httpreq</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01590">urldata.h:1590</a></div></div>
<div class="ttc" id="http2_8h_html_a8b6e1fdb20f29a378ded56ad2f05c133"><div class="ttname"><a href="http2_8h.html#a8b6e1fdb20f29a378ded56ad2f05c133">Curl_http2_remove_child</a></div><div class="ttdeci">#define Curl_http2_remove_child(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="http2_8h_source.html#l00078">http2.h:78</a></div></div>
<div class="ttc" id="url_8h_html"><div class="ttname"><a href="url_8h.html">url.h</a></div></div>
<div class="ttc" id="get_8d_html_a38b0ef81b65f2aee282c8c217a123176"><div class="ttname"><a href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a></div><div class="ttdeci">Long this option will make all data specified with data</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="struct_single_request_html"><div class="ttname"><a href="struct_single_request.html">SingleRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00533">urldata.h:533</a></div></div>
<div class="ttc" id="http_8c_html_adaf0c79a3bcc19f4c388cb5e0a33f030"><div class="ttname"><a href="http_8c.html#adaf0c79a3bcc19f4c388cb5e0a33f030">Curl_add_buffer_free</a></div><div class="ttdeci">void Curl_add_buffer_free(Curl_send_buffer **inp)</div><div class="ttdef"><b>Definition:</b> <a href="http_8c_source.html#l01101">http.c:1101</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="curl__base64_8h_html"><div class="ttname"><a href="curl__base64_8h.html">curl_base64.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="http2_8c.html">http2.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
