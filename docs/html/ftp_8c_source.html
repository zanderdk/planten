<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/ftp.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ftp_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ftp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ftp_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_FTP</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifdef HAVE_UTSNAME_H</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;sys/utsname.h&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#ifdef __VMS</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;in.h&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;inet.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#if (defined(NETWARE) &amp;&amp; defined(__NOVELL_LIBC__))</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#undef in_addr_t</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#define in_addr_t unsigned long</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="curl_8h.html">curl/curl.h</a>&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="if2ip_8h.html">if2ip.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hostip_8h.html">hostip.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="progress_8h.html">progress.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="transfer_8h.html">transfer.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="escape_8h.html">escape.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="http_8h.html">http.h</a>&quot;</span> <span class="comment">/* for HTTP proxy tunnel stuff */</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="socks_8h.html">socks.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ftp_8h.html">ftp.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fileinfo_8h.html">fileinfo.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ftplistparser_8h.html">ftplistparser.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__range_8h.html">curl_range.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__sec_8h.html">curl_sec.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strtoofft_8h.html">strtoofft.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vtls_8h.html">vtls/vtls.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strerror_8h.html">strerror.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__ntop_8h.html">inet_ntop.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__pton_8h.html">inet_pton.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="parsedate_8h.html">parsedate.h</a>&quot;</span> <span class="comment">/* for the week day and month names */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sockaddr_8h.html">sockaddr.h</a>&quot;</span> <span class="comment">/* required for Curl_sockaddr_storage */</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="multiif_8h.html">multiif.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="url_8h.html">url.h</a>&quot;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="speedcheck_8h.html">speedcheck.h</a>&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="http__proxy_8h.html">http_proxy.h</a>&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="non-ascii_8h.html">non-ascii.h</a>&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#ifndef NI_MAXHOST</span></div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="ftp_8c.html#aebc53e498b2434654a1d44070d9ccd40">   87</a></span>&#160;<span class="preprocessor">#define NI_MAXHOST 1025</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#ifndef INET_ADDRSTRLEN</span></div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="ftp_8c.html#a93b37007689284fd9c4bde1a8f4b9199">   90</a></span>&#160;<span class="preprocessor">#define INET_ADDRSTRLEN 16</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#ifdef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#define ftp_pasv_verbose(a,b,c,d)  Curl_nop_stmt</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">/* Local API functions */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifndef DEBUGBUILD</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _state(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                   <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> newstate);</div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">  101</a></span>&#160;<span class="preprocessor">#define state(x,y) _state(x,y)</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _state(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                   <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> newstate,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                   <span class="keywordtype">int</span> lineno);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#define state(x,y) _state(x,y,__LINE__)</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_sendquote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                              <span class="keyword">struct</span> <a class="code" href="structcurl__slist.html">curl_slist</a> *quote);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_quit(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_parse_url_path(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_regular_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ftp_pasv_verbose(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                             <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *ai,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                             <span class="keywordtype">char</span> *newhost, <span class="comment">/* ascii version */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                             <span class="keywordtype">int</span> port);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_prepare_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_mdtm(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_quote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                <span class="keywordtype">bool</span> init, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_nb_type(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                            <span class="keywordtype">bool</span> ascii, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> newstate);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_need_type(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                         <span class="keywordtype">bool</span> ascii);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_do(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                         <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a>, <span class="keywordtype">bool</span> premature);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_disconnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> dead_connection);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_do_more(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> *completed);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_multi_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                       <span class="keywordtype">int</span> numsocks);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_domore_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                              <span class="keywordtype">int</span> numsocks);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_doing(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                          <span class="keywordtype">bool</span> *dophase_done);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_setup_connection(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> * conn);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> init_wc_data(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> wc_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> wc_data_dtor(<span class="keywordtype">void</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_retr(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_readresp(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                             <span class="keyword">struct</span> <a class="code" href="structpingpong.html">pingpong</a> *pp,</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                             <span class="keywordtype">int</span> *ftpcode,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                             <span class="keywordtype">size_t</span> *<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_dophase_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                 <span class="keywordtype">bool</span> connected);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">/* easy-to-use macro: */</span></div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">  158</a></span>&#160;<span class="preprocessor">#define PPSENDF(x,y,z)  result = Curl_pp_sendf(x,y,z); \</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">                        if(result)                     \</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">                          return result</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"> * FTP protocol handler.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="ftp_8h.html#a79071fb30b2abfa423a252245cbc6190">  167</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> <a class="code" href="ftp_8c.html#a79071fb30b2abfa423a252245cbc6190">Curl_handler_ftp</a> = {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="stringliteral">&quot;FTP&quot;</span>,                           <span class="comment">/* scheme */</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  ftp_setup_connection,            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  ftp_do,                          <span class="comment">/* do_it */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  ftp_done,                        <span class="comment">/* done */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  ftp_do_more,                     <span class="comment">/* do_more */</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  ftp_connect,                     <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  ftp_multi_statemach,             <span class="comment">/* connecting */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  ftp_doing,                       <span class="comment">/* doing */</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  ftp_getsock,                     <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  ftp_getsock,                     <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  ftp_domore_getsock,              <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  ftp_disconnect,                  <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <a class="code" href="urldata_8h.html#a5a17341fe1dab2c775265da4ab90af34">PORT_FTP</a>,                        <span class="comment">/* defport */</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="curl_8h.html#a9ba581e59a874626d594c0f7c241d6d2">CURLPROTO_FTP</a>,                   <span class="comment">/* protocol */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="urldata_8h.html#a703cdbe3f849aab3b41d2122f0d126f1">PROTOPT_DUAL</a> | <a class="code" href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a> | <a class="code" href="urldata_8h.html#a3b42f4c610116cfa591c4eda7c1f7346">PROTOPT_NEEDSPWD</a> |</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="urldata_8h.html#a93a3791fdbb761285b636725fed39385">PROTOPT_NOURLQUERY</a> | <a class="code" href="urldata_8h.html#a033a9d4c349c6179bbf570bab3c10444">PROTOPT_PROXY_AS_HTTP</a> |</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="urldata_8h.html#a766105b6448011146b33df92f55d2261">PROTOPT_WILDCARD</a> <span class="comment">/* flags */</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;};</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">#ifdef USE_SSL</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> * FTPS protocol handler.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> Curl_handler_ftps = {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="stringliteral">&quot;FTPS&quot;</span>,                          <span class="comment">/* scheme */</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  ftp_setup_connection,            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  ftp_do,                          <span class="comment">/* do_it */</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  ftp_done,                        <span class="comment">/* done */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  ftp_do_more,                     <span class="comment">/* do_more */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  ftp_connect,                     <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  ftp_multi_statemach,             <span class="comment">/* connecting */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  ftp_doing,                       <span class="comment">/* doing */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  ftp_getsock,                     <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  ftp_getsock,                     <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  ftp_domore_getsock,              <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  ftp_disconnect,                  <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                       <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="urldata_8h.html#ab7f1c24cdfca62f45ba0dc7618c0f568">PORT_FTPS</a>,                       <span class="comment">/* defport */</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="curl_8h.html#adef34e1e2989d3726cc20e3b5875f2f4">CURLPROTO_FTPS</a>,                  <span class="comment">/* protocol */</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a> | <a class="code" href="urldata_8h.html#a703cdbe3f849aab3b41d2122f0d126f1">PROTOPT_DUAL</a> | <a class="code" href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a> |</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="urldata_8h.html#a3b42f4c610116cfa591c4eda7c1f7346">PROTOPT_NEEDSPWD</a> | <a class="code" href="urldata_8h.html#a93a3791fdbb761285b636725fed39385">PROTOPT_NOURLQUERY</a> | <a class="code" href="urldata_8h.html#a766105b6448011146b33df92f55d2261">PROTOPT_WILDCARD</a> <span class="comment">/* flags */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;};</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> close_secondarysocket(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> != conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>]) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>]);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> * NOTE: back in the old days, we added code in the FTP code that made NOBODY</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> * requests on files respond with headers passed to the client/stdout that</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> * looked like HTTP ones.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> * This approach is not very elegant, it causes confusion and is error-prone.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> * It is subject for removal at the next (or at least a future) soname bump.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> * Until then you can test the effects of the removal by undefining the</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"> * following define named CURL_FTP_HTTPSTYLE_HEAD.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="ftp_8c.html#a113f034b06f26387c98293c69b4cddec">  238</a></span>&#160;<span class="preprocessor">#define CURL_FTP_HTTPSTYLE_HEAD 1</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> freedirs(<span class="keyword">struct</span> <a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = NULL;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a> = NULL;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> = 0;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">/* no longer of any use */</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">/* Returns non-zero if the given string contains CR (\r) or LF (\n),</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">   which are not allowed within RFC 959 &lt;string&gt;.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">   Note: The input string is in the client&#39;s encoding which might</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">   not be ASCII, so escape sequences \r &amp; \n must be used instead</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">   of hex values 0x0d &amp; 0x0a.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> isBadFtpString(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">return</span> ((NULL != strchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;\r&#39;</span>)) ||</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          (NULL != strchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;\n&#39;</span>))) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> * AcceptServerConnect()</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> * After connection request is received from the server this function is</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"> * called to accept the connection and close the listening socket</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> AcceptServerConnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>];</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> s = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__sockaddr__storage.html">Curl_sockaddr_storage</a> add;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keyword">struct </span>sockaddr_in add;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = (<a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a>) <span class="keyword">sizeof</span>(add);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span>(0 == getsockname(sock, (<span class="keyword">struct</span> sockaddr *) &amp;add, &amp;<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = <span class="keyword">sizeof</span>(add);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    s = accept(sock, (<span class="keyword">struct</span> sockaddr *) &amp;add, &amp;<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, sock); <span class="comment">/* close the first socket */</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == s) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Error accept()ing server connect&quot;</span>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Connection accepted from server\n&quot;</span>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">/* when this happens within the DO state it is important that we mark us as</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     not needing DO_MORE anymore */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7563463d9ad94df9ed822c17786dd6a2">do_more</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = s;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(s, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>); <span class="comment">/* enable non-blocking */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a0206025a79e7085b102e907730e901fe">sock_accepted</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.fsockopt) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">int</span> error = 0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">/* activate callback for setting socket options */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    error = <a class="code" href="structdata.html">data</a>-&gt;set.fsockopt(<a class="code" href="structdata.html">data</a>-&gt;set.sockopt_client,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                               s,</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                               <a class="code" href="curl_8h.html#ae319cab849319fca1b222de282506ad9ac1674afdd84449264ce314c1f525ab33">CURLSOCKTYPE_ACCEPT</a>);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      close_secondarysocket(conn);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a309ade641c94c3e710ae887405dba78b">CURLE_ABORTED_BY_CALLBACK</a>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"> * ftp_timeleft_accept() returns the amount of milliseconds left allowed for</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> * waiting server to connect. If the value is negative, the timeout time has</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> * already elapsed.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> * The start time is stored in progress.t_acceptdata - as set with</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> * Curl_pgrsTime(..., TIMER_STARTACCEPT);</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keyword">static</span> <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> ftp_timeleft_accept(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> timeout_ms = <a class="code" href="ftp_8h.html#aa0f0a799e8c85de11da0b1b426877750">DEFAULT_ACCEPT_TIMEOUT</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> other;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurltime.html">curltime</a> <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.accepttimeout &gt; 0)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    timeout_ms = <a class="code" href="structdata.html">data</a>-&gt;set.accepttimeout;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a> = <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>();</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">/* check if the generic timeout possibly is set shorter */</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  other =  <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, &amp;<a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span>(other &amp;&amp; (other &lt; timeout_ms))</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">/* note that this also works fine for when other happens to be negative</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">       due to it already having elapsed */</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    timeout_ms = other;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">/* subtract elapsed time */</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    timeout_ms -= <a class="code" href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a>(<a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>, <a class="code" href="structdata.html">data</a>-&gt;progress.t_acceptdata);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span>(!timeout_ms)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="comment">/* avoid returning 0 as that means no timeout! */</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">return</span> timeout_ms;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"> * ReceivedServerConnect()</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * After allowing server to connect to us from data port, this function</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> * checks both data connection for connection establishment and ctrl</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> * connection for a negative response regarding a failure in connecting</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ReceivedServerConnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *<a class="code" href="cert-status_8d.html#a28915fffd5a7223c5a7effeaeecc785f">received</a>)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;{</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> ctrl_sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> data_sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>];</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  time_t timeout_ms;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">int</span> ftpcode;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  *<a class="code" href="cert-status_8d.html#a28915fffd5a7223c5a7effeaeecc785f">received</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  timeout_ms = ftp_timeleft_accept(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Checking for server connect\n&quot;</span>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">/* if a timeout was already reached, bail out */</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Accept timeout occurred while waiting server connect&quot;</span>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4312ee806c76575f6183c9b9a57c4601">CURLE_FTP_ACCEPT_TIMEOUT</a>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">/* First check whether there is a cached response from server */</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a> &amp;&amp; pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a> &amp;&amp; pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>[0] &gt; <span class="charliteral">&#39;3&#39;</span>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">/* Data connection could not be established, let&#39;s return */</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;There is negative response in cache while serv connect\n&quot;</span>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(&amp;nread, <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, &amp;ftpcode);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9">CURLE_FTP_ACCEPT_FAILED</a>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a>(ctrl_sock, data_sock, <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>, 0);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">/* see if the connection request is already here */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">case</span> -1: <span class="comment">/* error */</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">/* let&#39;s die here */</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Error while waiting for server connect&quot;</span>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9">CURLE_FTP_ACCEPT_FAILED</a>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">case</span> 0:  <span class="comment">/* Server connect is not received yet */</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">break</span>; <span class="comment">/* loop */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp; <a class="code" href="select_8h.html#a43b4f4b7314433975d83a3c678994ff4">CURL_CSELECT_IN2</a>) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Ready to accept data connection from server\n&quot;</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      *<a class="code" href="cert-status_8d.html#a28915fffd5a7223c5a7effeaeecc785f">received</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp; <a class="code" href="multi_8h.html#ac9841bc853b2a1874c9b5528b2ad3e5b">CURL_CSELECT_IN</a>) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Ctrl conn has data while waiting for data conn\n&quot;</span>);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(&amp;nread, <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, &amp;ftpcode);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordflow">if</span>(ftpcode/100 &gt; 3)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9">CURLE_FTP_ACCEPT_FAILED</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  } <span class="comment">/* switch() */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> * InitiateTransfer()</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> * After connection from server is accepted this function is called to</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> * setup transfer parameters and initiate the data transfer.</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> InitiateTransfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;{</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a550a957124dfbe3ed5a3ea91504edb0a">ftp_use_data_ssl</a>) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">/* since we only have a plaintext TCP connection here, we must now</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">     * do the TLS stuff */</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Doing the SSL/TLS handshake on the data stream\n&quot;</span>);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#aab12c9ee7a4c9d065f76d3ab539bdb62">Curl_ssl_connect</a>(conn, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#afe0772034a72ef6799a141b877dcef0d">state_saved</a> == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab1ccd7c5223945586470ddac912f5659">FTP_STOR</a>) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    *(ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>) = 0;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">/* When we know we&#39;re uploading a specified file, we can get the file</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">       size prior to the actual upload. */</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <a class="code" href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="structdata.html">data</a>-&gt;state.infilesize);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">/* set the SO_SNDBUF for the secondary socket for those who need it */</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="connect_8h.html#a424d2b76b8d7dcd8e56ea081825248d4">Curl_sndbufset</a>(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>]);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, <span class="comment">/* no download */</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>, ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">/* FTP download: */</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a2cf7ba1957a627d4c956c11df54a1602">retr_size_saved</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>, -1, NULL); <span class="comment">/* no upload here */</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>.<a class="code" href="structpingpong.html#a3a10091c256aed9fce33a95f12bf5b8f">pending_resp</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* expect server response */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"> * AllowServerConnect()</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> * When we&#39;ve issue the PORT command, we have told the server to connect to</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> * us. This function checks whether data connection is established if so it is</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"> * accepted.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> AllowServerConnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *connected)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;{</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  time_t timeout_ms;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  *connected = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Preparing for accepting server on data port\n&quot;</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">/* Save the time we start accepting server connect */</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <a class="code" href="progress_8c.html#a1344967836d86ae13b5739ed0a6e6916">Curl_pgrsTime</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="progress_8h.html#abc090d144fb55d31dff488d24c46fb2aa4270c24c5c8157937a242ca32bcff6b5">TIMER_STARTACCEPT</a>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  timeout_ms = ftp_timeleft_accept(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">/* if a timeout was already reached, bail out */</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Accept timeout occurred while waiting server connect&quot;</span>);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4312ee806c76575f6183c9b9a57c4601">CURLE_FTP_ACCEPT_TIMEOUT</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">/* see if the connection request is already here */</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ReceivedServerConnect(conn, connected);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span>(*connected) {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = AcceptServerConnect(conn);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = InitiateTransfer(conn);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">/* Add timeout to multi handle and break out of the loop */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; *connected == <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="structdata.html">data</a>-&gt;set.accepttimeout &gt; 0 ?</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                  <a class="code" href="structdata.html">data</a>-&gt;set.accepttimeout: <a class="code" href="ftp_8h.html#aa0f0a799e8c85de11da0b1b426877750">DEFAULT_ACCEPT_TIMEOUT</a>, 0);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">/* macro to check for a three-digit ftp status code at the start of the</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">   given string */</span></div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="ftp_8c.html#a977ae5ca75fa33bfee0315d66a228808">  545</a></span>&#160;<span class="preprocessor">#define STATUSCODE(line) (ISDIGIT(line[0]) &amp;&amp; ISDIGIT(line[1]) &amp;&amp;       \</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="preprocessor">                          ISDIGIT(line[2]))</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">/* macro to check for the last line in an FTP server response */</span></div><div class="line"><a name="l00549"></a><span class="lineno"><a class="line" href="ftp_8c.html#af474756496959c8a45bbbb2d7e199aad">  549</a></span>&#160;<span class="preprocessor">#define LASTLINE(line) (STATUSCODE(line) &amp;&amp; (&#39; &#39; == line[3]))</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> ftp_endofresp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                          <span class="keywordtype">int</span> *<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  (void)conn;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 3) &amp;&amp; <a class="code" href="ftp_8c.html#af474756496959c8a45bbbb2d7e199aad">LASTLINE</a>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>)) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    *<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="warnless_8c.html#ad00eb8c7d08a3af99f84038736057606">curlx_sltosi</a>(strtol(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, NULL, 10));</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_readresp(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd,</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                             <span class="keyword">struct</span> <a class="code" href="structpingpong.html">pingpong</a> *pp,</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                             <span class="keywordtype">int</span> *ftpcode, <span class="comment">/* return the ftp-code if done */</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                             <span class="keywordtype">size_t</span> *<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>) <span class="comment">/* size of the response */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;{</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = pp-&gt;<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a37bd477ec46526ae33926df9e61e7051">Curl_pp_readresp</a>(sockfd, pp, &amp;<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI)</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">/* handle the security-oriented responses 6xx ***/</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">/* FIXME: some errorchecking perhaps... ***/</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">case</span> 631:</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = Curl_sec_read_msg(conn, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, PROT_SAFE);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">case</span> 632:</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = Curl_sec_read_msg(conn, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, PROT_PRIVATE);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">case</span> 633:</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = Curl_sec_read_msg(conn, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, PROT_CONFIDENTIAL);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">/* normal ftp stuff we pass through! */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="comment">/* store the latest code for later retrieval */</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;info.httpcode = <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">if</span>(ftpcode)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    *ftpcode = <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">if</span>(421 == <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">/* 421 means &quot;Service not available, closing control connection.&quot; and FTP</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">     * servers use it to signal that idle session timeout has been exceeded.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">     * If we ignored the response, it could end up hanging in some cases.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">     * This response code can come at any point so having it treated</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">     * generically is a good idea.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;We got a 421 - timeout!\n&quot;</span>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">/* --- parse FTP server responses --- */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * Curl_GetFTPResponse() is a BLOCKING function to read the full response</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> * from a server after a command.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno"><a class="line" href="ftp_8h.html#a035bc2bae606d0e07a50664590fe3346">  628</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> *nreadp, <span class="comment">/* return number of bytes read */</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                             <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                             <span class="keywordtype">int</span> *ftpcode) <span class="comment">/* return the ftp-code */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;{</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">   * We cannot read just one byte per read() and then go back to select() as</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">   * the OpenSSL read() doesn&#39;t grok that properly.</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">   * Alas, read as much as possible, split up into lines, use the ending</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">   * line in a response or continue reading.  */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordtype">size_t</span> nread;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordtype">int</span> cache_skip = 0;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordtype">int</span> value_to_be_ignored = 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">if</span>(ftpcode)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    *ftpcode = 0; <span class="comment">/* 0 for errors */</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">/* make the pointer point to something for the rest of this function */</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    ftpcode = &amp;value_to_be_ignored;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  *nreadp = 0;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">while</span>(!*ftpcode &amp;&amp; !<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">/* check and reset timeout value every lap */</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    time_t <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = <a class="code" href="pingpong_8c.html#a62b24aadd77bd06bae0b8be426ca5bd3">Curl_pp_state_timeout</a>(pp); <span class="comment">/* timeout in milliseconds */</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    time_t interval_ms;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> &lt;= 0) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;FTP response timeout&quot;</span>);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>; <span class="comment">/* already too little time */</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    interval_ms = 1000;  <span class="comment">/* use 1 second timeout intervals */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> &lt; interval_ms)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      interval_ms = <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">     * Since this function is blocking, we need to wait here for input on the</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">     * connection and only then we call the response reading function. We do</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">     * timeout at least every second to make the timeout check run.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">     * A caution here is that the ftp_readresp() function has a cache that may</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">     * contain pieces of a response from the previous invoke and we need to</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">     * make sure we don&#39;t just wait for input while there is unhandled data in</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">     * that cache. But also, if the cache is there, we call ftp_readresp() and</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">     * the cache wasn&#39;t good enough to continue we must not just busy-loop</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">     * around this function.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a> &amp;&amp; (cache_skip &lt; 2)) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">       * There&#39;s a cache left since before. We then skipping the wait for</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">       * socket action, unless this is the same cache like the previous round</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">       * as then the cache was deemed not enough to act on and we then need to</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">       * wait for more data anyway.</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="connect_8c.html#a040dc08db4e56830fee8cd4515b3db76">Curl_conn_data_pending</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>)) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">switch</span>(<a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(sockfd, interval_ms)) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordflow">case</span> -1: <span class="comment">/* select() error, stop reading */</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;FTP response aborted due to select/poll error: %d&quot;</span>,</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;              <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">case</span> 0: <span class="comment">/* timeout */</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="progress_8c.html#a40686d443707afea0c0e47cee805df01">Curl_pgrsUpdate</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>))</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a309ade641c94c3e710ae887405dba78b">CURLE_ABORTED_BY_CALLBACK</a>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">/* just continue in our loop for the timeout duration */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">default</span>: <span class="comment">/* for clarity */</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_readresp(sockfd, pp, ftpcode, &amp;nread);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">if</span>(!nread &amp;&amp; pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">/* bump cache skip counter as on repeated skips we must wait for more</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">         data */</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      cache_skip++;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="comment">/* when we got data or there is no cache left, we reset the cache skip</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">         counter */</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      cache_skip = 0;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    *nreadp += nread;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  } <span class="comment">/* while there&#39;s buffer left and loop is requested */</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#a3a10091c256aed9fce33a95f12bf5b8f">pending_resp</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;}</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor">#if defined(DEBUGBUILD) &amp;&amp; !defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="comment">/* for debug purposes */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ftp_state_names[]={</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="stringliteral">&quot;STOP&quot;</span>,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="stringliteral">&quot;WAIT220&quot;</span>,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="stringliteral">&quot;AUTH&quot;</span>,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="stringliteral">&quot;USER&quot;</span>,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="stringliteral">&quot;PASS&quot;</span>,</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="stringliteral">&quot;ACCT&quot;</span>,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="stringliteral">&quot;PBSZ&quot;</span>,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="stringliteral">&quot;PROT&quot;</span>,</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="stringliteral">&quot;CCC&quot;</span>,</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="stringliteral">&quot;PWD&quot;</span>,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="stringliteral">&quot;SYST&quot;</span>,</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="stringliteral">&quot;NAMEFMT&quot;</span>,</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="stringliteral">&quot;QUOTE&quot;</span>,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="stringliteral">&quot;RETR_PREQUOTE&quot;</span>,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="stringliteral">&quot;STOR_PREQUOTE&quot;</span>,</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="stringliteral">&quot;POSTQUOTE&quot;</span>,</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="stringliteral">&quot;CWD&quot;</span>,</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="stringliteral">&quot;MKD&quot;</span>,</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="stringliteral">&quot;MDTM&quot;</span>,</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="stringliteral">&quot;TYPE&quot;</span>,</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="stringliteral">&quot;LIST_TYPE&quot;</span>,</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="stringliteral">&quot;RETR_TYPE&quot;</span>,</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="stringliteral">&quot;STOR_TYPE&quot;</span>,</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="stringliteral">&quot;SIZE&quot;</span>,</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="stringliteral">&quot;RETR_SIZE&quot;</span>,</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="stringliteral">&quot;STOR_SIZE&quot;</span>,</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="stringliteral">&quot;REST&quot;</span>,</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="stringliteral">&quot;RETR_REST&quot;</span>,</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="stringliteral">&quot;PORT&quot;</span>,</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="stringliteral">&quot;PRET&quot;</span>,</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="stringliteral">&quot;PASV&quot;</span>,</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="stringliteral">&quot;LIST&quot;</span>,</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="stringliteral">&quot;RETR&quot;</span>,</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="stringliteral">&quot;STOR&quot;</span>,</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="stringliteral">&quot;QUIT&quot;</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;};</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">/* This is the ONLY way to change FTP state! */</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _state(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                   <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> newstate</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;#ifdef DEBUGBUILD</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                   , <span class="keywordtype">int</span> lineno</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;#endif</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  )</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;{</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="preprocessor">#if defined(DEBUGBUILD)</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="preprocessor">#if defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  (void) lineno;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a> != newstate)</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;FTP %p (line %d) state change from %s to %s\n&quot;</span>,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          (<span class="keywordtype">void</span> *)ftpc, lineno, ftp_state_names[ftpc-&gt;state],</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          ftp_state_names[newstate]);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a> = newstate;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_user(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;{</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">/* send USER */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;USER %s&quot;</span>, ftp-&gt;<a class="code" href="struct_f_t_p.html#ada20af2bff00cbbf74221db56fce01d3">user</a>?ftp-&gt;<a class="code" href="struct_f_t_p.html#ada20af2bff00cbbf74221db56fce01d3">user</a>:<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a">FTP_USER</a>);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0caaf995a72fe34ed49b6da18b36e9f6">ftp_trying_alternative</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;}</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_pwd(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;{</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">/* send PWD to discover our entry point */</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;PWD&quot;</span>);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca379f22e83e32b84e6ae13c8e2ec021">FTP_PWD</a>);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">/* For the FTP &quot;protocol connect&quot; and &quot;doing&quot; phases only */</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                       <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                       <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;{</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#aafa087a3d539d9b5e1257c083a4e93d2">Curl_pp_getsock</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, socks, numsocks);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">/* For the FTP &quot;DO_MORE&quot; phase only */</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_domore_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                              <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;{</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">if</span>(!numsocks)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="comment">/* When in DO_MORE state, we could be either waiting for us to connect to a</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">   * remote site, or we could wait for that site to connect to us. Or just</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">   * handle ordinary commands.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a> == ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">int</span> bits = <a class="code" href="multiif_8h.html#a4ae1fb64a27264765b6a2fe5aca78830">GETSOCK_READSOCK</a>(0);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">/* if stopped and still in this state, then we&#39;re also waiting for a</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">       connect on the secondary connection */</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    socks[0] = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a2707060ddbd7ff8a8893a7305a16d187">ftp_use_port</a>) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keywordtype">int</span> s;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="comment">/* PORT is used to tell the server to connect to us, and during that we</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">         don&#39;t do happy eyeballs, but we do if we connect to the server */</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">for</span>(s = 1, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;2; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a2e6cc8a072c4712d1a113c56ef37dd13">tempsock</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          socks[s] = conn-&gt;<a class="code" href="structconnectdata.html#a2e6cc8a072c4712d1a113c56ef37dd13">tempsock</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          bits |= <a class="code" href="multiif_8h.html#a9aabda59f0ff87c1db3a2d306a410713">GETSOCK_WRITESOCK</a>(s++);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      socks[1] = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>];</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      bits |= <a class="code" href="multiif_8h.html#a9aabda59f0ff87c1db3a2d306a410713">GETSOCK_WRITESOCK</a>(1) | <a class="code" href="multiif_8h.html#a4ae1fb64a27264765b6a2fe5aca78830">GETSOCK_READSOCK</a>(1);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">return</span> bits;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  }</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#aafa087a3d539d9b5e1257c083a4e93d2">Curl_pp_getsock</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, socks, numsocks);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;}</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">/* This is called after the FTP_QUOTE state is passed.</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">   ftp_state_cwd() sends the range of CWD commands to the server to change to</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">   the correct directory. It may also need to send MKD commands to create</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">   missing ones, if that option is enabled.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_cwd(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;{</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#ae6de82dcc76af4ea97e828e326606561">cwddone</a>)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="comment">/* already done and fine */</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_mdtm(conn);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = 0; <span class="comment">/* count2 counts failed CWDs */</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">/* count3 is set to allow a MKD to fail once. In the case when first CWD</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">       fails and then MKD fails (due to another session raced it to create the</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">       dir) this then allows for a second try to CWD to it */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">count3</a> = (conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a55d6133449a8920a98a66cb9c7d1ae61">ftp_create_missing_dirs</a> == 2)?1:0;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">if</span>((conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a0a3e765ba0eae3d45e73a0a0ec4a124b">ftp_filemethod</a> == <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a>) &amp;&amp; !ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a>)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="comment">/* No CWD necessary */</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_mdtm(conn);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a40c9341dbcd23241fd1b75054cf050a2">reuse</a> &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="comment">/* This is a re-used connection. Since we change directory to where the</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">         transfer is taking place, we must first get back to the original dir</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">         where we ended up after login: */</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> = 0; <span class="comment">/* we count this as the first path, then we add one</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">                             for all upcoming ones in the ftp-&gt;dirs[] array */</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;CWD %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f">FTP_CWD</a>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> = 1;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">/* issue the first CWD, the rest is sent when the CWD responses are</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">           received... */</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;CWD %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> -1]);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f">FTP_CWD</a>);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">/* No CWD necessary */</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_mdtm(conn);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  }</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno"><a class="line" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">  922</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> {</div><div class="line"><a name="l00923"></a><span class="lineno"><a class="line" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">  923</a></span>&#160;  <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a>,</div><div class="line"><a name="l00924"></a><span class="lineno"><a class="line" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">  924</a></span>&#160;  <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">PORT</a>,</div><div class="line"><a name="l00925"></a><span class="lineno"><a class="line" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749">  925</a></span>&#160;  <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749">DONE</a></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;} <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">ftpport</a>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_use_port(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                   <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">ftpport</a> fcmd) <span class="comment">/* start with this */</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;{</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> portsock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordtype">char</span> myhost[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__sockaddr__storage.html">Curl_sockaddr_storage</a> ss;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *res, *ai;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> sslen;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordtype">char</span> hbuf[<a class="code" href="ftp_8c.html#aebc53e498b2434654a1d44070d9ccd40">NI_MAXHOST</a>];</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keyword">struct </span>sockaddr *sa = (<span class="keyword">struct </span>sockaddr *)&amp;ss;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keyword">struct </span>sockaddr_in * <span class="keyword">const</span> sa4 = (<span class="keywordtype">void</span> *)sa;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keyword">struct </span>sockaddr_in6 * <span class="keyword">const</span> sa6 = (<span class="keywordtype">void</span> *)sa;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordtype">char</span> tmp[1024];</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> mode[][5] = { <span class="stringliteral">&quot;EPRT&quot;</span>, <span class="stringliteral">&quot;PORT&quot;</span> };</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = NULL;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordtype">char</span> *string_ftpport = <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa6114ab34b2617b1417c28d34af22bed6">STRING_FTPPORT</a>];</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *h = NULL;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port_min = 0;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port_max = 0;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordtype">bool</span> possibly_non_local = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> = NULL;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="comment">/* Step 1, figure out what is requested,</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">   * accepted format :</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">   * (ipv4|ipv6|domain|interface)?(:port(-range)?)?</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa6114ab34b2617b1417c28d34af22bed6">STRING_FTPPORT</a>] &amp;&amp;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;     (strlen(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa6114ab34b2617b1417c28d34af22bed6">STRING_FTPPORT</a>]) &gt; 1)) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordtype">size_t</span> addrlen = INET6_ADDRSTRLEN &gt; strlen(string_ftpport) ?</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      INET6_ADDRSTRLEN : strlen(string_ftpport);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">size_t</span> addrlen = <a class="code" href="ftp_8c.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a> &gt; strlen(string_ftpport) ?</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <a class="code" href="ftp_8c.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a> : strlen(string_ftpport);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="keywordtype">char</span> *ip_start = string_ftpport;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordtype">char</span> *ip_end = NULL;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordtype">char</span> *port_start = NULL;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">char</span> *port_sep = NULL;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(addrlen + 1, 1);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>)</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">if</span>(*string_ftpport == <span class="charliteral">&#39;[&#39;</span>) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="comment">/* [ipv6]:port(-range) */</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      ip_start = string_ftpport + 1;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      ip_end = strchr(string_ftpport, <span class="charliteral">&#39;]&#39;</span>);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">if</span>(ip_end)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        strncpy(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>, ip_start, ip_end - ip_start);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">if</span>(*string_ftpport == <span class="charliteral">&#39;:&#39;</span>) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment">/* :port */</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        ip_end = string_ftpport;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      }</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        ip_end = strchr(string_ftpport, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">if</span>(ip_end) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          <span class="comment">/* either ipv6 or (ipv4|domain|interface):port(-range) */</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, string_ftpport, sa6) == 1) {</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="comment">/* ipv6 */</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            port_min = port_max = 0;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            strcpy(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>, string_ftpport);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            ip_end = NULL; <span class="comment">/* this got no port ! */</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <span class="comment">/* (ipv4|domain|interface):port(-range) */</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            strncpy(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>, string_ftpport, ip_end - ip_start);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;          <span class="comment">/* ipv4|interface */</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;          strcpy(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>, string_ftpport);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">/* parse the port */</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span>(ip_end != NULL) {</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      port_start = strchr(ip_end, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">if</span>(port_start) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        port_min = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(strtoul(port_start + 1, NULL, 10));</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        port_sep = strchr(port_start, <span class="charliteral">&#39;-&#39;</span>);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span>(port_sep) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          port_max = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(strtoul(port_sep + 1, NULL, 10));</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;          port_max = port_min;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    }</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">/* correct errors like:</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">     *  :1234-1230</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">     *  :-4711,  in this case port_min is (unsigned)-1,</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">     *           therefore port_min &gt; port_max for all cases</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">     *           but port_max = (unsigned)-1</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">if</span>(port_min &gt; port_max)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      port_min = port_max = 0;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">if</span>(*<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> != <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="comment">/* attempt to get the address of the given interface name */</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">switch</span>(<a class="code" href="if2ip_8c.html#a2ab76018a23e5e70cf88972417e60310">Curl_if2ip</a>(conn-&gt;<a class="code" href="structconnectdata.html#ac3d5c58d5ebf77ad3eccd2332c424800">ip_addr</a>-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a>,</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                        <a class="code" href="if2ip_8c.html#a5991d11c807cffabec1cd1426ea9cae9">Curl_ipv6_scope</a>(conn-&gt;<a class="code" href="structconnectdata.html#ac3d5c58d5ebf77ad3eccd2332c424800">ip_addr</a>-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>),</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                        conn-&gt;<a class="code" href="structconnectdata.html#ac808f51d6deb49f7806300cc1da23824">scope_id</a>, <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>, hbuf, <span class="keyword">sizeof</span>(hbuf))) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eea6f409d3c1e34d2b7c92a46d51e60405c">IF2IP_NOT_FOUND</a>:</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          <span class="comment">/* not an interface, use the given string as host name instead */</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;          <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eea6389ed3ecbe54bc7bbe4fa60080b9eff">IF2IP_AF_NOT_SUPPORTED</a>:</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eeafa243304b615badc01baed1ef9ecf04d">IF2IP_FOUND</a>:</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = hbuf; <span class="comment">/* use the hbuf for host name */</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="comment">/* there was only a port(-range) given, default the host */</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = NULL;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  } <span class="comment">/* data-&gt;set.ftpport */</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a>) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="comment">/* not an interface and not a host name, get default by extracting</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">       the IP from the control connection */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    sslen = <span class="keyword">sizeof</span>(ss);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span>(getsockname(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>], sa, &amp;sslen)) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;getsockname() failed: %s&quot;</span>,</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>) );</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">switch</span>(sa-&gt;sa_family) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <a class="code" href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a>(sa-&gt;sa_family, &amp;sa6-&gt;sin6_addr, hbuf, <span class="keyword">sizeof</span>(hbuf));</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <a class="code" href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a>(sa-&gt;sa_family, &amp;sa4-&gt;sin_addr, hbuf, <span class="keyword">sizeof</span>(hbuf));</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = hbuf; <span class="comment">/* use this host name */</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    possibly_non_local = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* we know it is local now */</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">/* resolv ip/host to ip */</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a>, 0, &amp;h);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>)</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    (void)<a class="code" href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a>(conn, &amp;h);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">if</span>(h) {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    res = h-&gt;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">/* when we return from this function, we can forget about this entry</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">       to we can unlock it now already */</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<a class="code" href="structdata.html">data</a>, h);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  } <span class="comment">/* (h) */</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    res = NULL; <span class="comment">/* failure! */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordflow">if</span>(res == NULL) {</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to resolve the address provided to PORT: %s&quot;</span>, <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a>);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <a class="code" href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a> = NULL;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="comment">/* step 2, create a socket for the requested address */</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  portsock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  error = 0;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="keywordflow">for</span>(ai = res; ai; ai = ai-&gt;ai_next) {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="connect_8c.html#a35b7c261ff856c8778571709f440b837">Curl_socket</a>(conn, ai, NULL, &amp;portsock);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="keywordflow">if</span>(!ai) {</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;socket failure: %s&quot;</span>, <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, error));</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="comment">/* step 3, bind to a suitable local address */</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(sa, ai-&gt;ai_addr, ai-&gt;ai_addrlen);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  sslen = ai-&gt;ai_addrlen;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordflow">for</span>(port = port_min; port &lt;= port_max;) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">if</span>(sa-&gt;sa_family == AF_INET)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      sa4-&gt;sin_port = htons(port);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      sa6-&gt;sin6_port = htons(port);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">/* Try binding the given address. */</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(portsock, sa, sslen) ) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="comment">/* It failed. */</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">if</span>(possibly_non_local &amp;&amp; (error == EADDRNOTAVAIL)) {</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <span class="comment">/* The requested bind address is not local.  Use the address used for</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">         * the control connection instead and restart the port loop</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;bind(port=%hu) on non-local address failed: %s\n&quot;</span>, port,</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;              <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, error) );</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        sslen = <span class="keyword">sizeof</span>(ss);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keywordflow">if</span>(getsockname(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>], sa, &amp;sslen)) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;getsockname() failed: %s&quot;</span>,</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>) );</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        port = port_min;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        possibly_non_local = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* don&#39;t try this again */</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordflow">if</span>(error != EADDRINUSE &amp;&amp; error != EACCES) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;bind(port=%hu) failed: %s&quot;</span>, port,</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;              <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, error) );</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    port++;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="comment">/* maybe all ports were in use already*/</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keywordflow">if</span>(port &gt; port_max) {</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;bind() failed, we ran out of ports!&quot;</span>);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  }</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">/* get the name again after the bind() so that we can extract the</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">     port number it uses now */</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  sslen = <span class="keyword">sizeof</span>(ss);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordflow">if</span>(getsockname(portsock, (<span class="keyword">struct</span> sockaddr *)sa, &amp;sslen)) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;getsockname() failed: %s&quot;</span>,</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>) );</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="comment">/* step 4, listen on the socket */</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordflow">if</span>(listen(portsock, 1)) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;socket failure: %s&quot;</span>, <a class="code" href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a>(conn, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>));</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  }</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">/* step 5, send the proper FTP command */</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">/* get a plain printable version of the numerical address to work with</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">     below */</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <a class="code" href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a>(ai, myhost, <span class="keyword">sizeof</span>(myhost));</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa6493ae964163380f432dd306f2618f6">ftp_use_eprt</a> &amp;&amp; conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa4606cd7d5928857e28473a129c4ccf0">ipv6</a>)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="comment">/* EPRT is disabled but we are connected to a IPv6 host, so we ignore the</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">       request and enable EPRT again! */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa6493ae964163380f432dd306f2618f6">ftp_use_eprt</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">for</span>(; fcmd != <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749">DONE</a>; fcmd++) {</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa6493ae964163380f432dd306f2618f6">ftp_use_eprt</a> &amp;&amp; (<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a> == fcmd))</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="comment">/* if disabled, goto next */</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">PORT</a> == fcmd) &amp;&amp; sa-&gt;sa_family != AF_INET)</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      <span class="comment">/* PORT is IPv4 only */</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">switch</span>(sa-&gt;sa_family) {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      port = ntohs(sa4-&gt;sin_port);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      port = ntohs(sa6-&gt;sin6_port);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">/* might as well skip this */</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a> == fcmd) {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">       * Two fine examples from RFC2428;</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">       * EPRT |1|132.235.1.2|6275|</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">       * EPRT |2|1080::8:800:200C:417A|5282|</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s |%d|%s|%hu|&quot;</span>, mode[fcmd],</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                             sa-&gt;sa_family == AF_INET?1:2,</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                             myhost, port);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failure sending EPRT command: %s&quot;</span>,</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;              <a class="code" href="curl_8h.html#a1feaa896e865ad01f32cc46f6f8c72f5">curl_easy_strerror</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>));</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="comment">/* don&#39;t retry using PORT */</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">PORT</a>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="comment">/* bail out */</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">PORT</a> == fcmd) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordtype">char</span> *source = myhost;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordtype">char</span> *dest = tmp;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="comment">/* translate x.x.x.x to x,x,x,x */</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <span class="keywordflow">while</span>(source &amp;&amp; *source) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="keywordflow">if</span>(*source == <span class="charliteral">&#39;.&#39;</span>)</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;          *dest = <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;          *dest = *source;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        dest++;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        source++;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      *dest = 0;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(dest, 20, <span class="stringliteral">&quot;,%d,%d&quot;</span>, (<span class="keywordtype">int</span>)(port&gt;&gt;8), (<span class="keywordtype">int</span>)(port&amp;0xff));</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s %s&quot;</span>, mode[fcmd], tmp);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failure sending PORT command: %s&quot;</span>,</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;              <a class="code" href="curl_8h.html#a1feaa896e865ad01f32cc46f6f8c72f5">curl_easy_strerror</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>));</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <a class="code" href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a>(conn, portsock);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="comment">/* bail out */</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="comment">/* store which command was sent */</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = fcmd;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  close_secondarysocket(conn);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="comment">/* we set the secondary socket variable to this for now, it is only so that</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">     the cleanup function will close it in case we fail before the true</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">     secondary stuff is made */</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = portsock;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="comment">/* this tcpconnect assignment below is a hackish work-around to make the</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">     multi interface with active FTP work - as it will not wait for a</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">     (passive) connect in Curl_is_connected().</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">     The *proper* fix is to make sure that the active connection from the</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">     server is done in a non-blocking way. Currently, it is still BLOCKING.</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ad8fbe74a695b640f4c917d49696c1b90">FTP_PORT</a>);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;}</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_use_pasv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;{</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">    Here&#39;s the excecutive summary on what to do:</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">    PASV is RFC959, expect:</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">    227 Entering Passive Mode (a1,a2,a3,a4,p1,p2)</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">    LPSV is RFC1639, expect:</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">    228 Entering Long Passive Mode (4,4,a1,a2,a3,a4,2,p1,p2)</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">    EPSV is RFC2428, expect:</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">    229 Entering Extended Passive Mode (|||port|)</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> mode[][5] = { <span class="stringliteral">&quot;EPSV&quot;</span>, <span class="stringliteral">&quot;PASV&quot;</span> };</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordtype">int</span> modeoff;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#ifdef PF_INET6</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a06ee9e40c4f7e506b01c849754ae40c8">ftp_use_epsv</a> &amp;&amp; conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa4606cd7d5928857e28473a129c4ccf0">ipv6</a>)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="comment">/* EPSV is disabled but we are connected to a IPv6 host, so we ignore the</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">       request and enable EPSV again! */</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a06ee9e40c4f7e506b01c849754ae40c8">ftp_use_epsv</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  modeoff = conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a06ee9e40c4f7e506b01c849754ae40c8">ftp_use_epsv</a>?0:1;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, mode[modeoff]);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = modeoff;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac50fb126afa10cf6754b070caa0485e3">FTP_PASV</a>);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Connect data stream passively\n&quot;</span>);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;}</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment"> * ftp_state_prepare_transfer() starts PORT, PASV or PRET etc.</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment"> * REST is the last command in the chain of commands when a &quot;head&quot;-like</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment"> * request is made. Thus, if an actual transfer is to be made this is where we</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"> * take off for real.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_prepare_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;{</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>) {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="comment">/* doesn&#39;t transfer any data */</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">/* still possibly do PRE QUOTE jobs */</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_quote(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_use_port) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">/* We have chosen to use the PORT (or similar) command */</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_use_port(conn, <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="comment">/* We have chosen (this is default) to use the PASV (or similar) command */</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_use_pret) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="comment">/* The user has requested that we send a PRET command</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">         to prepare the server for the upcoming PASV */</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PRET %s&quot;</span>,</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a>]?</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a>]:</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                (<a class="code" href="structdata.html">data</a>-&gt;set.ftp_list_only?<span class="stringliteral">&quot;NLST&quot;</span>:<span class="stringliteral">&quot;LIST&quot;</span>));</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      }</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.upload) {</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PRET STOR %s&quot;</span>, conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      }</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PRET RETR %s&quot;</span>, conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1e32e2a175bcdb45625a04ebcfea1d7f">FTP_PRET</a>);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_use_pasv(conn);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  }</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_rest(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;{</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="keywordflow">if</span>((ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>) &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">/* if a &quot;head&quot;-like request is being made (on a file) */</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="comment">/* Determine if server can respond to REST command and therefore</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">       whether it supports range */</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;REST %d&quot;</span>, 0);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a9dfb8cf86d141a0b4dd611d19069d127">FTP_REST</a>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  }</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_prepare_transfer(conn);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;}</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_size(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;{</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordflow">if</span>((ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> == <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a>) &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="comment">/* if a &quot;head&quot;-like request is being made (on a file) */</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">/* we know ftpc-&gt;file is a valid pointer to a file name */</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;SIZE %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b38c28089de4d15ded4a7a16ac28a87">FTP_SIZE</a>);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_rest(conn);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;}</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_list(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;{</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="comment">/* If this output is to be machine-parsed, the NLST command might be better</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">     to use, since the LIST command output is not specified or standard in any</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">     way. It has turned out that the NLST list output is not the same on all</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">     servers either... */</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">     if FTPFILE_NOCWD was specified, we are currently in</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">     the user&#39;s home directory, so we should add the path</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">     as argument for the LIST / NLST / or custom command.</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment">     Whether the server will support this, is uncertain.</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">     The other ftp_filemethods will CWD into dir/dir/ first and</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment">     then just do LIST (in that case: nothing to do here)</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordtype">char</span> *cmd, *lstArg, *slashPos;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *inpath = ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  lstArg = NULL;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;set.ftp_filemethod == <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a>) &amp;&amp;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;     inpath &amp;&amp; inpath[0] &amp;&amp; strchr(inpath, <span class="charliteral">&#39;/&#39;</span>)) {</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = strlen(inpath);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="comment">/* Check if path does not end with /, as then we cut off the file part */</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span>(inpath[<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> - 1] != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="comment">/* chop off the file part if format is dir/dir/file */</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      slashPos = strrchr(inpath, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = slashPos - inpath;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, inpath, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, &amp;lstArg, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  cmd = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>,</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a>]?</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a>]:</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                (<a class="code" href="structdata.html">data</a>-&gt;set.ftp_list_only?<span class="stringliteral">&quot;NLST&quot;</span>:<span class="stringliteral">&quot;LIST&quot;</span>),</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                lstArg? <span class="stringliteral">&quot; &quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                lstArg? lstArg: <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordflow">if</span>(!cmd) {</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(lstArg);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  }</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, cmd);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(lstArg);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;}</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_retr_prequote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;{</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">/* We&#39;ve sent the TYPE, now we must send the list of prequote strings */</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_quote(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;}</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_stor_prequote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;{</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="comment">/* We&#39;ve sent the TYPE, now we must send the list of prequote strings */</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_quote(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15">FTP_STOR_PREQUOTE</a>);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;}</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_type(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;{</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">/* If we have selected NOBODY and HEADER, it means that we only want file</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">     information. Which in FTP can&#39;t be much more than the file size and</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">     date. */</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.opt_no_body &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a> &amp;&amp;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;     ftp_need_type(conn, <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii)) {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="comment">/* The SIZE command is _not_ RFC 959 specified, and therefore many servers</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">       may not support it! It is however the only way we have to get a file&#39;s</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">       size! */</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="comment">/* this means no actual transfer will be made */</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="comment">/* Some servers return different sizes for different modes, and thus we</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">       must set the proper type before we check the size */</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_nb_type(conn, <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2706bd50f04c829f62a30ee886e67ed0">FTP_TYPE</a>);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_size(conn);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;}</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">/* This is called after the CWD commands have been done in the beginning of</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment">   the DO phase */</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_mdtm(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;{</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="comment">/* Requested time of file or time-depended transfer? */</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;set.get_filetime || <a class="code" href="structdata.html">data</a>-&gt;set.timecondition) &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="comment">/* we have requested to get the modified-time of the file, this is a white</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">       spot as the MDTM is not mentioned in RFC959 */</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;MDTM %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a27602c6b9eaa7f0ce5fbb45493180e49">FTP_MDTM</a>);</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_type(conn);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;}</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">/* This is called after the TYPE and possible quote commands have been sent */</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_ul_setup(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                                   <span class="keywordtype">bool</span> sizechecked)</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;{</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;state.resume_from &amp;&amp; !sizechecked) ||</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;     ((<a class="code" href="structdata.html">data</a>-&gt;state.resume_from &gt; 0) &amp;&amp; sizechecked)) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="comment">/* we&#39;re about to continue the uploading of a file */</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="comment">/* 1. get already existing file&#39;s size. We use the SIZE command for this</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">       which may not exist in the server!  The SIZE command is not in</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">       RFC959. */</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="comment">/* 2. This used to set REST. But since we can do append, we</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">       don&#39;t another ftp command. We just skip the source file</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">       offset and then we APPEND the rest on the file instead */</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">/* 3. pass file-size number of bytes in the source file */</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="comment">/* 4. lower the infilesize counter */</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="comment">/* =&gt; transfer as usual */</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordtype">int</span> seekerr = <a class="code" href="curl_8h.html#af7074ca58279ac7ad8f78b9954a31160">CURL_SEEKFUNC_OK</a>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.resume_from &lt; 0) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="comment">/* Got no given size to start from, figure it out */</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;SIZE %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b3b874197ce162d8f012723a7184004">FTP_STOR_SIZE</a>);</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    }</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="comment">/* enable append */</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;set.ftp_append = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="comment">/* Let&#39;s read off the proper amount of bytes from the input. */</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a01e38af502b3798152533aa52884b423">seek_func</a>) {</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      seekerr = conn-&gt;<a class="code" href="structconnectdata.html#a01e38af502b3798152533aa52884b423">seek_func</a>(conn-&gt;<a class="code" href="structconnectdata.html#ad7ad0216049eeb5099888585025e2202">seek_client</a>, <a class="code" href="structdata.html">data</a>-&gt;state.resume_from,</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                                SEEK_SET);</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    }</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span>(seekerr != <a class="code" href="curl_8h.html#af7074ca58279ac7ad8f78b9954a31160">CURL_SEEKFUNC_OK</a>) {</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> passed = 0;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="keywordflow">if</span>(seekerr != <a class="code" href="curl_8h.html#a34eb017e0a29378f976becdaa94160d1">CURL_SEEKFUNC_CANTSEEK</a>) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Could not seek stream&quot;</span>);</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a404154a216fca019f85509759015820c">CURLE_FTP_COULDNT_USE_REST</a>;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      }</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <span class="comment">/* seekerr == CURL_SEEKFUNC_CANTSEEK (can&#39;t seek to offset) */</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="keywordtype">size_t</span> readthisamountnow =</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;          (<a class="code" href="structdata.html">data</a>-&gt;state.resume_from - passed &gt; <a class="code" href="structdata.html">data</a>-&gt;set.buffer_size) ?</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;          (<span class="keywordtype">size_t</span>)<a class="code" href="structdata.html">data</a>-&gt;set.buffer_size :</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;          <a class="code" href="warnless_8c.html#a9b1c2efcef4120b8096d53bc254bfb9b">curlx_sotouz</a>(<a class="code" href="structdata.html">data</a>-&gt;state.resume_from - passed);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="keywordtype">size_t</span> actuallyread =</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;state.fread_func(<a class="code" href="structdata.html">data</a>-&gt;state.buffer, 1, readthisamountnow,</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                                 <a class="code" href="structdata.html">data</a>-&gt;state.in);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        passed += actuallyread;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">if</span>((actuallyread == 0) || (actuallyread &gt; readthisamountnow)) {</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;          <span class="comment">/* this checks for greater-than only to make sure that the</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">             CURL_READFUNC_ABORT return code still aborts */</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to read data&quot;</span>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a404154a216fca019f85509759015820c">CURLE_FTP_COULDNT_USE_REST</a>;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      } <span class="keywordflow">while</span>(passed &lt; data-&gt;<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>.resume_from);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    }</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="comment">/* now, decrease the size of the read */</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.infilesize&gt;0) {</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;state.infilesize -= <a class="code" href="structdata.html">data</a>-&gt;state.resume_from;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.infilesize &lt;= 0) {</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;File already completely uploaded\n&quot;</span>);</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="comment">/* no data to transfer */</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="comment">/* Set -&gt;transfer so that we won&#39;t get any error in</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">         * ftp_done() because we didn&#39;t transfer anything! */</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a>;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      }</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <span class="comment">/* we&#39;ve passed, proceed as normal */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  } <span class="comment">/* resume_from */</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <a class="code" href="structdata.html">data</a>-&gt;set.ftp_append?<span class="stringliteral">&quot;APPE %s&quot;</span>:<span class="stringliteral">&quot;STOR %s&quot;</span>,</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab1ccd7c5223945586470ddac912f5659">FTP_STOR</a>);</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;}</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_quote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                                <span class="keywordtype">bool</span> init,</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                                <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;{</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="keywordtype">bool</span> quote = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *item;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">switch</span>(instate) {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2">FTP_QUOTE</a>:</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    item = <a class="code" href="structdata.html">data</a>-&gt;set.quote;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>:</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15">FTP_STOR_PREQUOTE</a>:</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    item = <a class="code" href="structdata.html">data</a>-&gt;set.prequote;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac15dd7cd691c70046eb44ed87668587b">FTP_POSTQUOTE</a>:</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    item = <a class="code" href="structdata.html">data</a>-&gt;set.postquote;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  }</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">   * This state uses:</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">   * &#39;count1&#39; to iterate over the commands to send</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">   * &#39;count2&#39; to store whether to allow commands to fail</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keywordflow">if</span>(init)</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = 0;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a>++;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">if</span>(item) {</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="comment">/* Skip count1 items in the linked list */</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">while</span>((i&lt; ftpc-&gt;count1) &amp;&amp; item) {</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      item = item-&gt;<a class="code" href="structcurl__slist.html#a56fcfc41d89a47865933c310d316a108">next</a>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    }</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordflow">if</span>(item) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordtype">char</span> *cmd = item-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">if</span>(cmd[0] == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        cmd++;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = 1; <span class="comment">/* the sent command is allowed to fail */</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = 0; <span class="comment">/* failure means cancel operation */</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, cmd);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, instate);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      quote = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    }</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  }</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordflow">if</span>(!quote) {</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="comment">/* No more quote to send, continue to ... */</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keywordflow">switch</span>(instate) {</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2">FTP_QUOTE</a>:</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_cwd(conn);</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>:</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a> != -1) {</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, ftpc-&gt;<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a>);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_retr(conn, ftpc-&gt;<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a>);</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        }</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ignorecl) {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            <span class="comment">/* This code is to support download of growing files.  It prevents</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">               the state machine from requesting the file size from the</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">               server.  With an unknown file size the download continues until</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">               the server terminates it, otherwise the client stops if the</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">               received byte count exceeds the reported file size.  Set option</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">               CURLOPT_IGNORE_CONTENT_LENGTH to 1 to enable this behavior.*/</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;RETR %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a>);</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;          }</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;          <span class="keywordflow">else</span> {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;SIZE %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;            <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65af08a45f6d43a3e58495131fb582ff1c0">FTP_RETR_SIZE</a>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          }</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        }</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      }</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15">FTP_STOR_PREQUOTE</a>:</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_ul_setup(conn, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac15dd7cd691c70046eb44ed87668587b">FTP_POSTQUOTE</a>:</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    }</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  }</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;}</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">/* called from ftp_state_pasv_resp to switch to PASV in case of EPSV</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">   problems */</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_epsv_disable(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;{</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa4606cd7d5928857e28473a129c4ccf0">ipv6</a> &amp;&amp; !(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">tunnel_proxy</a> || conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a91829a03c2fae88d0de9c895e9df8cca">socksproxy</a>)) {</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="comment">/* We can&#39;t disable EPSV when doing IPv6, so this is instead a fail */</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed EPSV attempt, exiting\n&quot;</span>);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  }</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed EPSV attempt. Disabling EPSV\n&quot;</span>);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="comment">/* disable it for next transfer */</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a06ee9e40c4f7e506b01c849754ae40c8">ftp_use_epsv</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a826153c9d8591bb303e3edccf169520b">errorbuf</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* allow error message to get</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">                                         rewritten */</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;PASV&quot;</span>);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a>++;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <span class="comment">/* remain in/go to the FTP_PASV state */</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac50fb126afa10cf6754b070caa0485e3">FTP_PASV</a>);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;}</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *control_address(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;{</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="comment">/* Returns the control connection IP address.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">     If a proxy tunnel is used, returns the original host name instead, because</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">     the effective control connection address is the proxy address,</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">     not the ftp host. */</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">tunnel_proxy</a> || conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a91829a03c2fae88d0de9c895e9df8cca">socksproxy</a>)</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">return</span> conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordflow">return</span> conn-&gt;<a class="code" href="structconnectdata.html#a9dc784dcbf29ca027c3aa6eda1cc8755">ip_addr_str</a>;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;}</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_pasv_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                                    <span class="keywordtype">int</span> ftpcode)</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;{</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> = NULL;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> connectport; <span class="comment">/* the local port connect() should use! */</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = &amp;<a class="code" href="structdata.html">data</a>-&gt;state.buffer[4];  <span class="comment">/* start on the first letter */</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="comment">/* if we come here again, make sure the former name is cleared */</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>);</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="keywordflow">if</span>((ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> == 0) &amp;&amp;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;     (ftpcode == 229)) {</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="comment">/* positive EPSV response */</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strchr(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="charliteral">&#39;(&#39;</span>);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="keywordtype">char</span> separator[4];</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">if</span>(5 == sscanf(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, <span class="stringliteral">&quot;%c%c%c%u%c&quot;</span>,</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                     &amp;separator[0],</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                     &amp;separator[1],</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                     &amp;separator[2],</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                     &amp;num,</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                     &amp;separator[3])) {</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> sep1 = separator[0];</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="comment">/* The four separators should be identical, or else this is an oddly</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">           formatted reply and we bail out immediately. */</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;4; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;          <span class="keywordflow">if</span>(separator[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != sep1) {</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = NULL; <span class="comment">/* set to NULL to signal error */</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;          }</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        }</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordflow">if</span>(num &gt; 0xffff) {</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Illegal port number in EPSV reply&quot;</span>);</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647">CURLE_FTP_WEIRD_PASV_REPLY</a>;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        }</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">newport</a> = (<span class="keywordtype">unsigned</span> short)(num &amp; 0xffff);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(control_address(conn));</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;          <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>)</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        }</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      }</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = NULL;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    }</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Weirdly formatted EPSV reply&quot;</span>);</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647">CURLE_FTP_WEIRD_PASV_REPLY</a>;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    }</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  }</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> == 1) &amp;&amp;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          (ftpcode == 227)) {</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="comment">/* positive PASV response */</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ip[4];</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port[2];</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">     * Scan for a sequence of six comma-separated numbers and use them as</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">     * IP+port indicators.</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">     * Found reply-strings include:</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">     * &quot;227 Entering Passive Mode (127,0,0,1,4,51)&quot;</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">     * &quot;227 Data transfer will passively listen to 127,0,0,1,4,51&quot;</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     * &quot;227 Entering passive mode. 127,0,0,1,4,51&quot;</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) {</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keywordflow">if</span>(6 == sscanf(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="stringliteral">&quot;%u,%u,%u,%u,%u,%u&quot;</span>,</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                     &amp;ip[0], &amp;ip[1], &amp;ip[2], &amp;ip[3],</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                     &amp;port[0], &amp;port[1]))</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>++;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    }</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">if</span>(!*<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> || (ip[0] &gt; 255) || (ip[1] &gt; 255)  || (ip[2] &gt; 255)  ||</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;       (ip[3] &gt; 255) || (port[0] &gt; 255)  || (port[1] &gt; 255) ) {</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Couldn&#39;t interpret the 227-response&quot;</span>);</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa798d744ee845440856a8fdfcaf46b06">CURLE_FTP_WEIRD_227_FORMAT</a>;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    }</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="comment">/* we got OK from server */</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_skip_ip) {</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      <span class="comment">/* told to ignore the remotely given IP but instead use the host we used</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">         for the control connection */</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Skip %u.%u.%u.%u for data connection, re-use %s instead\n&quot;</span>,</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            ip[0], ip[1], ip[2], ip[3],</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>);</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(control_address(conn));</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a> = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%u.%u.%u.%u&quot;</span>, ip[0], ip[1], ip[2], ip[3]);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">newport</a> = (<span class="keywordtype">unsigned</span> short)(((port[0]&lt;&lt;8) + port[1]) &amp; 0xffff);</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  }</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> == 0) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="comment">/* EPSV failed, move on to PASV */</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">return</span> ftp_epsv_disable(conn);</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Bad PASV/EPSV response: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647">CURLE_FTP_WEIRD_PASV_REPLY</a>;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  }</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#ad6024fcc7a2aefd8d8d1359f9ae7955d">proxy</a>) {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">     * This connection uses a proxy and we need to connect to the proxy again</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">     * here. We don&#39;t want to rely on a former host lookup that might&#39;ve</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">     * expired now, instead we remake the lookup here and now!</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> host_name = conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a91829a03c2fae88d0de9c895e9df8cca">socksproxy</a> ?</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a44ea1ec223e43a877daac8a34167096a">socks_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> : conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, host_name, (<span class="keywordtype">int</span>)conn-&gt;<a class="code" href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">port</a>, &amp;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>)</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="comment">/* BLOCKING, ignores the return code but &#39;addr&#39; will be NULL in</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">         case of failure */</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      (void)<a class="code" href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a>(conn, &amp;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    connectport =</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      (<span class="keywordtype">unsigned</span> short)conn-&gt;<a class="code" href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">port</a>; <span class="comment">/* we connect to the proxy&#39;s port */</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>) {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Can&#39;t resolve proxy host %s:%hu&quot;</span>, host_name, connectport);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd">CURLE_COULDNT_RESOLVE_PROXY</a>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="comment">/* normal, direct, ftp connection */</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>, ftpc-&gt;<a class="code" href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">newport</a>, &amp;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>)</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="comment">/* BLOCKING */</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      (void)<a class="code" href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a>(conn, &amp;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    connectport = ftpc-&gt;<a class="code" href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">newport</a>; <span class="comment">/* we connect to the remote port */</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>) {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Can&#39;t resolve new host %s:%hu&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>, connectport);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af977c5b7373a2cbb9f657327ec6bb675">CURLE_FTP_CANT_GET_HOST</a>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    }</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  }</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="connect_8c.html#a1b49073aa2d83991c63d3903e3a3d275">Curl_connecthost</a>(conn, <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>); <span class="comment">/* we&#39;re done using this address */</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> == 0 &amp;&amp; ftpcode == 229)</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">return</span> ftp_epsv_disable(conn);</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">   * When this is used from the multi interface, this might&#39;ve returned with</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">   * the &#39;connected&#39; set to FALSE and thus we are now awaiting a non-blocking</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">   * connect to connect.</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.verbose)</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="comment">/* this just dumps information about this second connection */</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    ftp_pasv_verbose(conn, <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>-&gt;addr, ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>, connectport);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>); <span class="comment">/* we&#39;re done using this address */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(conn-&gt;<a class="code" href="structconnectdata.html#a4ae9ef32ff4f93d9fe8cc5f6ba7c690b">secondaryhostname</a>);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3385c7e824e59f8075d69b410fd7a72e">secondary_port</a> = ftpc-&gt;<a class="code" href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">newport</a>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a4ae9ef32ff4f93d9fe8cc5f6ba7c690b">secondaryhostname</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a4ae9ef32ff4f93d9fe8cc5f6ba7c690b">secondaryhostname</a>)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7563463d9ad94df9ed822c17786dd6a2">do_more</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* this phase is completed */</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;}</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_port_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                    <span class="keywordtype">int</span> ftpcode)</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;{</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">ftpport</a> fcmd = (<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">ftpport</a>)ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a>;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="comment">/* The FTP spec tells a positive response should have code 200.</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">     Be more permissive here to tolerate deviant servers. */</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <span class="keywordflow">if</span>(ftpcode / 100 != 2) {</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="comment">/* the command failed */</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a> == fcmd) {</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;disabling EPRT usage\n&quot;</span>);</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aa6493ae964163380f432dd306f2618f6">ftp_use_eprt</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    fcmd++;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <span class="keywordflow">if</span>(fcmd == <a class="code" href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749">DONE</a>) {</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to do PORT&quot;</span>);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    }</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="comment">/* try next */</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_use_port(conn, fcmd);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Connect data stream actively\n&quot;</span>);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* end of DO phase */</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_dophase_done(conn, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  }</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;}</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_mdtm_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                                    <span class="keywordtype">int</span> ftpcode)</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;{</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="keywordflow">switch</span>(ftpcode) {</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="keywordflow">case</span> 213:</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      <span class="comment">/* we got a time. Format should be: &quot;YYYYMMDDHHMMSS[.sss]&quot; where the</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">         last .sss part is optional and means fractions of a second */</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="keywordtype">int</span> year, month, day, hour, minute, second;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <span class="keywordflow">if</span>(6 == sscanf(&amp;<a class="code" href="structdata.html">data</a>-&gt;state.buffer[4], <span class="stringliteral">&quot;%04d%02d%02d%02d%02d%02d&quot;</span>,</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                     &amp;year, &amp;month, &amp;day, &amp;hour, &amp;minute, &amp;second)) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        <span class="comment">/* we have a time, reformat it */</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="keywordtype">char</span> timebuf[24];</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        time_t secs = <a class="code" href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a>(NULL);</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(timebuf, <span class="keyword">sizeof</span>(timebuf),</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                  <span class="stringliteral">&quot;%04d%02d%02d %02d:%02d:%02d GMT&quot;</span>,</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                  year, month, day, hour, minute, second);</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        <span class="comment">/* now, convert this into a time() value: */</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <a class="code" href="structdata.html">data</a>-&gt;info.filetime = <a class="code" href="curl_8h.html#ad4dd80e15a6f20cdd628a7f222fcb8eb">curl_getdate</a>(timebuf, &amp;secs);</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      }</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="preprocessor">#ifdef CURL_FTP_HTTPSTYLE_HEAD</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="comment">/* If we asked for a time of the file and we actually got one as well,</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">         we &quot;emulate&quot; a HTTP-style header in our output. */</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.opt_no_body &amp;&amp;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;         ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a> &amp;&amp;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;         <a class="code" href="structdata.html">data</a>-&gt;set.get_filetime &amp;&amp;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;         (<a class="code" href="structdata.html">data</a>-&gt;info.filetime &gt;= 0) ) {</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <span class="keywordtype">char</span> headerbuf[128];</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        time_t filetime = <a class="code" href="structdata.html">data</a>-&gt;info.filetime;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        <span class="keyword">struct </span>tm <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span>tm *tm = &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="parsedate_8c.html#a192aac16662dc4aaf80ef3722b581958">Curl_gmtime</a>(filetime, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="comment">/* format: &quot;Tue, 15 Nov 1994 12:45:26&quot; */</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(headerbuf, <span class="keyword">sizeof</span>(headerbuf),</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                  <span class="stringliteral">&quot;Last-Modified: %s, %02d %s %4d %02d:%02d:%02d GMT\r\n&quot;</span>,</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                  <a class="code" href="parsedate_8c.html#afbefdd1c70bc7fde8f2369a4cf46a62f">Curl_wkday</a>[tm-&gt;tm_wday?tm-&gt;tm_wday-1:6],</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                  tm-&gt;tm_mday,</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                  <a class="code" href="parsedate_8c.html#a4a84c69a44848f5947487bf91f86b733">Curl_month</a>[tm-&gt;tm_mon],</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                  tm-&gt;tm_year + 1900,</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                  tm-&gt;tm_hour,</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                  tm-&gt;tm_min,</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                  tm-&gt;tm_sec);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(conn, <a class="code" href="sendf_8h.html#a2d27756d638621a2d2300dab33833f0c">CLIENTWRITE_BOTH</a>, headerbuf, 0);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      } <span class="comment">/* end of a ridiculous amount of conditionals */</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    }</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unsupported MDTM reply format\n&quot;</span>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="keywordflow">case</span> 550: <span class="comment">/* &quot;No such file or directory&quot; */</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Given file does not exist&quot;</span>);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff">CURLE_FTP_COULDNT_RETR_FILE</a>;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  }</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.timecondition) {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;info.filetime &gt; 0) &amp;&amp; (<a class="code" href="structdata.html">data</a>-&gt;set.timevalue &gt; 0)) {</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      <span class="keywordflow">switch</span>(<a class="code" href="structdata.html">data</a>-&gt;set.timecondition) {</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a845d262749bd413d724b58e26f713f25ad13e365aab4f32a0ee193510118f533d">CURL_TIMECOND_IFMODSINCE</a>:</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;info.filetime &lt;= <a class="code" href="structdata.html">data</a>-&gt;set.timevalue) {</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The requested document is not new enough\n&quot;</span>);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;          ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a>; <span class="comment">/* mark to not transfer data */</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;info.timecond = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;          <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        }</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a845d262749bd413d724b58e26f713f25ab52a0e6ddf579f8f81b40d8a684155a6">CURL_TIMECOND_IFUNMODSINCE</a>:</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;info.filetime &gt; <a class="code" href="structdata.html">data</a>-&gt;set.timevalue) {</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The requested document is not old enough\n&quot;</span>);</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;          ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a>; <span class="comment">/* mark to not transfer data */</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;info.timecond = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;          <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        }</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      } <span class="comment">/* switch */</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    }</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Skipping time comparison\n&quot;</span>);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    }</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  }</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_type(conn);</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;}</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_type_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                                    <span class="keywordtype">int</span> ftpcode,</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                                    <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;{</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <span class="keywordflow">if</span>(ftpcode/100 != 2) {</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="comment">/* &quot;sasserftpd&quot; and &quot;(u)r(x)bot ftpd&quot; both responds with 226 after a</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">       successful &#39;TYPE I&#39;. While that is not as RFC959 says, it is still a</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">       positive response code and we allow that. */</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Couldn&#39;t set desired mode&quot;</span>);</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa1f636ad685a1ab9e362ebb4fe068063">CURLE_FTP_COULDNT_SET_TYPE</a>;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  }</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="keywordflow">if</span>(ftpcode != 200)</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Got a %03d response code instead of the assumed 200\n&quot;</span>,</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;          ftpcode);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2706bd50f04c829f62a30ee886e67ed0">FTP_TYPE</a>)</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_size(conn);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a65afd49b1baa6e1a4915c85f372a64eb">FTP_LIST_TYPE</a>)</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_list(conn);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1d39a52adb8e2162b2c56dcaf0943c80">FTP_RETR_TYPE</a>)</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_retr_prequote(conn);</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa6233d6e045100c7beda9fb549430f28">FTP_STOR_TYPE</a>)</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_stor_prequote(conn);</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;}</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_retr(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                                         <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>)</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;{</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.max_filesize &amp;&amp; (<a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a> &gt; <a class="code" href="structdata.html">data</a>-&gt;set.max_filesize)) {</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Maximum file size exceeded&quot;</span>);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a575639ff443233dd9af2c1835192ad3a">CURLE_FILESIZE_EXCEEDED</a>;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> = <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.resume_from) {</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="comment">/* We always (attempt to) get the size of downloads, so it is done before</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="comment">       this even when not doing resumes. */</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a> == -1) {</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ftp server doesn&#39;t support SIZE\n&quot;</span>);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      <span class="comment">/* We couldn&#39;t get the size and therefore we can&#39;t know if there really</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment">         is a part of the file left to get, although the server will just</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">         close the connection when we start the connection so it won&#39;t cause</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">         us any harm, just not make us exit as nicely. */</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    }</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="comment">/* We got a file size report, so we check that there actually is a</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment">         part of the file left to get, or else we go home.  */</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.resume_from&lt; 0) {</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="comment">/* We&#39;re supposed to download the last abs(from) bytes */</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keywordflow">if</span>(filesize &lt; -data-&gt;<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>.resume_from) {</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Offset (%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                <span class="stringliteral">&quot;) was beyond file size (%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;)&quot;</span>,</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;state.resume_from, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa35bfdab90de5c981dc4e10e5e352a5e">CURLE_BAD_DOWNLOAD_RESUME</a>;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        }</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="comment">/* convert to size to download */</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> = -<a class="code" href="structdata.html">data</a>-&gt;state.resume_from;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="comment">/* download from where? */</span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <a class="code" href="structdata.html">data</a>-&gt;state.resume_from = <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a> - ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a>;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      }</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        <span class="keywordflow">if</span>(filesize &lt; data-&gt;<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>.resume_from) {</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Offset (%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                <span class="stringliteral">&quot;) was beyond file size (%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;)&quot;</span>,</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                <a class="code" href="structdata.html">data</a>-&gt;state.resume_from, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa35bfdab90de5c981dc4e10e5e352a5e">CURLE_BAD_DOWNLOAD_RESUME</a>;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        }</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="comment">/* Now store the number of bytes we are expected to download */</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> = <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>-<a class="code" href="structdata.html">data</a>-&gt;state.resume_from;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      }</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> == 0) {</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <span class="comment">/* no data to transfer */</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;File already completely downloaded\n&quot;</span>);</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="comment">/* Set -&gt;transfer so that we won&#39;t get any error in ftp_done()</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="comment">       * because we didn&#39;t transfer the any file */</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a>;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="comment">/* Set resume file transfer offset */</span></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Instructs server to resume from offset %&quot;</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;          <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="structdata.html">data</a>-&gt;state.resume_from);</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;REST %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a>,</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;            <a class="code" href="structdata.html">data</a>-&gt;state.resume_from);</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a0d9d6b2c221700c4479d9c4aab0192f8">FTP_RETR_REST</a>);</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  }</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="comment">/* no resume */</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;RETR %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a>);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  }</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;}</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_size_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                                    <span class="keywordtype">int</span> ftpcode,</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                                    <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;{</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a> = -1;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="comment">/* get the size from the ascii string: */</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">if</span>(ftpcode == 213)</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <span class="comment">/* ignores parsing errors, which will make the size remain unknown */</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    (void)<a class="code" href="strtoofft_8c.html#a3c9f5c063165fc15454feac4def889d7">curlx_strtoofft</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> + 4, NULL, 0, &amp;<a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b38c28089de4d15ded4a7a16ac28a87">FTP_SIZE</a>) {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="preprocessor">#ifdef CURL_FTP_HTTPSTYLE_HEAD</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">if</span>(-1 != <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>) {</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      <span class="keywordtype">char</span> clbuf[128];</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(clbuf, <span class="keyword">sizeof</span>(clbuf),</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                <span class="stringliteral">&quot;Content-Length: %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;\r\n&quot;</span>, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(conn, <a class="code" href="sendf_8h.html#a2d27756d638621a2d2300dab33833f0c">CLIENTWRITE_BOTH</a>, clbuf, 0);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    }</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_rest(conn);</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65af08a45f6d43a3e58495131fb582ff1c0">FTP_RETR_SIZE</a>) {</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_retr(conn, <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>);</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  }</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b3b874197ce162d8f012723a7184004">FTP_STOR_SIZE</a>) {</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.resume_from = <a class="code" href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a>;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_ul_setup(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  }</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;}</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_rest_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                                    <span class="keywordtype">int</span> ftpcode,</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                                    <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;{</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="keywordflow">switch</span>(instate) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a9dfb8cf86d141a0b4dd611d19069d127">FTP_REST</a>:</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="preprocessor">#ifdef CURL_FTP_HTTPSTYLE_HEAD</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="keywordflow">if</span>(ftpcode == 350) {</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[24]= { <span class="stringliteral">&quot;Accept-ranges: bytes\r\n&quot;</span> };</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(conn, <a class="code" href="sendf_8h.html#a2d27756d638621a2d2300dab33833f0c">CLIENTWRITE_BOTH</a>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 0);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    }</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_prepare_transfer(conn);</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a0d9d6b2c221700c4479d9c4aab0192f8">FTP_RETR_REST</a>:</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordflow">if</span>(ftpcode != 350) {</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Couldn&#39;t use REST&quot;</span>);</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a404154a216fca019f85509759015820c">CURLE_FTP_COULDNT_USE_REST</a>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    }</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;RETR %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a>);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    }</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  }</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;}</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_stor_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                                    <span class="keywordtype">int</span> ftpcode, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;{</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keywordflow">if</span>(ftpcode &gt;= 400) {</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed FTP upload: %0d&quot;</span>, ftpcode);</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="comment">/* oops, we never close the sockets! */</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a>;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  }</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#afe0772034a72ef6799a141b877dcef0d">state_saved</a> = instate;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="comment">/* PORT means we are now awaiting the server to connect to us. */</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_use_port) {</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordtype">bool</span> connected;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* no longer in STOR state */</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = AllowServerConnect(conn, &amp;connected);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="keywordflow">if</span>(!connected) {</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Data conn was not available immediately\n&quot;</span>);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  }</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keywordflow">return</span> InitiateTransfer(conn);</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;}</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">/* for LIST and RETR responses */</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_get_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                                    <span class="keywordtype">int</span> ftpcode,</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                                    <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;{</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  <span class="keywordflow">if</span>((ftpcode == 150) || (ftpcode == 125)) {</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment">      A;</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">      150 Opening BINARY mode data connection for /etc/passwd (2241</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">      bytes).  (ok, the file is being transferred)</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">      B:</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">      150 Opening ASCII mode data connection for /bin/ls</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">      C:</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">      150 ASCII data connection for /bin/ls (137.167.104.91,37445) (0 bytes).</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">      D:</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">      150 Opening ASCII mode data connection for [file] (0.0.0.0,0) (545 bytes)</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment">      E:</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="comment">      125 Data connection already open; Transfer starting. */</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = -1; <span class="comment">/* default unknown size */</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment">     * It appears that there are FTP-servers that return size 0 for files when</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment">     * SIZE is used on the file while being in BINARY mode. To work around</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment">     * that (stupid) behavior, we attempt to parse the RETR response even if</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">     * the SIZE returned size zero.</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="comment">     * Debugging help from Salvatore Sorrentino on February 26, 2003.</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    <span class="keywordflow">if</span>((instate != <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>) &amp;&amp;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;       !<a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii &amp;&amp;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;       (ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> &lt; 1)) {</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">       * It seems directory listings either don&#39;t show the size or very</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">       * often uses size 0 anyway. ASCII transfers may very well turn out</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment">       * that the transferred amount of data is not the same as this line</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">       * tells, why using this number in those cases only confuses us.</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment">       * Example D above makes this parsing a little tricky */</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      <span class="keywordtype">char</span> *bytes;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      bytes = strstr(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="stringliteral">&quot; bytes&quot;</span>);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      <span class="keywordflow">if</span>(bytes) {</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="keywordtype">long</span> <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a> = (long)(--bytes-<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="comment">/* this is a hint there is size information in there! ;-) */</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        <span class="keywordflow">while</span>(--<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>) {</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;          <span class="comment">/* scan for the left parenthesis and break there */</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;          <span class="keywordflow">if</span>(<span class="charliteral">&#39;(&#39;</span> == *bytes)</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;          <span class="comment">/* skip only digits */</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;          <span class="keywordflow">if</span>(!<a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*bytes)) {</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            bytes = NULL;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;          }</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;          <span class="comment">/* one more estep backwards */</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;          bytes--;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        }</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        <span class="comment">/* if we have nothing but digits: */</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="keywordflow">if</span>(bytes++) {</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;          <span class="comment">/* get the number! */</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;          (void)<a class="code" href="strtoofft_8c.html#a3c9f5c063165fc15454feac4def889d7">curlx_strtoofft</a>(bytes, NULL, 0, &amp;<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      }</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    }</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> &gt; -1)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a>;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> &gt; <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload &gt; 0)</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = <a class="code" href="structdata.html">data</a>-&gt;req.size = <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((instate != <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>) &amp;&amp; (<a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii))</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = -1; <span class="comment">/* kludge for servers that understate ASCII mode file size */</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Maxdownload = %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload);</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    <span class="keywordflow">if</span>(instate != <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>)</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Getting file with size: %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;            <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <span class="comment">/* FTP download: */</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#afe0772034a72ef6799a141b877dcef0d">state_saved</a> = instate;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a2cf7ba1957a627d4c956c11df54a1602">retr_size_saved</a> = <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_use_port) {</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="keywordtype">bool</span> connected;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = AllowServerConnect(conn, &amp;connected);</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      <span class="keywordflow">if</span>(!connected) {</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Data conn was not available immediately\n&quot;</span>);</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      }</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    }</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      <span class="keywordflow">return</span> InitiateTransfer(conn);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  }</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    <span class="keywordflow">if</span>((instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>) &amp;&amp; (ftpcode == 450)) {</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="comment">/* simply no matching files in the dir listing */</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a>; <span class="comment">/* don&#39;t download anything */</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* this phase is over */</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    }</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;RETR response: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="keywordflow">return</span> instate == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a> &amp;&amp; ftpcode == 550?</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a>:</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff">CURLE_FTP_COULDNT_RETR_FILE</a>;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;  }</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;}</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="comment">/* after USER, PASS and ACCT */</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_loggedin(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;{</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a>) {</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="comment">/* PBSZ = PROTECTION BUFFER SIZE.</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="comment">    The &#39;draft-murray-auth-ftp-ssl&#39; (draft 12, page 7) says:</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="comment">    Specifically, the PROT command MUST be preceded by a PBSZ</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment">    command and a PBSZ command MUST be preceded by a successful</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="comment">    security data exchange (the TLS negotiation in this case)</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment">    ... (and on page 8):</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="comment">    Thus the PBSZ command must still be issued, but must have a</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="comment">    parameter of &#39;0&#39; to indicate that no buffering is taking place</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="comment">    and the data connection should not be encapsulated.</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PBSZ %d&quot;</span>, 0);</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa5bab60813f0dee8060cc00dadf070d9">FTP_PBSZ</a>);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  }</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_pwd(conn);</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  }</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;}</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="comment">/* for USER and PASS responses */</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_user_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                                    <span class="keywordtype">int</span> ftpcode,</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                                    <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> instate)</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;{</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <span class="comment">/* some need password anyway, and others just return 2xx ignored */</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="keywordflow">if</span>((ftpcode == 331) &amp;&amp; (ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a> == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a">FTP_USER</a>)) {</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    <span class="comment">/* 331 Password required for ...</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment">       (the server requires to send the user&#39;s password too) */</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PASS %s&quot;</span>, ftp-&gt;<a class="code" href="struct_f_t_p.html#a4b007b3a38109d7ea3b60ea8be4383e3">passwd</a>?ftp-&gt;<a class="code" href="struct_f_t_p.html#a4b007b3a38109d7ea3b60ea8be4383e3">passwd</a>:<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca6266a872be15f938cdbbfb3848fc83">FTP_PASS</a>);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftpcode/100 == 2) {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="comment">/* 230 User ... logged in.</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="comment">       (the user logged in with or without password) */</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_loggedin(conn);</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  }</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftpcode == 332) {</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa51394e43374873edba2391d5b4e09877">STRING_FTP_ACCOUNT</a>]) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;ACCT %s&quot;</span>, <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa51394e43374873edba2391d5b4e09877">STRING_FTP_ACCOUNT</a>]);</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a93a65808449e2f199c573d6c71aaca8b">FTP_ACCT</a>);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    }</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ACCT requested but none available&quot;</span>);</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  }</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <span class="comment">/* All other response codes, like:</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment">    530 User ... access denied</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="comment">    (the server denies to log the specified user) */</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a13f05a0089337483c7dbe40fbc42aac2">str</a>[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa8dbe5b1757d1ef779fe0345422ee1dcc">STRING_FTP_ALTERNATIVE_TO_USER</a>] &amp;&amp;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        !conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0caaf995a72fe34ed49b6da18b36e9f6">ftp_trying_alternative</a>) {</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      <span class="comment">/* Ok, USER failed.  Let&#39;s try the supplied command. */</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>,</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;              conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a13f05a0089337483c7dbe40fbc42aac2">str</a>[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa8dbe5b1757d1ef779fe0345422ee1dcc">STRING_FTP_ALTERNATIVE_TO_USER</a>]);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a0caaf995a72fe34ed49b6da18b36e9f6">ftp_trying_alternative</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a">FTP_USER</a>);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Access denied: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    }</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  }</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;}</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="comment">/* for ACCT response */</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_state_acct_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                                    <span class="keywordtype">int</span> ftpcode)</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;{</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="keywordflow">if</span>(ftpcode != 230) {</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ACCT rejected by server: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c679a0c848f49bf6a02e97c7784d20c">CURLE_FTP_WEIRD_PASS_REPLY</a>; <span class="comment">/* FIX */</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  }</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_loggedin(conn);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;}</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_statemach_act(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;{</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;  <span class="keywordtype">int</span> ftpcode;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> ftpauth[][4]  = { <span class="stringliteral">&quot;SSL&quot;</span>, <span class="stringliteral">&quot;TLS&quot;</span> };</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="keywordtype">size_t</span> nread = 0;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#a4f9a725e7d24dbfe7b0574ce14671048">sendleft</a>)</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#a2f6c579918627b1add05e82015bad826">Curl_pp_flushsend</a>(pp);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_readresp(sock, pp, &amp;ftpcode, &amp;nread);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  <span class="keywordflow">if</span>(ftpcode) {</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="comment">/* we have now received a full FTP server response */</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;    <span class="keywordflow">switch</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>) {</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65abae6a623835e4269b257ff21bcb79ed0">FTP_WAIT220</a>:</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      <span class="keywordflow">if</span>(ftpcode == 230)</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        <span class="comment">/* 230 User logged in - already! */</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        <span class="keywordflow">return</span> ftp_state_user_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftpcode != 220) {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Got a %03d ftp-server response when 220 was expected&quot;</span>,</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;              ftpcode);</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      }</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;      <span class="comment">/* We have received a 220 response fine, now we proceed. */</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.krb) {</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <span class="comment">/* If not anonymous login, try a secure login. Note that this</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment">           procedure is still BLOCKING. */</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        Curl_sec_request_prot(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;private&quot;</span>);</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <span class="comment">/* We set private first as default, in case the line below fails to</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="comment">           set a valid level */</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        Curl_sec_request_prot(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fac722cfe21427fe2ea477684dd260b540">STRING_KRB_LEVEL</a>]);</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <span class="keywordflow">if</span>(Curl_sec_login(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>))</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Logging in with password in cleartext!\n&quot;</span>);</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Authentication successful\n&quot;</span>);</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      }</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl &amp;&amp;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;         (!<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a> ||</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;          (<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#aec16dc8e44e2c34947cf23a7e0211b53">proxy_ssl_connected</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>] &amp;&amp;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;           !<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a>))) {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        <span class="comment">/* We don&#39;t have a SSL/TLS connection yet, but FTPS is</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;<span class="comment">           requested. Try a FTPS connection now */</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">count3</a> = 0;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <span class="keywordflow">switch</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftpsslauth) {</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8da46e091e25e4a6e44c28b131bc2559248">CURLFTPAUTH_DEFAULT</a>:</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8da578e0d340b5e495763b25fa1e8da3c3f">CURLFTPAUTH_SSL</a>:</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = 1; <span class="comment">/* add one to get next */</span></div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = 0;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8dad3c7dc37f58e16b08fdd590bdaf712e7">CURLFTPAUTH_TLS</a>:</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = -1; <span class="comment">/* subtract one to get next */</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> = 1;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unsupported parameter to CURLOPT_FTPSSLAUTH: %d&quot;</span>,</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                (<span class="keywordtype">int</span>)<a class="code" href="structdata.html">data</a>-&gt;set.ftpsslauth);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951abf7638d198de39a72f5594dad2655bbe">CURLE_UNKNOWN_OPTION</a>; <span class="comment">/* we don&#39;t know what to do */</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        }</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;AUTH %s&quot;</span>, ftpauth[ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a>]);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2bd11bd4d07b54cfbeb51199eaf998d9">FTP_AUTH</a>);</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      }</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_user(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      }</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2bd11bd4d07b54cfbeb51199eaf998d9">FTP_AUTH</a>:</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      <span class="comment">/* we have gotten the response to a previous AUTH command */</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <span class="comment">/* RFC2228 (page 5) says:</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">       * If the server is willing to accept the named security mechanism,</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">       * and does not require any security data, it must respond with</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">       * reply code 234/334.</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      <span class="keywordflow">if</span>((ftpcode == 234) || (ftpcode == 334)) {</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        <span class="comment">/* Curl_ssl_connect is BLOCKING */</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#aab12c9ee7a4c9d065f76d3ab539bdb62">Curl_ssl_connect</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;          <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a550a957124dfbe3ed5a3ea91504edb0a">ftp_use_data_ssl</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* clear-text data */</span></div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_user(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        }</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      }</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">count3</a> &lt; 1) {</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">count3</a>++;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> += ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a>; <span class="comment">/* get next attempt */</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;AUTH %s&quot;</span>, ftpauth[ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a>]);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        <span class="comment">/* remain in this same state */</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      }</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl &gt; <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986">CURLUSESSL_TRY</a>)</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;          <span class="comment">/* we failed and CURLUSESSL_CONTROL or CURLUSESSL_ALL is set */</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a>;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;          <span class="comment">/* ignore the failure and continue */</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_user(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      }</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a">FTP_USER</a>:</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca6266a872be15f938cdbbfb3848fc83">FTP_PASS</a>:</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_user_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a93a65808449e2f199c573d6c71aaca8b">FTP_ACCT</a>:</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_acct_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode);</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa5bab60813f0dee8060cc00dadf070d9">FTP_PBSZ</a>:</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;PROT %c&quot;</span>,</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;              <a class="code" href="structdata.html">data</a>-&gt;set.use_ssl == <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa6b661cf271e2f9d9ff0eb28d926d417b">CURLUSESSL_CONTROL</a> ? <span class="charliteral">&#39;C&#39;</span> : <span class="charliteral">&#39;P&#39;</span>);</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a41b778c2aeab0dd5779fe00bd47fd383">FTP_PROT</a>);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a41b778c2aeab0dd5779fe00bd47fd383">FTP_PROT</a>:</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="keywordflow">if</span>(ftpcode/100 == 2)</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        <span class="comment">/* We have enabled SSL for the data connection! */</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a550a957124dfbe3ed5a3ea91504edb0a">ftp_use_data_ssl</a> =</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;          (<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl != <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa6b661cf271e2f9d9ff0eb28d926d417b">CURLUSESSL_CONTROL</a>) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="comment">/* FTP servers typically responds with 500 if they decide to reject</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment">         our &#39;P&#39; request */</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl &gt; <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa6b661cf271e2f9d9ff0eb28d926d417b">CURLUSESSL_CONTROL</a>)</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        <span class="comment">/* we failed and bails out */</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a>;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_ccc) {</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        <span class="comment">/* CCC - Clear Command Channel</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;CCC&quot;</span>);</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a84a7ed5d4f674a884524357db49c890d">FTP_CCC</a>);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_pwd(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;      }</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a84a7ed5d4f674a884524357db49c890d">FTP_CCC</a>:</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;      <span class="keywordflow">if</span>(ftpcode &lt; 500) {</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        <span class="comment">/* First shut down the SSL layer (note: this call will block) */</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#a17b59e5f0576d37fa4b20ac37a6848e9">Curl_ssl_shutdown</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>);</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed to clear the command channel (CCC)&quot;</span>);</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        }</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      }</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      <span class="comment">/* Then continue as normal */</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_pwd(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca379f22e83e32b84e6ae13c8e2ec021">FTP_PWD</a>:</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      <span class="keywordflow">if</span>(ftpcode == 257) {</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = &amp;<a class="code" href="structdata.html">data</a>-&gt;state.buffer[4];  <span class="comment">/* start on the first letter */</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> buf_size = <a class="code" href="structdata.html">data</a>-&gt;set.buffer_size;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;        <span class="keywordtype">char</span> *dir;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        <span class="keywordtype">bool</span> entry_extracted = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        dir = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(nread + 1);</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        <span class="keywordflow">if</span>(!dir)</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        <span class="comment">/* Reply format is like</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="comment">           257&lt;space&gt;[rubbish]&quot;&lt;directory-name&gt;&quot;&lt;space&gt;&lt;commentary&gt; and the</span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment">           RFC959 says</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">           The directory name can contain any character; embedded</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment">           double-quotes should be escaped by double-quotes (the</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment">           &quot;quote-doubling&quot; convention).</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;        <span class="comment">/* scan for the first double-quote for non-standard responses */</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        <span class="keywordflow">while</span>(ptr &lt; &amp;data-&gt;<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>.buffer[buf_size]</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;              &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;&quot;&#39;</span>)</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;          <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        <span class="keywordflow">if</span>(<span class="charliteral">&#39;\&quot;&#39;</span> == *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;          <span class="comment">/* it started good */</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;          <span class="keywordtype">char</span> *store;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;          <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;          <span class="keywordflow">for</span>(store = dir; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;) {</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;            <span class="keywordflow">if</span>(<span class="charliteral">&#39;\&quot;&#39;</span> == *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;              <span class="keywordflow">if</span>(<span class="charliteral">&#39;\&quot;&#39;</span> == <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[1]) {</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                <span class="comment">/* &quot;quote-doubling&quot; */</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                *store = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[1];</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;              }</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;              <span class="keywordflow">else</span> {</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                <span class="comment">/* end of path */</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                entry_extracted = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                <span class="keywordflow">break</span>; <span class="comment">/* get out of this loop */</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;              }</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            }</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;              *store = *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            store++;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;          }</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;          *store = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* zero terminate */</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        }</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;        <span class="keywordflow">if</span>(entry_extracted) {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;          <span class="comment">/* If the path name does not look like an absolute path (i.e.: it</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment">             does not start with a &#39;/&#39;), we probably need some server-dependent</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment">             adjustments. For example, this is the case when connecting to</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="comment">             an OS400 FTP server: this server supports two name syntaxes,</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="comment">             the default one being incompatible with standard paths. In</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="comment">             addition, this server switches automatically to the regular path</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="comment">             syntax when one is encountered in a command: this results in</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="comment">             having an entrypath in the wrong syntax when later used in CWD.</span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment">               The method used here is to check the server OS: we do it only</span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="comment">             if the path name looks strange to minimize overhead on other</span></div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment">             systems. */</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;          <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a> &amp;&amp; dir[0] != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;SYST&quot;</span>);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;              <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(dir);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;              <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            }</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a> = dir; <span class="comment">/* remember this */</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;            <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Entry path is &#39;%s&#39;\n&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;            <span class="comment">/* also save it where getinfo can access it: */</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            <a class="code" href="structdata.html">data</a>-&gt;state.most_recent_ftp_entrypath = ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;            <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a18b677d0252c2519d54ad5e65476eff0">FTP_SYST</a>);</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;          }</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;          <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a> = dir; <span class="comment">/* remember this */</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Entry path is &#39;%s&#39;\n&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;          <span class="comment">/* also save it where getinfo can access it: */</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;state.most_recent_ftp_entrypath = ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        }</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;          <span class="comment">/* couldn&#39;t get the path */</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;          <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(dir);</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to figure out path\n&quot;</span>);</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        }</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      }</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* we are done with the CONNECT phase! */</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;protocol connect phase DONE\n&quot;</span>));</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a18b677d0252c2519d54ad5e65476eff0">FTP_SYST</a>:</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      <span class="keywordflow">if</span>(ftpcode == 215) {</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = &amp;<a class="code" href="structdata.html">data</a>-&gt;state.buffer[4];  <span class="comment">/* start on the first letter */</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        <span class="keywordtype">char</span> *os;</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <span class="keywordtype">char</span> *store;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        os = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(nread + 1);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        <span class="keywordflow">if</span>(!os)</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        <span class="comment">/* Reply format is like</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="comment">           215&lt;space&gt;&lt;OS-name&gt;&lt;space&gt;&lt;commentary&gt;</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> == <span class="charliteral">&#39; &#39;</span>)</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;          <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        <span class="keywordflow">for</span>(store = os; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39; &#39;</span>;)</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;          *store++ = *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        *store = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* zero terminate */</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        <span class="comment">/* Check for special servers here. */</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(os, <span class="stringliteral">&quot;OS/400&quot;</span>)) {</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;          <span class="comment">/* Force OS400 name format 1. */</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;SITE NAMEFMT 1&quot;</span>);</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;            <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(os);</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;          }</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;          <span class="comment">/* remember target server OS */</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;          <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a>);</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a> = os;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;          <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a424cb619b42ed94ebefe203d045abc99">FTP_NAMEFMT</a>);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        }</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <span class="comment">/* Nothing special for the target server. */</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="comment">/* remember target server OS */</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a>);</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a> = os;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      }</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        <span class="comment">/* Cannot identify server OS. Continue anyway and cross fingers. */</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      }</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* we are done with the CONNECT phase! */</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;protocol connect phase DONE\n&quot;</span>));</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a424cb619b42ed94ebefe203d045abc99">FTP_NAMEFMT</a>:</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">if</span>(ftpcode == 250) {</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="comment">/* Name format change successful: reload initial path. */</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        ftp_state_pwd(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      }</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>); <span class="comment">/* we are done with the CONNECT phase! */</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;protocol connect phase DONE\n&quot;</span>));</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2">FTP_QUOTE</a>:</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac15dd7cd691c70046eb44ed87668587b">FTP_POSTQUOTE</a>:</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a>:</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15">FTP_STOR_PREQUOTE</a>:</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <span class="keywordflow">if</span>((ftpcode &gt;= 400) &amp;&amp; !ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a>) {</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;        <span class="comment">/* failure response code, and not allowed to fail */</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;QUOT command failed with %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb">CURLE_QUOTE_ERROR</a>;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;      }</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_quote(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f">FTP_CWD</a>:</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <span class="keywordflow">if</span>(ftpcode/100 != 2) {</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <span class="comment">/* failure to CWD there */</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a55d6133449a8920a98a66cb9c7d1ae61">ftp_create_missing_dirs</a> &amp;&amp;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;           ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> &amp;&amp; !ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a>) {</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;          <span class="comment">/* try making it */</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a>++; <span class="comment">/* counter to prevent CWD-MKD loops */</span></div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;          <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;MKD %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> - 1]);</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;          <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a8115a39494ea1a40fd0e2d9e51b61b92">FTP_MKD</a>);</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        }</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;          <span class="comment">/* return failure */</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server denied you to change to the given directory&quot;</span>);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a5899ffca5f9760f9e0109f126d0167fd">cwdfail</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* don&#39;t remember this path as we failed</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment">                                   to enter it */</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a682b1c9a48ab0eff7ca39e6ee8728bbc">CURLE_REMOTE_ACCESS_DENIED</a>;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        }</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      }</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        <span class="comment">/* success */</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">count2</a> = 0;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        <span class="keywordflow">if</span>(++ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> &lt;= ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>) {</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;          <span class="comment">/* send next CWD */</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;          <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;CWD %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> - 1]);</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        }</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_mdtm(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        }</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      }</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a8115a39494ea1a40fd0e2d9e51b61b92">FTP_MKD</a>:</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="keywordflow">if</span>((ftpcode/100 != 2) &amp;&amp; !ftpc-&gt;<a class="code" href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">count3</a>--) {</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <span class="comment">/* failure to MKD the dir */</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to MKD dir: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a682b1c9a48ab0eff7ca39e6ee8728bbc">CURLE_REMOTE_ACCESS_DENIED</a>;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;      }</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f">FTP_CWD</a>);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      <span class="comment">/* send CWD */</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;CWD %s&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">cwdcount</a> - 1]);</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a27602c6b9eaa7f0ce5fbb45493180e49">FTP_MDTM</a>:</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_mdtm_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode);</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2706bd50f04c829f62a30ee886e67ed0">FTP_TYPE</a>:</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a65afd49b1baa6e1a4915c85f372a64eb">FTP_LIST_TYPE</a>:</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1d39a52adb8e2162b2c56dcaf0943c80">FTP_RETR_TYPE</a>:</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa6233d6e045100c7beda9fb549430f28">FTP_STOR_TYPE</a>:</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_type_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b38c28089de4d15ded4a7a16ac28a87">FTP_SIZE</a>:</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65af08a45f6d43a3e58495131fb582ff1c0">FTP_RETR_SIZE</a>:</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b3b874197ce162d8f012723a7184004">FTP_STOR_SIZE</a>:</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_size_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a9dfb8cf86d141a0b4dd611d19069d127">FTP_REST</a>:</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a0d9d6b2c221700c4479d9c4aab0192f8">FTP_RETR_REST</a>:</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_rest_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1e32e2a175bcdb45625a04ebcfea1d7f">FTP_PRET</a>:</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">if</span>(ftpcode != 200) {</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="comment">/* there only is this one standard OK return code. */</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;PRET command not accepted: %03d&quot;</span>, ftpcode);</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aebe38dbbb2739f5b0941a1bd1b4aa37c">CURLE_FTP_PRET_FAILED</a>;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      }</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_use_pasv(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac50fb126afa10cf6754b070caa0485e3">FTP_PASV</a>:</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_pasv_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode);</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ad8fbe74a695b640f4c917d49696c1b90">FTP_PORT</a>:</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_port_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode);</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a>:</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a>:</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_get_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab1ccd7c5223945586470ddac912f5659">FTP_STOR</a>:</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_stor_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, ftpcode, ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a5a431b48a039b3f3125648f79ac77057">FTP_QUIT</a>:</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      <span class="comment">/* fallthrough, just stop! */</span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;      <span class="comment">/* internal error */</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    }</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;  } <span class="comment">/* if(ftpcode) */</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;}</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="comment">/* called repeatedly until done from multi.c */</span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_multi_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                                    <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;{</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="comment">/* Check for the state outside of the Curl_socket_check() return code checks</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="comment">     since at times we are in fact already in this state when this function</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="comment">     gets called. */</span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;  *done = (ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a> == <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;}</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_block_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;{</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  <span class="keywordflow">while</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a> != <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>) {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a>(pp, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;  }</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;}</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment"> * ftp_connect() should do everything that is to be considered a part of</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment"> * the connection phase.</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment"> * The variable &#39;done&#39; points to will be TRUE if the protocol-layer connect</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment"> * phase is done when this function returns, or FALSE if not.</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                                 <span class="keywordtype">bool</span> *done) <span class="comment">/* see description above */</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;{</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to not done yet */</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;  <span class="comment">/* We always support persistent connections on ftp */</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;  <a class="code" href="connect_8h.html#acdca2a91749c4f2ca1805e482bad0f90">connkeep</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;FTP default&quot;</span>);</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">response_time</a> = <a class="code" href="urldata_8h.html#a0320d3ae0f4915a179d877818b3e2a05">RESP_TIMEOUT</a>; <span class="comment">/* set default response time-out */</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#a124ea1f6b5aa08b8938cdd3d8a5c4b9f">statemach_act</a> = ftp_statemach_act;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#ad13b684e9f73f8d93d077003c97f5b43">endofresp</a> = ftp_endofresp;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a> = <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a>-&gt;<a class="code" href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">flags</a> &amp; <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a>) {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="comment">/* BLOCKING */</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#aab12c9ee7a4c9d065f76d3ab539bdb62">Curl_ssl_connect</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>);</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  }</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  <a class="code" href="pingpong_8c.html#afa377ab63385678cbf3059b1cd3f9aaa">Curl_pp_init</a>(pp); <span class="comment">/* init the generic pingpong data */</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;  <span class="comment">/* When we connect, we start in the state where we await the 220</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment">     response */</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65abae6a623835e4269b257ff21bcb79ed0">FTP_WAIT220</a>);</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, done);</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;}</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment"> * ftp_done()</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment"> * The DONE function. This does what needs to be done after a single DO has</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment"> * performed.</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment"> * Input argument is already checked for validity.</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> status,</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                         <span class="keywordtype">bool</span> premature)</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;{</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;  <span class="keywordtype">int</span> ftpcode;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a> = NULL;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <span class="keywordflow">if</span>(!ftp)</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;  <span class="keywordflow">switch</span>(status) {</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa35bfdab90de5c981dc4e10e5e352a5e">CURLE_BAD_DOWNLOAD_RESUME</a>:</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647">CURLE_FTP_WEIRD_PASV_REPLY</a>:</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a>:</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9">CURLE_FTP_ACCEPT_FAILED</a>:</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4312ee806c76575f6183c9b9a57c4601">CURLE_FTP_ACCEPT_TIMEOUT</a>:</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa1f636ad685a1ab9e362ebb4fe068063">CURLE_FTP_COULDNT_SET_TYPE</a>:</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff">CURLE_FTP_COULDNT_RETR_FILE</a>:</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d">CURLE_PARTIAL_FILE</a>:</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a>:</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a682b1c9a48ab0eff7ca39e6ee8728bbc">CURLE_REMOTE_ACCESS_DENIED</a>:</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a575639ff443233dd9af2c1835192ad3a">CURLE_FILESIZE_EXCEEDED</a>:</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a>:</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951acaaed2faf20c957350e90a68282ae314">CURLE_WRITE_ERROR</a>:</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="comment">/* the connection stays alive fine even though this happened */</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    <span class="comment">/* fall-through */</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>: <span class="comment">/* doesn&#39;t affect the control connection&#39;s status */</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <span class="keywordflow">if</span>(!premature)</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="comment">/* until we cope better with prematurely ended requests, let them</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="comment">     * fallback as if in complete failure */</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="keywordflow">default</span>:       <span class="comment">/* by default, an error means the control connection is</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="comment">                    wedged and should not be used anymore */</span></div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a5899ffca5f9760f9e0109f126d0167fd">cwdfail</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* set this TRUE to prevent us to remember the</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;<span class="comment">                             current path, as this connection is going */</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;FTP ended with bad error code&quot;</span>);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = status;      <span class="comment">/* use the already set error code */</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  }</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  <span class="comment">/* now store a copy of the directory we are in */</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.wildcardmatch) {</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.chunk_end &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;set.chunk_end(<a class="code" href="structdata.html">data</a>-&gt;wildcard.customptr);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    }</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a> = -1;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;  }</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    <span class="comment">/* get the &quot;raw&quot; path */</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>, 0, &amp;<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    <span class="comment">/* We can limp along anyway (and should try to since we may already be in</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">     * the error path) */</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* mark control connection as bad */</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;FTP: out of memory!&quot;</span>); <span class="comment">/* mark for connection closure */</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a> = NULL; <span class="comment">/* no path remembering */</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;  }</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="keywordtype">size_t</span> flen = ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>?strlen(ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>):0; <span class="comment">/* file is &quot;raw&quot; already */</span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    <span class="keywordtype">size_t</span> dlen = strlen(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>)-flen;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a5899ffca5f9760f9e0109f126d0167fd">cwdfail</a>) {</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a8107b427cf1821e350705c896a3961e3">prevmethod</a> = <a class="code" href="structdata.html">data</a>-&gt;set.ftp_filemethod;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      <span class="keywordflow">if</span>(dlen &amp;&amp; (<a class="code" href="structdata.html">data</a>-&gt;set.ftp_filemethod != <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a>)) {</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a> = <a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="keywordflow">if</span>(flen)</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;          <span class="comment">/* if &#39;path&#39; is not the whole string */</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>[dlen] = 0; <span class="comment">/* terminate */</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      }</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>);</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        <span class="comment">/* we never changed dir */</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>)</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      }</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>)</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Remembering we are in dir \&quot;%s\&quot;\n&quot;</span>, ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>);</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    }</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a> = NULL; <span class="comment">/* no path */</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>);</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    }</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  }</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;  <span class="comment">/* free the dir tree and file parts */</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  freedirs(ftpc);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;  <span class="comment">/* shut down the socket to inform the server we&#39;re done */</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="preprocessor">#ifdef _WIN32_WCE</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;  shutdown(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>], 2);  <span class="comment">/* SD_BOTH */</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload &gt; 0) {</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      <span class="comment">/* partial download completed */</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(pp, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;ABOR&quot;</span>);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failure sending ABOR command: %s&quot;</span>,</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;              <a class="code" href="curl_8h.html#a1feaa896e865ad01f32cc46f6f8c72f5">curl_easy_strerror</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>));</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* mark control connection as bad */</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;ABOR command failed&quot;</span>); <span class="comment">/* connection closure */</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      }</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    }</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a>) {</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      <span class="comment">/* The secondary socket is using SSL so we must close down that part</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;<span class="comment">         first before we close the socket for real */</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      <a class="code" href="vtls_8h.html#a4b8227a2fd2fbf2d20147513033a8ade">Curl_ssl_close</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>);</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      <span class="comment">/* Note that we keep &quot;use&quot; set to TRUE since that (next) connection is</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="comment">         still requested to use SSL */</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    }</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    close_secondarysocket(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;  }</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; (ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> == <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>) &amp;&amp; ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> &amp;&amp;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;     pp-&gt;<a class="code" href="structpingpong.html#a3a10091c256aed9fce33a95f12bf5b8f">pending_resp</a> &amp;&amp; !premature) {</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="comment">     * Let&#39;s see what the server says about the transfer we just performed,</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;<span class="comment">     * but lower the timeout as sometimes this connection has died while the</span></div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;<span class="comment">     * data has been transferred. This happens when doing through NATs etc that</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;<span class="comment">     * abandon old silent connections.</span></div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    <span class="keywordtype">long</span> old_time = pp-&gt;<a class="code" href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">response_time</a>;</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    pp-&gt;<a class="code" href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">response_time</a> = 60*1000; <span class="comment">/* give it only a minute for now */</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    pp-&gt;<a class="code" href="structpingpong.html#a41d7af4e20ce3d40d90eddf0f62cb64d">response</a> = <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>(); <span class="comment">/* timeout relative now */</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(&amp;nread, <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, &amp;ftpcode);</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    pp-&gt;<a class="code" href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">response_time</a> = old_time; <span class="comment">/* set this back to previous value */</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    <span class="keywordflow">if</span>(!nread &amp;&amp; (<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a> == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)) {</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;control connection looks dead&quot;</span>);</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* mark control connection as bad */</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;      <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;Timeout or similar in FTP DONE operation&quot;</span>); <span class="comment">/* close */</span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    }</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload &gt; 0) {</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      <span class="comment">/* we have just sent ABOR and there is no reliable way to check if it was</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">       * successful or not; we have to close the connection now */</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;partial download completed, closing connection\n&quot;</span>);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;Partial download with no ability to check&quot;</span>);</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    }</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a>) {</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      <span class="comment">/* 226 Transfer complete, 250 Requested file action okay, completed. */</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;      <span class="keywordflow">if</span>((ftpcode != 226) &amp;&amp; (ftpcode != 250)) {</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;server did not report OK, got %d&quot;</span>, ftpcode);</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d">CURLE_PARTIAL_FILE</a>;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      }</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    }</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;  }</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || premature)</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    <span class="comment">/* the response code from the transfer showed an error already so no</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;<span class="comment">       use checking further */</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    ;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.upload) {</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">if</span>((-1 != <a class="code" href="structdata.html">data</a>-&gt;state.infilesize) &amp;&amp;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;       (<a class="code" href="structdata.html">data</a>-&gt;state.infilesize != *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>) &amp;&amp;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;       !<a class="code" href="structdata.html">data</a>-&gt;set.crlf &amp;&amp;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;       (ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> == <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>)) {</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Uploaded unaligned file size (%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            <span class="stringliteral">&quot; out of %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot; bytes)&quot;</span>,</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>, <a class="code" href="structdata.html">data</a>-&gt;state.infilesize);</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d">CURLE_PARTIAL_FILE</a>;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    }</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  }</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="keywordflow">if</span>((-1 != <a class="code" href="structdata.html">data</a>-&gt;req.size) &amp;&amp;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;       (<a class="code" href="structdata.html">data</a>-&gt;req.size != *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>) &amp;&amp;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;#ifdef <a class="code" href="urldata_8h.html#a9039214065dbe00b428b3ddcb2192f79">CURL_DO_LINEEND_CONV</a></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;       <span class="comment">/* Most FTP servers don&#39;t adjust their file SIZE response for CRLFs, so</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="comment">        * we&#39;ll check to see if the discrepancy can be explained by the number</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="comment">        * of CRLFs we&#39;ve changed to LFs.</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;       ((<a class="code" href="structdata.html">data</a>-&gt;req.size + <a class="code" href="structdata.html">data</a>-&gt;state.crlf_conversions) !=</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>) &amp;&amp;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;#endif <span class="comment">/* CURL_DO_LINEEND_CONV */</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;       (<a class="code" href="structdata.html">data</a>-&gt;req.maxdownload != *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>)) {</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Received only partial file: %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;            <span class="stringliteral">&quot; bytes&quot;</span>, *ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a>);</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d">CURLE_PARTIAL_FILE</a>;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    }</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a> &amp;&amp;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            !*ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a> &amp;&amp;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            (<a class="code" href="structdata.html">data</a>-&gt;req.size&gt;0)) {</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;No data was received!&quot;</span>);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff">CURLE_FTP_COULDNT_RETR_FILE</a>;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    }</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;  }</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;  <span class="comment">/* clear these for next connection */</span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;  <span class="comment">/* Send any post-transfer QUOTE strings? */</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;  <span class="keywordflow">if</span>(!status &amp;&amp; !<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; !premature &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;set.postquote)</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_sendquote(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="structdata.html">data</a>-&gt;set.postquote);</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f277380bb8d9d1876c10acb36ca98d7">pathalloc</a>);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;}</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="comment"> * ftp_sendquote()</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="comment"> * Where a &#39;quote&#39; means a list of custom commands to send to the server.</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="comment"> * The quote list is passed as an argument.</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment"> * BLOCKING</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_sendquote(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="keyword">struct</span> <a class="code" href="structcurl__slist.html">curl_slist</a> *quote)</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;{</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *item;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;  <span class="keywordtype">int</span> ftpcode;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;  item = quote;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  <span class="keywordflow">while</span>(item) {</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;    <span class="keywordflow">if</span>(item-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>) {</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;      <span class="keywordtype">char</span> *cmd = item-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      <span class="keywordtype">bool</span> acceptfail = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      <span class="comment">/* if a command starts with an asterisk, which a legal FTP command never</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="comment">         can, the command will be allowed to fail without it causing any</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="comment">         aborts or cancels etc. It will cause libcurl to act as if the command</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="comment">         is successful, whatever the server reponds. */</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;      <span class="keywordflow">if</span>(cmd[0] == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;        cmd++;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        acceptfail = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      }</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, cmd);</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      pp-&gt;<a class="code" href="structpingpong.html#a41d7af4e20ce3d40d90eddf0f62cb64d">response</a> = <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>(); <span class="comment">/* timeout relative now */</span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(&amp;nread, <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, &amp;ftpcode);</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      <span class="keywordflow">if</span>(!acceptfail &amp;&amp; (ftpcode &gt;= 400)) {</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;QUOT string not accepted: %s&quot;</span>, cmd);</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb">CURLE_QUOTE_ERROR</a>;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      }</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    }</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    item = item-&gt;<a class="code" href="structcurl__slist.html#a56fcfc41d89a47865933c310d316a108">next</a>;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;  }</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;}</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="comment"> * ftp_need_type()</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="comment"> * Returns TRUE if we in the current situation should send TYPE</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_need_type(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                         <span class="keywordtype">bool</span> ascii_wanted)</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;{</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab0970f16c847f1cbf177ea0f31087612">transfertype</a> != (ascii_wanted?<span class="charliteral">&#39;A&#39;</span>:<span class="charliteral">&#39;I&#39;</span>);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;}</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="comment"> * ftp_nb_type()</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;<span class="comment"> * Set TYPE. We only deal with ASCII or BINARY so this function</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="comment"> * sets one of them.</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;<span class="comment"> * If the transfer type is not sent, simulate on OK response in newstate</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_nb_type(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;                            <span class="keywordtype">bool</span> ascii, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a> newstate)</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;{</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;  <span class="keywordtype">char</span> want = (char)(ascii?<span class="charliteral">&#39;A&#39;</span>:<span class="charliteral">&#39;I&#39;</span>);</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#ab0970f16c847f1cbf177ea0f31087612">transfertype</a> == want) {</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, newstate);</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    <span class="keywordflow">return</span> ftp_state_type_resp(conn, 200, newstate);</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  }</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;  <a class="code" href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a>(&amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;TYPE %c&quot;</span>, want);</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, newstate);</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;  <span class="comment">/* keep track of our current transfer type */</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#ab0970f16c847f1cbf177ea0f31087612">transfertype</a> = want;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;}</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment"> * ftp_pasv_verbose()</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="comment"> * This function only outputs some informationals about this second connection</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="comment"> * when we&#39;ve issued a PASV command before and thus we have connected to a</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="comment"> * possibly new IP address.</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;ftp_pasv_verbose(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                 <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *ai,</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                 <span class="keywordtype">char</span> *<a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>, <span class="comment">/* ascii version */</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                 <span class="keywordtype">int</span> port)</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;{</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[256];</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  <a class="code" href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a>(ai, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>));</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Connecting to %s (%s) port %d\n&quot;</span>, <a class="code" href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">newhost</a>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, port);</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;}</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;<span class="comment"> * ftp_do_more()</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;<span class="comment"> * This function shall be called when the second FTP (data) connection is</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="comment"> * connected.</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;<span class="comment"> * &#39;complete&#39; can return 0 for incomplete, 1 for done and -1 for go back</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="comment"> * (which basically is only for when PASV is being sent to retry a failed</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="comment"> * EPSV).</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_do_more(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> *completep)</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;{</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;  <span class="keywordtype">bool</span> connected = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;  <span class="keywordtype">bool</span> complete = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;  <span class="comment">/* the ftp struct is inited in ftp_connect() */</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;  <span class="comment">/* if the second connection isn&#39;t done yet, wait for it */</span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>]) {</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="http__proxy_8c.html#a64cc706da81f4e2a504fc457b79542e2">Curl_connect_ongoing</a>(conn)) {</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;      <span class="comment">/* As we&#39;re in TUNNEL_CONNECT state now, we know the proxy name and port</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="comment">         aren&#39;t used so we blank their arguments. TODO: make this nicer */</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http__proxy_8c.html#a9fffe1c2e53dc5f8c47b0fd8d03f458a">Curl_proxyCONNECT</a>(conn, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>, NULL, 0);</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    }</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="connect_8c.html#a347cba516188d3bc3c6efc14dc3780d7">Curl_is_connected</a>(conn, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>, &amp;connected);</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    <span class="comment">/* Ready to do more? */</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;    <span class="keywordflow">if</span>(connected) {</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;      <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;DO-MORE connected phase starts\n&quot;</span>));</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    }</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; (ftpc-&gt;<a class="code" href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">count1</a> == 0)) {</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;        *completep = -1; <span class="comment">/* go back to DOING please */</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;        <span class="comment">/* this is a EPSV connect failing, try PASV instead */</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;        <span class="keywordflow">return</span> ftp_epsv_disable(conn);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      }</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    }</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;  }</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="http__proxy_8c.html#ac79abdd8c0d0b2818f4478e91afcaa35">Curl_proxy_connect</a>(conn, <a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="url_8h.html#af1f919128ab34b121c890ac634feb001">CONNECT_SECONDARYSOCKET_PROXY_SSL</a>())</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">tunnel_proxy</a> &amp;&amp; conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7a7b20d08be448324d83ed41df90adfb">httpproxy</a> &amp;&amp;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;     <a class="code" href="http__proxy_8c.html#a64cc706da81f4e2a504fc457b79542e2">Curl_connect_ongoing</a>(conn))</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">state</a>) {</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    <span class="comment">/* already in a state so skip the initial commands.</span></div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;<span class="comment">       They are only done to kickstart the do_more state */</span></div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(conn, &amp;complete);</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    *completep = (int)complete;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    <span class="comment">/* if we got an error or if we don&#39;t wait for a data connection return</span></div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;<span class="comment">       immediately */</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> != <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a>)</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      <span class="comment">/* if we reach the end of the FTP state machine here, *complete will be</span></div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;<span class="comment">         TRUE but so is ftpc-&gt;wait_data_conn, which says we need to wait for</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;<span class="comment">         the data connection and therefore we&#39;re not actually complete */</span></div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      *completep = 0;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  }</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> &lt;= <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a>) {</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="comment">/* a transfer is about to take place, or if not a file name was given</span></div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="comment">       so we&#39;ll do a SIZE on it later and then we need the right TYPE first */</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> == <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      <span class="keywordtype">bool</span> serv_conned;</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ReceivedServerConnect(conn, &amp;serv_conned);</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>; <span class="comment">/* Failed to accept data connection */</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;      <span class="keywordflow">if</span>(serv_conned) {</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        <span class="comment">/* It looks data connection is established */</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = AcceptServerConnect(conn);</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = InitiateTransfer(conn);</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        *completep = 1; <span class="comment">/* this state is now complete when the server has</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="comment">                           connected back to us */</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      }</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;    }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.upload) {</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_nb_type(conn, <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa6233d6e045100c7beda9fb549430f28">FTP_STOR_TYPE</a>);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(conn, &amp;complete);</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a>)</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        <span class="comment">/* if we reach the end of the FTP state machine here, *complete will be</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment">           TRUE but so is ftpc-&gt;wait_data_conn, which says we need to wait for</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">           the data connection and therefore we&#39;re not actually complete */</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;        *completep = 0;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;        *completep = (int)complete;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    }</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;      <span class="comment">/* download */</span></div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;      ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> = -1; <span class="comment">/* unknown as of yet */</span></div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl__range_8c.html#a82ce81e65f559e7316b160291d1a22b6">Curl_range</a>(conn);</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload &gt;= 0) {</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;        <span class="comment">/* Don&#39;t check for successful transfer */</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;        ftpc-&gt;<a class="code" href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">dont_check</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      }</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;        ;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_list_only || !ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>) {</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        <span class="comment">/* The specified path ends with a slash, and therefore we think this</span></div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="comment">           is a directory that is requested, use LIST. But before that we</span></div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;<span class="comment">           need to set ASCII transfer mode. */</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;        <span class="comment">/* But only if a body transfer was requested. */</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> == <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>) {</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_nb_type(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a65afd49b1baa6e1a4915c85f372a64eb">FTP_LIST_TYPE</a>);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;        }</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        <span class="comment">/* otherwise just fall through */</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;      }</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_nb_type(conn, <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1d39a52adb8e2162b2c56dcaf0943c80">FTP_RETR_TYPE</a>);</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;      }</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(conn, &amp;complete);</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;      *completep = (int)complete;</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    }</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;  }</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; (ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>))</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;    <span class="comment">/* no data to transfer. FIX: it feels like a kludge to have this here</span></div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="comment">       too! */</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;  <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a>) {</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <span class="comment">/* no waiting for the data connection so this is now complete */</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    *completep = 1;</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;DO-MORE phase ends with %d\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>));</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;  }</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;}</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;<span class="comment"> * ftp_perform()</span></div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;<span class="comment"> * This is the actual DO function for FTP. Get a file/directory according to</span></div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;<span class="comment"> * the options previously setup.</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_perform(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                     <span class="keywordtype">bool</span> *connected,  <span class="comment">/* connect status after PASV / PORT */</span></div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                     <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;{</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;  <span class="comment">/* this is FTP and no proxy */</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase starts\n&quot;</span>));</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a5e855dcf947888f8f1730b0e9fc03c32">opt_no_body</a>) {</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;    <span class="comment">/* requested no body means no transfer... */</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a>;</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;  }</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;  *dophase_done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* not done yet */</span></div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;  <span class="comment">/* start the first command in the DO phase */</span></div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_state_quote(conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2">FTP_QUOTE</a>);</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;  <span class="comment">/* run the state-machine */</span></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(conn, dophase_done);</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;  *connected = conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>];</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;ftp_perform ends with SECONDARY: %d\n&quot;</span>, *connected);</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;  <span class="keywordflow">if</span>(*dophase_done)</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase is complete1\n&quot;</span>));</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;}</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> wc_data_dtor(<span class="keywordtype">void</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;{</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__wc.html">ftp_wc</a> *ftpwc = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;  <span class="keywordflow">if</span>(ftpwc &amp;&amp; ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>)</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;    <a class="code" href="ftplistparser_8c.html#a822c4a0b890c2b7e9464514eb773b8d8">Curl_ftp_parselist_data_free</a>(&amp;ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>);</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpwc);</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;}</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> init_wc_data(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;{</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;  <span class="keywordtype">char</span> *last_slash;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a> = ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_wildcard_data.html">WildcardData</a> *wildcard = &amp;(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">wildcard</a>);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__wc.html">ftp_wc</a> *ftpwc = NULL;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;  last_slash = strrchr(ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;  <span class="keywordflow">if</span>(last_slash) {</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    last_slash++;</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    <span class="keywordflow">if</span>(last_slash[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>;</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_parse_url_path(conn);</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    }</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">pattern</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(last_slash);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    <span class="keywordflow">if</span>(!wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">pattern</a>)</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    last_slash[0] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* cut file from path */</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;  }</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">/* there is only &#39;wildcard pattern&#39; or nothing */</span></div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>[0]) {</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">pattern</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>);</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;      <span class="keywordflow">if</span>(!wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">pattern</a>)</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;      <a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    }</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">/* only list */</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>;</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_parse_url_path(conn);</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    }</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  }</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  <span class="comment">/* program continues only if URL is not ending with slash, allocate needed</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="comment">     resources for wildcard transfer */</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;  <span class="comment">/* allocate ftp protocol specific wildcard data */</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;  ftpwc = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structftp__wc.html">ftp_wc</a>));</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;  <span class="keywordflow">if</span>(!ftpwc) {</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;  }</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;  <span class="comment">/* INITIALIZE parselist structure */</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a> = <a class="code" href="ftplistparser_8c.html#a3ada8442a76dfa5e7d90be2ce9b4bb15">Curl_ftp_parselist_data_alloc</a>();</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;  <span class="keywordflow">if</span>(!ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>) {</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;  }</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;  wildcard-&gt;<a class="code" href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">protdata</a> = ftpwc; <span class="comment">/* put it to the WildcardData tmp pointer */</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;  wildcard-&gt;<a class="code" href="struct_wildcard_data.html#afe7e4bdcd1d620a7cb309126e2b05265">dtor</a> = wc_data_dtor;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;  <span class="comment">/* wildcard does not support NOCWD option (assert it?) */</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a0a3e765ba0eae3d45e73a0a0ec4a124b">ftp_filemethod</a> == <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a>)</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a0a3e765ba0eae3d45e73a0a0ec4a124b">ftp_filemethod</a> = <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955a99eba1414ed72de04dca8f1914a90b9a">FTPFILE_MULTICWD</a>;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  <span class="comment">/* try to parse ftp url */</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_parse_url_path(conn);</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;  }</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a696af622f22c72aa29f0af99e9833ed7">path</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>);</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  <span class="keywordflow">if</span>(!wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a696af622f22c72aa29f0af99e9833ed7">path</a>) {</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;  }</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;  <span class="comment">/* backup old write_function */</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#ae73ce67e5c2a18aaff021770934adee6">write_function</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a7c3b9ad30be2fed915aa3a694a31dc36">fwrite_func</a>;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  <span class="comment">/* parsing write function */</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a7c3b9ad30be2fed915aa3a694a31dc36">fwrite_func</a> = <a class="code" href="ftplistparser_8c.html#ad72b3b4dd2ac9ddc6089b0638c2af67a">Curl_ftp_parselist</a>;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  <span class="comment">/* backup old file descriptor */</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;  ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#a99acb1d843e05a88ae7974cab659375a">file_descriptor</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#aba5a454bc6c3ad60937bc8cdf93cc2de">out</a>;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  <span class="comment">/* let the writefunc callback know what curl pointer is working with */</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#aba5a454bc6c3ad60937bc8cdf93cc2de">out</a> = conn;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Wildcard - Parsing started\n&quot;</span>);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;  <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>:</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;  <span class="keywordflow">if</span>(ftpwc) {</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;    <a class="code" href="ftplistparser_8c.html#a822c4a0b890c2b7e9464514eb773b8d8">Curl_ftp_parselist_data_free</a>(&amp;ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>);</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpwc);</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;  }</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">pattern</a>);</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;  wildcard-&gt;<a class="code" href="struct_wildcard_data.html#afe7e4bdcd1d620a7cb309126e2b05265">dtor</a> = <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;  wildcard-&gt;<a class="code" href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">protdata</a> = NULL;</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;}</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;<span class="comment">/* This is called recursively */</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> wc_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;{</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_wildcard_data.html">WildcardData</a> * <span class="keyword">const</span> wildcard = &amp;(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">wildcard</a>);</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;  <span class="keywordflow">switch</span>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a>) {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aafac8d563d66d0af0fceb27bca71fc3ac">CURLWC_INIT</a>:</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = init_wc_data(conn);</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;    <span class="keywordflow">if</span>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> == <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>)</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      <span class="comment">/* only listing! */</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;    wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> ? <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa008ebf373c80fec111653fefacd75b50">CURLWC_ERROR</a> : <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf53e9618bd2fcb940dfa77b2707950bd">CURLWC_MATCHING</a>;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf53e9618bd2fcb940dfa77b2707950bd">CURLWC_MATCHING</a>: {</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;    <span class="comment">/* In this state is LIST response successfully parsed, so lets restore</span></div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;<span class="comment">       previous WRITEFUNCTION callback and WRITEDATA pointer */</span></div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;    <span class="keyword">struct </span><a class="code" href="structftp__wc.html">ftp_wc</a> *ftpwc = wildcard-&gt;<a class="code" href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">protdata</a>;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a7c3b9ad30be2fed915aa3a694a31dc36">fwrite_func</a> = ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#ae73ce67e5c2a18aaff021770934adee6">write_function</a>;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#aba5a454bc6c3ad60937bc8cdf93cc2de">out</a> = ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#a99acb1d843e05a88ae7974cab659375a">file_descriptor</a>;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;    ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#ae73ce67e5c2a18aaff021770934adee6">write_function</a> = <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    ftpwc-&gt;<a class="code" href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">backup</a>.<a class="code" href="structftp__wc.html#a99acb1d843e05a88ae7974cab659375a">file_descriptor</a> = NULL;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;    wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa265c50a923f1ba7979a1f4f64adf71e9">CURLWC_DOWNLOADING</a>;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="ftplistparser_8c.html#aaa44be04d49bc6bb4f26759980f346a6">Curl_ftp_parselist_geterror</a>(ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>)) {</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;      <span class="comment">/* error found in LIST parsing */</span></div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;      <span class="keywordflow">return</span> wc_statemach(conn);</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;    }</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">if</span>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#abca9151666b85a2a95d44bbbe1dcf8b2">size</a> == 0) {</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      <span class="comment">/* no corresponding file */</span></div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a>;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;    }</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;    <span class="keywordflow">return</span> wc_statemach(conn);</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;  }</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa265c50a923f1ba7979a1f4f64adf71e9">CURLWC_DOWNLOADING</a>: {</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    <span class="comment">/* filelist has at least one file, lets get first one */</span></div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;    <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcurl__fileinfo.html">curl_fileinfo</a> *finfo = wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#a3f6e07aacbee78561127b0166cc28fe7">head</a>-&gt;<a class="code" href="structcurl__llist__element.html#aa3c3cb90fae86e24d88eea4437bc61ab">ptr</a>;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;    <span class="keywordtype">char</span> *tmp_path = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s%s&quot;</span>, wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a696af622f22c72aa29f0af99e9833ed7">path</a>, finfo-&gt;<a class="code" href="structcurl__fileinfo.html#ae42985a10c5ac94b2ac09c5e75c05e40">filename</a>);</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    <span class="keywordflow">if</span>(!tmp_path)</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;    <span class="comment">/* switch default ftp-&gt;path and tmp_path */</span></div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f277380bb8d9d1876c10acb36ca98d7">pathalloc</a>);</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;    ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f277380bb8d9d1876c10acb36ca98d7">pathalloc</a> = ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a> = tmp_path;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Wildcard - START of \&quot;%s\&quot;\n&quot;</span>, finfo-&gt;<a class="code" href="structcurl__fileinfo.html#ae42985a10c5ac94b2ac09c5e75c05e40">filename</a>);</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a2d141b704c392572a00ec42b33bdadb2">chunk_bgn</a>) {</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;      <span class="keywordtype">long</span> userresponse;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;      userresponse = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a2d141b704c392572a00ec42b33bdadb2">chunk_bgn</a>(</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;        finfo, wildcard-&gt;<a class="code" href="struct_wildcard_data.html#a2bf8eb435d74b316148901988744f1e0">customptr</a>, (<span class="keywordtype">int</span>)wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#abca9151666b85a2a95d44bbbe1dcf8b2">size</a>);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;      <span class="keywordflow">switch</span>(userresponse) {</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#ad33aec6913a92b0f7730934990435499">CURL_CHUNK_BGN_FUNC_SKIP</a>:</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Wildcard - \&quot;%s\&quot; skipped by user\n&quot;</span>,</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;              finfo-&gt;<a class="code" href="structcurl__fileinfo.html#ae42985a10c5ac94b2ac09c5e75c05e40">filename</a>);</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;        wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354">CURLWC_SKIP</a>;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;        <span class="keywordflow">return</span> wc_statemach(conn);</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a225ec1b70e37967edeaf7fdb780d0456">CURL_CHUNK_BGN_FUNC_FAIL</a>:</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a91e314b8c572061fed47b9a204d3397d">CURLE_CHUNK_FAILED</a>;</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;      }</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    }</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;    <span class="keywordflow">if</span>(finfo-&gt;<a class="code" href="structcurl__fileinfo.html#a69b09df292a2f8a749ffd24f172b0bde">filetype</a> != <a class="code" href="curl_8h.html#a9780ca29d2faed151148e197d1d1e94fa5f08730cf69dcbc51c08420fb9f4c03d">CURLFILETYPE_FILE</a>) {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354">CURLWC_SKIP</a>;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;      <span class="keywordflow">return</span> wc_statemach(conn);</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;    }</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;    <span class="keywordflow">if</span>(finfo-&gt;<a class="code" href="structcurl__fileinfo.html#a4db8370a5202c50f4e3cf57bc0002c79">flags</a> &amp; <a class="code" href="curl_8h.html#a530ec194255dd00d6ea8968c76a0d03f">CURLFINFOFLAG_KNOWN_SIZE</a>)</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a> = finfo-&gt;<a class="code" href="structcurl__fileinfo.html#a23e38e1ca497cb7a140d9aff92f33fc0">size</a>;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_parse_url_path(conn);</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;    <span class="comment">/* we don&#39;t need the Curl_fileinfo of first file anymore */</span></div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;    <a class="code" href="llist_8c.html#a36b09b21eb5d63095a325575113df4f0">Curl_llist_remove</a>(&amp;wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>, wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#a3f6e07aacbee78561127b0166cc28fe7">head</a>, NULL);</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    <span class="keywordflow">if</span>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#abca9151666b85a2a95d44bbbe1dcf8b2">size</a> == 0) { <span class="comment">/* remains only one file to down. */</span></div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;      <span class="comment">/* after that will be ftp_do called once again and no transfer</span></div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;<span class="comment">         will be done because of CURLWC_CLEAN state */</span></div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    }</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  } <span class="keywordflow">break</span>;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354">CURLWC_SKIP</a>: {</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a55cebfc4d6849eb5f25fd8e7712823e9">chunk_end</a>) {</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a55cebfc4d6849eb5f25fd8e7712823e9">chunk_end</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">wildcard</a>.<a class="code" href="struct_wildcard_data.html#a2bf8eb435d74b316148901988744f1e0">customptr</a>);</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;    }</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <a class="code" href="llist_8c.html#a36b09b21eb5d63095a325575113df4f0">Curl_llist_remove</a>(&amp;wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>, wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#a3f6e07aacbee78561127b0166cc28fe7">head</a>, NULL);</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = (wildcard-&gt;<a class="code" href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">filelist</a>.<a class="code" href="structcurl__llist.html#abca9151666b85a2a95d44bbbe1dcf8b2">size</a> == 0) ?</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                      <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a> : <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa265c50a923f1ba7979a1f4f64adf71e9">CURLWC_DOWNLOADING</a>;</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;    <span class="keywordflow">return</span> wc_statemach(conn);</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;  }</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a>: {</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;    <span class="keyword">struct </span><a class="code" href="structftp__wc.html">ftp_wc</a> *ftpwc = wildcard-&gt;<a class="code" href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">protdata</a>;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;    <span class="keywordflow">if</span>(ftpwc)</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="ftplistparser_8c.html#aaa44be04d49bc6bb4f26759980f346a6">Curl_ftp_parselist_geterror</a>(ftpwc-&gt;<a class="code" href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">parser</a>);</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    wildcard-&gt;<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> = <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> ? <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa008ebf373c80fec111653fefacd75b50">CURLWC_ERROR</a> : <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf7b19e6541139da47849ca1761694d28">CURLWC_DONE</a>;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  } <span class="keywordflow">break</span>;</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf7b19e6541139da47849ca1761694d28">CURLWC_DONE</a>:</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa008ebf373c80fec111653fefacd75b50">CURLWC_ERROR</a>:</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa883c5854c27480107ee93c9dbf1f9e81">CURLWC_CLEAR</a>:</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    <span class="keywordflow">if</span>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#afe7e4bdcd1d620a7cb309126e2b05265">dtor</a>)</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;      wildcard-&gt;<a class="code" href="struct_wildcard_data.html#afe7e4bdcd1d620a7cb309126e2b05265">dtor</a>(wildcard-&gt;<a class="code" href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">protdata</a>);</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;  }</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;}</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;<span class="comment"> * ftp_do()</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;<span class="comment"> * This function is registered as &#39;curl_do&#39; function. It decodes the path</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;<span class="comment"> * parts etc as a wrapper to the actual DO function (ftp_perform).</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;<span class="comment"> * The input argument is already checked for validity.</span></div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_do(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;{</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;  *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to false */</span></div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">wait_data_conn</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to no such wait */</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#af62312f9834129445d1da33ed37d4f2b">wildcardmatch</a>) {</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = wc_statemach(conn);</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">wildcard</a>.<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> == <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354">CURLWC_SKIP</a> ||</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">wildcard</a>.<a class="code" href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">state</a> == <a class="code" href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf7b19e6541139da47849ca1761694d28">CURLWC_DONE</a>) {</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      <span class="comment">/* do not call ftp_regular_transfer */</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    }</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) <span class="comment">/* error, loop or skipping the file */</span></div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;  }</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">/* no wildcard FSM needed */</span></div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_parse_url_path(conn);</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;  }</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_regular_transfer(conn, done);</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;}</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"><a class="line" href="ftp_8h.html#a7c1c05a7854e33b820bdd94b89b228c5"> 3956</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="ftp_8c.html#ab65c9f67cc4c67672341d00c4b7110f5">Curl_ftpsend</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;{</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> bytes_written;</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="preprocessor">#define SBUF_SIZE 1024</span></div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;  <span class="keywordtype">char</span> s[<a class="code" href="ftp_8c.html#a2facdfca371afebb3364c87fae328d95">SBUF_SIZE</a>];</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;  <span class="keywordtype">size_t</span> write_len;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;  <span class="keywordtype">char</span> *sptr = s;</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;  <span class="keyword">enum</span> protection_level data_sec = conn-&gt;data_prot;</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;  <span class="keywordflow">if</span>(!cmd)</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a>;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  write_len = strlen(cmd);</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <span class="keywordflow">if</span>(!write_len || write_len &gt; (<span class="keyword">sizeof</span>(s) -3))</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a>;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;s, cmd, write_len);</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;  strcpy(&amp;s[write_len], <span class="stringliteral">&quot;\r\n&quot;</span>); <span class="comment">/* append a trailing CRLF */</span></div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;  write_len += 2;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;  bytes_written = 0;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="non-ascii_8h.html#ab7de472e1367a01da556c8f5acad93bb">Curl_convert_to_network</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, s, write_len);</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  <span class="comment">/* Curl_convert_to_network calls failf if unsuccessful */</span></div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    conn-&gt;data_prot = PROT_CMD;</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#a6d7b9f1e0b64c65b824a115d0b00b5a2">Curl_write</a>(conn, conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>], sptr, write_len,</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;                        &amp;bytes_written);</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(data_sec &gt; PROT_NONE &amp;&amp; data_sec &lt; PROT_LAST);</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    conn-&gt;data_prot = data_sec;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a5a5553b0cb30c0014b4c53d2ba0825f3">verbose</a>)</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;      <a class="code" href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <a class="code" href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a39c388deb977296403ec7a28b6c5acbe">CURLINFO_HEADER_OUT</a>, sptr, (<span class="keywordtype">size_t</span>)bytes_written);</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    <span class="keywordflow">if</span>(bytes_written != (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)write_len) {</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;      write_len -= bytes_written;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;      sptr += bytes_written;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    }</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;  }</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;}</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment"> * ftp_quit()</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment"> * This should be called before calling sclose() on an ftp control connection</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment"> * (not data connections). We should then wait for the response from the</span></div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="comment"> * server before returning. The calling code should then try to close the</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;<span class="comment"> * connection.</span></div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_quit(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;{</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a>) {</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;QUIT&quot;</span>);</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failure sending QUIT command: %s&quot;</span>,</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;            <a class="code" href="curl_8h.html#a1feaa896e865ad01f32cc46f6f8c72f5">curl_easy_strerror</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>));</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;      conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* mark control connection as bad */</span></div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;      <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(conn, <span class="stringliteral">&quot;QUIT command failed&quot;</span>); <span class="comment">/* mark for connection closure */</span></div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a>);</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;    }</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a5a431b48a039b3f3125648f79ac77057">FTP_QUIT</a>);</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_block_statemach(conn);</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;  }</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;}</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;<span class="comment"> * ftp_disconnect()</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment"> * Disconnect from an FTP server. Cleanup protocol-specific per-connection</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="comment"> * resources. BLOCKING.</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_disconnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> dead_connection)</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;{</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">pp</a>;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;  <span class="comment">/* We cannot send quit unconditionally. If this connection is stale or</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;<span class="comment">     bad in any way, sending quit and waiting around here will make the</span></div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;<span class="comment">     disconnect wait in vain and cause more problems than we need to.</span></div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;<span class="comment">     ftp_quit() will check the state of ftp-&gt;ctl_valid. If it&#39;s ok it</span></div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;<span class="comment">     will try to send the QUIT command, otherwise it will just return.</span></div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;  <span class="keywordflow">if</span>(dead_connection)</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;  <span class="comment">/* The FTP session may or may not have been allocated/setup at this point! */</span></div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;  (void)ftp_quit(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>); <span class="comment">/* ignore errors on the QUIT */</span></div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>) {</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.most_recent_ftp_entrypath == ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>) {</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;state.most_recent_ftp_entrypath = NULL;</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;    }</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a>);</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">entrypath</a> = NULL;</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;  }</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  freedirs(ftpc);</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>);</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a> = NULL;</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a>);</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">server_os</a> = NULL;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;  <a class="code" href="pingpong_8c.html#a6ba0ccd2a13cada0cffd6fa6c2ea98f6">Curl_pp_disconnect</a>(pp);</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  Curl_sec_end(conn);</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;}</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;<span class="comment"> * ftp_parse_url_path()</span></div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;<span class="comment"> * Parse the URL path into separate path components.</span></div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_parse_url_path(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;{</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  <span class="comment">/* the ftp struct is already inited in ftp_connect() */</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *slash_pos;  <span class="comment">/* position of the first &#39;/&#39; char in curpos */</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *path_to_use = ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *cur_pos;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = NULL;</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;  cur_pos = path_to_use; <span class="comment">/* current position in path. point at the begin of</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="comment">                            next path component */</span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a5899ffca5f9760f9e0109f126d0167fd">cwdfail</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_filemethod) {</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a>:</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;    <span class="comment">/* fastest, but less standard-compliant */</span></div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;<span class="comment">      The best time to check whether the path is a file or directory is right</span></div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="comment">      here. so:</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="comment">      the first condition in the if() right here, is there just in case</span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;<span class="comment">      someone decides to set path to NULL one day</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;    <span class="keywordflow">if</span>(path_to_use[0] &amp;&amp;</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;       (path_to_use[strlen(path_to_use) - 1] != <span class="charliteral">&#39;/&#39;</span>) )</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;      <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = path_to_use;  <span class="comment">/* this is a full file path */</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;<span class="comment">      else {</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;<span class="comment">        ftpc-&gt;file is not used anywhere other than for operations on a file.</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="comment">        In other words, never for directory operations.</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="comment">        So we can safely leave filename as NULL here and use it as a</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="comment">        argument in dir/file decisions.</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955a6797c5e57b04b63f4f8bab20bbac89f3">FTPFILE_SINGLECWD</a>:</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;    <span class="comment">/* get the last slash */</span></div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;    <span class="keywordflow">if</span>(!path_to_use[0]) {</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;      <span class="comment">/* no dir, no file */</span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> = 0;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    }</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;    slash_pos = strrchr(cur_pos, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;    <span class="keywordflow">if</span>(slash_pos || !*cur_pos) {</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;      <span class="keywordtype">size_t</span> dirlen = slash_pos-cur_pos;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <span class="keyword">sizeof</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[0]));</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;      <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>)</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;      <span class="keywordflow">if</span>(!dirlen)</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;        dirlen++;</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, slash_pos ? cur_pos : <span class="stringliteral">&quot;/&quot;</span>,</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;                              slash_pos ? dirlen : 1,</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;                              &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[0], NULL,</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;                              <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;        freedirs(ftpc);</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      }</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> = 1; <span class="comment">/* we consider it to be a single dir */</span></div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = slash_pos ? slash_pos + 1 : cur_pos; <span class="comment">/* rest is file name */</span></div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    }</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = cur_pos;  <span class="comment">/* this is a file name only */</span></div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;  <span class="keywordflow">default</span>: <span class="comment">/* allow pretty much anything */</span></div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955a99eba1414ed72de04dca8f1914a90b9a">FTPFILE_MULTICWD</a>:</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> = 0;</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">diralloc</a> = 5; <span class="comment">/* default dir depth to allocate */</span></div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">diralloc</a>, <span class="keyword">sizeof</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[0]));</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>)</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;    <span class="comment">/* we have a special case for listing the root dir only */</span></div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;    <span class="keywordflow">if</span>(!strcmp(path_to_use, <span class="stringliteral">&quot;/&quot;</span>)) {</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      cur_pos++; <span class="comment">/* make it point to the zero byte */</span></div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[0] = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>++;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    }</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      <span class="comment">/* parse the URL path into separate path components */</span></div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;      <span class="keywordflow">while</span>((slash_pos = strchr(cur_pos, <span class="charliteral">&#39;/&#39;</span>)) != NULL) {</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;        <span class="comment">/* 1 or 0 pointer offset to indicate absolute directory */</span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;        <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> absolute_dir = ((cur_pos - ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a> &gt; 0) &amp;&amp;</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;                                (ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> == 0))?1:0;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;        <span class="comment">/* seek out the next path component */</span></div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;        <span class="keywordflow">if</span>(slash_pos-cur_pos) {</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;          <span class="comment">/* we skip empty path components, like &quot;x//y&quot; since the FTP command</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="comment">             CWD requires a parameter and a non-existent parameter a) doesn&#39;t</span></div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;<span class="comment">             work on many servers and b) has no effect on the others. */</span></div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;          <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = slash_pos - cur_pos + absolute_dir;</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;          <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> =</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;            <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, cur_pos - absolute_dir, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;                           &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>], NULL,</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;                           <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;            freedirs(ftpc);</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;          }</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;        }</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;          cur_pos = slash_pos + 1; <span class="comment">/* jump to the rest of the string */</span></div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;          <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>) {</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;            <span class="comment">/* path starts with a slash, add that as a directory */</span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;            ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>] = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;            <span class="keywordflow">if</span>(!ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a>++]) { <span class="comment">/* run out of memory ... */</span></div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;              <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;no memory&quot;</span>);</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;              freedirs(ftpc);</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;              <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;            }</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;          }</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;        }</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;        cur_pos = slash_pos + 1; <span class="comment">/* jump to the rest of the string */</span></div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;        <span class="keywordflow">if</span>(++ftpc-&gt;<a class="code" href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">dirdepth</a> &gt;= ftpc-&gt;<a class="code" href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">diralloc</a>) {</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;          <span class="comment">/* enlarge array */</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;          <span class="keywordtype">char</span> **bigger;</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">diralloc</a> *= 2; <span class="comment">/* double the size each time */</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;          bigger = <a class="code" href="curl__memory_8h.html#aa568500a9ca507b5a53de5372c81f26a">realloc</a>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>, ftpc-&gt;<a class="code" href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">diralloc</a> * <span class="keyword">sizeof</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a>[0]));</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;          <span class="keywordflow">if</span>(!bigger) {</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;            freedirs(ftpc);</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;          }</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;          ftpc-&gt;<a class="code" href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">dirs</a> = bigger;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        }</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;      }</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    }</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;    <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = cur_pos;  <span class="comment">/* the rest is the file name */</span></div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;  } <span class="comment">/* switch */</span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> &amp;&amp; *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>) {</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> =</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;      <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, 0,  &amp;ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      freedirs(ftpc);</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    }</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;  }</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a> = NULL; <span class="comment">/* instead of point to a zero byte, we make it a NULL</span></div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="comment">                          pointer */</span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.upload &amp;&amp; !ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a> &amp;&amp; (ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> == <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>)) {</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="comment">/* We need a file name when uploading. Return error! */</span></div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Uploading to a URL without a file name!&quot;</span>);</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;  }</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#ae6de82dcc76af4ea97e828e326606561">cwddone</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to not done */</span></div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;  <span class="keywordflow">if</span>(ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>) {</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    <span class="comment">/* prevpath is &quot;raw&quot; so we convert the input path before we compare the</span></div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;<span class="comment">       strings */</span></div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    <span class="keywordtype">size_t</span> dlen;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>;</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> =</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;      <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>, 0, &amp;<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>, &amp;dlen, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;      freedirs(ftpc);</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;    }</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;    dlen -= ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>?strlen(ftpc-&gt;<a class="code" href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">file</a>):0;</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;    <span class="keywordflow">if</span>((dlen == strlen(ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>)) &amp;&amp;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;       !strncmp(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>, ftpc-&gt;<a class="code" href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">prevpath</a>, dlen) &amp;&amp;</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;       (ftpc-&gt;<a class="code" href="structftp__conn.html#a8107b427cf1821e350705c896a3961e3">prevmethod</a> == <a class="code" href="structdata.html">data</a>-&gt;set.ftp_filemethod)) {</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Request has same path as previous transfer\n&quot;</span>);</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      ftpc-&gt;<a class="code" href="structftp__conn.html#ae6de82dcc76af4ea97e828e326606561">cwddone</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;    }</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a>);</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  }</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;}</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;<span class="comment">/* call this when the DO phase has completed */</span></div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_dophase_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;                                 <span class="keywordtype">bool</span> connected)</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;{</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;  <span class="keywordflow">if</span>(connected) {</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;    <span class="keywordtype">int</span> completed;</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_do_more(conn, &amp;completed);</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;      close_secondarysocket(conn);</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;    }</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;  }</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;  <span class="keywordflow">if</span>(ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>)</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    <span class="comment">/* no data to transfer */</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!connected)</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;    <span class="comment">/* since we didn&#39;t connect now, we want do_more to get called */</span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7563463d9ad94df9ed822c17786dd6a2">do_more</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* seems good */</span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;}</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;<span class="comment">/* called from multi.c while DOing */</span></div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_doing(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;                          <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;{</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_multi_statemach(conn, dophase_done);</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase failed\n&quot;</span>));</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*dophase_done) {</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_dophase_done(conn, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> <span class="comment">/* not connected */</span>);</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase is complete2\n&quot;</span>));</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;  }</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;}</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;<span class="comment"> * ftp_regular_transfer()</span></div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;<span class="comment"> * The input argument is already checked for validity.</span></div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="comment"> * Performs all commands done before a regular transfer between a local and a</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;<span class="comment"> * remote host.</span></div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="comment"> * ftp-&gt;ctl_valid starts out as FALSE, and gets set to TRUE if we reach the</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;<span class="comment"> * ftp_done() function without finding any major problem.</span></div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_regular_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;                              <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;{</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;  <span class="keywordtype">bool</span> connected = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;  <span class="keyword">struct </span><a class="code" href="structftp__conn.html">ftp_conn</a> *ftpc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;req.size = -1; <span class="comment">/* make sure this is unknown at this point */</span></div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;  <a class="code" href="progress_8c.html#a9458c724bbe21e16b9abf8f696a3916a">Curl_pgrsSetUploadCounter</a>(<a class="code" href="structdata.html">data</a>, 0);</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;  <a class="code" href="progress_8c.html#afd65889574fb7bde6ffcec48b0d8debb">Curl_pgrsSetDownloadCounter</a>(<a class="code" href="structdata.html">data</a>, 0);</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;  <a class="code" href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a>(<a class="code" href="structdata.html">data</a>, -1);</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, -1);</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;  ftpc-&gt;<a class="code" href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ctl_valid</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* starts good */</span></div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_perform(conn,</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;                       &amp;connected, <span class="comment">/* have we connected after PASV/PORT */</span></div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;                       dophase_done); <span class="comment">/* all commands in the DO-phase done? */</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    <span class="keywordflow">if</span>(!*dophase_done)</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;      <span class="comment">/* the DO phase has not completed yet */</span></div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ftp_dophase_done(conn, connected);</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;  }</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;    freedirs(ftpc);</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;}</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ftp_setup_connection(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;{</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>;</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_f_t_p.html">FTP</a> *ftp;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a> = ftp = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_f_t_p.html">FTP</a>), 1);</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;  <span class="keywordflow">if</span>(NULL == ftp)</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a> = &amp;<a class="code" href="structdata.html">data</a>-&gt;state.up.path[1]; <span class="comment">/* don&#39;t include the initial slash */</span></div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.slash_removed = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* we&#39;ve skipped the slash */</span></div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;  <span class="comment">/* FTP URLs support an extension like &quot;;type=&lt;typecode&gt;&quot; that</span></div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;<span class="comment">   * we&#39;ll try to get now! */</span></div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;  <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a> = strstr(ftp-&gt;<a class="code" href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">path</a>, <span class="stringliteral">&quot;;type=&quot;</span>);</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>)</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a> = strstr(conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a291f3a076a5e010a90c0245625ea09b9">rawalloc</a>, <span class="stringliteral">&quot;;type=&quot;</span>);</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>) {</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>;</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;    *<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a> = 0;                     <span class="comment">/* it was in the middle of the hostname */</span></div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a> = <a class="code" href="strcase_8c.html#a555bbf5fd8dc146336474a2bb7959524">Curl_raw_toupper</a>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>[6]);</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#ad01da5e5ef1d73274b15318ad886696f">type_set</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>) {</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>: <span class="comment">/* ASCII mode */</span></div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>: <span class="comment">/* directory mode */</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;set.ftp_list_only = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>: <span class="comment">/* binary mode */</span></div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;      <span class="comment">/* switch off ASCII */</span></div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;set.prefer_ascii = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;    }</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;  }</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  <span class="comment">/* get some initial data into the ftp struct */</span></div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">bytecountp</a> = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a7bd7f9afc35050a31e496a08c5baaeb8">bytecount</a>;</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>;</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">downloadsize</a> = 0;</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;  <span class="comment">/* No need to duplicate user+password, the connectdata struct won&#39;t change</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;<span class="comment">     during a session, but we re-init them here since on subsequent inits</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;<span class="comment">     since the conn struct may have changed or been replaced.</span></div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#ada20af2bff00cbbf74221db56fce01d3">user</a> = conn-&gt;<a class="code" href="structconnectdata.html#a85cb9da7776d42c440612d2940a7fcb4">user</a>;</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;  ftp-&gt;<a class="code" href="struct_f_t_p.html#a4b007b3a38109d7ea3b60ea8be4383e3">passwd</a> = conn-&gt;<a class="code" href="structconnectdata.html#a4bb3a85b09c8a63a0b526a24f9b1897a">passwd</a>;</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;  <span class="keywordflow">if</span>(isBadFtpString(ftp-&gt;<a class="code" href="struct_f_t_p.html#ada20af2bff00cbbf74221db56fce01d3">user</a>))</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;  <span class="keywordflow">if</span>(isBadFtpString(ftp-&gt;<a class="code" href="struct_f_t_p.html#a4b007b3a38109d7ea3b60ea8be4383e3">passwd</a>))</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">ftpc</a>.<a class="code" href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">known_filesize</a> = -1; <span class="comment">/* unknown size for now */</span></div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;}</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_DISABLE_FTP */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00498">curl.h:498</a></div></div>
<div class="ttc" id="struct_connect_bits_html_ad6024fcc7a2aefd8d8d1359f9ae7955d"><div class="ttname"><a href="struct_connect_bits.html#ad6024fcc7a2aefd8d8d1359f9ae7955d">ConnectBits::proxy</a></div><div class="ttdeci">bool proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00387">urldata.h:387</a></div></div>
<div class="ttc" id="structcurl__fileinfo_html_a4db8370a5202c50f4e3cf57bc0002c79"><div class="ttname"><a href="structcurl__fileinfo.html#a4db8370a5202c50f4e3cf57bc0002c79">curl_fileinfo::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00299">curl.h:299</a></div></div>
<div class="ttc" id="structpingpong_html_a3a10091c256aed9fce33a95f12bf5b8f"><div class="ttname"><a href="structpingpong.html#a3a10091c256aed9fce33a95f12bf5b8f">pingpong::pending_resp</a></div><div class="ttdeci">bool pending_resp</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00054">pingpong.h:54</a></div></div>
<div class="ttc" id="structftp__wc_html"><div class="ttname"><a href="structftp__wc.html">ftp_wc</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00084">ftp.h:84</a></div></div>
<div class="ttc" id="structconnectdata_html_ab6f11cf5c5bc549e9f9af12fc65e2e23"><div class="ttname"><a href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">connectdata::ssl</a></div><div class="ttdeci">struct ssl_connect_data ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00885">urldata.h:885</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a15aced4a015c44ff454787debee23520"><div class="ttname"><a href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">Curl_easy::state</a></div><div class="ttdeci">struct UrlState state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01795">urldata.h:1795</a></div></div>
<div class="ttc" id="curl_8h_html_adef34e1e2989d3726cc20e3b5875f2f4"><div class="ttname"><a href="curl_8h.html#adef34e1e2989d3726cc20e3b5875f2f4">CURLPROTO_FTPS</a></div><div class="ttdeci">#define CURLPROTO_FTPS</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00868">curl.h:868</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65af08a45f6d43a3e58495131fb582ff1c0"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65af08a45f6d43a3e58495131fb582ff1c0">FTP_RETR_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00068">ftp.h:68</a></div></div>
<div class="ttc" id="sendf_8h_html_a2d27756d638621a2d2300dab33833f0c"><div class="ttname"><a href="sendf_8h.html#a2d27756d638621a2d2300dab33833f0c">CLIENTWRITE_BOTH</a></div><div class="ttdeci">#define CLIENTWRITE_BOTH</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00052">sendf.h:52</a></div></div>
<div class="ttc" id="struct_user_defined_html_a2707060ddbd7ff8a8893a7305a16d187"><div class="ttname"><a href="struct_user_defined.html#a2707060ddbd7ff8a8893a7305a16d187">UserDefined::ftp_use_port</a></div><div class="ttdeci">bool ftp_use_port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01629">urldata.h:1629</a></div></div>
<div class="ttc" id="ftp_8c_html_a77812d4945cd21094debbd06962f0f01"><div class="ttname"><a href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a></div><div class="ttdeci">#define state(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00101">ftp.c:101</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a16be3d146abcb8267fcf04cd9c41b647">CURLE_FTP_WEIRD_PASV_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00477">curl.h:477</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a7a7b20d08be448324d83ed41df90adfb"><div class="ttname"><a href="struct_connect_bits.html#a7a7b20d08be448324d83ed41df90adfb">ConnectBits::httpproxy</a></div><div class="ttdeci">bool httpproxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00388">urldata.h:388</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="ftp_8c_html_ab65c9f67cc4c67672341d00c4b7110f5"><div class="ttname"><a href="ftp_8c.html#ab65c9f67cc4c67672341d00c4b7110f5">Curl_ftpsend</a></div><div class="ttdeci">CURLcode Curl_ftpsend(struct connectdata *conn, const char *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l03956">ftp.c:3956</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00527">curl.h:527</a></div></div>
<div class="ttc" id="escape_8c_html_a11aa4921a19102059a1d94e2be15477a"><div class="ttname"><a href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a></div><div class="ttdeci">CURLcode Curl_urldecode(struct Curl_easy *data, const char *string, size_t length, char **ostring, size_t *olen, bool reject_ctrl)</div><div class="ttdef"><b>Definition:</b> <a href="escape_8c_source.html#l00147">escape.c:147</a></div></div>
<div class="ttc" id="structpingpong_html_a4f9a725e7d24dbfe7b0574ce14671048"><div class="ttname"><a href="structpingpong.html#a4f9a725e7d24dbfe7b0574ce14671048">pingpong::sendleft</a></div><div class="ttdeci">size_t sendleft</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00059">pingpong.h:59</a></div></div>
<div class="ttc" id="parsedate_8c_html_afbefdd1c70bc7fde8f2369a4cf46a62f"><div class="ttname"><a href="parsedate_8c.html#afbefdd1c70bc7fde8f2369a4cf46a62f">Curl_wkday</a></div><div class="ttdeci">const char *const Curl_wkday[]</div><div class="ttdef"><b>Definition:</b> <a href="parsedate_8c_source.html#l00085">parsedate.c:85</a></div></div>
<div class="ttc" id="if2ip_8h_html_a5b6d01fb9da7688daa9437b3628d83eea6f409d3c1e34d2b7c92a46d51e60405c"><div class="ttname"><a href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eea6f409d3c1e34d2b7c92a46d51e60405c">IF2IP_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="if2ip_8h_source.html#l00038">if2ip.h:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00536">curl.h:536</a></div></div>
<div class="ttc" id="curl_8h_html_af7074ca58279ac7ad8f78b9954a31160"><div class="ttname"><a href="curl_8h.html#af7074ca58279ac7ad8f78b9954a31160">CURL_SEEKFUNC_OK</a></div><div class="ttdeci">#define CURL_SEEKFUNC_OK</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00343">curl.h:343</a></div></div>
<div class="ttc" id="connect_8c_html_a040dc08db4e56830fee8cd4515b3db76"><div class="ttname"><a href="connect_8c.html#a040dc08db4e56830fee8cd4515b3db76">Curl_conn_data_pending</a></div><div class="ttdeci">bool Curl_conn_data_pending(struct connectdata *conn, int sockindex)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l01432">connect.c:1432</a></div></div>
<div class="ttc" id="url_8h_html_af1f919128ab34b121c890ac634feb001"><div class="ttname"><a href="url_8h.html#af1f919128ab34b121c890ac634feb001">CONNECT_SECONDARYSOCKET_PROXY_SSL</a></div><div class="ttdeci">#define CONNECT_SECONDARYSOCKET_PROXY_SSL()</div><div class="ttdef"><b>Definition:</b> <a href="url_8h_source.html#l00107">url.h:107</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="pingpong_8h_html_aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961"><div class="ttname"><a href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00037">pingpong.h:37</a></div></div>
<div class="ttc" id="ftp_8h_html_ad68713f9a78b1d9e9eeec5ad478a3955a99eba1414ed72de04dca8f1914a90b9a"><div class="ttname"><a href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955a99eba1414ed72de04dca8f1914a90b9a">FTPFILE_MULTICWD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00094">ftp.h:94</a></div></div>
<div class="ttc" id="setup-os400_8h_html_af65cc88d9ccb2274b94e0025d25d965f"><div class="ttname"><a href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a></div><div class="ttdeci">#define bind</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00211">setup-os400.h:211</a></div></div>
<div class="ttc" id="structftp__conn_html_afe0772034a72ef6799a141b877dcef0d"><div class="ttname"><a href="structftp__conn.html#afe0772034a72ef6799a141b877dcef0d">ftp_conn::state_saved</a></div><div class="ttdeci">ftpstate state_saved</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00147">ftp.h:147</a></div></div>
<div class="ttc" id="mime_8c_html_a6750c6bf3d5e493a9afbf0c278110187"><div class="ttname"><a href="mime_8c.html#a6750c6bf3d5e493a9afbf0c278110187">filesize</a></div><div class="ttdeci">#define filesize(name, stat_data)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l00125">mime.c:125</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ab1ccd7c5223945586470ddac912f5659"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab1ccd7c5223945586470ddac912f5659">FTP_STOR</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00077">ftp.h:77</a></div></div>
<div class="ttc" id="structftp__conn_html_a5899ffca5f9760f9e0109f126d0167fd"><div class="ttname"><a href="structftp__conn.html#a5899ffca5f9760f9e0109f126d0167fd">ftp_conn::cwdfail</a></div><div class="ttdeci">bool cwdfail</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00136">ftp.h:136</a></div></div>
<div class="ttc" id="progress_8c_html_a9458c724bbe21e16b9abf8f696a3916a"><div class="ttname"><a href="progress_8c.html#a9458c724bbe21e16b9abf8f696a3916a">Curl_pgrsSetUploadCounter</a></div><div class="ttdeci">void Curl_pgrsSetUploadCounter(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00336">progress.c:336</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00513">curl.h:513</a></div></div>
<div class="ttc" id="connect_8h_html_a0f98be540dd5a5f56c9ec98dc2489661"><div class="ttname"><a href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a></div><div class="ttdeci">#define connclose(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00145">connect.h:145</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a45792e6cafc2628e4bef7a25035acd4d">FTP_LIST</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00075">ftp.h:75</a></div></div>
<div class="ttc" id="connect_8h_html_a424d2b76b8d7dcd8e56ea081825248d4"><div class="ttname"><a href="connect_8h.html#a424d2b76b8d7dcd8e56ea081825248d4">Curl_sndbufset</a></div><div class="ttdeci">#define Curl_sndbufset(y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00071">connect.h:71</a></div></div>
<div class="ttc" id="urldata_8h_html_a9039214065dbe00b428b3ddcb2192f79"><div class="ttname"><a href="urldata_8h.html#a9039214065dbe00b428b3ddcb2192f79">CURL_DO_LINEEND_CONV</a></div><div class="ttdeci">#define CURL_DO_LINEEND_CONV</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01324">urldata.h:1324</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a2b3b874197ce162d8f012723a7184004"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b3b874197ce162d8f012723a7184004">FTP_STOR_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00069">ftp.h:69</a></div></div>
<div class="ttc" id="ftp_8c_html_ae19150e23e50c1c93bff64146ea0e5c5"><div class="ttname"><a href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5">ftpport</a></div><div class="ttdeci">ftpport</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00922">ftp.c:922</a></div></div>
<div class="ttc" id="structcurl__slist_html"><div class="ttname"><a href="structcurl__slist.html">curl_slist</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02394">curl.h:2394</a></div></div>
<div class="ttc" id="curl_8h_html_a225ec1b70e37967edeaf7fdb780d0456"><div class="ttname"><a href="curl_8h.html#a225ec1b70e37967edeaf7fdb780d0456">CURL_CHUNK_BGN_FUNC_FAIL</a></div><div class="ttdeci">#define CURL_CHUNK_BGN_FUNC_FAIL</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00309">curl.h:309</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa6114ab34b2617b1417c28d34af22bed6"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa6114ab34b2617b1417c28d34af22bed6">STRING_FTPPORT</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01410">urldata.h:1410</a></div></div>
<div class="ttc" id="structpingpong_html_afc0e964e626fa8bd851d96082f70eeb9"><div class="ttname"><a href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">pingpong::response_time</a></div><div class="ttdeci">long response_time</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00063">pingpong.h:63</a></div></div>
<div class="ttc" id="warnless_8c_html_ad00eb8c7d08a3af99f84038736057606"><div class="ttname"><a href="warnless_8c.html#ad00eb8c7d08a3af99f84038736057606">curlx_sltosi</a></div><div class="ttdeci">int curlx_sltosi(long slnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00264">warnless.c:264</a></div></div>
<div class="ttc" id="ftp_8c_html_ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841"><div class="ttname"><a href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a8268527d969e4ef493d3f35844a0b841">PORT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00924">ftp.c:924</a></div></div>
<div class="ttc" id="struct_curl__easy_html_ae5d06a1cef02a1310a3fd7be169f9d46"><div class="ttname"><a href="struct_curl__easy.html#ae5d06a1cef02a1310a3fd7be169f9d46">Curl_easy::wildcard</a></div><div class="ttdeci">struct WildcardData wildcard</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01797">urldata.h:1797</a></div></div>
<div class="ttc" id="structproxy__info_html_ae2cc9c2eb5c4ea0c4b92bf067e391bdc"><div class="ttname"><a href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">proxy_info::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00752">urldata.h:752</a></div></div>
<div class="ttc" id="progress_8c_html_a1344967836d86ae13b5739ed0a6e6916"><div class="ttname"><a href="progress_8c.html#a1344967836d86ae13b5739ed0a6e6916">Curl_pgrsTime</a></div><div class="ttdeci">void Curl_pgrsTime(struct Curl_easy *data, timerid timer)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00166">progress.c:166</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="urldata_8h_html_a93a3791fdbb761285b636725fed39385"><div class="ttname"><a href="urldata_8h.html#a93a3791fdbb761285b636725fed39385">PROTOPT_NOURLQUERY</a></div><div class="ttdeci">#define PROTOPT_NOURLQUERY</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00717">urldata.h:717</a></div></div>
<div class="ttc" id="pingpong_8c_html_a6ba0ccd2a13cada0cffd6fa6c2ea98f6"><div class="ttname"><a href="pingpong_8c.html#a6ba0ccd2a13cada0cffd6fa6c2ea98f6">Curl_pp_disconnect</a></div><div class="ttdeci">CURLcode Curl_pp_disconnect(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00508">pingpong.c:508</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_a696af622f22c72aa29f0af99e9833ed7"><div class="ttname"><a href="struct_wildcard_data.html#a696af622f22c72aa29f0af99e9833ed7">WildcardData::path</a></div><div class="ttdeci">char * path</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00048">wildcard.h:48</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa3b20ef4cea470a653b7d611a040b1354">CURLWC_SKIP</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00037">wildcard.h:37</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aafac8d563d66d0af0fceb27bca71fc3ac"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aafac8d563d66d0af0fceb27bca71fc3ac">CURLWC_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00032">wildcard.h:32</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="struct_curl__handler_html"><div class="ttname"><a href="struct_curl__handler.html">Curl_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00628">urldata.h:628</a></div></div>
<div class="ttc" id="http__proxy_8h_html"><div class="ttname"><a href="http__proxy_8h.html">http_proxy.h</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa1594fce26a7a9f56cb2295b8eb819f63">CURLWC_CLEAN</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00036">wildcard.h:36</a></div></div>
<div class="ttc" id="retry-max-time_8d_html_a612021c6b1f447b49053406818ef4ee6"><div class="ttname"><a href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a></div><div class="ttdeci">Long the request will be made and while it may take longer than this given time period.To limit a single request s maximum time</div><div class="ttdef"><b>Definition:</b> <a href="retry-max-time_8d_source.html#l00008">retry-max-time.d:8</a></div></div>
<div class="ttc" id="struct_connect_bits_html_ad01da5e5ef1d73274b15318ad886696f"><div class="ttname"><a href="struct_connect_bits.html#ad01da5e5ef1d73274b15318ad886696f">ConnectBits::type_set</a></div><div class="ttdeci">bool type_set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00435">urldata.h:435</a></div></div>
<div class="ttc" id="curl_8h_html_afa63f4f6ec2b2589a3cb5e5ee4ac7f8da46e091e25e4a6e44c28b131bc2559248"><div class="ttname"><a href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8da46e091e25e4a6e44c28b131bc2559248">CURLFTPAUTH_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00834">curl.h:834</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a550a957124dfbe3ed5a3ea91504edb0a"><div class="ttname"><a href="struct_connect_bits.html#a550a957124dfbe3ed5a3ea91504edb0a">ConnectBits::ftp_use_data_ssl</a></div><div class="ttdeci">bool ftp_use_data_ssl</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00424">urldata.h:424</a></div></div>
<div class="ttc" id="pingpong_8h_html_aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9"><div class="ttname"><a href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00036">pingpong.h:36</a></div></div>
<div class="ttc" id="curl_8h_html_a34eb017e0a29378f976becdaa94160d1"><div class="ttname"><a href="curl_8h.html#a34eb017e0a29378f976becdaa94160d1">CURL_SEEKFUNC_CANTSEEK</a></div><div class="ttdeci">#define CURL_SEEKFUNC_CANTSEEK</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00345">curl.h:345</a></div></div>
<div class="ttc" id="ftp_8c_html_ac474366ad3ca4fbae5b26e6a4942f064"><div class="ttname"><a href="ftp_8c.html#ac474366ad3ca4fbae5b26e6a4942f064">PPSENDF</a></div><div class="ttdeci">#define PPSENDF(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00158">ftp.c:158</a></div></div>
<div class="ttc" id="if2ip_8c_html_a5991d11c807cffabec1cd1426ea9cae9"><div class="ttname"><a href="if2ip_8c.html#a5991d11c807cffabec1cd1426ea9cae9">Curl_ipv6_scope</a></div><div class="ttdeci">unsigned int Curl_ipv6_scope(const struct sockaddr *sa)</div><div class="ttdef"><b>Definition:</b> <a href="if2ip_8c_source.html#l00064">if2ip.c:64</a></div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a682b1c9a48ab0eff7ca39e6ee8728bbc"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a682b1c9a48ab0eff7ca39e6ee8728bbc">CURLE_REMOTE_ACCESS_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00468">curl.h:468</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="structftp__conn_html_a8107b427cf1821e350705c896a3961e3"><div class="ttname"><a href="structftp__conn.html#a8107b427cf1821e350705c896a3961e3">ftp_conn::prevmethod</a></div><div class="ttdeci">curl_ftpfile prevmethod</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00140">ftp.h:140</a></div></div>
<div class="ttc" id="structcurl__slist_html_a5fe4d926491a1c9b8b9a73c40505f601"><div class="ttname"><a href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">curl_slist::data</a></div><div class="ttdeci">char * data</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02395">curl.h:2395</a></div></div>
<div class="ttc" id="unit1608_8c_html_afb9ed1b8a27eb20854efe6e23e297683"><div class="ttname"><a href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a></div><div class="ttdeci">CURLcode code</div><div class="ttdef"><b>Definition:</b> <a href="unit1608_8c_source.html#l00047">unit1608.c:47</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="ftp_8c_html_af474756496959c8a45bbbb2d7e199aad"><div class="ttname"><a href="ftp_8c.html#af474756496959c8a45bbbb2d7e199aad">LASTLINE</a></div><div class="ttdeci">#define LASTLINE(line)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00549">ftp.c:549</a></div></div>
<div class="ttc" id="ftp_8h_html_ad68713f9a78b1d9e9eeec5ad478a3955a6797c5e57b04b63f4f8bab20bbac89f3"><div class="ttname"><a href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955a6797c5e57b04b63f4f8bab20bbac89f3">FTPFILE_SINGLECWD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00096">ftp.h:96</a></div></div>
<div class="ttc" id="parsedate_8c_html_a4a84c69a44848f5947487bf91f86b733"><div class="ttname"><a href="parsedate_8c.html#a4a84c69a44848f5947487bf91f86b733">Curl_month</a></div><div class="ttdeci">const char *const Curl_month[]</div><div class="ttdef"><b>Definition:</b> <a href="parsedate_8c_source.html#l00090">parsedate.c:90</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_afe7e4bdcd1d620a7cb309126e2b05265"><div class="ttname"><a href="struct_wildcard_data.html#afe7e4bdcd1d620a7cb309126e2b05265">WildcardData::dtor</a></div><div class="ttdeci">curl_wildcard_dtor dtor</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00052">wildcard.h:52</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="structftp__conn_html_a6e3efa129313fb94346e7ecff8d6ab87"><div class="ttname"><a href="structftp__conn.html#a6e3efa129313fb94346e7ecff8d6ab87">ftp_conn::diralloc</a></div><div class="ttdeci">int diralloc</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00125">ftp.h:125</a></div></div>
<div class="ttc" id="curl_8h_html_aa5618da2459dcb16a18ed3552c17d33fa6b661cf271e2f9d9ff0eb28d926d417b"><div class="ttname"><a href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa6b661cf271e2f9d9ff0eb28d926d417b">CURLUSESSL_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00784">curl.h:784</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65abae6a623835e4269b257ff21bcb79ed0"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65abae6a623835e4269b257ff21bcb79ed0">FTP_WAIT220</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00044">ftp.h:44</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a3630e79d997c97b4eb91c87c67bb477f">FTP_CWD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00060">ftp.h:60</a></div></div>
<div class="ttc" id="structconnectdata_html_ae7924587f916593e1fb682086f298ce8"><div class="ttname"><a href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">connectdata::handler</a></div><div class="ttdeci">const struct Curl_handler * handler</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00905">urldata.h:905</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="structftp__conn_html_a52af6638576b3f069c72a23c3d531793"><div class="ttname"><a href="structftp__conn.html#a52af6638576b3f069c72a23c3d531793">ftp_conn::newport</a></div><div class="ttdeci">unsigned short newport</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00157">ftp.h:157</a></div></div>
<div class="ttc" id="hostip_8h_html_ac32022a9b31aaa164578cb4d487cfc7d"><div class="ttname"><a href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a></div><div class="ttdeci">#define CURLRESOLV_PENDING</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00085">hostip.h:85</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="multiif_8h_html_a4ae1fb64a27264765b6a2fe5aca78830"><div class="ttname"><a href="multiif_8h.html#a4ae1fb64a27264765b6a2fe5aca78830">GETSOCK_READSOCK</a></div><div class="ttdeci">#define GETSOCK_READSOCK(x)</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00051">multiif.h:51</a></div></div>
<div class="ttc" id="vtls_8h_html_a4b8227a2fd2fbf2d20147513033a8ade"><div class="ttname"><a href="vtls_8h.html#a4b8227a2fd2fbf2d20147513033a8ade">Curl_ssl_close</a></div><div class="ttdeci">#define Curl_ssl_close(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00258">vtls.h:258</a></div></div>
<div class="ttc" id="struct_f_t_p_html_ada20af2bff00cbbf74221db56fce01d3"><div class="ttname"><a href="struct_f_t_p.html#ada20af2bff00cbbf74221db56fce01d3">FTP::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00106">ftp.h:106</a></div></div>
<div class="ttc" id="structftp__conn_html_ab0970f16c847f1cbf177ea0f31087612"><div class="ttname"><a href="structftp__conn.html#ab0970f16c847f1cbf177ea0f31087612">ftp_conn::transfertype</a></div><div class="ttdeci">char transfertype</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00141">ftp.h:141</a></div></div>
<div class="ttc" id="ftp_8c_html_a6c80331789cf6af62a7379f76f6202f6"><div class="ttname"><a href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a></div><div class="ttdeci">CURLcode Curl_GetFTPResponse(ssize_t *nreadp, struct connectdata *conn, int *ftpcode)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00628">ftp.c:628</a></div></div>
<div class="ttc" id="sockaddr_8h_html"><div class="ttname"><a href="sockaddr_8h.html">sockaddr.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00467">curl.h:467</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="unit1399_8c_html_acf1e931ffa73126ce876102dc2186895"><div class="ttname"><a href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a></div><div class="ttdeci">struct curltime now</div><div class="ttdef"><b>Definition:</b> <a href="unit1399_8c_source.html#l00083">unit1399.c:83</a></div></div>
<div class="ttc" id="struct_user_defined_html_a0a3e765ba0eae3d45e73a0a0ec4a124b"><div class="ttname"><a href="struct_user_defined.html#a0a3e765ba0eae3d45e73a0a0ec4a124b">UserDefined::ftp_filemethod</a></div><div class="ttdeci">curl_ftpfile ftp_filemethod</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01611">urldata.h:1611</a></div></div>
<div class="ttc" id="ftp_8c_html_aebc53e498b2434654a1d44070d9ccd40"><div class="ttname"><a href="ftp_8c.html#aebc53e498b2434654a1d44070d9ccd40">NI_MAXHOST</a></div><div class="ttdeci">#define NI_MAXHOST</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00087">ftp.c:87</a></div></div>
<div class="ttc" id="connect_8c_html_a084a7d0729207e1c8c5a63f10e7ac815"><div class="ttname"><a href="connect_8c.html#a084a7d0729207e1c8c5a63f10e7ac815">Curl_closesocket</a></div><div class="ttdeci">int Curl_closesocket(struct connectdata *conn, curl_socket_t sock)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l01305">connect.c:1305</a></div></div>
<div class="ttc" id="structftp__conn_html_a17df3aea99fb9a9af5128274354c4321"><div class="ttname"><a href="structftp__conn.html#a17df3aea99fb9a9af5128274354c4321">ftp_conn::dirs</a></div><div class="ttdeci">char ** dirs</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00123">ftp.h:123</a></div></div>
<div class="ttc" id="pingpong_8c_html_a2f6c579918627b1add05e82015bad826"><div class="ttname"><a href="pingpong_8c.html#a2f6c579918627b1add05e82015bad826">Curl_pp_flushsend</a></div><div class="ttdeci">CURLcode Curl_pp_flushsend(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00484">pingpong.c:484</a></div></div>
<div class="ttc" id="structftp__conn_html_a3963dc806ac74b8d6fae8005d06f7283"><div class="ttname"><a href="structftp__conn.html#a3963dc806ac74b8d6fae8005d06f7283">ftp_conn::prevpath</a></div><div class="ttdeci">char * prevpath</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00139">ftp.h:139</a></div></div>
<div class="ttc" id="curl_8h_html_a845d262749bd413d724b58e26f713f25ad13e365aab4f32a0ee193510118f533d"><div class="ttname"><a href="curl_8h.html#a845d262749bd413d724b58e26f713f25ad13e365aab4f32a0ee193510118f533d">CURL_TIMECOND_IFMODSINCE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02017">curl.h:2017</a></div></div>
<div class="ttc" id="struct_url_state_html_af62312f9834129445d1da33ed37d4f2b"><div class="ttname"><a href="struct_url_state.html#af62312f9834129445d1da33ed37d4f2b">UrlState::wildcardmatch</a></div><div class="ttdeci">bool wildcardmatch</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01316">urldata.h:1316</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_a2bf8eb435d74b316148901988744f1e0"><div class="ttname"><a href="struct_wildcard_data.html#a2bf8eb435d74b316148901988744f1e0">WildcardData::customptr</a></div><div class="ttdeci">void * customptr</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00053">wildcard.h:53</a></div></div>
<div class="ttc" id="curl_8h_html_a530ec194255dd00d6ea8968c76a0d03f"><div class="ttname"><a href="curl_8h.html#a530ec194255dd00d6ea8968c76a0d03f">CURLFINFOFLAG_KNOWN_SIZE</a></div><div class="ttdeci">#define CURLFINFOFLAG_KNOWN_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00273">curl.h:273</a></div></div>
<div class="ttc" id="multi_8c_html_af60eeb6175f9a25baeee40253c56330e"><div class="ttname"><a href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a></div><div class="ttdeci">void Curl_set_in_callback(struct Curl_easy *data, bool value)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l03174">multi.c:3174</a></div></div>
<div class="ttc" id="structconnectdata_html_a2e6cc8a072c4712d1a113c56ef37dd13"><div class="ttname"><a href="structconnectdata.html#a2e6cc8a072c4712d1a113c56ef37dd13">connectdata::tempsock</a></div><div class="ttdeci">curl_socket_t tempsock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00876">urldata.h:876</a></div></div>
<div class="ttc" id="curl_8h_html_afa63f4f6ec2b2589a3cb5e5ee4ac7f8da578e0d340b5e495763b25fa1e8da3c3f"><div class="ttname"><a href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8da578e0d340b5e495763b25fa1e8da3c3f">CURLFTPAUTH_SSL</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00835">curl.h:835</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00461">curl.h:461</a></div></div>
<div class="ttc" id="parsedate_8h_html"><div class="ttname"><a href="parsedate_8h.html">parsedate.h</a></div></div>
<div class="ttc" id="urldata_8h_html_ac1138557ffc9ee3a520805205b76daee"><div class="ttname"><a href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a></div><div class="ttdeci">#define SECONDARYSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00481">urldata.h:481</a></div></div>
<div class="ttc" id="connect_8c_html_a35b7c261ff856c8778571709f440b837"><div class="ttname"><a href="connect_8c.html#a35b7c261ff856c8778571709f440b837">Curl_socket</a></div><div class="ttdeci">CURLcode Curl_socket(struct connectdata *conn, const Curl_addrinfo *ai, struct Curl_sockaddr_ex *addr, curl_socket_t *sockfd)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l01343">connect.c:1343</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a424cb619b42ed94ebefe203d045abc99"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a424cb619b42ed94ebefe203d045abc99">FTP_NAMEFMT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00055">ftp.h:55</a></div></div>
<div class="ttc" id="structftp__conn_html_a537292f9d1482a4a1dd44d3203e37fac"><div class="ttname"><a href="structftp__conn.html#a537292f9d1482a4a1dd44d3203e37fac">ftp_conn::wait_data_conn</a></div><div class="ttdeci">bool wait_data_conn</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00138">ftp.h:138</a></div></div>
<div class="ttc" id="structconnectdata_html_a91d94af5dfef86510940d658476b61cf"><div class="ttname"><a href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">connectdata::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00830">urldata.h:830</a></div></div>
<div class="ttc" id="curl_8h_html"><div class="ttname"><a href="curl_8h.html">curl.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65aca379f22e83e32b84e6ae13c8e2ec021"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca379f22e83e32b84e6ae13c8e2ec021">FTP_PWD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00053">ftp.h:53</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa568500a9ca507b5a53de5372c81f26a"><div class="ttname"><a href="curl__memory_8h.html#aa568500a9ca507b5a53de5372c81f26a">realloc</a></div><div class="ttdeci">#define realloc(ptr, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00128">curl_memory.h:128</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a436e55df5f5834180e78cefa2e95bc29">FTP_RETR_PREQUOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00057">ftp.h:57</a></div></div>
<div class="ttc" id="cert-status_8d_html_a28915fffd5a7223c5a7effeaeecc785f"><div class="ttname"><a href="cert-status_8d.html#a28915fffd5a7223c5a7effeaeecc785f">received</a></div><div class="ttdeci">Long if the response suggests that the server certificate has been or no response at all is received</div><div class="ttdef"><b>Definition:</b> <a href="cert-status_8d_source.html#l00010">cert-status.d:10</a></div></div>
<div class="ttc" id="vtls_8h_html_aab12c9ee7a4c9d065f76d3ab539bdb62"><div class="ttname"><a href="vtls_8h.html#aab12c9ee7a4c9d065f76d3ab539bdb62">Curl_ssl_connect</a></div><div class="ttdeci">#define Curl_ssl_connect(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00256">vtls.h:256</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a2bd11bd4d07b54cfbeb51199eaf998d9"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2bd11bd4d07b54cfbeb51199eaf998d9">FTP_AUTH</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00046">ftp.h:46</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aa265c50a923f1ba7979a1f4f64adf71e9"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa265c50a923f1ba7979a1f4f64adf71e9">CURLWC_DOWNLOADING</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00035">wildcard.h:35</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ac15dd7cd691c70046eb44ed87668587b"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac15dd7cd691c70046eb44ed87668587b">FTP_POSTQUOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00059">ftp.h:59</a></div></div>
<div class="ttc" id="strcase_8h_html_a4b6a8324b9a93ddfa5413308a22bfa44"><div class="ttname"><a href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a></div><div class="ttdeci">#define strcasecompare(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00035">strcase.h:35</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65aca6266a872be15f938cdbbfb3848fc83"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aca6266a872be15f938cdbbfb3848fc83">FTP_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00048">ftp.h:48</a></div></div>
<div class="ttc" id="curl_8h_html_a9780ca29d2faed151148e197d1d1e94fa5f08730cf69dcbc51c08420fb9f4c03d"><div class="ttname"><a href="curl_8h.html#a9780ca29d2faed151148e197d1d1e94fa5f08730cf69dcbc51c08420fb9f4c03d">CURLFILETYPE_FILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00255">curl.h:255</a></div></div>
<div class="ttc" id="structftp__conn_html_ae2660b015c55aec7c79f619b00ed8098"><div class="ttname"><a href="structftp__conn.html#ae2660b015c55aec7c79f619b00ed8098">ftp_conn::server_os</a></div><div class="ttdeci">char * server_os</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00150">ftp.h:150</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="urldata_8h_html_ab7f1c24cdfca62f45ba0dc7618c0f568"><div class="ttname"><a href="urldata_8h.html#ab7f1c24cdfca62f45ba0dc7618c0f568">PORT_FTPS</a></div><div class="ttdeci">#define PORT_FTPS</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00030">urldata.h:30</a></div></div>
<div class="ttc" id="struct_user_defined_html_a5e855dcf947888f8f1730b0e9fc03c32"><div class="ttname"><a href="struct_user_defined.html#a5e855dcf947888f8f1730b0e9fc03c32">UserDefined::opt_no_body</a></div><div class="ttdeci">bool opt_no_body</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01639">urldata.h:1639</a></div></div>
<div class="ttc" id="structftp__conn_html_a80b9c9f3256802c0b61ac1f533c8411b"><div class="ttname"><a href="structftp__conn.html#a80b9c9f3256802c0b61ac1f533c8411b">ftp_conn::newhost</a></div><div class="ttdeci">char * newhost</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00156">ftp.h:156</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a3dca40ce1e998420175eabe37246e05b"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="ttdeci">#define CURL_FORMAT_CURL_OFF_T</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00395">system.h:395</a></div></div>
<div class="ttc" id="structftp__wc_html_afa8c2347dd6df60f3ad90709190500fe"><div class="ttname"><a href="structftp__wc.html#afa8c2347dd6df60f3ad90709190500fe">ftp_wc::backup</a></div><div class="ttdeci">struct ftp_wc::@21 backup</div></div>
<div class="ttc" id="structhostname_html_a9c9ce90bfcab1734f9376c6539d92cdd"><div class="ttname"><a href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">hostname::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00449">urldata.h:449</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="curl_8h_html_a9ba581e59a874626d594c0f7c241d6d2"><div class="ttname"><a href="curl_8h.html#a9ba581e59a874626d594c0f7c241d6d2">CURLPROTO_FTP</a></div><div class="ttdeci">#define CURLPROTO_FTP</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00867">curl.h:867</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a40c9341dbcd23241fd1b75054cf050a2"><div class="ttname"><a href="struct_connect_bits.html#a40c9341dbcd23241fd1b75054cf050a2">ConnectBits::reuse</a></div><div class="ttdeci">bool reuse</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00382">urldata.h:382</a></div></div>
<div class="ttc" id="speedcheck_8h_html"><div class="ttname"><a href="speedcheck_8h.html">speedcheck.h</a></div></div>
<div class="ttc" id="structftp__conn_html_a2cf7ba1957a627d4c956c11df54a1602"><div class="ttname"><a href="structftp__conn.html#a2cf7ba1957a627d4c956c11df54a1602">ftp_conn::retr_size_saved</a></div><div class="ttdeci">curl_off_t retr_size_saved</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00149">ftp.h:149</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="structftp__conn_html_aa54a94f33093241f936fc99510d2631a"><div class="ttname"><a href="structftp__conn.html#aa54a94f33093241f936fc99510d2631a">ftp_conn::known_filesize</a></div><div class="ttdeci">curl_off_t known_filesize</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00151">ftp.h:151</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a9dfb8cf86d141a0b4dd611d19069d127"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a9dfb8cf86d141a0b4dd611d19069d127">FTP_REST</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00070">ftp.h:70</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a494e2b4279dc064f7ed1d0abd602b28d"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_OFF_T curl_off_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00442">system.h:442</a></div></div>
<div class="ttc" id="structconnectdata_html_a9dc784dcbf29ca027c3aa6eda1cc8755"><div class="ttname"><a href="structconnectdata.html#a9dc784dcbf29ca027c3aa6eda1cc8755">connectdata::ip_addr_str</a></div><div class="ttdeci">char ip_addr_str[MAX_IPADR_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00824">urldata.h:824</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="struct_user_defined_html_aba5a454bc6c3ad60937bc8cdf93cc2de"><div class="ttname"><a href="struct_user_defined.html#aba5a454bc6c3ad60937bc8cdf93cc2de">UserDefined::out</a></div><div class="ttdeci">void * out</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01499">urldata.h:1499</a></div></div>
<div class="ttc" id="connect_8c_html_a1b49073aa2d83991c63d3903e3a3d275"><div class="ttname"><a href="connect_8c.html#a1b49073aa2d83991c63d3903e3a3d275">Curl_connecthost</a></div><div class="ttdeci">CURLcode Curl_connecthost(struct connectdata *conn, const struct Curl_dns_entry *remotehost)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l01170">connect.c:1170</a></div></div>
<div class="ttc" id="struct_url_state_html_a826153c9d8591bb303e3edccf169520b"><div class="ttname"><a href="struct_url_state.html#a826153c9d8591bb303e3edccf169520b">UrlState::errorbuf</a></div><div class="ttdeci">bool errorbuf</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01276">urldata.h:1276</a></div></div>
<div class="ttc" id="curl_8h_html_aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986"><div class="ttname"><a href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986">CURLUSESSL_TRY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00783">curl.h:783</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aaf7b19e6541139da47849ca1761694d28"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf7b19e6541139da47849ca1761694d28">CURLWC_DONE</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00039">wildcard.h:39</a></div></div>
<div class="ttc" id="inet__ntop_8c_html_a0c8c29e80617bf572b009e3f8eddfdf3"><div class="ttname"><a href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a></div><div class="ttdeci">char * Curl_inet_ntop(int af, const void *src, char *buf, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="inet__ntop_8c_source.html#l00183">inet_ntop.c:183</a></div></div>
<div class="ttc" id="nonblock_8c_html_a0b0747a29eed9acae52471c25a66e042"><div class="ttname"><a href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a></div><div class="ttdeci">int curlx_nonblock(curl_socket_t sockfd, int nonblock)</div><div class="ttdef"><b>Definition:</b> <a href="nonblock_8c_source.html#l00047">nonblock.c:47</a></div></div>
<div class="ttc" id="form_8d_html_a2ff994e16bf9521154de4cf659a3b689"><div class="ttname"><a href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a></div><div class="ttdeci">filename</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00057">form.d:57</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a404154a216fca019f85509759015820c"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a404154a216fca019f85509759015820c">CURLE_FTP_COULDNT_USE_REST</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00501">curl.h:501</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_af4c42325827bfe7ed453ecb2c791815b"><div class="ttname"><a href="struct_wildcard_data.html#af4c42325827bfe7ed453ecb2c791815b">WildcardData::filelist</a></div><div class="ttdeci">struct curl_llist filelist</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00050">wildcard.h:50</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="structconnectdata_html_a4df63a4042ad767671bb3bfd74aa68fc"><div class="ttname"><a href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">connectdata::http_proxy</a></div><div class="ttdeci">struct proxy_info http_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00837">urldata.h:837</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd">CURLE_COULDNT_RESOLVE_PROXY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00464">curl.h:464</a></div></div>
<div class="ttc" id="http_8h_html"><div class="ttname"><a href="http_8h.html">http.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a01e38af502b3798152533aa52884b423"><div class="ttname"><a href="structconnectdata.html#a01e38af502b3798152533aa52884b423">connectdata::seek_func</a></div><div class="ttdeci">curl_seek_callback seek_func</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00973">urldata.h:973</a></div></div>
<div class="ttc" id="timeval_8c_html_ae736e803680e1b7fa2b2868317b4b91f"><div class="ttname"><a href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a></div><div class="ttdeci">struct curltime Curl_now(void)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00154">timeval.c:154</a></div></div>
<div class="ttc" id="struct_connect_bits_html_af764c68e6af921d2073c498f80741ea4"><div class="ttname"><a href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">ConnectBits::tunnel_proxy</a></div><div class="ttdeci">bool tunnel_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00405">urldata.h:405</a></div></div>
<div class="ttc" id="structconnectdata_html_a4bb3a85b09c8a63a0b526a24f9b1897a"><div class="ttname"><a href="structconnectdata.html#a4bb3a85b09c8a63a0b526a24f9b1897a">connectdata::passwd</a></div><div class="ttdeci">char * passwd</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00864">urldata.h:864</a></div></div>
<div class="ttc" id="urldata_8h_html_ad851f566879d5b859ec9181a21318b64"><div class="ttname"><a href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a></div><div class="ttdeci">#define PROTOPT_SSL</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00706">urldata.h:706</a></div></div>
<div class="ttc" id="ftp_8c_html_ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7"><div class="ttname"><a href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5ad11a5684a2d8dd93df27782a4462f6e7">EPRT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00923">ftp.c:923</a></div></div>
<div class="ttc" id="warnless_8c_html_a5cda9889c201b12398833787bff13e6e"><div class="ttname"><a href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a></div><div class="ttdeci">unsigned short curlx_ultous(unsigned long ulnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00124">warnless.c:124</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab73fcc31ca43404e66b393f314ed3c15">FTP_STOR_PREQUOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00058">ftp.h:58</a></div></div>
<div class="ttc" id="structpingpong_html_a124ea1f6b5aa08b8938cdd3d8a5c4b9f"><div class="ttname"><a href="structpingpong.html#a124ea1f6b5aa08b8938cdd3d8a5c4b9f">pingpong::statemach_act</a></div><div class="ttdeci">CURLcode(* statemach_act)(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00072">pingpong.h:72</a></div></div>
<div class="ttc" id="progress_8c_html_a40686d443707afea0c0e47cee805df01"><div class="ttname"><a href="progress_8c.html#a40686d443707afea0c0e47cee805df01">Curl_pgrsUpdate</a></div><div class="ttdeci">int Curl_pgrsUpdate(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00369">progress.c:369</a></div></div>
<div class="ttc" id="inet__pton_8h_html"><div class="ttname"><a href="inet__pton_8h.html">inet_pton.h</a></div></div>
<div class="ttc" id="vtls_8h_html"><div class="ttname"><a href="vtls_8h.html">vtls.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00540">curl.h:540</a></div></div>
<div class="ttc" id="ftp_8h_html_ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8"><div class="ttname"><a href="ftp_8h.html#ad68713f9a78b1d9e9eeec5ad478a3955af40087a98668a23d7e6167d675c37ce8">FTPFILE_NOCWD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00095">ftp.h:95</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a575639ff443233dd9af2c1835192ad3a"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a575639ff443233dd9af2c1835192ad3a">CURLE_FILESIZE_EXCEEDED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00535">curl.h:535</a></div></div>
<div class="ttc" id="structftp__conn_html_a831bd86495d87bc074d9b94cdd5c3efc"><div class="ttname"><a href="structftp__conn.html#a831bd86495d87bc074d9b94cdd5c3efc">ftp_conn::count3</a></div><div class="ttdeci">int count3</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00145">ftp.h:145</a></div></div>
<div class="ttc" id="structconnectdata_html_ac3d5c58d5ebf77ad3eccd2332c424800"><div class="ttname"><a href="structconnectdata.html#ac3d5c58d5ebf77ad3eccd2332c424800">connectdata::ip_addr</a></div><div class="ttdeci">Curl_addrinfo * ip_addr</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00818">urldata.h:818</a></div></div>
<div class="ttc" id="form_8d_html_a7aead736a07eaf25623ad7bfa1f0ee2d"><div class="ttname"><a href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00048">form.d:48</a></div></div>
<div class="ttc" id="vtls_8h_html_a17b59e5f0576d37fa4b20ac37a6848e9"><div class="ttname"><a href="vtls_8h.html#a17b59e5f0576d37fa4b20ac37a6848e9">Curl_ssl_shutdown</a></div><div class="ttdeci">#define Curl_ssl_shutdown(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00259">vtls.h:259</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curlx_8c_html_af6458f5d187f1d7c82fb9ea7ef634b44"><div class="ttname"><a href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a></div><div class="ttdeci">#define ZERO_NULL</div><div class="ttdef"><b>Definition:</b> <a href="curlx_8c_source.html#l00131">curlx.c:131</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html_a606b5303ecd260663dbf9b1f9f7f98dd"><div class="ttname"><a href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">Curl_dns_entry::addr</a></div><div class="ttdeci">Curl_addrinfo * addr</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00067">hostip.h:67</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a114cd0e74c19b6463a13df837b6931d9">CURLE_FTP_ACCEPT_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00471">curl.h:471</a></div></div>
<div class="ttc" id="structftp__conn_html_ae6de82dcc76af4ea97e828e326606561"><div class="ttname"><a href="structftp__conn.html#ae6de82dcc76af4ea97e828e326606561">ftp_conn::cwddone</a></div><div class="ttdeci">bool cwddone</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00133">ftp.h:133</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00491">curl.h:491</a></div></div>
<div class="ttc" id="quote_8d_html_ae7102b102f9ed4847a2862ff6984ca3f"><div class="ttname"><a href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a></div><div class="ttdeci">Long to be exact.To make commands take place after a successful prefix them with a dash.To make commands be sent after curl has changed the working just before the transfer command(s)</div></div>
<div class="ttc" id="struct_curl__easy_html_a8a13221afd448ab0b91f021b4f5ec7c7"><div class="ttname"><a href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">Curl_easy::req</a></div><div class="ttdeci">struct SingleRequest req</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01787">urldata.h:1787</a></div></div>
<div class="ttc" id="ftp_8h_html"><div class="ttname"><a href="ftp_8h.html">ftp.h</a></div></div>
<div class="ttc" id="curl__range_8c_html_a82ce81e65f559e7316b160291d1a22b6"><div class="ttname"><a href="curl__range_8c.html#a82ce81e65f559e7316b160291d1a22b6">Curl_range</a></div><div class="ttdeci">CURLcode Curl_range(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="curl__range_8c_source.html#l00036">curl_range.c:36</a></div></div>
<div class="ttc" id="progress_8h_html"><div class="ttname"><a href="progress_8h.html">progress.h</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aa883c5854c27480107ee93c9dbf1f9e81"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa883c5854c27480107ee93c9dbf1f9e81">CURLWC_CLEAR</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00031">wildcard.h:31</a></div></div>
<div class="ttc" id="structssl__connect__data_html_ad63d8e461921062845bbf07dfc0007c5"><div class="ttname"><a href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">ssl_connect_data::use</a></div><div class="ttdeci">bool use</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00201">urldata.h:201</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a1d39a52adb8e2162b2c56dcaf0943c80"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1d39a52adb8e2162b2c56dcaf0943c80">FTP_RETR_TYPE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00065">ftp.h:65</a></div></div>
<div class="ttc" id="output_8d_html_a7bcb6a773be04cbd4890bfe10fa42696"><div class="ttname"><a href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a></div><div class="ttdeci">Long you can use specifier.That variable will be replaced with the current string for the URL being fetched.Like if you specify two URLs on the same command line</div><div class="ttdef"><b>Definition:</b> <a href="output_8d_source.html#l00008">output.d:8</a></div></div>
<div class="ttc" id="transfer_8c_html_a8ccd1948f2a90c90b6fd1ac993e44a32"><div class="ttname"><a href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a></div><div class="ttdeci">void Curl_setup_transfer(struct connectdata *conn, int sockindex, curl_off_t size, bool getheader, curl_off_t *bytecountp, int writesockindex, curl_off_t *writecountp)</div><div class="ttdef"><b>Definition:</b> <a href="transfer_8c_source.html#l01743">transfer.c:1743</a></div></div>
<div class="ttc" id="unit1398_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00033">unit1398.c:33</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a0091f833e532479d6510f72639f726ef"><div class="ttname"><a href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">ConnectBits::tcpconnect</a></div><div class="ttdeci">bool tcpconnect[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00398">urldata.h:398</a></div></div>
<div class="ttc" id="structcurl__llist_html_abca9151666b85a2a95d44bbbe1dcf8b2"><div class="ttname"><a href="structcurl__llist.html#abca9151666b85a2a95d44bbbe1dcf8b2">curl_llist::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="llist_8h_source.html#l00040">llist.h:40</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aaf53e9618bd2fcb940dfa77b2707950bd"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aaf53e9618bd2fcb940dfa77b2707950bd">CURLWC_MATCHING</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00033">wildcard.h:33</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9c679a0c848f49bf6a02e97c7784d20c"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9c679a0c848f49bf6a02e97c7784d20c">CURLE_FTP_WEIRD_PASS_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00473">curl.h:473</a></div></div>
<div class="ttc" id="multi_8h_html_ac9841bc853b2a1874c9b5528b2ad3e5b"><div class="ttname"><a href="multi_8h.html#ac9841bc853b2a1874c9b5528b2ad3e5b">CURL_CSELECT_IN</a></div><div class="ttdeci">#define CURL_CSELECT_IN</div><div class="ttdef"><b>Definition:</b> <a href="multi_8h_source.html#l00266">multi.h:266</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_ab72a36e22c2c7cb539df0351f59359ca"><div class="ttname"><a href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">Curl_addrinfo::ai_addr</a></div><div class="ttdeci">struct sockaddr * ai_addr</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00058">curl_addrinfo.h:58</a></div></div>
<div class="ttc" id="structpingpong_html_ad13b684e9f73f8d93d077003c97f5b43"><div class="ttname"><a href="structpingpong.html#ad13b684e9f73f8d93d077003c97f5b43">pingpong::endofresp</a></div><div class="ttdeci">bool(* endofresp)(struct connectdata *conn, char *ptr, size_t len, int *code)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00074">pingpong.h:74</a></div></div>
<div class="ttc" id="structftp__conn_html_a65a81fe9976947ff339081c5f83077c0"><div class="ttname"><a href="structftp__conn.html#a65a81fe9976947ff339081c5f83077c0">ftp_conn::ctl_valid</a></div><div class="ttdeci">bool ctl_valid</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00130">ftp.h:130</a></div></div>
<div class="ttc" id="pingpong_8c_html_ac23a9a0836693c1ec2eb24ac53123391"><div class="ttname"><a href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a></div><div class="ttdeci">CURLcode Curl_pp_statemach(struct pingpong *pp, bool block)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00080">pingpong.c:80</a></div></div>
<div class="ttc" id="struct_f_t_p_html_ad671531094afd7ef812491f2f2e481ea"><div class="ttname"><a href="struct_f_t_p.html#ad671531094afd7ef812491f2f2e481ea">FTP::transfer</a></div><div class="ttdeci">curl_pp_transfer transfer</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00113">ftp.h:113</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html"><div class="ttname"><a href="struct_curl__dns__entry.html">Curl_dns_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00066">hostip.h:66</a></div></div>
<div class="ttc" id="strerror_8c_html_a7176009c0b1b8f7d59097fdd1e1c77f8"><div class="ttname"><a href="strerror_8c.html#a7176009c0b1b8f7d59097fdd1e1c77f8">Curl_strerror</a></div><div class="ttdeci">const char * Curl_strerror(struct connectdata *conn, int err)</div><div class="ttdef"><b>Definition:</b> <a href="strerror_8c_source.html#l00649">strerror.c:649</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aa1f636ad685a1ab9e362ebb4fe068063"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aa1f636ad685a1ab9e362ebb4fe068063">CURLE_FTP_COULDNT_SET_TYPE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00483">curl.h:483</a></div></div>
<div class="ttc" id="struct_wildcard_data_html"><div class="ttname"><a href="struct_wildcard_data.html">WildcardData</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00046">wildcard.h:46</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="if2ip_8h_html_a5b6d01fb9da7688daa9437b3628d83eeafa243304b615badc01baed1ef9ecf04d"><div class="ttname"><a href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eeafa243304b615badc01baed1ef9ecf04d">IF2IP_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="if2ip_8h_source.html#l00040">if2ip.h:40</a></div></div>
<div class="ttc" id="connect_8c_html_aed32c0fb99c80a40c097c98a3eb03c74"><div class="ttname"><a href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a></div><div class="ttdeci">timediff_t Curl_timeleft(struct Curl_easy *data, struct curltime *nowp, bool duringconnect)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l00184">connect.c:184</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ad8fbe74a695b640f4c917d49696c1b90"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ad8fbe74a695b640f4c917d49696c1b90">FTP_PORT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00072">ftp.h:72</a></div></div>
<div class="ttc" id="structcurl__slist_html_a56fcfc41d89a47865933c310d316a108"><div class="ttname"><a href="structcurl__slist.html#a56fcfc41d89a47865933c310d316a108">curl_slist::next</a></div><div class="ttdeci">struct curl_slist * next</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02396">curl.h:2396</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_ad393bb8e082a9ff4a4d5a30ef1812c82"><div class="ttname"><a href="struct_wildcard_data.html#ad393bb8e082a9ff4a4d5a30ef1812c82">WildcardData::protdata</a></div><div class="ttdeci">void * protdata</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00051">wildcard.h:51</a></div></div>
<div class="ttc" id="structcurl__llist__element_html_aa3c3cb90fae86e24d88eea4437bc61ab"><div class="ttname"><a href="structcurl__llist__element.html#aa3c3cb90fae86e24d88eea4437bc61ab">curl_llist_element::ptr</a></div><div class="ttdeci">void * ptr</div><div class="ttdef"><b>Definition:</b> <a href="llist_8h_source.html#l00031">llist.h:31</a></div></div>
<div class="ttc" id="select_8h_html_a7e89e8a851eb27402914a0d5beb58d99"><div class="ttname"><a href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a></div><div class="ttdeci">#define SOCKET_READABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00079">select.h:79</a></div></div>
<div class="ttc" id="structcurl__fileinfo_html_a23e38e1ca497cb7a140d9aff92f33fc0"><div class="ttname"><a href="structcurl__fileinfo.html#a23e38e1ca497cb7a140d9aff92f33fc0">curl_fileinfo::size</a></div><div class="ttdeci">curl_off_t size</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00287">curl.h:287</a></div></div>
<div class="ttc" id="structftp__wc_html_ae73ce67e5c2a18aaff021770934adee6"><div class="ttname"><a href="structftp__wc.html#ae73ce67e5c2a18aaff021770934adee6">ftp_wc::write_function</a></div><div class="ttdeci">curl_write_callback write_function</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00088">ftp.h:88</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a2706bd50f04c829f62a30ee886e67ed0"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2706bd50f04c829f62a30ee886e67ed0">FTP_TYPE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00063">ftp.h:63</a></div></div>
<div class="ttc" id="strtoofft_8c_html_a3c9f5c063165fc15454feac4def889d7"><div class="ttname"><a href="strtoofft_8c.html#a3c9f5c063165fc15454feac4def889d7">curlx_strtoofft</a></div><div class="ttdeci">CURLofft curlx_strtoofft(const char *str, char **endp, int base, curl_off_t *num)</div><div class="ttdef"><b>Definition:</b> <a href="strtoofft_8c_source.html#l00215">strtoofft.c:215</a></div></div>
<div class="ttc" id="hostip_8c_html_a9682d744b66312d5f6ceaa8a6a02aff7"><div class="ttname"><a href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a></div><div class="ttdeci">const char * Curl_printable_address(const Curl_addrinfo *ai, char *buf, size_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00172">hostip.c:172</a></div></div>
<div class="ttc" id="ftp_8c_html_a93b37007689284fd9c4bde1a8f4b9199"><div class="ttname"><a href="ftp_8c.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a></div><div class="ttdeci">#define INET_ADDRSTRLEN</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00090">ftp.c:90</a></div></div>
<div class="ttc" id="structftp__conn_html_a008ec248827badcb60d8243e0b717120"><div class="ttname"><a href="structftp__conn.html#a008ec248827badcb60d8243e0b717120">ftp_conn::dirdepth</a></div><div class="ttdeci">int dirdepth</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00124">ftp.h:124</a></div></div>
<div class="ttc" id="if2ip_8h_html"><div class="ttname"><a href="if2ip_8h.html">if2ip.h</a></div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="connect_8c_html_a347cba516188d3bc3c6efc14dc3780d7"><div class="ttname"><a href="connect_8c.html#a347cba516188d3bc3c6efc14dc3780d7">Curl_is_connected</a></div><div class="ttdeci">CURLcode Curl_is_connected(struct connectdata *conn, int sockindex, bool *connected)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l00728">connect.c:728</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_abadfae881af6425a56ff823ef0bb1a70"><div class="ttname"><a href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">Curl_addrinfo::ai_family</a></div><div class="ttdeci">int ai_family</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00053">curl_addrinfo.h:53</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a309ade641c94c3e710ae887405dba78b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a309ade641c94c3e710ae887405dba78b">CURLE_ABORTED_BY_CALLBACK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00512">curl.h:512</a></div></div>
<div class="ttc" id="structftp__conn_html_a66569c61f61185dfcc2220f731eba91b"><div class="ttname"><a href="structftp__conn.html#a66569c61f61185dfcc2220f731eba91b">ftp_conn::count1</a></div><div class="ttdeci">int count1</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00143">ftp.h:143</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb">CURLE_QUOTE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00487">curl.h:487</a></div></div>
<div class="ttc" id="struct_user_defined_html_a55d6133449a8920a98a66cb9c7d1ae61"><div class="ttname"><a href="struct_user_defined.html#a55d6133449a8920a98a66cb9c7d1ae61">UserDefined::ftp_create_missing_dirs</a></div><div class="ttdeci">int ftp_create_missing_dirs</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01613">urldata.h:1613</a></div></div>
<div class="ttc" id="strerror_8h_html"><div class="ttname"><a href="strerror_8h.html">strerror.h</a></div></div>
<div class="ttc" id="progress_8c_html_a82906bd19baedaf94d95274dd2371b22"><div class="ttname"><a href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a></div><div class="ttdeci">void Curl_pgrsSetUploadSize(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00353">progress.c:353</a></div></div>
<div class="ttc" id="if2ip_8c_html_a2ab76018a23e5e70cf88972417e60310"><div class="ttname"><a href="if2ip_8c.html#a2ab76018a23e5e70cf88972417e60310">Curl_if2ip</a></div><div class="ttdeci">if2ip_result_t Curl_if2ip(int af, unsigned int remote_scope, unsigned int remote_scope_id, const char *interf, char *buf, int buf_size)</div><div class="ttdef"><b>Definition:</b> <a href="if2ip_8c_source.html#l00261">if2ip.c:261</a></div></div>
<div class="ttc" id="hostip_8c_html_ad81776a26da21671062cbf5ccd11be23"><div class="ttname"><a href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a></div><div class="ttdeci">int Curl_resolv(struct connectdata *conn, const char *hostname, int port, struct Curl_dns_entry **entry)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00521">hostip.c:521</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00557">curl.h:557</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a65afd49b1baa6e1a4915c85f372a64eb"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a65afd49b1baa6e1a4915c85f372a64eb">FTP_LIST_TYPE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00064">ftp.h:64</a></div></div>
<div class="ttc" id="struct_f_t_p_html"><div class="ttname"><a href="struct_f_t_p.html">FTP</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00104">ftp.h:104</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aa798d744ee845440856a8fdfcaf46b06"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aa798d744ee845440856a8fdfcaf46b06">CURLE_FTP_WEIRD_227_FORMAT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00478">curl.h:478</a></div></div>
<div class="ttc" id="progress_8c_html_a00f01952b08507f31def8af5b088e53f"><div class="ttname"><a href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a></div><div class="ttdeci">void Curl_pgrsSetDownloadSize(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00341">progress.c:341</a></div></div>
<div class="ttc" id="non-ascii_8h_html_ab7de472e1367a01da556c8f5acad93bb"><div class="ttname"><a href="non-ascii_8h.html#ab7de472e1367a01da556c8f5acad93bb">Curl_convert_to_network</a></div><div class="ttdeci">#define Curl_convert_to_network(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="non-ascii_8h_source.html#l00056">non-ascii.h:56</a></div></div>
<div class="ttc" id="urldata_8h_html_a033a9d4c349c6179bbf570bab3c10444"><div class="ttname"><a href="urldata_8h.html#a033a9d4c349c6179bbf570bab3c10444">PROTOPT_PROXY_AS_HTTP</a></div><div class="ttdeci">#define PROTOPT_PROXY_AS_HTTP</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00725">urldata.h:725</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a27602c6b9eaa7f0ce5fbb45493180e49"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a27602c6b9eaa7f0ce5fbb45493180e49">FTP_MDTM</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00062">ftp.h:62</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aa35bfdab90de5c981dc4e10e5e352a5e"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aa35bfdab90de5c981dc4e10e5e352a5e">CURLE_BAD_DOWNLOAD_RESUME</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00506">curl.h:506</a></div></div>
<div class="ttc" id="multiif_8h_html_ad755633cd6d4e90c3df49fefd1052bad"><div class="ttname"><a href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a></div><div class="ttdeci">#define GETSOCK_BLANK</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00045">multiif.h:45</a></div></div>
<div class="ttc" id="strtoofft_8h_html"><div class="ttname"><a href="strtoofft_8h.html">strtoofft.h</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa8dbe5b1757d1ef779fe0345422ee1dcc"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa8dbe5b1757d1ef779fe0345422ee1dcc">STRING_FTP_ALTERNATIVE_TO_USER</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01409">urldata.h:1409</a></div></div>
<div class="ttc" id="sendf_8c_html_a8b0f0a06869b888abb80a069182d0d5a"><div class="ttname"><a href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a></div><div class="ttdeci">int Curl_debug(struct Curl_easy *data, curl_infotype type, char *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00776">sendf.c:776</a></div></div>
<div class="ttc" id="hostip_8c_html_a47fa53659ab4a0c796ea2fd58629674c"><div class="ttname"><a href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a></div><div class="ttdeci">void Curl_resolv_unlock(struct Curl_easy *data, struct Curl_dns_entry *dns)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00814">hostip.c:814</a></div></div>
<div class="ttc" id="inet__ntop_8h_html"><div class="ttname"><a href="inet__ntop_8h.html">inet_ntop.h</a></div></div>
<div class="ttc" id="ftplistparser_8c_html_ad72b3b4dd2ac9ddc6089b0638c2af67a"><div class="ttname"><a href="ftplistparser_8c.html#ad72b3b4dd2ac9ddc6089b0638c2af67a">Curl_ftp_parselist</a></div><div class="ttdeci">size_t Curl_ftp_parselist(char *buffer, size_t size, size_t nmemb, void *connptr)</div><div class="ttdef"><b>Definition:</b> <a href="ftplistparser_8c_source.html#l00326">ftplistparser.c:326</a></div></div>
<div class="ttc" id="ftp_8c_html_ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749"><div class="ttname"><a href="ftp_8c.html#ae19150e23e50c1c93bff64146ea0e5c5a9c954bcf443428c80b0f107b3bc48749">DONE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00925">ftp.c:925</a></div></div>
<div class="ttc" id="curl__range_8h_html"><div class="ttname"><a href="curl__range_8h.html">curl_range.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65">ftpstate</a></div><div class="ttdeci">ftpstate</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00042">ftp.h:42</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a93a65808449e2f199c573d6c71aaca8b"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a93a65808449e2f199c573d6c71aaca8b">FTP_ACCT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00049">ftp.h:49</a></div></div>
<div class="ttc" id="sendf_8c_html_a6d7b9f1e0b64c65b824a115d0b00b5a2"><div class="ttname"><a href="sendf_8c.html#a6d7b9f1e0b64c65b824a115d0b00b5a2">Curl_write</a></div><div class="ttdeci">CURLcode Curl_write(struct connectdata *conn, curl_socket_t sockfd, const void *mem, size_t len, ssize_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00338">sendf.c:338</a></div></div>
<div class="ttc" id="multiif_8h_html_a9aabda59f0ff87c1db3a2d306a410713"><div class="ttname"><a href="multiif_8h.html#a9aabda59f0ff87c1db3a2d306a410713">GETSOCK_WRITESOCK</a></div><div class="ttdeci">#define GETSOCK_WRITESOCK(x)</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00048">multiif.h:48</a></div></div>
<div class="ttc" id="curl_8h_html_a9704d2633927f77efaa3e3c6f1c23a14a39c388deb977296403ec7a28b6c5acbe"><div class="ttname"><a href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a39c388deb977296403ec7a28b6c5acbe">CURLINFO_HEADER_OUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00435">curl.h:435</a></div></div>
<div class="ttc" id="fail-early_8d_html_a2b978ebca1e6cb7fcbcb9a6b51701ce3"><div class="ttname"><a href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply fail</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="structcurltime_html"><div class="ttname"><a href="structcurltime.html">curltime</a></div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00033">timeval.h:33</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="structconnectdata_html_a44ea1ec223e43a877daac8a34167096a"><div class="ttname"><a href="structconnectdata.html#a44ea1ec223e43a877daac8a34167096a">connectdata::socks_proxy</a></div><div class="ttdeci">struct proxy_info socks_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00836">urldata.h:836</a></div></div>
<div class="ttc" id="structcurl__fileinfo_html_a69b09df292a2f8a749ffd24f172b0bde"><div class="ttname"><a href="structcurl__fileinfo.html#a69b09df292a2f8a749ffd24f172b0bde">curl_fileinfo::filetype</a></div><div class="ttdeci">curlfiletype filetype</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00282">curl.h:282</a></div></div>
<div class="ttc" id="inet__pton_8c_html_a8d1e996e3cc6d70e844c787b1a8614cc"><div class="ttname"><a href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a></div><div class="ttdeci">int Curl_inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="inet__pton_8c_source.html#l00066">inet_pton.c:66</a></div></div>
<div class="ttc" id="structcurl__llist_html_a3f6e07aacbee78561127b0166cc28fe7"><div class="ttname"><a href="structcurl__llist.html#a3f6e07aacbee78561127b0166cc28fe7">curl_llist::head</a></div><div class="ttdeci">struct curl_llist_element * head</div><div class="ttdef"><b>Definition:</b> <a href="llist_8h_source.html#l00037">llist.h:37</a></div></div>
<div class="ttc" id="urldata_8h_html_a3b42f4c610116cfa591c4eda7c1f7346"><div class="ttname"><a href="urldata_8h.html#a3b42f4c610116cfa591c4eda7c1f7346">PROTOPT_NEEDSPWD</a></div><div class="ttdeci">#define PROTOPT_NEEDSPWD</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00715">urldata.h:715</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a29324ee6c3345ce74d7ad9d47a509b0a">CURLE_FTP_PORT_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00500">curl.h:500</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a1e32e2a175bcdb45625a04ebcfea1d7f"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1e32e2a175bcdb45625a04ebcfea1d7f">FTP_PRET</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00073">ftp.h:73</a></div></div>
<div class="ttc" id="multiif_8h_html"><div class="ttname"><a href="multiif_8h.html">multiif.h</a></div></div>
<div class="ttc" id="sendf_8c_html_ad59954133649b7538b387f940b86024f"><div class="ttname"><a href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a></div><div class="ttdeci">CURLcode Curl_client_write(struct connectdata *conn, int type, char *ptr, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00651">sendf.c:651</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aebe38dbbb2739f5b0941a1bd1b4aa37c"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aebe38dbbb2739f5b0941a1bd1b4aa37c">CURLE_FTP_PRET_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00571">curl.h:571</a></div></div>
<div class="ttc" id="if2ip_8h_html_a5b6d01fb9da7688daa9437b3628d83eea6389ed3ecbe54bc7bbe4fa60080b9eff"><div class="ttname"><a href="if2ip_8h.html#a5b6d01fb9da7688daa9437b3628d83eea6389ed3ecbe54bc7bbe4fa60080b9eff">IF2IP_AF_NOT_SUPPORTED</a></div><div class="ttdef"><b>Definition:</b> <a href="if2ip_8h_source.html#l00039">if2ip.h:39</a></div></div>
<div class="ttc" id="http__proxy_8c_html_a64cc706da81f4e2a504fc457b79542e2"><div class="ttname"><a href="http__proxy_8c.html#a64cc706da81f4e2a504fc457b79542e2">Curl_connect_ongoing</a></div><div class="ttdeci">bool Curl_connect_ongoing(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="http__proxy_8c_source.html#l00144">http_proxy.c:144</a></div></div>
<div class="ttc" id="fileinfo_8h_html"><div class="ttname"><a href="fileinfo_8h.html">fileinfo.h</a></div></div>
<div class="ttc" id="timeval_8c_html_a93ce3158c8838916ed817489c98e37c4"><div class="ttname"><a href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a></div><div class="ttdeci">timediff_t Curl_timediff(struct curltime newer, struct curltime older)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00181">timeval.c:181</a></div></div>
<div class="ttc" id="memdebug_8h_html_a795660f73c902cc80ac0fe6cda0dbd1c"><div class="ttname"><a href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a></div><div class="ttdeci">#define Curl_safefree(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="memdebug_8h_source.html#l00176">memdebug.h:176</a></div></div>
<div class="ttc" id="progress_8h_html_abc090d144fb55d31dff488d24c46fb2aa4270c24c5c8157937a242ca32bcff6b5"><div class="ttname"><a href="progress_8h.html#abc090d144fb55d31dff488d24c46fb2aa4270c24c5c8157937a242ca32bcff6b5">TIMER_STARTACCEPT</a></div><div class="ttdef"><b>Definition:</b> <a href="progress_8h_source.html#l00038">progress.h:38</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="structpingpong_html_a3114f4d2dc54a2816b07d3688e425a43"><div class="ttname"><a href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">pingpong::cache_size</a></div><div class="ttdeci">size_t cache_size</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00050">pingpong.h:50</a></div></div>
<div class="ttc" id="pingpong_8c_html_aafa087a3d539d9b5e1257c083a4e93d2"><div class="ttname"><a href="pingpong_8c.html#aafa087a3d539d9b5e1257c083a4e93d2">Curl_pp_getsock</a></div><div class="ttdeci">int Curl_pp_getsock(struct pingpong *pp, curl_socket_t *socks, int numsocks)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00464">pingpong.c:464</a></div></div>
<div class="ttc" id="structconnectdata_html_a3385c7e824e59f8075d69b410fd7a72e"><div class="ttname"><a href="structconnectdata.html#a3385c7e824e59f8075d69b410fd7a72e">connectdata::secondary_port</a></div><div class="ttdeci">unsigned short secondary_port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00843">urldata.h:843</a></div></div>
<div class="ttc" id="structftp__wc_html_a8ddded70d25f4fe26ec10ccd0b7f568e"><div class="ttname"><a href="structftp__wc.html#a8ddded70d25f4fe26ec10ccd0b7f568e">ftp_wc::parser</a></div><div class="ttdeci">struct ftp_parselist_data * parser</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00085">ftp.h:85</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3e3dfee99c81f563d18ef4626d8886e1"><div class="ttname"><a href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a></div><div class="ttdeci">#define aprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00046">curl_printf.h:46</a></div></div>
<div class="ttc" id="http__proxy_8c_html_a9fffe1c2e53dc5f8c47b0fd8d03f458a"><div class="ttname"><a href="http__proxy_8c.html#a9fffe1c2e53dc5f8c47b0fd8d03f458a">Curl_proxyCONNECT</a></div><div class="ttdeci">CURLcode Curl_proxyCONNECT(struct connectdata *conn, int sockindex, const char *hostname, int remote_port)</div><div class="ttdef"><b>Definition:</b> <a href="http__proxy_8c_source.html#l00660">http_proxy.c:660</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a91829a03c2fae88d0de9c895e9df8cca"><div class="ttname"><a href="struct_connect_bits.html#a91829a03c2fae88d0de9c895e9df8cca">ConnectBits::socksproxy</a></div><div class="ttdeci">bool socksproxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00389">urldata.h:389</a></div></div>
<div class="ttc" id="llist_8c_html_a36b09b21eb5d63095a325575113df4f0"><div class="ttname"><a href="llist_8c.html#a36b09b21eb5d63095a325575113df4f0">Curl_llist_remove</a></div><div class="ttdeci">void Curl_llist_remove(struct curl_llist *list, struct curl_llist_element *e, void *user)</div><div class="ttdef"><b>Definition:</b> <a href="llist_8c_source.html#l00093">llist.c:93</a></div></div>
<div class="ttc" id="header_8d_html_a1fa2fe05139b1bad1ba9f137f51a222f"><div class="ttname"><a href="header_8d.html#a1fa2fe05139b1bad1ba9f137f51a222f">host</a></div><div class="ttdeci">to send X Custom you should thus fBnot fP add that as a part of the header they will only mess things up for you.Starting this option can take an argument in filename which then adds a header for each line in the input file.Using will make curl read the header file from stdin.See also the user agent and referer options.Starting you need proxy header to send custom headers intended for a proxy.like when told with location.This can lead to the header being sent to other hosts than the original host</div><div class="ttdef"><b>Definition:</b> <a href="header_8d_source.html#l00019">header.d:19</a></div></div>
<div class="ttc" id="select_8c_html_a5c7e56fd4476c27a049314f502981f29"><div class="ttname"><a href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a></div><div class="ttdeci">int Curl_socket_check(curl_socket_t readfd0, curl_socket_t readfd1, curl_socket_t writefd, time_t timeout_ms)</div><div class="ttdef"><b>Definition:</b> <a href="select_8c_source.html#l00145">select.c:145</a></div></div>
<div class="ttc" id="select_8h_html_a43b4f4b7314433975d83a3c678994ff4"><div class="ttname"><a href="select_8h.html#a43b4f4b7314433975d83a3c678994ff4">CURL_CSELECT_IN2</a></div><div class="ttdeci">#define CURL_CSELECT_IN2</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00073">select.h:73</a></div></div>
<div class="ttc" id="struct_single_request_html_a5803af0f75195ad74badb6ced9b24b16"><div class="ttname"><a href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">SingleRequest::protop</a></div><div class="ttdeci">void * protop</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00619">urldata.h:619</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01404">urldata.h:1404</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a0d9d6b2c221700c4479d9c4aab0192f8"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a0d9d6b2c221700c4479d9c4aab0192f8">FTP_RETR_REST</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00071">ftp.h:71</a></div></div>
<div class="ttc" id="ftp_8c_html_a79071fb30b2abfa423a252245cbc6190"><div class="ttname"><a href="ftp_8c.html#a79071fb30b2abfa423a252245cbc6190">Curl_handler_ftp</a></div><div class="ttdeci">const struct Curl_handler Curl_handler_ftp</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00167">ftp.c:167</a></div></div>
<div class="ttc" id="struct_connect_bits_html_aa6493ae964163380f432dd306f2618f6"><div class="ttname"><a href="struct_connect_bits.html#aa6493ae964163380f432dd306f2618f6">ConnectBits::ftp_use_eprt</a></div><div class="ttdeci">bool ftp_use_eprt</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00421">urldata.h:421</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65aa5bab60813f0dee8060cc00dadf070d9"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa5bab60813f0dee8060cc00dadf070d9">FTP_PBSZ</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00050">ftp.h:50</a></div></div>
<div class="ttc" id="urldata_8h_html_a0320d3ae0f4915a179d877818b3e2a05"><div class="ttname"><a href="urldata_8h.html#a0320d3ae0f4915a179d877818b3e2a05">RESP_TIMEOUT</a></div><div class="ttdeci">#define RESP_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00080">urldata.h:80</a></div></div>
<div class="ttc" id="struct_f_t_p_html_a49cded0904da8573af538a74dff5f141"><div class="ttname"><a href="struct_f_t_p.html#a49cded0904da8573af538a74dff5f141">FTP::downloadsize</a></div><div class="ttdeci">curl_off_t downloadsize</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00114">ftp.h:114</a></div></div>
<div class="ttc" id="non-ascii_8h_html"><div class="ttname"><a href="non-ascii_8h.html">non-ascii.h</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ab728995e08add6b7411b0c347b973b42">FTP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00043">ftp.h:43</a></div></div>
<div class="ttc" id="ftp_8h_html_aa0f0a799e8c85de11da0b1b426877750"><div class="ttname"><a href="ftp_8h.html#aa0f0a799e8c85de11da0b1b426877750">DEFAULT_ACCEPT_TIMEOUT</a></div><div class="ttdeci">#define DEFAULT_ACCEPT_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00161">ftp.h:161</a></div></div>
<div class="ttc" id="curl_8h_html_afa63f4f6ec2b2589a3cb5e5ee4ac7f8dad3c7dc37f58e16b08fdd590bdaf712e7"><div class="ttname"><a href="curl_8h.html#afa63f4f6ec2b2589a3cb5e5ee4ac7f8dad3c7dc37f58e16b08fdd590bdaf712e7">CURLFTPAUTH_TLS</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00836">curl.h:836</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a5a431b48a039b3f3125648f79ac77057"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a5a431b48a039b3f3125648f79ac77057">FTP_QUIT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00078">ftp.h:78</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="structpingpong_html_ac6242b076d5ebd5ff7c2325aeebcea36"><div class="ttname"><a href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">pingpong::cache</a></div><div class="ttdeci">char * cache</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00049">pingpong.h:49</a></div></div>
<div class="ttc" id="struct_curl__sockaddr__storage_html"><div class="ttname"><a href="struct_curl__sockaddr__storage.html">Curl_sockaddr_storage</a></div><div class="ttdef"><b>Definition:</b> <a href="sockaddr_8h_source.html#l00027">sockaddr.h:27</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ac50fb126afa10cf6754b070caa0485e3"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ac50fb126afa10cf6754b070caa0485e3">FTP_PASV</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00074">ftp.h:74</a></div></div>
<div class="ttc" id="structcurl__fileinfo_html"><div class="ttname"><a href="structcurl__fileinfo.html">curl_fileinfo</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00280">curl.h:280</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="curl_8h_html_ad4dd80e15a6f20cdd628a7f222fcb8eb"><div class="ttname"><a href="curl_8h.html#ad4dd80e15a6f20cdd628a7f222fcb8eb">curl_getdate</a></div><div class="ttdeci">CURL_EXTERN time_t curl_getdate(const char *p, const time_t *unused)</div><div class="ttdef"><b>Definition:</b> <a href="parsedate_8c_source.html#l00559">parsedate.c:559</a></div></div>
<div class="ttc" id="progress_8c_html_afd65889574fb7bde6ffcec48b0d8debb"><div class="ttname"><a href="progress_8c.html#afd65889574fb7bde6ffcec48b0d8debb">Curl_pgrsSetDownloadCounter</a></div><div class="ttdeci">void Curl_pgrsSetDownloadCounter(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00306">progress.c:306</a></div></div>
<div class="ttc" id="struct_url_state_html_a0caaf995a72fe34ed49b6da18b36e9f6"><div class="ttname"><a href="struct_url_state.html#a0caaf995a72fe34ed49b6da18b36e9f6">UrlState::ftp_trying_alternative</a></div><div class="ttdeci">bool ftp_trying_alternative</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01315">urldata.h:1315</a></div></div>
<div class="ttc" id="parsedate_8c_html_a192aac16662dc4aaf80ef3722b581958"><div class="ttname"><a href="parsedate_8c.html#a192aac16662dc4aaf80ef3722b581958">Curl_gmtime</a></div><div class="ttdeci">CURLcode Curl_gmtime(time_t intime, struct tm *store)</div><div class="ttdef"><b>Definition:</b> <a href="parsedate_8c_source.html#l00581">parsedate.c:581</a></div></div>
<div class="ttc" id="connect_8h_html_acdca2a91749c4f2ca1805e482bad0f90"><div class="ttname"><a href="connect_8h.html#acdca2a91749c4f2ca1805e482bad0f90">connkeep</a></div><div class="ttdeci">#define connkeep(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00146">connect.h:146</a></div></div>
<div class="ttc" id="struct_user_defined_html_a5a5553b0cb30c0014b4c53d2ba0825f3"><div class="ttname"><a href="struct_user_defined.html#a5a5553b0cb30c0014b4c53d2ba0825f3">UserDefined::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01643">urldata.h:1643</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fac722cfe21427fe2ea477684dd260b540"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fac722cfe21427fe2ea477684dd260b540">STRING_KRB_LEVEL</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01417">urldata.h:1417</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65aa6233d6e045100c7beda9fb549430f28"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65aa6233d6e045100c7beda9fb549430f28">FTP_STOR_TYPE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00066">ftp.h:66</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65ace331d2993199828afd6f0a348483f91">FTP_RETR</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00076">ftp.h:76</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951acaaed2faf20c957350e90a68282ae314"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951acaaed2faf20c957350e90a68282ae314">CURLE_WRITE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00489">curl.h:489</a></div></div>
<div class="ttc" id="struct_user_defined_html_a13f05a0089337483c7dbe40fbc42aac2"><div class="ttname"><a href="struct_user_defined.html#a13f05a0089337483c7dbe40fbc42aac2">UserDefined::str</a></div><div class="ttdeci">char * str[STRING_LAST]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01671">urldata.h:1671</a></div></div>
<div class="ttc" id="urldata_8h_html_a703cdbe3f849aab3b41d2122f0d126f1"><div class="ttname"><a href="urldata_8h.html#a703cdbe3f849aab3b41d2122f0d126f1">PROTOPT_DUAL</a></div><div class="ttdeci">#define PROTOPT_DUAL</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00707">urldata.h:707</a></div></div>
<div class="ttc" id="pingpong_8c_html_afa377ab63385678cbf3059b1cd3f9aaa"><div class="ttname"><a href="pingpong_8c.html#afa377ab63385678cbf3059b1cd3f9aaa">Curl_pp_init</a></div><div class="ttdeci">void Curl_pp_init(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00139">pingpong.c:139</a></div></div>
<div class="ttc" id="structconnectdata_html_ac808f51d6deb49f7806300cc1da23824"><div class="ttname"><a href="structconnectdata.html#ac808f51d6deb49f7806300cc1da23824">connectdata::scope_id</a></div><div class="ttdeci">unsigned int scope_id</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00826">urldata.h:826</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="struct_single_request_html_a7bd7f9afc35050a31e496a08c5baaeb8"><div class="ttname"><a href="struct_single_request.html#a7bd7f9afc35050a31e496a08c5baaeb8">SingleRequest::bytecount</a></div><div class="ttdeci">curl_off_t bytecount</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00541">urldata.h:541</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a18b677d0252c2519d54ad5e65476eff0"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a18b677d0252c2519d54ad5e65476eff0">FTP_SYST</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00054">ftp.h:54</a></div></div>
<div class="ttc" id="header_8d_html_af039c1a4bf9f7d5ffdd981d66cd3fb2d"><div class="ttname"><a href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a></div><div class="ttdeci">Long your externally set header will be used instead of the one.This allows you to make even trickier stuff than curl would normally do.You should not replace internally set headers without knowing perfectly well what you re doing.Remove an header by giving a replacement without content on the right side of the as in</div><div class="ttdef"><b>Definition:</b> <a href="header_8d_source.html#l00009">header.d:9</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_acc3e9b1176bd8c62c4fe0e017007e719"><div class="ttname"><a href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a></div><div class="ttdeci">#define ISDIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00065">curl_ctype.h:65</a></div></div>
<div class="ttc" id="struct_curl__handler_html_a2fc887b2697c63980406a19108b82a24"><div class="ttname"><a href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">Curl_handler::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00702">urldata.h:702</a></div></div>
<div class="ttc" id="transfer_8h_html"><div class="ttname"><a href="transfer_8h.html">transfer.h</a></div></div>
<div class="ttc" id="structpingpong_html_a522d890c9b0b6e9edbc977e9543ef362"><div class="ttname"><a href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">pingpong::conn</a></div><div class="ttdeci">struct connectdata * conn</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00066">pingpong.h:66</a></div></div>
<div class="ttc" id="ftplistparser_8h_html"><div class="ttname"><a href="ftplistparser_8h.html">ftplistparser.h</a></div></div>
<div class="ttc" id="ftplistparser_8c_html_aaa44be04d49bc6bb4f26759980f346a6"><div class="ttname"><a href="ftplistparser_8c.html#aaa44be04d49bc6bb4f26759980f346a6">Curl_ftp_parselist_geterror</a></div><div class="ttdeci">CURLcode Curl_ftp_parselist_geterror(struct ftp_parselist_data *pl_data)</div><div class="ttdef"><b>Definition:</b> <a href="ftplistparser_8c_source.html#l00198">ftplistparser.c:198</a></div></div>
<div class="ttc" id="escape_8h_html"><div class="ttname"><a href="escape_8h.html">escape.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af977c5b7373a2cbb9f657327ec6bb675"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af977c5b7373a2cbb9f657327ec6bb675">CURLE_FTP_CANT_GET_HOST</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00479">curl.h:479</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a06ee9e40c4f7e506b01c849754ae40c8"><div class="ttname"><a href="struct_connect_bits.html#a06ee9e40c4f7e506b01c849754ae40c8">ConnectBits::ftp_use_epsv</a></div><div class="ttdeci">bool ftp_use_epsv</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00417">urldata.h:417</a></div></div>
<div class="ttc" id="pingpong_8c_html_a72d99a85630458817725215f758898b6"><div class="ttname"><a href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a></div><div class="ttdeci">CURLcode Curl_pp_sendf(struct pingpong *pp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00253">pingpong.c:253</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="curl__sec_8h_html"><div class="ttname"><a href="curl__sec_8h.html">curl_sec.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a8115a39494ea1a40fd0e2d9e51b61b92"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a8115a39494ea1a40fd0e2d9e51b61b92">FTP_MKD</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00061">ftp.h:61</a></div></div>
<div class="ttc" id="structconnectdata_html_a347307932d5d64be48527b2f3ed666ca"><div class="ttname"><a href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">connectdata::proto</a></div><div class="ttdeci">union connectdata::@45 proto</div></div>
<div class="ttc" id="structhostname_html_a291f3a076a5e010a90c0245625ea09b9"><div class="ttname"><a href="structhostname.html#a291f3a076a5e010a90c0245625ea09b9">hostname::rawalloc</a></div><div class="ttdeci">char * rawalloc</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00447">urldata.h:447</a></div></div>
<div class="ttc" id="structftp__conn_html_a2068379f1421acf8658b1bb75bfd30de"><div class="ttname"><a href="structftp__conn.html#a2068379f1421acf8658b1bb75bfd30de">ftp_conn::state</a></div><div class="ttdeci">ftpstate state</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00146">ftp.h:146</a></div></div>
<div class="ttc" id="struct_user_defined_html_a2d141b704c392572a00ec42b33bdadb2"><div class="ttname"><a href="struct_user_defined.html#a2d141b704c392572a00ec42b33bdadb2">UserDefined::chunk_bgn</a></div><div class="ttdeci">curl_chunk_bgn_callback chunk_bgn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01684">urldata.h:1684</a></div></div>
<div class="ttc" id="structconnectdata_html_a57fed5d378439f0b8cbad7cc9e916604"><div class="ttname"><a href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">connectdata::proxy_ssl</a></div><div class="ttdeci">struct ssl_connect_data proxy_ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00886">urldata.h:886</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_a8f5a54a191464a085db2d5e586aeefed"><div class="ttname"><a href="struct_wildcard_data.html#a8f5a54a191464a085db2d5e586aeefed">WildcardData::pattern</a></div><div class="ttdeci">char * pattern</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00049">wildcard.h:49</a></div></div>
<div class="ttc" id="struct_connect_bits_html_aa4606cd7d5928857e28473a129c4ccf0"><div class="ttname"><a href="struct_connect_bits.html#aa4606cd7d5928857e28473a129c4ccf0">ConnectBits::ipv6</a></div><div class="ttdeci">bool ipv6</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00394">urldata.h:394</a></div></div>
<div class="ttc" id="structconnectdata_html_a0206025a79e7085b102e907730e901fe"><div class="ttname"><a href="structconnectdata.html#a0206025a79e7085b102e907730e901fe">connectdata::sock_accepted</a></div><div class="ttdeci">bool sock_accepted[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00877">urldata.h:877</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html"><div class="ttname"><a href="struct_curl__addrinfo.html">Curl_addrinfo</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00051">curl_addrinfo.h:51</a></div></div>
<div class="ttc" id="structconnectdata_html_ac9d24fcd15a4c660fa7b6fbf55f6451d"><div class="ttname"><a href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">connectdata::port</a></div><div class="ttdeci">long port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00839">urldata.h:839</a></div></div>
<div class="ttc" id="structftp__conn_html_a678c7789979434e2a2212b3177ed9eb8"><div class="ttname"><a href="structftp__conn.html#a678c7789979434e2a2212b3177ed9eb8">ftp_conn::dont_check</a></div><div class="ttdeci">bool dont_check</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00127">ftp.h:127</a></div></div>
<div class="ttc" id="structconnectdata_html_ad7ad0216049eeb5099888585025e2202"><div class="ttname"><a href="structconnectdata.html#ad7ad0216049eeb5099888585025e2202">connectdata::seek_client</a></div><div class="ttdeci">void * seek_client</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00974">urldata.h:974</a></div></div>
<div class="ttc" id="structftp__conn_html_ab70bbd41ddfe254007b5bca2680d8933"><div class="ttname"><a href="structftp__conn.html#ab70bbd41ddfe254007b5bca2680d8933">ftp_conn::cwdcount</a></div><div class="ttdeci">int cwdcount</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00135">ftp.h:135</a></div></div>
<div class="ttc" id="wildcard_8h_html_ab4724474e988ca4793d666e449cd2b0aa008ebf373c80fec111653fefacd75b50"><div class="ttname"><a href="wildcard_8h.html#ab4724474e988ca4793d666e449cd2b0aa008ebf373c80fec111653fefacd75b50">CURLWC_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00038">wildcard.h:38</a></div></div>
<div class="ttc" id="curl_8h_html_ae319cab849319fca1b222de282506ad9ac1674afdd84449264ce314c1f525ab33"><div class="ttname"><a href="curl_8h.html#ae319cab849319fca1b222de282506ad9ac1674afdd84449264ce314c1f525ab33">CURLSOCKTYPE_ACCEPT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00365">curl.h:365</a></div></div>
<div class="ttc" id="urldata_8h_html_a766105b6448011146b33df92f55d2261"><div class="ttname"><a href="urldata_8h.html#a766105b6448011146b33df92f55d2261">PROTOPT_WILDCARD</a></div><div class="ttdeci">#define PROTOPT_WILDCARD</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00728">urldata.h:728</a></div></div>
<div class="ttc" id="struct_user_defined_html_a7c3b9ad30be2fed915aa3a694a31dc36"><div class="ttname"><a href="struct_user_defined.html#a7c3b9ad30be2fed915aa3a694a31dc36">UserDefined::fwrite_func</a></div><div class="ttdeci">curl_write_callback fwrite_func</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01523">urldata.h:1523</a></div></div>
<div class="ttc" id="pingpong_8c_html_a37bd477ec46526ae33926df9e61e7051"><div class="ttname"><a href="pingpong_8c.html#a37bd477ec46526ae33926df9e61e7051">Curl_pp_readresp</a></div><div class="ttdeci">CURLcode Curl_pp_readresp(curl_socket_t sockfd, struct pingpong *pp, int *code, size_t *size)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00272">pingpong.c:272</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="structftp__conn_html_a203982dfa2c975ba4d9c20a0509eba48"><div class="ttname"><a href="structftp__conn.html#a203982dfa2c975ba4d9c20a0509eba48">ftp_conn::count2</a></div><div class="ttdeci">int count2</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00144">ftp.h:144</a></div></div>
<div class="ttc" id="struct_f_t_p_html_a7775830abeda135e03f2df4929ec27e1"><div class="ttname"><a href="struct_f_t_p.html#a7775830abeda135e03f2df4929ec27e1">FTP::bytecountp</a></div><div class="ttdeci">curl_off_t * bytecountp</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00105">ftp.h:105</a></div></div>
<div class="ttc" id="asyn_8h_html_ad14e13eb0e765d0d2b825ae8d0ad7c00"><div class="ttname"><a href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a></div><div class="ttdeci">CURLcode Curl_resolver_wait_resolv(struct connectdata *conn, struct Curl_dns_entry **dnsentry)</div></div>
<div class="ttc" id="struct_user_defined_html_a55cebfc4d6849eb5f25fd8e7712823e9"><div class="ttname"><a href="struct_user_defined.html#a55cebfc4d6849eb5f25fd8e7712823e9">UserDefined::chunk_end</a></div><div class="ttdeci">curl_chunk_end_callback chunk_end</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01686">urldata.h:1686</a></div></div>
<div class="ttc" id="multi_8c_html_a759a3f675165554a5f5d6e784afa7fe0"><div class="ttname"><a href="multi_8c.html#a759a3f675165554a5f5d6e784afa7fe0">Curl_expire</a></div><div class="ttdeci">void Curl_expire(struct Curl_easy *data, time_t milli, expire_id id)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l02994">multi.c:2994</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a1fdf8f9a38a07300052b2c9a49659fd2">FTP_QUOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00056">ftp.h:56</a></div></div>
<div class="ttc" id="structftp__conn_html"><div class="ttname"><a href="structftp__conn.html">ftp_conn</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00120">ftp.h:120</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a7563463d9ad94df9ed822c17786dd6a2"><div class="ttname"><a href="struct_connect_bits.html#a7563463d9ad94df9ed822c17786dd6a2">ConnectBits::do_more</a></div><div class="ttdeci">bool do_more</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00396">urldata.h:396</a></div></div>
<div class="ttc" id="struct_f_t_p_html_a8f0c4898b604a9e3973d7568fc12edd1"><div class="ttname"><a href="struct_f_t_p.html#a8f0c4898b604a9e3973d7568fc12edd1">FTP::path</a></div><div class="ttdeci">char * path</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00108">ftp.h:108</a></div></div>
<div class="ttc" id="structftp__conn_html_aca1e36474c6b5ed4b9e998add6fd0ca4"><div class="ttname"><a href="structftp__conn.html#aca1e36474c6b5ed4b9e998add6fd0ca4">ftp_conn::entrypath</a></div><div class="ttdeci">char * entrypath</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00122">ftp.h:122</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a95518daa497390189c61aa83c8a1e88a">FTP_USER</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00047">ftp.h:47</a></div></div>
<div class="ttc" id="hostip_8h_html"><div class="ttname"><a href="hostip_8h.html">hostip.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ac6544fd7da6ddfd7893d74095b17a28d">CURLE_PARTIAL_FILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00484">curl.h:484</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ac0a65d42e6dbdf1da26be9f6cff864ff">CURLE_FTP_COULDNT_RETR_FILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00485">curl.h:485</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a84a7ed5d4f674a884524357db49c890d"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a84a7ed5d4f674a884524357db49c890d">FTP_CCC</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00052">ftp.h:52</a></div></div>
<div class="ttc" id="struct_f_t_p_html_a4b007b3a38109d7ea3b60ea8be4383e3"><div class="ttname"><a href="struct_f_t_p.html#a4b007b3a38109d7ea3b60ea8be4383e3">FTP::passwd</a></div><div class="ttdeci">char * passwd</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00107">ftp.h:107</a></div></div>
<div class="ttc" id="ftp_8c_html_a2facdfca371afebb3364c87fae328d95"><div class="ttname"><a href="ftp_8c.html#a2facdfca371afebb3364c87fae328d95">SBUF_SIZE</a></div><div class="ttdeci">#define SBUF_SIZE</div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a2b38c28089de4d15ded4a7a16ac28a87"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a2b38c28089de4d15ded4a7a16ac28a87">FTP_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00067">ftp.h:67</a></div></div>
<div class="ttc" id="urldata_8h_html_a5a17341fe1dab2c775265da4ab90af34"><div class="ttname"><a href="urldata_8h.html#a5a17341fe1dab2c775265da4ab90af34">PORT_FTP</a></div><div class="ttdeci">#define PORT_FTP</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00029">urldata.h:29</a></div></div>
<div class="ttc" id="ftplistparser_8c_html_a822c4a0b890c2b7e9464514eb773b8d8"><div class="ttname"><a href="ftplistparser_8c.html#a822c4a0b890c2b7e9464514eb773b8d8">Curl_ftp_parselist_data_free</a></div><div class="ttdeci">void Curl_ftp_parselist_data_free(struct ftp_parselist_data **parserp)</div><div class="ttdef"><b>Definition:</b> <a href="ftplistparser_8c_source.html#l00188">ftplistparser.c:188</a></div></div>
<div class="ttc" id="urldata_8h_html_ad1e824167a50a205dad75e1256dedfca"><div class="ttname"><a href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a></div><div class="ttdeci">#define PROTOPT_CLOSEACTION</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00708">urldata.h:708</a></div></div>
<div class="ttc" id="warnless_8c_html_a9b1c2efcef4120b8096d53bc254bfb9b"><div class="ttname"><a href="warnless_8c.html#a9b1c2efcef4120b8096d53bc254bfb9b">curlx_sotouz</a></div><div class="ttdeci">size_t curlx_sotouz(curl_off_t sonum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00347">warnless.c:347</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa51394e43374873edba2391d5b4e09877"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa51394e43374873edba2391d5b4e09877">STRING_FTP_ACCOUNT</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01408">urldata.h:1408</a></div></div>
<div class="ttc" id="struct_connect_bits_html_aec16dc8e44e2c34947cf23a7e0211b53"><div class="ttname"><a href="struct_connect_bits.html#aec16dc8e44e2c34947cf23a7e0211b53">ConnectBits::proxy_ssl_connected</a></div><div class="ttdeci">bool proxy_ssl_connected[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00441">urldata.h:441</a></div></div>
<div class="ttc" id="structconnectdata_html_a4ae9ef32ff4f93d9fe8cc5f6ba7c690b"><div class="ttname"><a href="structconnectdata.html#a4ae9ef32ff4f93d9fe8cc5f6ba7c690b">connectdata::secondaryhostname</a></div><div class="ttdeci">char * secondaryhostname</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00832">urldata.h:832</a></div></div>
<div class="ttc" id="socks_8h_html"><div class="ttname"><a href="socks_8h.html">socks.h</a></div></div>
<div class="ttc" id="curl_8h_html_a1feaa896e865ad01f32cc46f6f8c72f5"><div class="ttname"><a href="curl_8h.html#a1feaa896e865ad01f32cc46f6f8c72f5">curl_easy_strerror</a></div><div class="ttdeci">CURL_EXTERN const char * curl_easy_strerror(CURLcode)</div><div class="ttdef"><b>Definition:</b> <a href="strerror_8c_source.html#l00057">strerror.c:57</a></div></div>
<div class="ttc" id="struct_wildcard_data_html_aa312ae53f66b4fe3f10c3701c67abecf"><div class="ttname"><a href="struct_wildcard_data.html#aa312ae53f66b4fe3f10c3701c67abecf">WildcardData::state</a></div><div class="ttdeci">curl_wildcard_states state</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8h_source.html#l00047">wildcard.h:47</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_af89f74b4f46628d93e3cc829fcd69801"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_SOCKLEN_T curl_socklen_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00436">system.h:436</a></div></div>
<div class="ttc" id="url_8h_html"><div class="ttname"><a href="url_8h.html">url.h</a></div></div>
<div class="ttc" id="structpingpong_html"><div class="ttname"><a href="structpingpong.html">pingpong</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00048">pingpong.h:48</a></div></div>
<div class="ttc" id="structftp__conn_html_ab98ebc40c5fa6a685da919de5b06a96f"><div class="ttname"><a href="structftp__conn.html#ab98ebc40c5fa6a685da919de5b06a96f">ftp_conn::pp</a></div><div class="ttdeci">struct pingpong pp</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00121">ftp.h:121</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a4312ee806c76575f6183c9b9a57c4601"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a4312ee806c76575f6183c9b9a57c4601">CURLE_FTP_ACCEPT_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00474">curl.h:474</a></div></div>
<div class="ttc" id="structftp__conn_html_a8c3cde6cac2101bcc33471a69ebf8998"><div class="ttname"><a href="structftp__conn.html#a8c3cde6cac2101bcc33471a69ebf8998">ftp_conn::file</a></div><div class="ttdeci">char * file</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00126">ftp.h:126</a></div></div>
<div class="ttc" id="structftp__wc_html_a99acb1d843e05a88ae7974cab659375a"><div class="ttname"><a href="structftp__wc.html#a99acb1d843e05a88ae7974cab659375a">ftp_wc::file_descriptor</a></div><div class="ttdeci">FILE * file_descriptor</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00089">ftp.h:89</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="strcase_8c_html_a555bbf5fd8dc146336474a2bb7959524"><div class="ttname"><a href="strcase_8c.html#a555bbf5fd8dc146336474a2bb7959524">Curl_raw_toupper</a></div><div class="ttdeci">char Curl_raw_toupper(char in)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8c_source.html#l00031">strcase.c:31</a></div></div>
<div class="ttc" id="curl_8h_html_a845d262749bd413d724b58e26f713f25ab52a0e6ddf579f8f81b40d8a684155a6"><div class="ttname"><a href="curl_8h.html#a845d262749bd413d724b58e26f713f25ab52a0e6ddf579f8f81b40d8a684155a6">CURL_TIMECOND_IFUNMODSINCE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02018">curl.h:2018</a></div></div>
<div class="ttc" id="pingpong_8h_html_aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864"><div class="ttname"><a href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eaf4c12ee7b954ced8f842a98553195864">FTPTRANSFER_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00038">pingpong.h:38</a></div></div>
<div class="ttc" id="structpingpong_html_a41d7af4e20ce3d40d90eddf0f62cb64d"><div class="ttname"><a href="structpingpong.html#a41d7af4e20ce3d40d90eddf0f62cb64d">pingpong::response</a></div><div class="ttdeci">struct curltime response</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00061">pingpong.h:61</a></div></div>
<div class="ttc" id="structconnectdata_html_a61d74d062cbc2449e09c15d31106127c"><div class="ttname"><a href="structconnectdata.html#a61d74d062cbc2449e09c15d31106127c">connectdata::ftpc</a></div><div class="ttdeci">struct ftp_conn ftpc</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01003">urldata.h:1003</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="pingpong_8c_html_a62b24aadd77bd06bae0b8be426ca5bd3"><div class="ttname"><a href="pingpong_8c.html#a62b24aadd77bd06bae0b8be426ca5bd3">Curl_pp_state_timeout</a></div><div class="ttdeci">time_t Curl_pp_state_timeout(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00047">pingpong.c:47</a></div></div>
<div class="ttc" id="structconnectdata_html_a85cb9da7776d42c440612d2940a7fcb4"><div class="ttname"><a href="structconnectdata.html#a85cb9da7776d42c440612d2940a7fcb4">connectdata::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00863">urldata.h:863</a></div></div>
<div class="ttc" id="ftp_8h_html_a09ddc2c929b5d7c0e5142b88b98dec65a41b778c2aeab0dd5779fe00bd47fd383"><div class="ttname"><a href="ftp_8h.html#a09ddc2c929b5d7c0e5142b88b98dec65a41b778c2aeab0dd5779fe00bd47fd383">FTP_PROT</a></div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00051">ftp.h:51</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="struct_f_t_p_html_a8f277380bb8d9d1876c10acb36ca98d7"><div class="ttname"><a href="struct_f_t_p.html#a8f277380bb8d9d1876c10acb36ca98d7">FTP::pathalloc</a></div><div class="ttdeci">char * pathalloc</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8h_source.html#l00109">ftp.h:109</a></div></div>
<div class="ttc" id="ftplistparser_8c_html_a3ada8442a76dfa5e7d90be2ce9b4bb15"><div class="ttname"><a href="ftplistparser_8c.html#a3ada8442a76dfa5e7d90be2ce9b4bb15">Curl_ftp_parselist_data_alloc</a></div><div class="ttdeci">struct ftp_parselist_data * Curl_ftp_parselist_data_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="ftplistparser_8c_source.html#l00182">ftplistparser.c:182</a></div></div>
<div class="ttc" id="util_8c_html_a3b02c6de5c049804444a246f7fdf46b4"><div class="ttname"><a href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a></div><div class="ttdeci">const char * path</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00194">util.c:194</a></div></div>
<div class="ttc" id="timeval_8h_html_aeb19832fd3e7f11c8d047d6824300e87"><div class="ttname"><a href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a></div><div class="ttdeci">int timediff_t</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00028">timeval.h:28</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a91e314b8c572061fed47b9a204d3397d"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a91e314b8c572061fed47b9a204d3397d">CURLE_CHUNK_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00575">curl.h:575</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951abf7638d198de39a72f5594dad2655bbe"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951abf7638d198de39a72f5594dad2655bbe">CURLE_UNKNOWN_OPTION</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00518">curl.h:518</a></div></div>
<div class="ttc" id="curl_8h_html_ad33aec6913a92b0f7730934990435499"><div class="ttname"><a href="curl_8h.html#ad33aec6913a92b0f7730934990435499">CURL_CHUNK_BGN_FUNC_SKIP</a></div><div class="ttdeci">#define CURL_CHUNK_BGN_FUNC_SKIP</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00310">curl.h:310</a></div></div>
<div class="ttc" id="http__proxy_8c_html_ac79abdd8c0d0b2818f4478e91afcaa35"><div class="ttname"><a href="http__proxy_8c.html#ac79abdd8c0d0b2818f4478e91afcaa35">Curl_proxy_connect</a></div><div class="ttdeci">CURLcode Curl_proxy_connect(struct connectdata *conn, int sockindex)</div><div class="ttdef"><b>Definition:</b> <a href="http__proxy_8c_source.html#l00072">http_proxy.c:72</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a805079d1643f348afa725659b45b6f87"><div class="ttname"><a href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a></div><div class="ttdeci">#define DEBUGF(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00390">curl_setup_once.h:390</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
<div class="ttc" id="structcurl__fileinfo_html_ae42985a10c5ac94b2ac09c5e75c05e40"><div class="ttname"><a href="structcurl__fileinfo.html#ae42985a10c5ac94b2ac09c5e75c05e40">curl_fileinfo::filename</a></div><div class="ttdeci">char * filename</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00281">curl.h:281</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="ftp_8c.html">ftp.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
