<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/curl_ntlm_core.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('curl__ntlm__core_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">curl_ntlm_core.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="curl__ntlm__core_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#if defined(USE_NTLM)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * NTLM details:</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * https://davenport.sourceforge.io/ntlm.html</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * https://www.innovation.ch/java/ntlm.html</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/* Please keep the SSL backend-specific #if branches in this order:</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">   1. USE_OPENSSL</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">   2. USE_GNUTLS_NETTLE</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">   3. USE_GNUTLS</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">   4. USE_NSS</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">   5. USE_MBEDTLS</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">   6. USE_DARWINSSL</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">   7. USE_OS400CRYPTO</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">   8. USE_WIN32_CRYPTO</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">   This ensures that:</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   - the same SSL branch gets activated throughout this source</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">     file even if multiple backends are enabled at the same time.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">   - OpenSSL and NSS have higher priority than Windows Crypt, due</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">     to issues with the latter supporting NTLM2Session responses</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">     in NTLM type-3 messages.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#if !defined(USE_WINDOWS_SSPI) || defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#  include &lt;openssl/des.h&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#  ifndef OPENSSL_NO_MD4</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#    include &lt;openssl/md4.h&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#  endif</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#  include &lt;openssl/md5.h&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#  include &lt;openssl/ssl.h&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#  include &lt;openssl/rand.h&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#  if (OPENSSL_VERSION_NUMBER &lt; 0x00907001L)</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#    define DES_key_schedule des_key_schedule</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#    define DES_cblock des_cblock</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#    define DES_set_odd_parity des_set_odd_parity</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#    define DES_set_key des_set_key</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#    define DES_ecb_encrypt des_ecb_encrypt</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#    define DESKEY(x) x</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#    define DESKEYARG(x) x</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#  else</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#    define DESKEYARG(x) *x</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#    define DESKEY(x) &amp;x</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#  endif</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS_NETTLE)</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#  include &lt;nettle/des.h&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#  include &lt;nettle/md4.h&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS)</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#  include &lt;gcrypt.h&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#  define MD5_DIGEST_LENGTH 16</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#  define MD4_DIGEST_LENGTH 16</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#elif defined(USE_NSS)</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#  include &lt;nss.h&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#  include &lt;pk11pub.h&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#  include &lt;hasht.h&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#  include &quot;<a class="code" href="curl__md4_8h.html">curl_md4.h</a>&quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#  define MD5_DIGEST_LENGTH MD5_LENGTH</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#elif defined(USE_MBEDTLS)</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#  include &lt;mbedtls/des.h&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#  include &lt;mbedtls/md4.h&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#  if !defined(MBEDTLS_MD4_C)</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#    include &quot;<a class="code" href="curl__md4_8h.html">curl_md4.h</a>&quot;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#  endif</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#elif defined(USE_DARWINSSL)</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#  include &lt;CommonCrypto/CommonCryptor.h&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#  include &lt;CommonCrypto/CommonDigest.h&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#elif defined(USE_OS400CRYPTO)</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#  include &quot;cipher.mih&quot;</span>  <span class="comment">/* mih/cipher */</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#  include &quot;<a class="code" href="curl__md4_8h.html">curl_md4.h</a>&quot;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#elif defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#  include &lt;wincrypt.h&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#  error &quot;Can&#39;t compile NTLM support without a crypto library.&quot;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="non-ascii_8h.html">non-ascii.h</a>&quot;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__ntlm__core_8h.html">curl_ntlm_core.h</a>&quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__md5_8h.html">curl_md5.h</a>&quot;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__hmac_8h.html">curl_hmac.h</a>&quot;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__endian_8h.html">curl_endian.h</a>&quot;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__des_8h.html">curl_des.h</a>&quot;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#define NTLM_HMAC_MD5_LEN     (16)</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#define NTLMv2_BLOB_SIGNATURE &quot;\x01\x01\x00\x00&quot;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#define NTLMv2_BLOB_LEN       (44 -16 + ntlm-&gt;target_info_len + 4)</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">* Turns a 56-bit key into being 64-bit wide.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> extend_key_56_to_64(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56, <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[0] = key_56[0];</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[1] = (<span class="keywordtype">unsigned</span> char)(((key_56[0] &lt;&lt; 7) &amp; 0xFF) | (key_56[1] &gt;&gt; 1));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[2] = (<span class="keywordtype">unsigned</span> char)(((key_56[1] &lt;&lt; 6) &amp; 0xFF) | (key_56[2] &gt;&gt; 2));</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[3] = (<span class="keywordtype">unsigned</span> char)(((key_56[2] &lt;&lt; 5) &amp; 0xFF) | (key_56[3] &gt;&gt; 3));</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[4] = (<span class="keywordtype">unsigned</span> char)(((key_56[3] &lt;&lt; 4) &amp; 0xFF) | (key_56[4] &gt;&gt; 4));</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[5] = (<span class="keywordtype">unsigned</span> char)(((key_56[4] &lt;&lt; 3) &amp; 0xFF) | (key_56[5] &gt;&gt; 5));</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[6] = (<span class="keywordtype">unsigned</span> char)(((key_56[5] &lt;&lt; 2) &amp; 0xFF) | (key_56[6] &gt;&gt; 6));</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[7] = (<span class="keywordtype">unsigned</span> char) ((key_56[6] &lt;&lt; 1) &amp; 0xFF);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> * Turns a 56 bit key into the 64 bit, odd parity key and sets the key.  The</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> * key schedule ks is also set.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> setup_des_key(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56,</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                          DES_key_schedule DESKEYARG(ks))</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  DES_cblock <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  extend_key_56_to_64(key_56, (<span class="keywordtype">char</span> *) &amp;<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="setup-vms_8h.html#a3071e688ccca88778282efa98e5a5a1f">DES_set_odd_parity</a>(&amp;<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">/* Set the key */</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="setup-vms_8h.html#a5d96084a50f1a9c6c335707b2c71cc1b">DES_set_key</a>(&amp;<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, ks);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS_NETTLE)</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> setup_des_key(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56,</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                          <span class="keyword">struct</span> des_ctx *des)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  extend_key_56_to_64(key_56, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>));</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">/* Set the key */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  des_set_key(des, (<span class="keyword">const</span> uint8_t *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS)</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * Turns a 56 bit key into the 64 bit, odd parity key and sets the key.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> setup_des_key(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56,</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                          gcry_cipher_hd_t *des)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  extend_key_56_to_64(key_56, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>));</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">/* Set the key */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  gcry_cipher_setkey(*des, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>));</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#elif defined(USE_NSS)</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"> * Expands a 56 bit key KEY_56 to 64 bit and encrypts 64 bit of data, using</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"> * the expanded key.  The caller is responsible for giving 64 bit of valid</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"> * data is IN and (at least) 64 bit large buffer as OUT.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> encrypt_des(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keyword">const</span> CK_MECHANISM_TYPE mech = CKM_DES_ECB; <span class="comment">/* DES cipher in ECB mode */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  PK11SlotInfo *slot = NULL;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];                                <span class="comment">/* expanded 64 bit key */</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  SECItem key_item;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  PK11SymKey *symkey = NULL;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  SECItem *param = NULL;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  PK11Context *ctx = NULL;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">int</span> out_len;                                <span class="comment">/* not used, required by NSS */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordtype">bool</span> rv = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">/* use internal slot for DES encryption (requires NSS to be initialized) */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  slot = PK11_GetInternalKeySlot();</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span>(!slot)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  extend_key_56_to_64(key_56, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>));</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">/* Import the key */</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  key_item.data = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  key_item.len = <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  symkey = PK11_ImportSymKey(slot, mech, PK11_OriginUnwrap, CKA_ENCRYPT,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                             &amp;key_item, NULL);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span>(!symkey)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">/* Create the DES encryption context */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  param = PK11_ParamFromIV(mech, <span class="comment">/* no IV in ECB mode */</span> NULL);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">if</span>(!param)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  ctx = PK11_CreateContextBySymKey(mech, CKA_ENCRYPT, symkey, param);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span>(!ctx)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">/* Perform the encryption */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">if</span>(SECSuccess == PK11_CipherOp(ctx, out, &amp;out_len, <span class="comment">/* outbuflen */</span> 8,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="comment">/* inbuflen */</span> 8)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      &amp;&amp; SECSuccess == PK11_Finalize(ctx))</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    rv = <span class="comment">/* all OK */</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>:</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">/* cleanup */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span>(ctx)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    PK11_DestroyContext(ctx, PR_TRUE);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">if</span>(symkey)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    PK11_FreeSymKey(symkey);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span>(param)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    SECITEM_FreeItem(param, PR_TRUE);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  PK11_FreeSlot(slot);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">#elif defined(USE_MBEDTLS)</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> encrypt_des(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  mbedtls_des_context ctx;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  extend_key_56_to_64(key_56, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  mbedtls_des_key_set_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">/* Perform the encryption */</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  mbedtls_des_init(&amp;ctx);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  mbedtls_des_setkey_enc(&amp;ctx, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">return</span> mbedtls_des_crypt_ecb(&amp;ctx, <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, out) == 0;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#elif defined(USE_DARWINSSL)</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> encrypt_des(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">size_t</span> out_len;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  CCCryptorStatus err;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  extend_key_56_to_64(key_56, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>));</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">/* Perform the encryption */</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  err = CCCrypt(kCCEncrypt, kCCAlgorithmDES, kCCOptionECBMode, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                kCCKeySizeDES, NULL, <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, 8 <span class="comment">/* inbuflen */</span>, out,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                8 <span class="comment">/* outbuflen */</span>, &amp;out_len);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">return</span> err == kCCSuccess;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">#elif defined(USE_OS400CRYPTO)</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> encrypt_des(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;{</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  _CIPHER_Control_T ctl;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">/* Setup the cipher control structure */</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  ctl.Func_ID = ENCRYPT_ONLY;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  ctl.Data_Len = <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  extend_key_56_to_64(key_56, ctl.Crypto_Key);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ctl.Crypto_Key, ctl.Data_Len);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">/* Perform the encryption */</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  _CIPHER((_SPCPTR *) &amp;out, &amp;ctl, (_SPCPTR *) &amp;<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#elif defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> encrypt_des(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *out,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key_56)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  HCRYPTPROV hprov;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  HCRYPTKEY hkey;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keyword">struct </span>{</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    BLOBHEADER hdr;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>[8];</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  } blob;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  DWORD <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 8;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">/* Acquire the crypto provider */</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span>(!CryptAcquireContext(&amp;hprov, NULL, NULL, PROV_RSA_FULL,</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                          CRYPT_VERIFYCONTEXT))</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">/* Setup the key blob structure */</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;blob, 0, <span class="keyword">sizeof</span>(blob));</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  blob.hdr.bType = PLAINTEXTKEYBLOB;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  blob.hdr.bVersion = 2;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  blob.hdr.aiKeyAlg = CALG_DES;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  blob.len = <span class="keyword">sizeof</span>(blob.key);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="comment">/* Expand the 56-bit key to 64-bits */</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  extend_key_56_to_64(key_56, blob.key);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">/* Set the key parity to odd */</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  Curl_des_set_odd_parity((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) blob.key, <span class="keyword">sizeof</span>(blob.key));</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="comment">/* Import the key */</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span>(!CryptImportKey(hprov, (BYTE *) &amp;blob, <span class="keyword">sizeof</span>(blob), 0, 0, &amp;hkey)) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    CryptReleaseContext(hprov, 0);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(out, <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, 8);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">/* Perform the encryption */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  CryptEncrypt(hkey, 0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, 0, out, &amp;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  CryptDestroyKey(hkey);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  CryptReleaseContext(hprov, 0);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* defined(USE_WIN32_CRYPTO) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; <span class="comment">/*</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">  * takes a 21 byte array and treats it as 3 56-bit DES keys. The</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">  * 8 byte plaintext is encrypted with each key and the resulting 24</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">  * bytes are stored in the results array.</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordtype">void</span> Curl_ntlm_core_lm_resp(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *keys,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *plaintext,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *results)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  DES_key_schedule ks;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  setup_des_key(keys, DESKEY(ks));</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a>((DES_cblock*) plaintext, (DES_cblock*) results,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                  DESKEY(ks), DES_ENCRYPT);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  setup_des_key(keys + 7, DESKEY(ks));</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <a class="code" href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a>((DES_cblock*) plaintext, (DES_cblock*) (results + 8),</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                  DESKEY(ks), DES_ENCRYPT);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  setup_des_key(keys + 14, DESKEY(ks));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a>((DES_cblock*) plaintext, (DES_cblock*) (results + 16),</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                  DESKEY(ks), DES_ENCRYPT);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS_NETTLE)</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keyword">struct </span>des_ctx des;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  setup_des_key(keys, &amp;des);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  des_encrypt(&amp;des, 8, results, plaintext);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  setup_des_key(keys + 7, &amp;des);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  des_encrypt(&amp;des, 8, results + 8, plaintext);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  setup_des_key(keys + 14, &amp;des);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  des_encrypt(&amp;des, 8, results + 16, plaintext);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS)</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  gcry_cipher_hd_t des;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  gcry_cipher_open(&amp;des, GCRY_CIPHER_DES, GCRY_CIPHER_MODE_ECB, 0);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  setup_des_key(keys, &amp;des);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  gcry_cipher_encrypt(des, results, 8, plaintext, 8);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  gcry_cipher_close(des);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  gcry_cipher_open(&amp;des, GCRY_CIPHER_DES, GCRY_CIPHER_MODE_ECB, 0);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  setup_des_key(keys + 7, &amp;des);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  gcry_cipher_encrypt(des, results + 8, 8, plaintext, 8);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  gcry_cipher_close(des);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  gcry_cipher_open(&amp;des, GCRY_CIPHER_DES, GCRY_CIPHER_MODE_ECB, 0);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  setup_des_key(keys + 14, &amp;des);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  gcry_cipher_encrypt(des, results + 16, 8, plaintext, 8);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  gcry_cipher_close(des);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor">#elif defined(USE_NSS) || defined(USE_MBEDTLS) || defined(USE_DARWINSSL) \</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor">  || defined(USE_OS400CRYPTO) || defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  encrypt_des(plaintext, results, keys);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  encrypt_des(plaintext, results + 8, keys + 7);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  encrypt_des(plaintext, results + 16, keys + 14);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"> * Set up lanmanager hashed password</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ntlm_core_mk_lm_hash(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *password,</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *lmbuffer <span class="comment">/* 21 bytes */</span>)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pw[14];</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> magic[] = {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    0x4B, 0x47, 0x53, 0x21, 0x40, 0x23, 0x24, 0x25 <span class="comment">/* i.e. KGS!@#$% */</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  };</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = <a class="code" href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a>(strlen(password), 14);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="strcase_8c.html#af365bf4de48b867b59fce8d1e777af92">Curl_strntoupper</a>((<span class="keywordtype">char</span> *)pw, password, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;pw[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>], 0, 14 - <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">   * The LanManager hashed password needs to be created using the</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">   * password in the network encoding not the host encoding.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="non-ascii_8h.html#ab7de472e1367a01da556c8f5acad93bb">Curl_convert_to_network</a>(<a class="code" href="structdata.html">data</a>, (<span class="keywordtype">char</span> *)pw, 14);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">/* Create LanManager hashed password. */</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    DES_key_schedule ks;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    setup_des_key(pw, DESKEY(ks));</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a>((DES_cblock *)magic, (DES_cblock *)lmbuffer,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    DESKEY(ks), DES_ENCRYPT);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    setup_des_key(pw + 7, DESKEY(ks));</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a>((DES_cblock *)magic, (DES_cblock *)(lmbuffer + 8),</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    DESKEY(ks), DES_ENCRYPT);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS_NETTLE)</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">struct </span>des_ctx des;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    setup_des_key(pw, &amp;des);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    des_encrypt(&amp;des, 8, lmbuffer, magic);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    setup_des_key(pw + 7, &amp;des);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    des_encrypt(&amp;des, 8, lmbuffer + 8, magic);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS)</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    gcry_cipher_hd_t des;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    gcry_cipher_open(&amp;des, GCRY_CIPHER_DES, GCRY_CIPHER_MODE_ECB, 0);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    setup_des_key(pw, &amp;des);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    gcry_cipher_encrypt(des, lmbuffer, 8, magic, 8);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    gcry_cipher_close(des);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    gcry_cipher_open(&amp;des, GCRY_CIPHER_DES, GCRY_CIPHER_MODE_ECB, 0);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    setup_des_key(pw + 7, &amp;des);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    gcry_cipher_encrypt(des, lmbuffer + 8, 8, magic, 8);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    gcry_cipher_close(des);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#elif defined(USE_NSS) || defined(USE_MBEDTLS) || defined(USE_DARWINSSL) \</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">  || defined(USE_OS400CRYPTO) || defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    encrypt_des(magic, lmbuffer, pw);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    encrypt_des(magic, lmbuffer + 8, pw + 7);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(lmbuffer + 16, 0, 21 - 16);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">#ifdef USE_NTRESPONSES</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ascii_to_unicode_le(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dest, <span class="keyword">const</span> <span class="keywordtype">char</span> *src,</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                <span class="keywordtype">size_t</span> srclen)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; srclen; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    dest[2 * <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = (<span class="keywordtype">unsigned</span> char)src[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    dest[2 * <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;}</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#if defined(USE_NTLM_V2) &amp;&amp; !defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ascii_uppercase_to_unicode_le(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dest,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">size_t</span> srclen)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;{</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; srclen; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    dest[2 * <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = (<span class="keywordtype">unsigned</span> char)(<a class="code" href="strcase_8c.html#a555bbf5fd8dc146336474a2bb7959524">Curl_raw_toupper</a>(src[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]));</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    dest[2 * <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;}</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_NTLM_V2 &amp;&amp; !USE_WINDOWS_SSPI */</span><span class="preprocessor"></span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"> * Set up nt hashed passwords</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"> * @unittest: 1600</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ntlm_core_mk_nt_hash(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *password,</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ntbuffer <span class="comment">/* 21 bytes */</span>)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;{</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = strlen(password);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pw;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; <a class="code" href="curl__setup_8h.html#acfa3af56d5e0045c1d7a5682fd1d2853">SIZE_T_MAX</a>/2) <span class="comment">/* avoid integer overflow */</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  pw = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> ? <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> * 2) : <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span>(!pw)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  ascii_to_unicode_le(pw, password, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">   * The NT hashed password needs to be created using the password in the</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">   * network encoding not the host encoding.</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="non-ascii_8h.html#ab7de472e1367a01da556c8f5acad93bb">Curl_convert_to_network</a>(<a class="code" href="structdata.html">data</a>, (<span class="keywordtype">char</span> *)pw, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> * 2);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">/* Create NT hashed password. */</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    MD4_CTX MD4pw;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="setup-vms_8h.html#a3d3b07068bf318d9935bc5d62c61416b">MD4_Init</a>(&amp;MD4pw);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="setup-vms_8h.html#a2833b67fb76a3a1f5e9085dc6a2276b7">MD4_Update</a>(&amp;MD4pw, pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="setup-vms_8h.html#ac634d64690d9592f6e43168f3d167350">MD4_Final</a>(ntbuffer, &amp;MD4pw);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS_NETTLE)</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keyword">struct </span>md4_ctx MD4pw;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    md4_init(&amp;MD4pw);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    md4_update(&amp;MD4pw, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>), pw);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    md4_digest(&amp;MD4pw, MD4_DIGEST_SIZE, ntbuffer);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#elif defined(USE_GNUTLS)</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    gcry_md_hd_t MD4pw;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    gcry_md_open(&amp;MD4pw, GCRY_MD_MD4, 0);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    gcry_md_write(MD4pw, pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(ntbuffer, gcry_md_read(MD4pw, 0), MD4_DIGEST_LENGTH);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    gcry_md_close(MD4pw);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#elif defined(USE_NSS)</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    Curl_md4it(ntbuffer, pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#elif defined(USE_MBEDTLS)</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_MD4_C)</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    mbedtls_md4(pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, ntbuffer);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    Curl_md4it(ntbuffer, pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#elif defined(USE_DARWINSSL)</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    (void)CC_MD4(pw, (CC_LONG)(2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>), ntbuffer);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor">#elif defined(USE_OS400CRYPTO)</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    Curl_md4it(ntbuffer, pw, 2 * <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#elif defined(USE_WIN32_CRYPTO)</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    HCRYPTPROV hprov;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span>(CryptAcquireContext(&amp;hprov, NULL, NULL, PROV_RSA_FULL,</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                           CRYPT_VERIFYCONTEXT)) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      HCRYPTHASH hhash;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">if</span>(CryptCreateHash(hprov, CALG_MD4, 0, 0, &amp;hhash)) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        DWORD length = 16;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        CryptHashData(hhash, pw, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> * 2, 0);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        CryptGetHashParam(hhash, HP_HASHVAL, ntbuffer, &amp;length, 0);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        CryptDestroyHash(hhash);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      CryptReleaseContext(hprov, 0);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(ntbuffer + 16, 0, 21 - 16);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(pw);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#if defined(USE_NTLM_V2) &amp;&amp; !defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">/* This returns the HMAC MD5 digest */</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_hmac_md5(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keylen,</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structdata.html">data</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datalen,</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="struct_h_m_a_c__context.html">HMAC_context</a> *ctxt = <a class="code" href="curl__hmac_8h.html#a3548c207f321af6c3058756525b96a2e">Curl_HMAC_init</a>(<a class="code" href="curl__md5_8h.html#a0456a99323ab3735aeb7ed54048b451d">Curl_HMAC_MD5</a>, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, keylen);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span>(!ctxt)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">/* Update the digest with the given challenge */</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="curl__hmac_8h.html#a43c67b4993b41baf668176a129e508d2">Curl_HMAC_update</a>(ctxt, <a class="code" href="structdata.html">data</a>, datalen);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="comment">/* Finalise the digest */</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <a class="code" href="curl__hmac_8h.html#a8e5090f9cf3bb68ef07cdd2f80d51c08">Curl_HMAC_final</a>(ctxt, <a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">/* This creates the NTLMv2 hash by using NTLM hash as the key and Unicode</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"> * (uppercase UserName + Domain) as the data</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ntlm_core_mk_ntlmv2_hash(<span class="keyword">const</span> <span class="keywordtype">char</span> *user, <span class="keywordtype">size_t</span> userlen,</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mail-rcpt_8d.html#a2bf47710f7123dd01376c838ea4c5eb4">domain</a>, <span class="keywordtype">size_t</span> domlen,</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ntlmhash,</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ntlmv2hash)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;{</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">/* Unicode representation */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordtype">size_t</span> identity_len;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *identity;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">/* we do the length checks below separately to avoid integer overflow risk</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">     on extreme data lengths */</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">if</span>((userlen &gt; <a class="code" href="curl__setup_8h.html#acfa3af56d5e0045c1d7a5682fd1d2853">SIZE_T_MAX</a>/2) ||</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;     (domlen &gt; <a class="code" href="curl__setup_8h.html#acfa3af56d5e0045c1d7a5682fd1d2853">SIZE_T_MAX</a>/2) ||</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;     ((userlen + domlen) &gt; <a class="code" href="curl__setup_8h.html#acfa3af56d5e0045c1d7a5682fd1d2853">SIZE_T_MAX</a>/2))</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  identity_len = (userlen + domlen) * 2;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  identity = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(identity_len);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">if</span>(!identity)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  ascii_uppercase_to_unicode_le(identity, user, userlen);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  ascii_to_unicode_le(identity + (userlen &lt;&lt; 1), <a class="code" href="mail-rcpt_8d.html#a2bf47710f7123dd01376c838ea4c5eb4">domain</a>, domlen);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_hmac_md5(ntlmhash, 16, identity, <a class="code" href="warnless_8c.html#a20955df32ae739bf660266410d9e6526">curlx_uztoui</a>(identity_len),</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                         ntlmv2hash);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(identity);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment"> * Curl_ntlm_core_mk_ntlmv2_resp()</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"> * This creates the NTLMv2 response as set in the ntlm type-3 message.</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment"> * Parameters:</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment"> * ntlmv2hash       [in] - The ntlmv2 hash (16 bytes)</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment"> * challenge_client [in] - The client nonce (8 bytes)</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment"> * ntlm             [in] - The ntlm data struct being used to read TargetInfo</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">                           and Server challenge received in the type-2 message</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment"> * ntresp          [out] - The address where a pointer to newly allocated</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment"> *                         memory holding the NTLMv2 response.</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment"> * ntresp_len      [out] - The length of the output message.</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment"> * Returns CURLE_OK on success.</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ntlm_core_mk_ntlmv2_resp(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ntlmv2hash,</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *challenge_client,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                       <span class="keyword">struct</span> ntlmdata *<a class="code" href="anyauth_8d.html#a5d6dba6daaf229c755e2e3d07bcecfa4">ntlm</a>,</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **ntresp,</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ntresp_len)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;{</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">/* NTLMv2 response structure :</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">------------------------------------------------------------------------------</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">0     HMAC MD5         16 bytes</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">------BLOB--------------------------------------------------------------------</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">16    Signature        0x01010000</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">20    Reserved         long (0x00000000)</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">24    Timestamp        LE, 64-bit signed value representing the number of</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">                       tenths of a microsecond since January 1, 1601.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">32    Client Nonce     8 bytes</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">40    Unknown          4 bytes</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">44    Target Info      N bytes (from the type-2 message)</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">44+N  Unknown          4 bytes</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">------------------------------------------------------------------------------</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = NULL;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hmac_output[NTLM_HMAC_MD5_LEN];</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> tw;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#if CURL_SIZEOF_CURL_OFF_T &lt; 8</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">#error &quot;this section needs 64bit support to work&quot;</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">/* Calculate the timestamp */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="preprocessor">#ifdef DEBUGBUILD</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordtype">char</span> *force_timestamp = <a class="code" href="setup-vms_8h.html#aafc8c101dfb6313ab0416a6c5903ce66">getenv</a>(<span class="stringliteral">&quot;CURL_FORCETIME&quot;</span>);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordflow">if</span>(force_timestamp)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    tw = <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a5c5d338cf3f0e585ed739b384f2a2a6e">CURL_OFF_T_C</a>(11644473600) * 10000000;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    tw = ((<a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a>)<a class="code" href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a>(NULL) + <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a5c5d338cf3f0e585ed739b384f2a2a6e">CURL_OFF_T_C</a>(11644473600)) * 10000000;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="comment">/* Calculate the response len */</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = NTLM_HMAC_MD5_LEN + NTLMv2_BLOB_LEN;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">/* Allocate the response */</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">/* Create the BLOB structure */</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>((<span class="keywordtype">char</span> *)<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + NTLM_HMAC_MD5_LEN, NTLMv2_BLOB_LEN,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="stringliteral">&quot;%c%c%c%c&quot;</span>   <span class="comment">/* NTLMv2_BLOB_SIGNATURE */</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="stringliteral">&quot;%c%c%c%c&quot;</span>,  <span class="comment">/* Reserved = 0 */</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            NTLMv2_BLOB_SIGNATURE[0], NTLMv2_BLOB_SIGNATURE[1],</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            NTLMv2_BLOB_SIGNATURE[2], NTLMv2_BLOB_SIGNATURE[3],</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            0, 0, 0, 0);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  Curl_write64_le(tw, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 24);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 32, challenge_client, 8);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 44, <a class="code" href="anyauth_8d.html#a5d6dba6daaf229c755e2e3d07bcecfa4">ntlm</a>-&gt;target_info, <a class="code" href="anyauth_8d.html#a5d6dba6daaf229c755e2e3d07bcecfa4">ntlm</a>-&gt;target_info_len);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">/* Concatenate the Type 2 challenge with the BLOB and do HMAC MD5 */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 8, &amp;<a class="code" href="anyauth_8d.html#a5d6dba6daaf229c755e2e3d07bcecfa4">ntlm</a>-&gt;nonce[0], 8);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_hmac_md5(ntlmv2hash, NTLM_HMAC_MD5_LEN, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 8,</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                         NTLMv2_BLOB_LEN + 8, hmac_output);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">/* Concatenate the HMAC MD5 output  with the BLOB */</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, hmac_output, NTLM_HMAC_MD5_LEN);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="comment">/* Return the response */</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  *ntresp = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  *ntresp_len = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;}</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment"> * Curl_ntlm_core_mk_lmv2_resp()</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment"> * This creates the LMv2 response as used in the ntlm type-3 message.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment"> * Parameters:</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment"> * ntlmv2hash        [in] - The ntlmv2 hash (16 bytes)</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment"> * challenge_client  [in] - The client nonce (8 bytes)</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment"> * challenge_client  [in] - The server challenge (8 bytes)</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment"> * lmresp           [out] - The LMv2 response (24 bytes)</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment"> * Returns CURLE_OK on success.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a>  Curl_ntlm_core_mk_lmv2_resp(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ntlmv2hash,</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *challenge_client,</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *challenge_server,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *lmresp)</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;{</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structdata.html">data</a>[16];</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hmac_output[16];</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="structdata.html">data</a>[0], challenge_server, 8);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="structdata.html">data</a>[8], challenge_client, 8);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_hmac_md5(ntlmv2hash, 16, &amp;<a class="code" href="structdata.html">data</a>[0], 16, hmac_output);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">/* Concatenate the HMAC MD5 output  with the client nonce */</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(lmresp, hmac_output, 16);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(lmresp + 16, challenge_client, 8);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;}</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_NTLM_V2 &amp;&amp; !USE_WINDOWS_SSPI */</span><span class="preprocessor"></span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_NTRESPONSES */</span><span class="preprocessor"></span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !USE_WINDOWS_SSPI || USE_WIN32_CRYPTO */</span><span class="preprocessor"></span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_NTLM */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aafc8c101dfb6313ab0416a6c5903ce66"><div class="ttname"><a href="setup-vms_8h.html#aafc8c101dfb6313ab0416a6c5903ce66">getenv</a></div><div class="ttdeci">#define getenv</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00052">setup-vms.h:52</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="curl__hmac_8h_html"><div class="ttname"><a href="curl__hmac_8h.html">curl_hmac.h</a></div></div>
<div class="ttc" id="curl__md5_8h_html_a0456a99323ab3735aeb7ed54048b451d"><div class="ttname"><a href="curl__md5_8h.html#a0456a99323ab3735aeb7ed54048b451d">Curl_HMAC_MD5</a></div><div class="ttdeci">const HMAC_params Curl_HMAC_MD5[1]</div><div class="ttdef"><b>Definition:</b> <a href="md5_8c_source.html#l00480">md5.c:480</a></div></div>
<div class="ttc" id="_sample_h_i_d_keyboard_8cpp_html_a3baed8fd316b19ffc4765639221cf225"><div class="ttname"><a href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a></div><div class="ttdeci">BLECharacteristic * output</div><div class="ttdef"><b>Definition:</b> <a href="_sample_h_i_d_keyboard_8cpp_source.html#l00020">SampleHIDKeyboard.cpp:20</a></div></div>
<div class="ttc" id="retry-max-time_8d_html_a612021c6b1f447b49053406818ef4ee6"><div class="ttname"><a href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a></div><div class="ttdeci">Long the request will be made and while it may take longer than this given time period.To limit a single request s maximum time</div><div class="ttdef"><b>Definition:</b> <a href="retry-max-time_8d_source.html#l00008">retry-max-time.d:8</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a5c5d338cf3f0e585ed739b384f2a2a6e"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a5c5d338cf3f0e585ed739b384f2a2a6e">CURL_OFF_T_C</a></div><div class="ttdeci">#define CURL_OFF_T_C(Val)</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00489">system.h:489</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a5d96084a50f1a9c6c335707b2c71cc1b"><div class="ttname"><a href="setup-vms_8h.html#a5d96084a50f1a9c6c335707b2c71cc1b">DES_set_key</a></div><div class="ttdeci">#define DES_set_key</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00221">setup-vms.h:221</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="curl__hmac_8h_html_a8e5090f9cf3bb68ef07cdd2f80d51c08"><div class="ttname"><a href="curl__hmac_8h.html#a8e5090f9cf3bb68ef07cdd2f80d51c08">Curl_HMAC_final</a></div><div class="ttdeci">int Curl_HMAC_final(HMAC_context *context, unsigned char *result)</div><div class="ttdef"><b>Definition:</b> <a href="hmac_8c_source.html#l00113">hmac.c:113</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a5c151556dcd168f298e3b5efb0579418"><div class="ttname"><a href="setup-vms_8h.html#a5c151556dcd168f298e3b5efb0579418">DES_ecb_encrypt</a></div><div class="ttdeci">#define DES_ecb_encrypt</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00220">setup-vms.h:220</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a3071e688ccca88778282efa98e5a5a1f"><div class="ttname"><a href="setup-vms_8h.html#a3071e688ccca88778282efa98e5a5a1f">DES_set_odd_parity</a></div><div class="ttdeci">#define DES_set_odd_parity</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00222">setup-vms.h:222</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a494e2b4279dc064f7ed1d0abd602b28d"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_OFF_T curl_off_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00442">system.h:442</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="strcase_8c_html_af365bf4de48b867b59fce8d1e777af92"><div class="ttname"><a href="strcase_8c.html#af365bf4de48b867b59fce8d1e777af92">Curl_strntoupper</a></div><div class="ttdeci">void Curl_strntoupper(char *dest, const char *src, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8c_source.html#l00158">strcase.c:158</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="curl__md4_8h_html"><div class="ttname"><a href="curl__md4_8h.html">curl_md4.h</a></div></div>
<div class="ttc" id="curl__setup_8h_html_a5dd6efb91a5151f2bb4e4fff1b386582"><div class="ttname"><a href="curl__setup_8h.html#a5dd6efb91a5151f2bb4e4fff1b386582">CURLMIN</a></div><div class="ttdeci">#define CURLMIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00810">curl_setup.h:810</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="curl__md5_8h_html"><div class="ttname"><a href="curl__md5_8h.html">curl_md5.h</a></div></div>
<div class="ttc" id="curl__hmac_8h_html_a43c67b4993b41baf668176a129e508d2"><div class="ttname"><a href="curl__hmac_8h.html#a43c67b4993b41baf668176a129e508d2">Curl_HMAC_update</a></div><div class="ttdeci">int Curl_HMAC_update(HMAC_context *context, const unsigned char *data, unsigned int len)</div><div class="ttdef"><b>Definition:</b> <a href="hmac_8c_source.html#l00103">hmac.c:103</a></div></div>
<div class="ttc" id="non-ascii_8h_html_ab7de472e1367a01da556c8f5acad93bb"><div class="ttname"><a href="non-ascii_8h.html#ab7de472e1367a01da556c8f5acad93bb">Curl_convert_to_network</a></div><div class="ttdeci">#define Curl_convert_to_network(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="non-ascii_8h_source.html#l00056">non-ascii.h:56</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a2833b67fb76a3a1f5e9085dc6a2276b7"><div class="ttname"><a href="setup-vms_8h.html#a2833b67fb76a3a1f5e9085dc6a2276b7">MD4_Update</a></div><div class="ttdeci">#define MD4_Update</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00248">setup-vms.h:248</a></div></div>
<div class="ttc" id="warnless_8c_html_a20955df32ae739bf660266410d9e6526"><div class="ttname"><a href="warnless_8c.html#a20955df32ae739bf660266410d9e6526">curlx_uztoui</a></div><div class="ttdeci">unsigned int curlx_uztoui(size_t uznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00243">warnless.c:243</a></div></div>
<div class="ttc" id="fail-early_8d_html_a2b978ebca1e6cb7fcbcb9a6b51701ce3"><div class="ttname"><a href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply fail</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="mail-rcpt_8d_html_a2bf47710f7123dd01376c838ea4c5eb4"><div class="ttname"><a href="mail-rcpt_8d.html#a2bf47710f7123dd01376c838ea4c5eb4">domain</a></div><div class="ttdeci">Long user name or mailing list name.Repeat this option several times to send to multiple recipients.When performing a mail the recipient should specify a valid email address to send the mail to.When performing an address the recipient should be specified as the user name or user name and domain(as per Section 3.5 of RFC5321).(Added in 7.34.0) When performing a mailing list expand(EXPN command)</div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="curl__endian_8h_html"><div class="ttname"><a href="curl__endian_8h.html">curl_endian.h</a></div></div>
<div class="ttc" id="unit1652_8c_html_a1d19b0eef3b3acd31be88886a0277c2e"><div class="ttname"><a href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a></div><div class="ttdeci">memset(input, '\0', sizeof(input))</div></div>
<div class="ttc" id="anyauth_8d_html_a5d6dba6daaf229c755e2e3d07bcecfa4"><div class="ttname"><a href="anyauth_8d.html#a5d6dba6daaf229c755e2e3d07bcecfa4">ntlm</a></div><div class="ttdeci">Long and use the most secure one the remote site claims to support.This is done by first doing a request and checking the response thus possibly inducing an extra network round trip.This is used instead of setting a specific authentication which you can do with ntlm</div><div class="ttdef"><b>Definition:</b> <a href="anyauth_8d_source.html#l00006">anyauth.d:6</a></div></div>
<div class="ttc" id="non-ascii_8h_html"><div class="ttname"><a href="non-ascii_8h.html">non-ascii.h</a></div></div>
<div class="ttc" id="curl__ntlm__core_8h_html"><div class="ttname"><a href="curl__ntlm__core_8h.html">curl_ntlm_core.h</a></div></div>
<div class="ttc" id="struct_h_m_a_c__context_html"><div class="ttname"><a href="struct_h_m_a_c__context.html">HMAC_context</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__hmac_8h_source.html#l00048">curl_hmac.h:48</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="curl__hmac_8h_html_a3548c207f321af6c3058756525b96a2e"><div class="ttname"><a href="curl__hmac_8h.html#a3548c207f321af6c3058756525b96a2e">Curl_HMAC_init</a></div><div class="ttdeci">HMAC_context * Curl_HMAC_init(const HMAC_params *hashparams, const unsigned char *key, unsigned int keylen)</div><div class="ttdef"><b>Definition:</b> <a href="hmac_8c_source.html#l00051">hmac.c:51</a></div></div>
<div class="ttc" id="header_8d_html_af039c1a4bf9f7d5ffdd981d66cd3fb2d"><div class="ttname"><a href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a></div><div class="ttdeci">Long your externally set header will be used instead of the one.This allows you to make even trickier stuff than curl would normally do.You should not replace internally set headers without knowing perfectly well what you re doing.Remove an header by giving a replacement without content on the right side of the as in</div><div class="ttdef"><b>Definition:</b> <a href="header_8d_source.html#l00009">header.d:9</a></div></div>
<div class="ttc" id="curl__setup_8h_html_acfa3af56d5e0045c1d7a5682fd1d2853"><div class="ttname"><a href="curl__setup_8h.html#acfa3af56d5e0045c1d7a5682fd1d2853">SIZE_T_MAX</a></div><div class="ttdeci">#define SIZE_T_MAX</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00459">curl_setup.h:459</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ac634d64690d9592f6e43168f3d167350"><div class="ttname"><a href="setup-vms_8h.html#ac634d64690d9592f6e43168f3d167350">MD4_Final</a></div><div class="ttdeci">#define MD4_Final</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00246">setup-vms.h:246</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a3d3b07068bf318d9935bc5d62c61416b"><div class="ttname"><a href="setup-vms_8h.html#a3d3b07068bf318d9935bc5d62c61416b">MD4_Init</a></div><div class="ttdeci">#define MD4_Init</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00247">setup-vms.h:247</a></div></div>
<div class="ttc" id="curl__des_8h_html"><div class="ttname"><a href="curl__des_8h.html">curl_des.h</a></div></div>
<div class="ttc" id="strcase_8c_html_a555bbf5fd8dc146336474a2bb7959524"><div class="ttname"><a href="strcase_8c.html#a555bbf5fd8dc146336474a2bb7959524">Curl_raw_toupper</a></div><div class="ttdeci">char Curl_raw_toupper(char in)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8c_source.html#l00031">strcase.c:31</a></div></div>
<div class="ttc" id="unit1602_8c_html_a35af0be900467fedbb610bd6ea65ed78"><div class="ttname"><a href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a></div><div class="ttdeci">int key</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00056">unit1602.c:56</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="curl__ntlm__core_8c.html">curl_ntlm_core.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
