<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/hostip.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('hostip_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">hostip.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="hostip_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN6_H</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;netinet/in6.h&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifdef __VMS</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;in.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;inet.h&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#ifdef HAVE_SETJMP_H</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;setjmp.h&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL_H</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#ifdef HAVE_PROCESS_H</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &lt;process.h&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hostip_8h.html">hostip.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash_8h.html">hash.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rand_8h.html">rand.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="share_8h.html">share.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strerror_8h.html">strerror.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="url_8h.html">url.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__ntop_8h.html">inet_ntop.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="multiif_8h.html">multiif.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="doh_8h.html">doh.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#if defined(CURLRES_SYNCH) &amp;&amp; \</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">    defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM) &amp;&amp; defined(HAVE_SIGSETJMP)</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/* alarm-based timeouts can only be used with all the dependencies satisfied */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#define USE_ALARM_TIMEOUT</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> * hostip.c explained</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * ==================</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> * The main COMPILE-TIME DEFINES to keep in mind when reading the host*.c</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * source file are these:</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> * CURLRES_IPV6 - this host has getaddrinfo() and family, and thus we use</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * that. The host may not be able to resolve IPv6, but we don&#39;t really have to</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * take that into account. Hosts that aren&#39;t IPv6-enabled have CURLRES_IPV4</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * defined.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> * CURLRES_ARES - is defined if libcurl is built to use c-ares for</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * asynchronous name resolves. This can be Windows or *nix.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> * CURLRES_THREADED - is defined if libcurl is built to run under (native)</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * Windows, and then the name resolve will be done in a new thread, and the</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> * supported API will be the same as for ares-builds.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * If any of the two previous are defined, CURLRES_ASYNCH is defined too. If</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> * libcurl is not built to use an asynchronous resolver, CURLRES_SYNCH is</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> * defined.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> * The host*.c sources files are split up like this:</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> * hostip.c   - method-independent resolver functions and utility functions</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> * hostasyn.c - functions for asynchronous name resolves</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> * hostsyn.c  - functions for synchronous name resolves</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> * hostip4.c  - IPv4 specific functions</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> * hostip6.c  - IPv6 specific functions</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> * The two asynchronous name resolver backends are implemented in:</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * asyn-ares.c   - functions for ares-using name resolves</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * asyn-thread.c - functions for threaded name resolves</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> * The hostip.h is the united header file for all this. It defines the</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> * CURLRES_* defines based on the config*.h and curl_setup.h defines.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/* These two symbols are for the global DNS cache */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcurl__hash.html">curl_hash</a> hostname_cache;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> host_cache_initialized;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> freednsentry(<span class="keywordtype">void</span> *freethis);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> * Curl_global_host_cache_init() initializes and sets up a global DNS cache.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> * Global DNS cache is general badness. Do not use. This will be removed in</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> * a future version. Use the share interface instead!</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> * Returns a struct curl_hash pointer on success, NULL on failure.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="hostip_8h.html#ab2142b86e9e89284e1e8aa9c35488f24">  128</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcurl__hash.html">curl_hash</a> *<a class="code" href="hostip_8c.html#ab2142b86e9e89284e1e8aa9c35488f24">Curl_global_host_cache_init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = 0;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span>(!host_cache_initialized) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hash_8c.html#ad6fcf4d87ffe2648f214142d0288c8ee">Curl_hash_init</a>(&amp;hostname_cache, 7, <a class="code" href="hash_8c.html#ad03fbf647c1fe1cdd72ccc7a131ce680">Curl_hash_str</a>,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                        <a class="code" href="hash_8c.html#ab260dae4821964f2ea9816ca48939ac8">Curl_str_key_compare</a>, freednsentry);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      host_cache_initialized = 1;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>?NULL:&amp;hostname_cache;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> * Destroy and cleanup the global DNS cache</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="hostip_8h.html#a27f562d6b6399ed1dacb6dbc558f6d8e">  143</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="hostip_8c.html#a27f562d6b6399ed1dacb6dbc558f6d8e">Curl_global_host_cache_dtor</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span>(host_cache_initialized) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="hash_8c.html#a7e58db026000cd72601150793facbbdc">Curl_hash_destroy</a>(&amp;hostname_cache);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    host_cache_initialized = 0;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"> * Return # of addresses in a Curl_addrinfo struct</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="hostip_8h.html#ab7639aa864d22a73abf903210b551a4d">  154</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="hostip_8c.html#ab7639aa864d22a73abf903210b551a4d">Curl_num_addresses</a>(<span class="keyword">const</span> <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *addr)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">while</span>(addr) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    addr = addr-&gt;<a class="code" href="struct_curl__addrinfo.html#a871199ad1750edcfa4c642c74cb8ccd8">ai_next</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"> * Curl_printable_address() returns a printable version of the 1st address</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"> * given in the &#39;ai&#39; argument. The result will be stored in the buf that is</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> * bufsize bytes big.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> * If the conversion fails, it returns NULL.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="hostip_8h.html#ad08baba1107acf6481f3cd5db37f93c8">  172</a></span>&#160;<a class="code" href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a>(<span class="keyword">const</span> <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *ai, <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> bufsize)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr_in *sa4;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span>in_addr *ipaddr4;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr_in6 *sa6;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span>in6_addr *ipaddr6;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">switch</span>(ai-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a>) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      sa4 = (<span class="keyword">const</span> <span class="keywordtype">void</span> *)ai-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      ipaddr4 = &amp;sa4-&gt;sin_addr;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a>(ai-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a>, (<span class="keyword">const</span> <span class="keywordtype">void</span> *)ipaddr4, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                            bufsize);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      sa6 = (<span class="keyword">const</span> <span class="keywordtype">void</span> *)ai-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      ipaddr6 = &amp;sa6-&gt;sin6_addr;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a>(ai-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a>, (<span class="keyword">const</span> <span class="keywordtype">void</span> *)ipaddr6, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                            bufsize);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> * Return a hostcache id string for the provided host + port, to be used by</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"> * the DNS caching.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;create_hostcache_id(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="keywordtype">int</span> port)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">/* create and return the new allocated entry */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s:%d&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, port);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = id;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">/* lower case the name part */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; (*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;:&#39;</span>)) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = (char)<a class="code" href="curl__setup__once_8h.html#a50cf1998cd442f5d41df925e184fd841">TOLOWER</a>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">return</span> id;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="structhostcache__prune__data.html">  220</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhostcache__prune__data.html">hostcache_prune_data</a> {</div><div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="structhostcache__prune__data.html#a16bc4d24f4c0ac5d894a10cb23404356">  221</a></span>&#160;  <span class="keywordtype">long</span> <a class="code" href="structhostcache__prune__data.html#a16bc4d24f4c0ac5d894a10cb23404356">cache_timeout</a>;</div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="structhostcache__prune__data.html#ab8729b8c098744d69f3b33a4e4dcdd95">  222</a></span>&#160;  time_t <a class="code" href="structhostcache__prune__data.html#ab8729b8c098744d69f3b33a4e4dcdd95">now</a>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;};</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"> * This function is set as a callback to be called for every entry in the DNS</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"> * cache when we want to prune old unused entries.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> * Returning non-zero means remove the entry, return 0 to keep it in the</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> * cache.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;hostcache_timestamp_remove(<span class="keywordtype">void</span> *datap, <span class="keywordtype">void</span> *hc)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;{</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhostcache__prune__data.html">hostcache_prune_data</a> *<a class="code" href="structdata.html">data</a> =</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    (<span class="keyword">struct </span><a class="code" href="structhostcache__prune__data.html">hostcache_prune_data</a> *) datap;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *c = (<span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *) hc;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">return</span> (0 != c-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a>)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    &amp;&amp; (<a class="code" href="structdata.html">data</a>-&gt;now - c-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a> &gt;= <a class="code" href="structdata.html">data</a>-&gt;cache_timeout);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"> * Prune the DNS cache. This assumes that a lock has already been taken.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;hostcache_prune(<span class="keyword">struct</span> <a class="code" href="structcurl__hash.html">curl_hash</a> *hostcache, <span class="keywordtype">long</span> cache_timeout, time_t <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;{</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhostcache__prune__data.html">hostcache_prune_data</a> user;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  user.<a class="code" href="structhostcache__prune__data.html#a16bc4d24f4c0ac5d894a10cb23404356">cache_timeout</a> = <a class="code" href="structhostcache__prune__data.html#a16bc4d24f4c0ac5d894a10cb23404356">cache_timeout</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  user.now = <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <a class="code" href="hash_8c.html#a314c4725d597b408ed695e4b8548b0db">Curl_hash_clean_with_criterium</a>(hostcache,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                 (<span class="keywordtype">void</span> *) &amp;user,</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                 hostcache_timestamp_remove);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"> * Library-wide function for pruning the DNS cache. This function takes and</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> * returns the appropriate locks.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00263"></a><span class="lineno"><a class="line" href="hostip_8h.html#a77525441d6420606360f8430fa9c15ea">  263</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="hostip_8c.html#a77525441d6420606360f8430fa9c15ea">Curl_hostcache_prune</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  time_t <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="structdata.html">data</a>-&gt;set.dns_cache_timeout == -1) || !<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">/* cache forever means never prune, and NULL hostcache means</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">       we can&#39;t do it */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a>(&amp;<a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">/* Remove outdated and unused entries from the hostcache */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  hostcache_prune(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                  <a class="code" href="structdata.html">data</a>-&gt;set.dns_cache_timeout,</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                  <a class="code" href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGSETJMP</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">/* Beware this is a global and unique instance. This is used to store the</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">   return address that we can jump back to from inside a signal handler. This</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">   is not thread-safe stuff. */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;sigjmp_buf curl_jmpenv;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">/* lookup address, returns entry if found and not stale */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;fetch_addr(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="keywordtype">int</span> port)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">char</span> *entry_id = NULL;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns = NULL;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">size_t</span> entry_len;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">/* Create an entry id, based upon the hostname and port */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  entry_id = create_hostcache_id(<a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">/* If we can&#39;t create the entry id, fail */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span>(!entry_id)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  entry_len = strlen(entry_id);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">/* See if its already in our dns cache */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a> = <a class="code" href="hash_8c.html#a36789eb2833288dbbdd77d0317132131">Curl_hash_pick</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a> &amp;&amp; (<a class="code" href="structdata.html">data</a>-&gt;set.dns_cache_timeout != -1)) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">/* See whether the returned entry is stale. Done before we release lock */</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhostcache__prune__data.html">hostcache_prune_data</a> user;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a>(&amp;user.now);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    user.cache_timeout = <a class="code" href="structdata.html">data</a>-&gt;set.dns_cache_timeout;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span>(hostcache_timestamp_remove(&amp;user, dns)) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Hostname in DNS cache was stale, zapped\n&quot;</span>);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      dns = NULL; <span class="comment">/* the memory deallocation is being handled by the hash */</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <a class="code" href="hash_8c.html#a1b249bccd7f3b079b31a4254444538d5">Curl_hash_delete</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">/* free the allocated entry_id again */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">return</span> dns;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> * Curl_fetch_addr() fetches a &#39;Curl_dns_entry&#39; already in the DNS cache.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> * Curl_resolv() checks initially and multi_runsingle() checks each time</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> * it discovers the handle in the state WAITRESOLVE whether the hostname</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"> * has already been resolved and the address has already been stored in</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"> * the DNS cache. This short circuits waiting for a lot of pending</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment"> * lookups for the same hostname requested by different handles.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> * Returns the Curl_dns_entry entry pointer or NULL if not in the cache.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"> * The returned data *MUST* be &quot;unlocked&quot; with Curl_resolv_unlock() after</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"> * use, or we&#39;ll leak memory!</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *</div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="hostip_8h.html#a34d32d704f4d0ac5b0eed2ced2c88fba">  350</a></span>&#160;<a class="code" href="hostip_8c.html#a34d32d704f4d0ac5b0eed2ced2c88fba">Curl_fetch_addr</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                <span class="keywordtype">int</span> port)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns = NULL;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  dns = fetch_addr(conn, <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">if</span>(dns)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a>++; <span class="comment">/* we use it! */</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">return</span> dns;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * Curl_shuffle_addr() shuffles the order of addresses in a &#39;Curl_addrinfo&#39;</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> * struct by re-linking its linked list.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> * The addr argument should be the address of a pointer to the head node of a</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> * `Curl_addrinfo` list and it will be modified to point to the new head after</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> * shuffling.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"> * Not declared static only to make it easy to use in a unit test!</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> * @unittest: 1608</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="hostip_8h.html#a74a4bac819e867581bb87a476a3a5e4f">  383</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="hostip_8c.html#a74a4bac819e867581bb87a476a3a5e4f">Curl_shuffle_addr</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>, <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> **<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;{</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_addrs = <a class="code" href="hostip_8c.html#ab7639aa864d22a73abf903210b551a4d">Curl_num_addresses</a>(*<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">if</span>(num_addrs &gt; 1) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> **<a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Shuffling %i addresses&quot;</span>, num_addrs);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a> = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(num_addrs*<span class="keyword">sizeof</span>(*<a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>));</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rnd;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">size_t</span> rnd_size = num_addrs * <span class="keyword">sizeof</span>(*rnd);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="comment">/* build a plain array of Curl_addrinfo pointers */</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[0] = *<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; num_addrs; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-1]-&gt;ai_next;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      rnd = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(rnd_size);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">if</span>(rnd) {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="comment">/* Fisher-Yates shuffle */</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="rand_8c.html#a4af2eb5937000b1ce673ac32d79e48d9">Curl_rand</a>(<a class="code" href="structdata.html">data</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)rnd, rnd_size) == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *swap_tmp;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = num_addrs - 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt; 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>--) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            swap_tmp = <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[rnd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] % (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1)];</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[rnd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] % (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1)] = <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = swap_tmp;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          <span class="comment">/* relink list in the new order */</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; num_addrs; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-1]-&gt;ai_next = <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[num_addrs-1]-&gt;ai_next = NULL;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          *<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> = <a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>[0];</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(rnd);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;}</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> * Curl_cache_addr() stores a &#39;Curl_addrinfo&#39; struct in the DNS cache.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> * When calling Curl_resolv() has resulted in a response with a returned</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> * address, we call this function to store the information in the dns</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> * cache etc</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> * Returns the Curl_dns_entry entry pointer or NULL if the storage failed.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *</div><div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="hostip_8h.html#afab64c7c46db37643d596002f4a0c825">  445</a></span>&#160;<a class="code" href="hostip_8c.html#afab64c7c46db37643d596002f4a0c825">Curl_cache_addr</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>,</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="keywordtype">int</span> port)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;{</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">char</span> *entry_id;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">size_t</span> entry_len;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns2;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">/* shuffle addresses if requested */</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.dns_shuffle_addresses) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="hostip_8c.html#a74a4bac819e867581bb87a476a3a5e4f">Curl_shuffle_addr</a>(<a class="code" href="structdata.html">data</a>, &amp;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">/* Create an entry id, based upon the hostname and port */</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  entry_id = create_hostcache_id(<a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">/* If we can&#39;t create the entry id, fail */</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">if</span>(!entry_id)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  entry_len = strlen(entry_id);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">/* Create a new cache entry */</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  dns = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a>));</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span>(!dns) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a> = 1;   <span class="comment">/* the cache has the first reference */</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a> = <a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>; <span class="comment">/* this is the address(es) */</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a>(&amp;dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a>);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span>(dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a> == 0)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a> = 1;   <span class="comment">/* zero indicates CURLOPT_RESOLVE entry */</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">/* Store the resolved data in our DNS cache. */</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  dns2 = <a class="code" href="hash_8c.html#a79767eb92ddbebaedaee7c568b8bf4bd">Curl_hash_add</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1,</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                       (<span class="keywordtype">void</span> *)dns);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span>(!dns2) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(dns);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  dns = dns2;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a>++;         <span class="comment">/* mark entry as in-use */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">/* free the allocated entry_id */</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> dns;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"> * Curl_resolv() is the main name resolve function within libcurl. It resolves</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment"> * a name and returns a pointer to the entry in the &#39;entry&#39; argument (if one</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"> * is provided). This function might return immediately if we&#39;re using asynch</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"> * resolves. See the return codes.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> * The cache entry we return will get its &#39;inuse&#39; counter increased when this</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> * function is used. You MUST call Curl_resolv_unlock() later (when you&#39;re</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"> * done using this struct) to decrease the counter again.</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment"> * In debug mode, we specifically test for an interface name &quot;LocalHost&quot;</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment"> * and resolve &quot;localhost&quot; instead as a means to permit test cases</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment"> * to connect to a local test server with any host name.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment"> * Return codes:</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment"> * CURLRESOLV_ERROR   (-1) = error, no pointer</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"> * CURLRESOLV_RESOLVED (0) = OK, pointer provided</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment"> * CURLRESOLV_PENDING  (1) = waiting for response, no pointer</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="hostip_8h.html#a0880c7f4a8ce1a7698915f0bab575dc6">  521</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="keywordtype">int</span> port,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="keyword">struct</span> <a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> **entry)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns = NULL;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>; <span class="comment">/* default to failure */</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  *entry = NULL;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a> = fetch_addr(conn, <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Hostname %s was found in DNS cache\n&quot;</span>, <a class="code" href="structhostname.html">hostname</a>);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>-&gt;inuse++; <span class="comment">/* we use it! */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#a5de4dfc4ae1cd502b87f3d024f2bb1b1">CURLRESOLV_RESOLVED</a>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">/* The entry was not in the cache. Resolve it to IP address */</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *addr;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">int</span> respwait;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/* Check what IP specifics the app has requested and if we can provide it.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">     * If not, bail out. */</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="hostip_8h.html#ad9dff6c3cf93a335a95e06748fd9b43e">Curl_ipvalid</a>(conn))</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">/* notify the resolver start callback */</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.resolver_start) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordtype">int</span> st;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      st = <a class="code" href="structdata.html">data</a>-&gt;set.resolver_start(<a class="code" href="structdata.html">data</a>-&gt;state.resolver, NULL,</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                    <a class="code" href="structdata.html">data</a>-&gt;set.resolver_start_client);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordflow">if</span>(st)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.doh) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      addr = <a class="code" href="doh_8c.html#ad8f1d42272f3e981eb0f6a3cb71e1aa8">Curl_doh</a>(conn, <a class="code" href="structhostname.html">hostname</a>, port, &amp;respwait);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="comment">/* If Curl_getaddrinfo() returns NULL, &#39;respwait&#39; might be set to a</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">         non-zero value indicating that we need to wait for the response to the</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">         resolve call */</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      addr = <a class="code" href="hostip_8h.html#aaefb9beac7a719cbee212262950c5a44">Curl_getaddrinfo</a>(conn,</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;#ifdef DEBUGBUILD</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                              (<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa7b5f688f07bc6365060e0c78cb976ea8">STRING_DEVICE</a>]</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                               &amp;&amp; !strcmp(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa7b5f688f07bc6365060e0c78cb976ea8">STRING_DEVICE</a>],</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                          <span class="stringliteral">&quot;LocalHost&quot;</span>))?<span class="stringliteral">&quot;localhost&quot;</span>:</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;#endif</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                              <a class="code" href="structhostname.html">hostname</a>, port, &amp;respwait);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span>(!addr) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span>(respwait) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="comment">/* the response to our resolve call will come asynchronously at</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">           a later time, good or bad */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="comment">/* First, check that we haven&#39;t received the info by now */</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="hostip_8c.html#ae1886f5ce5b1a160f27efdddb130d33e">Curl_resolv_check</a>(conn, &amp;<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) <span class="comment">/* error detected */</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#a5de4dfc4ae1cd502b87f3d024f2bb1b1">CURLRESOLV_RESOLVED</a>; <span class="comment">/* pointer provided */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>; <span class="comment">/* no info yet */</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="comment">/* we got a response, store it in the cache */</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a> = <a class="code" href="hostip_8c.html#afab64c7c46db37643d596002f4a0c825">Curl_cache_addr</a>(<a class="code" href="structdata.html">data</a>, addr, <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">/* returned failure, bail out nicely */</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <a class="code" href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a>(addr);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#a5de4dfc4ae1cd502b87f3d024f2bb1b1">CURLRESOLV_RESOLVED</a>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  *entry = <a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#ifdef USE_ALARM_TIMEOUT</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * This signal handler jumps back into the main libcurl code and continues</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> * execution.  This effectively causes the remainder of the application to run</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> * within a signal handler which is nonportable and could lead to problems.</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> alarmfunc(<span class="keywordtype">int</span> sig)</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;{</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">/* this is for &quot;-ansi -Wall -pedantic&quot; to stop complaining!   (rabe) */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  (void)sig;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  siglongjmp(curl_jmpenv, 1);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_ALARM_TIMEOUT */</span><span class="preprocessor"></span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment"> * Curl_resolv_timeout() is the same as Curl_resolv() but specifies a</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment"> * timeout.  This function might return immediately if we&#39;re using asynch</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment"> * resolves. See the return codes.</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"> * The cache entry we return will get its &#39;inuse&#39; counter increased when this</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"> * function is used. You MUST call Curl_resolv_unlock() later (when you&#39;re</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"> * done using this struct) to decrease the counter again.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"> * If built with a synchronous resolver and use of signals is not</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"> * disabled by the application, then a nonzero timeout will cause a</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment"> * timeout after the specified number of milliseconds. Otherwise, timeout</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment"> * is ignored.</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment"> * Return codes:</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment"> * CURLRESOLV_TIMEDOUT(-2) = warning, time too short or previous alarm expired</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"> * CURLRESOLV_ERROR   (-1) = error, no pointer</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment"> * CURLRESOLV_RESOLVED (0) = OK, pointer provided</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"> * CURLRESOLV_PENDING  (1) = waiting for response, no pointer</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="hostip_8h.html#a53a82a13eee1c994fdf42a6be1da634c">  658</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="hostip_8c.html#a336a5d08a3d7db99e3bf4157a58d90dc">Curl_resolv_timeout</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                        <span class="keywordtype">int</span> port,</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                        <span class="keyword">struct</span> <a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> **entry,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                        time_t timeoutms)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;{</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="preprocessor">#ifdef USE_ALARM_TIMEOUT</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGACTION</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keyword">struct </span>sigaction keep_sigact;   <span class="comment">/* store the old struct here */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keyword">volatile</span> <span class="keywordtype">bool</span> keep_copysig = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* whether old sigact has been saved */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keyword">struct </span>sigaction sigact;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  void (*keep_sigact)(int);       <span class="comment">/* store the old handler here */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SIGNAL */</span><span class="preprocessor"></span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SIGACTION */</span><span class="preprocessor"></span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keyword">volatile</span> <span class="keywordtype">long</span> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> prev_alarm = 0;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_ALARM_TIMEOUT */</span><span class="preprocessor"></span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  *entry = NULL;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="keywordflow">if</span>(timeoutms &lt; 0)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">/* got an already expired timeout */</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hostip_8h.html#ae8618661546c3da74f78cc6e60dcc1b3">CURLRESOLV_TIMEDOUT</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="preprocessor">#ifdef USE_ALARM_TIMEOUT</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.no_signal)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">/* Ignore the timeout when signals are disabled */</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = 0;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = (timeoutms &gt; LONG_MAX) ? LONG_MAX : (<span class="keywordtype">long</span>)timeoutms;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* USE_ALARM_TIMEOUT defined, but no timeout actually requested */</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, <a class="code" href="structhostname.html">hostname</a>, port, entry);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> &lt; 1000) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">/* The alarm() function only provides integer second resolution, so if</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">       we want to wait less than one second we must bail out already now. */</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="stringliteral">&quot;remaining timeout of %ld too small to resolve via SIGALRM method&quot;</span>,</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hostip_8h.html#ae8618661546c3da74f78cc6e60dcc1b3">CURLRESOLV_TIMEDOUT</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="comment">/* This allows us to time-out from the name resolver, as the timeout</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">     will generate a signal and we will siglongjmp() from that here.</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">     This technique has problems (see alarmfunc).</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">     This should be the last thing we do before calling Curl_resolv(),</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">     as otherwise we&#39;d have to worry about variables that get modified</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">     before we invoke Curl_resolv() (and thus use &quot;volatile&quot;). */</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordflow">if</span>(sigsetjmp(curl_jmpenv, 1)) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">/* this is coming from a siglongjmp() after an alarm signal */</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;name lookup timed out&quot;</span>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">goto</span> clean_up;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">/*************************************************************</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">     * Set signal handler to catch SIGALRM</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">     * Store the old value to be able to set it back later!</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">     *************************************************************/</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGACTION</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    sigaction(SIGALRM, NULL, &amp;sigact);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    keep_sigact = sigact;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    keep_copysig = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* yes, we have a copy */</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    sigact.sa_handler = alarmfunc;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="preprocessor">#ifdef SA_RESTART</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">/* HPUX doesn&#39;t have SA_RESTART but defaults to that behaviour! */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    sigact.sa_flags &amp;= ~SA_RESTART;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">/* now set the new struct */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    sigaction(SIGALRM, &amp;sigact, NULL);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* HAVE_SIGACTION */</span><span class="preprocessor"></span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">/* no sigaction(), revert to the much lamer signal() */</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    keep_sigact = signal(SIGALRM, alarmfunc);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SIGACTION */</span><span class="preprocessor"></span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">/* alarm() makes a signal get sent when the timeout fires off, and that</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">       will abort system calls */</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    prev_alarm = alarm(<a class="code" href="warnless_8c.html#a484412938cdb71a3a90b7f3efaeeffb0">curlx_sltoui</a>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>/1000L));</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#ifndef CURLRES_ASYNCH</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordflow">if</span>(timeoutms)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;timeout on name lookup is not supported\n&quot;</span>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  (void)timeoutms; <span class="comment">/* timeoutms not used with an async resolver */</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_ALARM_TIMEOUT */</span><span class="preprocessor"></span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">/* Perform the actual name resolution. This might be interrupted by an</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">   * alarm if it takes too long.</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, <a class="code" href="structhostname.html">hostname</a>, port, entry);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor">#ifdef USE_ALARM_TIMEOUT</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;clean_up:</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordflow">if</span>(!prev_alarm)</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">/* deactivate a possibly active alarm before uninstalling the handler */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    alarm(0);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGACTION</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span>(keep_copysig) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">/* we got a struct as it looked before, now put that one back nice</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">       and clean */</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    sigaction(SIGALRM, &amp;keep_sigact, NULL); <span class="comment">/* put it back */</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">/* restore the previous SIGALRM handler */</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  signal(SIGALRM, keep_sigact);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SIGACTION */</span><span class="preprocessor"></span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="comment">/* switch back the alarm() to either zero or to what it was before minus</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">     the time we spent until now! */</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span>(prev_alarm) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">/* there was an alarm() set before us, now put it back */</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> elapsed_secs = <a class="code" href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a>(<a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>(),</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                            conn-&gt;<a class="code" href="structconnectdata.html#a08faf7d2e790fe1b1c424466292b3ca2">created</a>) / 1000;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">/* the alarm period is counted in even number of seconds */</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> alarm_set = prev_alarm - elapsed_secs;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">if</span>(!alarm_set ||</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;       ((alarm_set &gt;= 0x80000000) &amp;&amp; (prev_alarm &lt; 0x80000000)) ) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="comment">/* if the alarm time-left reached zero or turned &quot;negative&quot; (counted</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">         with unsigned values), we should fire off a SIGALRM here, but we</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">         won&#39;t, and zero would be to switch it off so we never set it to</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">         less than 1! */</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      alarm(1);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8h.html#ae8618661546c3da74f78cc6e60dcc1b3">CURLRESOLV_TIMEDOUT</a>;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Previous alarm fired off!&quot;</span>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      alarm((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)alarm_set);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_ALARM_TIMEOUT */</span><span class="preprocessor"></span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment"> * Curl_resolv_unlock() unlocks the given cached DNS entry. When this has been</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment"> * made, the struct may be destroyed due to pruning. It is important that only</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"> * one unlock is made for each Curl_resolv() call.</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment"> * May be called with &#39;data&#39; == NULL for global cache.</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00814"></a><span class="lineno"><a class="line" href="hostip_8h.html#a47fa53659ab4a0c796ea2fd58629674c">  814</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>, <span class="keyword">struct</span> <a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;{</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  freednsentry(<a class="code" href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">dns</a>);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;}</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"> * File-internal: release cache dns entry reference, free if inuse drops to 0</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> freednsentry(<span class="keywordtype">void</span> *freethis)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;{</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns = (<span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *) freethis;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(dns &amp;&amp; (dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a>&gt;0));</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a>--;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">if</span>(dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a> == 0) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a>(dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(dns);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"> * Curl_mk_dnscache() inits a new DNS cache and returns success/failure.</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="hostip_8h.html#ae84cb7831090ead4c353b412893a259a">  843</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="hostip_8c.html#ae84cb7831090ead4c353b412893a259a">Curl_mk_dnscache</a>(<span class="keyword">struct</span> <a class="code" href="structcurl__hash.html">curl_hash</a> *hash)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;{</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="hash_8c.html#ad6fcf4d87ffe2648f214142d0288c8ee">Curl_hash_init</a>(hash, 7, <a class="code" href="hash_8c.html#ad03fbf647c1fe1cdd72ccc7a131ce680">Curl_hash_str</a>, <a class="code" href="hash_8c.html#ab260dae4821964f2ea9816ca48939ac8">Curl_str_key_compare</a>,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                        freednsentry);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment"> * Curl_hostcache_clean()</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment"> * This _can_ be called with &#39;data&#39; == NULL but then of course no locking</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"> * can be done!</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="hostip_8h.html#a546aa63aadecc9d74c4cdb7a5e530d40">  856</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="hostip_8c.html#a546aa63aadecc9d74c4cdb7a5e530d40">Curl_hostcache_clean</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                          <span class="keyword">struct</span> <a class="code" href="structcurl__hash.html">curl_hash</a> *hash)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;{</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <a class="code" href="hash_8c.html#ad05c21e27ae750f680692c871a71f26c">Curl_hash_clean</a>(hash);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a> &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno"><a class="line" href="hostip_8h.html#a8b9544b1eed8e7a9680f3f06520c11e6">  869</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="hostip_8c.html#a8b9544b1eed8e7a9680f3f06520c11e6">Curl_loadhostpairs</a>(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;{</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *hostp;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="structhostname.html">hostname</a>[256];</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordtype">int</span> port = 0;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">for</span>(hostp = <a class="code" href="structdata.html">data</a>-&gt;change.resolve; hostp; hostp = hostp-&gt;<a class="code" href="structcurl__slist.html#a56fcfc41d89a47865933c310d316a108">next</a>) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span>(!hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>)</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span>(hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>[0] == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="keywordtype">char</span> *entry_id;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordtype">size_t</span> entry_len;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">if</span>(2 != sscanf(hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a> + 1, <span class="stringliteral">&quot;%255[^:]:%d&quot;</span>, <a class="code" href="structhostname.html">hostname</a>, &amp;port)) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Couldn&#39;t parse CURLOPT_RESOLVE removal entry &#39;%s&#39;!\n&quot;</span>,</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;              hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="comment">/* Create an entry id, based upon the hostname and port */</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      entry_id = create_hostcache_id(<a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="comment">/* If we can&#39;t create the entry id, fail */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">if</span>(!entry_id) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      entry_len = strlen(entry_id);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="comment">/* delete entry, ignore if it didn&#39;t exist */</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <a class="code" href="hash_8c.html#a1b249bccd7f3b079b31a4254444538d5">Curl_hash_delete</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="comment">/* free the allocated entry_id again */</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *<a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a> = NULL, *tail = NULL;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordtype">char</span> *entry_id;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordtype">size_t</span> entry_len;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordtype">char</span> address[64];</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor">#if !defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordtype">char</span> *addresses = NULL;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordtype">char</span> *addr_begin;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordtype">char</span> *addr_end;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordtype">char</span> *port_ptr;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordtype">char</span> *end_ptr;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordtype">char</span> *host_end;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tmp_port;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordtype">bool</span> error = <span class="keyword">true</span>;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      host_end = strchr(hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">if</span>(!host_end ||</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         ((host_end - hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>) &gt;= (ptrdiff_t)<span class="keyword">sizeof</span>(<a class="code" href="structhostname.html">hostname</a>)))</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="structhostname.html">hostname</a>, hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>, host_end - hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <a class="code" href="structhostname.html">hostname</a>[host_end - hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      port_ptr = host_end + 1;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      tmp_port = strtoul(port_ptr, &amp;end_ptr, 10);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">if</span>(tmp_port &gt; USHRT_MAX || end_ptr == port_ptr || *end_ptr != <span class="charliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      port = (int)tmp_port;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">#if !defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      addresses = end_ptr + 1;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">while</span>(*end_ptr) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordtype">size_t</span> alen;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *ai;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        addr_begin = end_ptr + 1;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        addr_end = strchr(addr_begin, <span class="charliteral">&#39;,&#39;</span>);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">if</span>(!addr_end)</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;          addr_end = addr_begin + strlen(addr_begin);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        end_ptr = addr_end;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="comment">/* allow IP(v6) address within [brackets] */</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span>(*addr_begin == <span class="charliteral">&#39;[&#39;</span>) {</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          <span class="keywordflow">if</span>(addr_end == addr_begin || *(addr_end - 1) != <span class="charliteral">&#39;]&#39;</span>)</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;          ++addr_begin;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;          --addr_end;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        alen = addr_end - addr_begin;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordflow">if</span>(!alen)</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="keywordflow">if</span>(alen &gt;= <span class="keyword">sizeof</span>(address))</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;          <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(address, addr_begin, alen);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        address[alen] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#ifndef ENABLE_IPV6</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="keywordflow">if</span>(strchr(address, <span class="charliteral">&#39;:&#39;</span>)) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Ignoring resolve address &#39;%s&#39;, missing IPv6 support.\n&quot;</span>,</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                address);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        ai = <a class="code" href="curl__addrinfo_8c.html#aba26698ba7f0593a2df22e31a4ccef02">Curl_str2addr</a>(address, port);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">if</span>(!ai) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Resolve address &#39;%s&#39; found illegal!\n&quot;</span>, address);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;          <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">if</span>(tail) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;          tail-&gt;ai_next = ai;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;          tail = tail-&gt;<a class="code" href="struct_curl__addrinfo.html#a871199ad1750edcfa4c642c74cb8ccd8">ai_next</a>;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          <a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a> = tail = ai;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a>)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      error = <span class="keyword">false</span>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   err:</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Couldn&#39;t parse CURLOPT_RESOLVE entry &#39;%s&#39;!\n&quot;</span>,</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;              hostp-&gt;<a class="code" href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">data</a>);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <a class="code" href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a>(<a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a>);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <span class="comment">/* Create an entry id, based upon the hostname and port */</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      entry_id = create_hostcache_id(<a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="comment">/* If we can&#39;t create the entry id, fail */</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <span class="keywordflow">if</span>(!entry_id) {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <a class="code" href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a>(<a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      entry_len = strlen(entry_id);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>, <a class="code" href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">/* See if its already in our dns cache */</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      dns = <a class="code" href="hash_8c.html#a36789eb2833288dbbdd77d0317132131">Curl_hash_pick</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordflow">if</span>(dns) {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;RESOLVE %s:%d is - old addresses discarded!\n&quot;</span>,</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment">/* delete old entry entry, there are two reasons for this</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">         1. old entry may have different addresses.</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">         2. even if entry with correct addresses is already in the cache,</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">            but if it is close to expire, then by the time next http</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">            request is made, it can get expired and pruned because old</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">            entry is not necessarily marked as added by CURLOPT_RESOLVE. */</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <a class="code" href="hash_8c.html#a1b249bccd7f3b079b31a4254444538d5">Curl_hash_delete</a>(<a class="code" href="structdata.html">data</a>-&gt;dns.hostcache, entry_id, entry_len + 1);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="comment">/* free the allocated entry_id again */</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(entry_id);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="comment">/* put this new host in the cache */</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      dns = <a class="code" href="hostip_8c.html#afab64c7c46db37643d596002f4a0c825">Curl_cache_addr</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a>, <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">if</span>(dns) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">timestamp</a> = 0; <span class="comment">/* mark as added by CURLOPT_RESOLVE */</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="comment">/* release the returned reference; the cache itself will keep the</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">         * entry alive: */</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">inuse</a>--;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;share)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <a class="code" href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a>);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">if</span>(!dns) {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <a class="code" href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a>(<a class="code" href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Added %s:%d:%s to DNS cache\n&quot;</span>,</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <a class="code" href="structhostname.html">hostname</a>, port, addresses);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    }</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  }</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;change.resolve = NULL; <span class="comment">/* dealt with now */</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="hostip_8h.html#ae1886f5ce5b1a160f27efdddb130d33e"> 1062</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="hostip_8c.html#ae1886f5ce5b1a160f27efdddb130d33e">Curl_resolv_check</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                           <span class="keyword">struct</span> <a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> **dns)</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;{</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ad3186b49a14ee582f4204eb538d62eb5">doh</a>)</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="doh_8c.html#ae7b7f8e58ab02795c6e4286dd1a00467">Curl_doh_is_resolved</a>(conn, dns);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="asyn_8h.html#a017ed0d46e9c50c0aaf19ca65412d269">Curl_resolver_is_resolved</a>(conn, dns);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;}</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"><a class="line" href="hostip_8h.html#aaa189624c85f30d5cb0eafe088c2ccd9"> 1070</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="hostip_8c.html#aaa189624c85f30d5cb0eafe088c2ccd9">Curl_resolv_getsock</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                        <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                        <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;{</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="preprocessor">#ifdef CURLRES_ASYNCH</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#ad3186b49a14ee582f4204eb538d62eb5">doh</a>)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">/* nothing to wait for during DOH resolve, those handles have their own</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">       sockets */</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="asyn_8h.html#a005f24350f3adcef7fe6be51da982536">Curl_resolver_getsock</a>(conn, socks, numsocks);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  (void)conn;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  (void)socks;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  (void)numsocks;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;}</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">/* Call this function after Curl_connect() has returned async=TRUE and</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">   then a successful name resolve has been received.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">   Note: this function disconnects and frees the conn data in case of</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">   resolve failure */</span></div><div class="line"><a name="l01093"></a><span class="lineno"><a class="line" href="hostip_8h.html#a50a09fd10f82d09b73f111c663998a5a"> 1093</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="hostip_8c.html#a9114f6a0239d0c123cc523c1e37b9c20">Curl_once_resolved</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                            <span class="keywordtype">bool</span> *protocol_done)</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;{</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a81b59f48e7176a865c7459ce844c45dd">async</a>.<a class="code" href="struct_curl__async.html#ad332b101ad0d9229113ca378e7909f29">dns</a>) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a5bc9b1d04e8c04b6d32f31e3415d0810">dns_entry</a> = conn-&gt;<a class="code" href="structconnectdata.html#a81b59f48e7176a865c7459ce844c45dd">async</a>.<a class="code" href="struct_curl__async.html#ad332b101ad0d9229113ca378e7909f29">dns</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a81b59f48e7176a865c7459ce844c45dd">async</a>.<a class="code" href="struct_curl__async.html#ad332b101ad0d9229113ca378e7909f29">dns</a> = NULL;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="url_8c.html#a82de17e216c4ffbafc29719bcf3b1d9a">Curl_setup_conn</a>(conn, protocol_done);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">/* We&#39;re not allowed to return failure with memory left allocated</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">       in the connectdata struct, free those here */</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <a class="code" href="url_8c.html#a3cd816b52d9e4d2393ce905dd98e57a9">Curl_disconnect</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, conn, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>); <span class="comment">/* close the connection */</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;}</div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="structcurl__hash_html"><div class="ttname"><a href="structcurl__hash.html">curl_hash</a></div><div class="ttdef"><b>Definition:</b> <a href="hash_8h_source.html#l00046">hash.h:46</a></div></div>
<div class="ttc" id="hostip_8h_html_a5de4dfc4ae1cd502b87f3d024f2bb1b1"><div class="ttname"><a href="hostip_8h.html#a5de4dfc4ae1cd502b87f3d024f2bb1b1">CURLRESOLV_RESOLVED</a></div><div class="ttdeci">#define CURLRESOLV_RESOLVED</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00084">hostip.h:84</a></div></div>
<div class="ttc" id="share_8h_html"><div class="ttname"><a href="share_8h.html">share.h</a></div></div>
<div class="ttc" id="struct_curl__async_html_ad332b101ad0d9229113ca378e7909f29"><div class="ttname"><a href="struct_curl__async.html#ad332b101ad0d9229113ca378e7909f29">Curl_async::dns</a></div><div class="ttdeci">struct Curl_dns_entry * dns</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00474">urldata.h:474</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a50cf1998cd442f5d41df925e184fd841"><div class="ttname"><a href="curl__setup__once_8h.html#a50cf1998cd442f5d41df925e184fd841">TOLOWER</a></div><div class="ttdeci">#define TOLOWER(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00276">curl_setup_once.h:276</a></div></div>
<div class="ttc" id="hostip_8c_html_a9114f6a0239d0c123cc523c1e37b9c20"><div class="ttname"><a href="hostip_8c.html#a9114f6a0239d0c123cc523c1e37b9c20">Curl_once_resolved</a></div><div class="ttdeci">CURLcode Curl_once_resolved(struct connectdata *conn, bool *protocol_done)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l01093">hostip.c:1093</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html_a2123052767933e498feece390309a7e3"><div class="ttname"><a href="struct_curl__dns__entry.html#a2123052767933e498feece390309a7e3">Curl_dns_entry::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00069">hostip.h:69</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="url_8c_html_a82de17e216c4ffbafc29719bcf3b1d9a"><div class="ttname"><a href="url_8c.html#a82de17e216c4ffbafc29719bcf3b1d9a">Curl_setup_conn</a></div><div class="ttdeci">CURLcode Curl_setup_conn(struct connectdata *conn, bool *protocol_done)</div><div class="ttdef"><b>Definition:</b> <a href="url_8c_source.html#l04073">url.c:4073</a></div></div>
<div class="ttc" id="hash_8c_html_ad6fcf4d87ffe2648f214142d0288c8ee"><div class="ttname"><a href="hash_8c.html#ad6fcf4d87ffe2648f214142d0288c8ee">Curl_hash_init</a></div><div class="ttdeci">int Curl_hash_init(struct curl_hash *h, int slots, hash_function hfunc, comp_function comparator, curl_hash_dtor dtor)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00057">hash.c:57</a></div></div>
<div class="ttc" id="hostip_8c_html_a77525441d6420606360f8430fa9c15ea"><div class="ttname"><a href="hostip_8c.html#a77525441d6420606360f8430fa9c15ea">Curl_hostcache_prune</a></div><div class="ttdeci">void Curl_hostcache_prune(struct Curl_easy *data)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00263">hostip.c:263</a></div></div>
<div class="ttc" id="structcurl__slist_html"><div class="ttname"><a href="structcurl__slist.html">curl_slist</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02394">curl.h:2394</a></div></div>
<div class="ttc" id="hash_8c_html_a314c4725d597b408ed695e4b8548b0db"><div class="ttname"><a href="hash_8c.html#a314c4725d597b408ed695e4b8548b0db">Curl_hash_clean_with_criterium</a></div><div class="ttdeci">void Curl_hash_clean_with_criterium(struct curl_hash *h, void *user, int(*comp)(void *, void *))</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00230">hash.c:230</a></div></div>
<div class="ttc" id="asyn_8h_html_a005f24350f3adcef7fe6be51da982536"><div class="ttname"><a href="asyn_8h.html#a005f24350f3adcef7fe6be51da982536">Curl_resolver_getsock</a></div><div class="ttdeci">int Curl_resolver_getsock(struct connectdata *conn, curl_socket_t *sock, int numsocks)</div></div>
<div class="ttc" id="curl_8h_html_a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95"><div class="ttname"><a href="curl_8h.html#a0ea2c7f23828ae93fb4eb9ab701bf6feac29aeaf619308f144ae4c72526fbdb95">CURL_LOCK_ACCESS_SINGLE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02619">curl.h:2619</a></div></div>
<div class="ttc" id="url_8c_html_a3cd816b52d9e4d2393ce905dd98e57a9"><div class="ttname"><a href="url_8c.html#a3cd816b52d9e4d2393ce905dd98e57a9">Curl_disconnect</a></div><div class="ttdeci">CURLcode Curl_disconnect(struct Curl_easy *data, struct connectdata *conn, bool dead_connection)</div><div class="ttdef"><b>Definition:</b> <a href="url_8c_source.html#l00751">url.c:751</a></div></div>
<div class="ttc" id="retry-max-time_8d_html_a612021c6b1f447b49053406818ef4ee6"><div class="ttname"><a href="retry-max-time_8d.html#a612021c6b1f447b49053406818ef4ee6">time</a></div><div class="ttdeci">Long the request will be made and while it may take longer than this given time period.To limit a single request s maximum time</div><div class="ttdef"><b>Definition:</b> <a href="retry-max-time_8d_source.html#l00008">retry-max-time.d:8</a></div></div>
<div class="ttc" id="config-dos_8h_html_adbe5dcee9c146b338794974137c55e70"><div class="ttname"><a href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a></div><div class="ttdeci">#define RETSIGTYPE</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00087">config-dos.h:87</a></div></div>
<div class="ttc" id="curl_8h_html_af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a"><div class="ttname"><a href="curl_8h.html#af898dd6eb71573ccb1668c3d2380549cacccfc548470f64bb4c100d13d4cc9c9a">CURL_LOCK_DATA_DNS</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02608">curl.h:2608</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="structcurl__slist_html_a5fe4d926491a1c9b8b9a73c40505f601"><div class="ttname"><a href="structcurl__slist.html#a5fe4d926491a1c9b8b9a73c40505f601">curl_slist::data</a></div><div class="ttdeci">char * data</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02395">curl.h:2395</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="hash_8c_html_a1b249bccd7f3b079b31a4254444538d5"><div class="ttname"><a href="hash_8c.html#a1b249bccd7f3b079b31a4254444538d5">Curl_hash_delete</a></div><div class="ttdeci">int Curl_hash_delete(struct curl_hash *h, void *key, size_t key_len)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00139">hash.c:139</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="hostip_8c_html_a74a4bac819e867581bb87a476a3a5e4f"><div class="ttname"><a href="hostip_8c.html#a74a4bac819e867581bb87a476a3a5e4f">Curl_shuffle_addr</a></div><div class="ttdeci">CURLcode Curl_shuffle_addr(struct Curl_easy *data, Curl_addrinfo **addr)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00383">hostip.c:383</a></div></div>
<div class="ttc" id="hostip_8h_html_ac32022a9b31aaa164578cb4d487cfc7d"><div class="ttname"><a href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a></div><div class="ttdeci">#define CURLRESOLV_PENDING</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00085">hostip.h:85</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="structconnectdata_html_a5bc9b1d04e8c04b6d32f31e3415d0810"><div class="ttname"><a href="structconnectdata.html#a5bc9b1d04e8c04b6d32f31e3415d0810">connectdata::dns_entry</a></div><div class="ttdeci">struct Curl_dns_entry * dns_entry</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00813">urldata.h:813</a></div></div>
<div class="ttc" id="hash_8h_html"><div class="ttname"><a href="hash_8h.html">hash.h</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa7b5f688f07bc6365060e0c78cb976ea8"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa7b5f688f07bc6365060e0c78cb976ea8">STRING_DEVICE</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01406">urldata.h:1406</a></div></div>
<div class="ttc" id="unit1399_8c_html_acf1e931ffa73126ce876102dc2186895"><div class="ttname"><a href="unit1399_8c.html#acf1e931ffa73126ce876102dc2186895">now</a></div><div class="ttdeci">struct curltime now</div><div class="ttdef"><b>Definition:</b> <a href="unit1399_8c_source.html#l00083">unit1399.c:83</a></div></div>
<div class="ttc" id="curl__addrinfo_8c_html_adfda8bf59056f5007ee5af04f3e411ac"><div class="ttname"><a href="curl__addrinfo_8c.html#adfda8bf59056f5007ee5af04f3e411ac">Curl_freeaddrinfo</a></div><div class="ttdeci">void Curl_freeaddrinfo(Curl_addrinfo *cahead)</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8c_source.html#l00085">curl_addrinfo.c:85</a></div></div>
<div class="ttc" id="multi_8c_html_af60eeb6175f9a25baeee40253c56330e"><div class="ttname"><a href="multi_8c.html#af60eeb6175f9a25baeee40253c56330e">Curl_set_in_callback</a></div><div class="ttdeci">void Curl_set_in_callback(struct Curl_easy *data, bool value)</div><div class="ttdef"><b>Definition:</b> <a href="multi_8c_source.html#l03174">multi.c:3174</a></div></div>
<div class="ttc" id="hash_8c_html_a7e58db026000cd72601150793facbbdc"><div class="ttname"><a href="hash_8c.html#a7e58db026000cd72601150793facbbdc">Curl_hash_destroy</a></div><div class="ttdeci">void Curl_hash_destroy(struct curl_hash *h)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00205">hash.c:205</a></div></div>
<div class="ttc" id="hash_8c_html_ad05c21e27ae750f680692c871a71f26c"><div class="ttname"><a href="hash_8c.html#ad05c21e27ae750f680692c871a71f26c">Curl_hash_clean</a></div><div class="ttdeci">void Curl_hash_clean(struct curl_hash *h)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00223">hash.c:223</a></div></div>
<div class="ttc" id="rand_8h_html"><div class="ttname"><a href="rand_8h.html">rand.h</a></div></div>
<div class="ttc" id="hostip_8c_html_aaa189624c85f30d5cb0eafe088c2ccd9"><div class="ttname"><a href="hostip_8c.html#aaa189624c85f30d5cb0eafe088c2ccd9">Curl_resolv_getsock</a></div><div class="ttdeci">int Curl_resolv_getsock(struct connectdata *conn, curl_socket_t *socks, int numsocks)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l01070">hostip.c:1070</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="structhostname_html"><div class="ttname"><a href="structhostname.html">hostname</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00446">urldata.h:446</a></div></div>
<div class="ttc" id="struct_user_defined_html_ad3186b49a14ee582f4204eb538d62eb5"><div class="ttname"><a href="struct_user_defined.html#ad3186b49a14ee582f4204eb538d62eb5">UserDefined::doh</a></div><div class="ttdeci">bool doh</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01728">urldata.h:1728</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="hostip_8h_html_ad9dff6c3cf93a335a95e06748fd9b43e"><div class="ttname"><a href="hostip_8h.html#ad9dff6c3cf93a335a95e06748fd9b43e">Curl_ipvalid</a></div><div class="ttdeci">bool Curl_ipvalid(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="hostip4_8c_source.html#l00065">hostip4.c:65</a></div></div>
<div class="ttc" id="structconnectdata_html_a08faf7d2e790fe1b1c424466292b3ca2"><div class="ttname"><a href="structconnectdata.html#a08faf7d2e790fe1b1c424466292b3ca2">connectdata::created</a></div><div class="ttdeci">struct curltime created</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00873">urldata.h:873</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_a871199ad1750edcfa4c642c74cb8ccd8"><div class="ttname"><a href="struct_curl__addrinfo.html#a871199ad1750edcfa4c642c74cb8ccd8">Curl_addrinfo::ai_next</a></div><div class="ttdeci">struct Curl_addrinfo * ai_next</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00059">curl_addrinfo.h:59</a></div></div>
<div class="ttc" id="inet__ntop_8c_html_a0c8c29e80617bf572b009e3f8eddfdf3"><div class="ttname"><a href="inet__ntop_8c.html#a0c8c29e80617bf572b009e3f8eddfdf3">Curl_inet_ntop</a></div><div class="ttdeci">char * Curl_inet_ntop(int af, const void *src, char *buf, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="inet__ntop_8c_source.html#l00183">inet_ntop.c:183</a></div></div>
<div class="ttc" id="hostip_8c_html_ab2142b86e9e89284e1e8aa9c35488f24"><div class="ttname"><a href="hostip_8c.html#ab2142b86e9e89284e1e8aa9c35488f24">Curl_global_host_cache_init</a></div><div class="ttdeci">struct curl_hash * Curl_global_host_cache_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00128">hostip.c:128</a></div></div>
<div class="ttc" id="timeval_8c_html_ae736e803680e1b7fa2b2868317b4b91f"><div class="ttname"><a href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a></div><div class="ttdeci">struct curltime Curl_now(void)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00154">timeval.c:154</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="hostip_8c_html_a27f562d6b6399ed1dacb6dbc558f6d8e"><div class="ttname"><a href="hostip_8c.html#a27f562d6b6399ed1dacb6dbc558f6d8e">Curl_global_host_cache_dtor</a></div><div class="ttdeci">void Curl_global_host_cache_dtor(void)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00143">hostip.c:143</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="hostip_8c_html_ae84cb7831090ead4c353b412893a259a"><div class="ttname"><a href="hostip_8c.html#ae84cb7831090ead4c353b412893a259a">Curl_mk_dnscache</a></div><div class="ttdeci">int Curl_mk_dnscache(struct curl_hash *hash)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00843">hostip.c:843</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html_a606b5303ecd260663dbf9b1f9f7f98dd"><div class="ttname"><a href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">Curl_dns_entry::addr</a></div><div class="ttdeci">Curl_addrinfo * addr</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00067">hostip.h:67</a></div></div>
<div class="ttc" id="share_8c_html_a85cdae024464c8d7e96a232797028d72"><div class="ttname"><a href="share_8c.html#a85cdae024464c8d7e96a232797028d72">Curl_share_unlock</a></div><div class="ttdeci">CURLSHcode Curl_share_unlock(struct Curl_easy *data, curl_lock_data type)</div><div class="ttdef"><b>Definition:</b> <a href="share_8c_source.html#l00244">share.c:244</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="structhostcache__prune__data_html"><div class="ttname"><a href="structhostcache__prune__data.html">hostcache_prune_data</a></div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00220">hostip.c:220</a></div></div>
<div class="ttc" id="doh_8c_html_ad8f1d42272f3e981eb0f6a3cb71e1aa8"><div class="ttname"><a href="doh_8c.html#ad8f1d42272f3e981eb0f6a3cb71e1aa8">Curl_doh</a></div><div class="ttdeci">Curl_addrinfo * Curl_doh(struct connectdata *conn, const char *hostname, int port, int *waitp)</div><div class="ttdef"><b>Definition:</b> <a href="doh_8c_source.html#l00270">doh.c:270</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_ab72a36e22c2c7cb539df0351f59359ca"><div class="ttname"><a href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">Curl_addrinfo::ai_addr</a></div><div class="ttdeci">struct sockaddr * ai_addr</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00058">curl_addrinfo.h:58</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html"><div class="ttname"><a href="struct_curl__dns__entry.html">Curl_dns_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00066">hostip.h:66</a></div></div>
<div class="ttc" id="structcurl__slist_html_a56fcfc41d89a47865933c310d316a108"><div class="ttname"><a href="structcurl__slist.html#a56fcfc41d89a47865933c310d316a108">curl_slist::next</a></div><div class="ttdeci">struct curl_slist * next</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02396">curl.h:2396</a></div></div>
<div class="ttc" id="hostip_8h_html_a983c878e70ef48673b790b47d2668b1d"><div class="ttname"><a href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a></div><div class="ttdeci">#define CURLRESOLV_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00083">hostip.h:83</a></div></div>
<div class="ttc" id="hostip_8c_html_a9682d744b66312d5f6ceaa8a6a02aff7"><div class="ttname"><a href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a></div><div class="ttdeci">const char * Curl_printable_address(const Curl_addrinfo *ai, char *buf, size_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00172">hostip.c:172</a></div></div>
<div class="ttc" id="hash_8c_html_ab260dae4821964f2ea9816ca48939ac8"><div class="ttname"><a href="hash_8c.html#ab260dae4821964f2ea9816ca48939ac8">Curl_str_key_compare</a></div><div class="ttdeci">size_t Curl_str_key_compare(void *k1, size_t key1_len, void *k2, size_t key2_len)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00271">hash.c:271</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_abadfae881af6425a56ff823ef0bb1a70"><div class="ttname"><a href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">Curl_addrinfo::ai_family</a></div><div class="ttdeci">int ai_family</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00053">curl_addrinfo.h:53</a></div></div>
<div class="ttc" id="remote-name_8d_html_aa335f8bb20424b03700f57b150bf0aa6"><div class="ttname"><a href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a></div><div class="ttdeci">Long the path is cut off.The file will be saved in the current working directory.If you want the file saved in a different make sure you change the current working directory before invoking curl with this option.The remote file name to use for saving is extracted from the given nothing and if it already exists it will be overwritten.If you want the server to be able to choose the file name refer to remote header name which can be used in addition to this option.If the server chooses a file name and that name already exists it will not be overwritten.There is no URL decoding done on the file name.If it has or other URL encoded parts of the name</div><div class="ttdef"><b>Definition:</b> <a href="remote-name_8d_source.html#l00006">remote-name.d:6</a></div></div>
<div class="ttc" id="strerror_8h_html"><div class="ttname"><a href="strerror_8h.html">strerror.h</a></div></div>
<div class="ttc" id="hostip_8c_html_ad81776a26da21671062cbf5ccd11be23"><div class="ttname"><a href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a></div><div class="ttdeci">int Curl_resolv(struct connectdata *conn, const char *hostname, int port, struct Curl_dns_entry **entry)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00521">hostip.c:521</a></div></div>
<div class="ttc" id="hostip_8c_html_ae1886f5ce5b1a160f27efdddb130d33e"><div class="ttname"><a href="hostip_8c.html#ae1886f5ce5b1a160f27efdddb130d33e">Curl_resolv_check</a></div><div class="ttdeci">CURLcode Curl_resolv_check(struct connectdata *conn, struct Curl_dns_entry **dns)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l01062">hostip.c:1062</a></div></div>
<div class="ttc" id="multiif_8h_html_ad755633cd6d4e90c3df49fefd1052bad"><div class="ttname"><a href="multiif_8h.html#ad755633cd6d4e90c3df49fefd1052bad">GETSOCK_BLANK</a></div><div class="ttdeci">#define GETSOCK_BLANK</div><div class="ttdef"><b>Definition:</b> <a href="multiif_8h_source.html#l00045">multiif.h:45</a></div></div>
<div class="ttc" id="hostip_8c_html_a47fa53659ab4a0c796ea2fd58629674c"><div class="ttname"><a href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a></div><div class="ttdeci">void Curl_resolv_unlock(struct Curl_easy *data, struct Curl_dns_entry *dns)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00814">hostip.c:814</a></div></div>
<div class="ttc" id="inet__ntop_8h_html"><div class="ttname"><a href="inet__ntop_8h.html">inet_ntop.h</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="doh_8c_html_ae7b7f8e58ab02795c6e4286dd1a00467"><div class="ttname"><a href="doh_8c.html#ae7b7f8e58ab02795c6e4286dd1a00467">Curl_doh_is_resolved</a></div><div class="ttdeci">CURLcode Curl_doh_is_resolved(struct connectdata *conn, struct Curl_dns_entry **dnsp)</div><div class="ttdef"><b>Definition:</b> <a href="doh_8c_source.html#l00817">doh.c:817</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="multiif_8h_html"><div class="ttname"><a href="multiif_8h.html">multiif.h</a></div></div>
<div class="ttc" id="timeval_8c_html_a93ce3158c8838916ed817489c98e37c4"><div class="ttname"><a href="timeval_8c.html#a93ce3158c8838916ed817489c98e37c4">Curl_timediff</a></div><div class="ttdeci">timediff_t Curl_timediff(struct curltime newer, struct curltime older)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00181">timeval.c:181</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3e3dfee99c81f563d18ef4626d8886e1"><div class="ttname"><a href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a></div><div class="ttdeci">#define aprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00046">curl_printf.h:46</a></div></div>
<div class="ttc" id="get_8d_html_a72405a3df7019c7ac95d2f3be7247548"><div class="ttname"><a href="get_8d.html#a72405a3df7019c7ac95d2f3be7247548">head</a></div><div class="ttdeci">Long this option will make all data specified with data binary or data urlencode to be used in an HTTP GET request instead of the POST request that otherwise would be used.The data will be appended to the URL with a separator.If used in combination with head</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a9aae7bf0c7e115aecd3db77123b25456"><div class="ttname"><a href="struct_curl__easy.html#a9aae7bf0c7e115aecd3db77123b25456">Curl_easy::dns</a></div><div class="ttdeci">struct Names dns</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01776">urldata.h:1776</a></div></div>
<div class="ttc" id="hostip_8c_html_a546aa63aadecc9d74c4cdb7a5e530d40"><div class="ttname"><a href="hostip_8c.html#a546aa63aadecc9d74c4cdb7a5e530d40">Curl_hostcache_clean</a></div><div class="ttdeci">void Curl_hostcache_clean(struct Curl_easy *data, struct curl_hash *hash)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00856">hostip.c:856</a></div></div>
<div class="ttc" id="unit1309_8c_html_aeb2cd1ec2b1721cdf9e6670d2391c991"><div class="ttname"><a href="unit1309_8c.html#aeb2cd1ec2b1721cdf9e6670d2391c991">nodes</a></div><div class="ttdeci">struct Curl_tree nodes[NUM_NODES *3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1309_8c_source.html#l00075">unit1309.c:75</a></div></div>
<div class="ttc" id="hostip_8c_html_ab7639aa864d22a73abf903210b551a4d"><div class="ttname"><a href="hostip_8c.html#ab7639aa864d22a73abf903210b551a4d">Curl_num_addresses</a></div><div class="ttdeci">int Curl_num_addresses(const Curl_addrinfo *addr)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00154">hostip.c:154</a></div></div>
<div class="ttc" id="hostip_8c_html_afab64c7c46db37643d596002f4a0c825"><div class="ttname"><a href="hostip_8c.html#afab64c7c46db37643d596002f4a0c825">Curl_cache_addr</a></div><div class="ttdeci">struct Curl_dns_entry * Curl_cache_addr(struct Curl_easy *data, Curl_addrinfo *addr, const char *hostname, int port)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00445">hostip.c:445</a></div></div>
<div class="ttc" id="hostip_8c_html_a336a5d08a3d7db99e3bf4157a58d90dc"><div class="ttname"><a href="hostip_8c.html#a336a5d08a3d7db99e3bf4157a58d90dc">Curl_resolv_timeout</a></div><div class="ttdeci">int Curl_resolv_timeout(struct connectdata *conn, const char *hostname, int port, struct Curl_dns_entry **entry, time_t timeoutms)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00658">hostip.c:658</a></div></div>
<div class="ttc" id="structhostcache__prune__data_html_a16bc4d24f4c0ac5d894a10cb23404356"><div class="ttname"><a href="structhostcache__prune__data.html#a16bc4d24f4c0ac5d894a10cb23404356">hostcache_prune_data::cache_timeout</a></div><div class="ttdeci">long cache_timeout</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00221">hostip.c:221</a></div></div>
<div class="ttc" id="structconnectdata_html_a81b59f48e7176a865c7459ce844c45dd"><div class="ttname"><a href="structconnectdata.html#a81b59f48e7176a865c7459ce844c45dd">connectdata::async</a></div><div class="ttdeci">struct Curl_async async</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00995">urldata.h:995</a></div></div>
<div class="ttc" id="asyn_8h_html_a017ed0d46e9c50c0aaf19ca65412d269"><div class="ttname"><a href="asyn_8h.html#a017ed0d46e9c50c0aaf19ca65412d269">Curl_resolver_is_resolved</a></div><div class="ttdeci">CURLcode Curl_resolver_is_resolved(struct connectdata *conn, struct Curl_dns_entry **dns)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="rand_8c_html_a4af2eb5937000b1ce673ac32d79e48d9"><div class="ttname"><a href="rand_8c.html#a4af2eb5937000b1ce673ac32d79e48d9">Curl_rand</a></div><div class="ttdeci">CURLcode Curl_rand(struct Curl_easy *data, unsigned char *rnd, size_t num)</div><div class="ttdef"><b>Definition:</b> <a href="rand_8c_source.html#l00120">rand.c:120</a></div></div>
<div class="ttc" id="curl__addrinfo_8c_html_aba26698ba7f0593a2df22e31a4ccef02"><div class="ttname"><a href="curl__addrinfo_8c.html#aba26698ba7f0593a2df22e31a4ccef02">Curl_str2addr</a></div><div class="ttdeci">Curl_addrinfo * Curl_str2addr(char *address, int port)</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8c_source.html#l00472">curl_addrinfo.c:472</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="hash_8c_html_ad03fbf647c1fe1cdd72ccc7a131ce680"><div class="ttname"><a href="hash_8c.html#ad03fbf647c1fe1cdd72ccc7a131ce680">Curl_hash_str</a></div><div class="ttdeci">size_t Curl_hash_str(void *key, size_t key_length, size_t slots_num)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00257">hash.c:257</a></div></div>
<div class="ttc" id="share_8c_html_a5dcfa53b653176b92395464a33b509cb"><div class="ttname"><a href="share_8c.html#a5dcfa53b653176b92395464a33b509cb">Curl_share_lock</a></div><div class="ttdeci">CURLSHcode Curl_share_lock(struct Curl_easy *data, curl_lock_data type, curl_lock_access accesstype)</div><div class="ttdef"><b>Definition:</b> <a href="share_8c_source.html#l00226">share.c:226</a></div></div>
<div class="ttc" id="hostip_8h_html_ae8618661546c3da74f78cc6e60dcc1b3"><div class="ttname"><a href="hostip_8h.html#ae8618661546c3da74f78cc6e60dcc1b3">CURLRESOLV_TIMEDOUT</a></div><div class="ttdeci">#define CURLRESOLV_TIMEDOUT</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00082">hostip.h:82</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html"><div class="ttname"><a href="struct_curl__addrinfo.html">Curl_addrinfo</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00051">curl_addrinfo.h:51</a></div></div>
<div class="ttc" id="hash_8c_html_a79767eb92ddbebaedaee7c568b8bf4bd"><div class="ttname"><a href="hash_8c.html#a79767eb92ddbebaedaee7c568b8bf4bd">Curl_hash_add</a></div><div class="ttdeci">void * Curl_hash_add(struct curl_hash *h, void *key, size_t key_len, void *p)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00109">hash.c:109</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html_a04bf1940359219c8e600a993c345d068"><div class="ttname"><a href="struct_curl__dns__entry.html#a04bf1940359219c8e600a993c345d068">Curl_dns_entry::inuse</a></div><div class="ttdeci">long inuse</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00071">hostip.h:71</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="warnless_8c_html_a484412938cdb71a3a90b7f3efaeeffb0"><div class="ttname"><a href="warnless_8c.html#a484412938cdb71a3a90b7f3efaeeffb0">curlx_sltoui</a></div><div class="ttdeci">unsigned int curlx_sltoui(long slnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00286">warnless.c:286</a></div></div>
<div class="ttc" id="hostip_8h_html"><div class="ttname"><a href="hostip_8h.html">hostip.h</a></div></div>
<div class="ttc" id="hostip_8c_html_a34d32d704f4d0ac5b0eed2ced2c88fba"><div class="ttname"><a href="hostip_8c.html#a34d32d704f4d0ac5b0eed2ced2c88fba">Curl_fetch_addr</a></div><div class="ttdeci">struct Curl_dns_entry * Curl_fetch_addr(struct connectdata *conn, const char *hostname, int port)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00350">hostip.c:350</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="hostip_8h_html_aaefb9beac7a719cbee212262950c5a44"><div class="ttname"><a href="hostip_8h.html#aaefb9beac7a719cbee212262950c5a44">Curl_getaddrinfo</a></div><div class="ttdeci">Curl_addrinfo * Curl_getaddrinfo(struct connectdata *conn, const char *hostname, int port, int *waitp)</div><div class="ttdef"><b>Definition:</b> <a href="hostip4_8c_source.html#l00092">hostip4.c:92</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="url_8h_html"><div class="ttname"><a href="url_8h.html">url.h</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="structhostcache__prune__data_html_ab8729b8c098744d69f3b33a4e4dcdd95"><div class="ttname"><a href="structhostcache__prune__data.html#ab8729b8c098744d69f3b33a4e4dcdd95">hostcache_prune_data::now</a></div><div class="ttdeci">time_t now</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00222">hostip.c:222</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="hash_8c_html_a36789eb2833288dbbdd77d0317132131"><div class="ttname"><a href="hash_8c.html#a36789eb2833288dbbdd77d0317132131">Curl_hash_pick</a></div><div class="ttdeci">void * Curl_hash_pick(struct curl_hash *h, void *key, size_t key_len)</div><div class="ttdef"><b>Definition:</b> <a href="hash_8c_source.html#l00160">hash.c:160</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="hostip_8c_html_a8b9544b1eed8e7a9680f3f06520c11e6"><div class="ttname"><a href="hostip_8c.html#a8b9544b1eed8e7a9680f3f06520c11e6">Curl_loadhostpairs</a></div><div class="ttdeci">CURLcode Curl_loadhostpairs(struct Curl_easy *data)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00869">hostip.c:869</a></div></div>
<div class="ttc" id="timeval_8h_html_aeb19832fd3e7f11c8d047d6824300e87"><div class="ttname"><a href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a></div><div class="ttdeci">int timediff_t</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00028">timeval.h:28</a></div></div>
<div class="ttc" id="doh_8h_html"><div class="ttname"><a href="doh_8h.html">doh.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="hostip_8c.html">hostip.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
