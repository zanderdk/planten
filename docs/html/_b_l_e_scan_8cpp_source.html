<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/BLEScan.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_b_l_e_scan_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLEScan.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_b_l_e_scan_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * BLEScan.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Jul 1, 2017</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#if defined(CONFIG_BT_ENABLED)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;esp_err.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_advertised_device_8h.html">BLEAdvertisedDevice.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_scan_8h.html">BLEScan.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_utils_8h.html">BLEUtils.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#ifdef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;esp32-hal-log.h&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;BLEScan&quot;</span>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;BLEScan::BLEScan() {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    m_scan_params.scan_type          = BLE_SCAN_TYPE_PASSIVE; <span class="comment">// Default is a passive scan.</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    m_scan_params.own_addr_type      = BLE_ADDR_TYPE_PUBLIC;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    m_scan_params.scan_filter_policy = BLE_SCAN_FILTER_ALLOW_ALL;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    m_pAdvertisedDeviceCallbacks     = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    m_stopped                        = <span class="keyword">true</span>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    m_wantDuplicates                 = <span class="keyword">false</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="class_b_l_e_scan.html#ad8cff030c66cd9f5dbebb4320ca0f446">setInterval</a>(100);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="class_b_l_e_scan.html#ab14d7160a919c1db291d11244dcfd9af">setWindow</a>(100);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;} <span class="comment">// BLEScan</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">void</span> BLEScan::handleGAPEvent(</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    esp_gap_ble_cb_event_t  event,</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    esp_ble_gap_cb_param_t* param) {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">switch</span>(event) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// ---------------------------</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="comment">// scan_rst:</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment">// esp_gap_search_evt_t search_evt</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">// esp_bd_addr_t bda</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">// esp_bt_dev_type_t dev_type</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">// esp_ble_addr_type_t ble_addr_type</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">// esp_ble_evt_type_t ble_evt_type</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="comment">// int rssi</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="comment">// uint8_t ble_adv[ESP_BLE_ADV_DATA_LEN_MAX]</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="comment">// int flag</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="comment">// int num_resps</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">// uint8_t adv_data_len</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="comment">// uint8_t scan_rsp_len</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">case</span> ESP_GAP_BLE_SCAN_RESULT_EVT: {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">switch</span>(param-&gt;scan_rst.search_evt) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="comment">//</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="comment">// ESP_GAP_SEARCH_INQ_CMPL_EVT</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="comment">//</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="comment">// Event that indicates that the duration allowed for the search has completed or that we have been</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="comment">// asked to stop.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">case</span> ESP_GAP_SEARCH_INQ_CMPL_EVT: {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                    ESP_LOGW(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_SEARCH_INQ_CMPL_EVT&quot;</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    m_stopped = <span class="keyword">true</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                    m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                    <span class="keywordflow">if</span> (m_scanCompleteCB != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                        m_scanCompleteCB(m_scanResults);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                } <span class="comment">// ESP_GAP_SEARCH_INQ_CMPL_EVT</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="comment">//</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                <span class="comment">// ESP_GAP_SEARCH_INQ_RES_EVT</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                <span class="comment">//</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <span class="comment">// Result that has arrived back from a Scan inquiry.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="keywordflow">case</span> ESP_GAP_SEARCH_INQ_RES_EVT: {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    <span class="keywordflow">if</span> (m_stopped) { <span class="comment">// If we are not scanning, nothing to do with the extra results.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">// Examine our list of previously scanned addresses and, if we found this one already,</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">// ignore it.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <a class="code" href="class_b_l_e_address.html">BLEAddress</a> advertisedAddress(param-&gt;scan_rst.bda);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    <span class="keywordflow">if</span> (m_scanResults.m_vectorAdvertisedDevices.count(advertisedAddress.toString()) != 0) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                        found = <span class="keyword">true</span>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    <span class="keywordflow">if</span> (found &amp;&amp; !m_wantDuplicates) {  <span class="comment">// If we found a previous entry AND we don&#39;t want duplicates, then we are done.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Ignoring %s, already seen it.&quot;</span>, advertisedAddress.toString().c_str());</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        vTaskDelay(1);  <span class="comment">// &lt;--- allow to switch task in case we scan infinity and dont have new devices to report, or we are blocked here</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    <span class="comment">// We now construct a model of the advertised device that we have just found for the first</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    <span class="comment">// time.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    <span class="comment">// ESP_LOG_BUFFER_HEXDUMP(LOG_TAG, (uint8_t*)param-&gt;scan_rst.ble_adv, param-&gt;scan_rst.adv_data_len + param-&gt;scan_rst.scan_rsp_len, ESP_LOG_DEBUG);</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    <span class="comment">// ESP_LOGW(LOG_TAG, &quot;bytes length: %d + %d, addr type: %d&quot;, param-&gt;scan_rst.adv_data_len, param-&gt;scan_rst.scan_rsp_len, param-&gt;scan_rst.ble_addr_type);</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <a class="code" href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a> *advertisedDevice = <span class="keyword">new</span> <a class="code" href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a>();</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    advertisedDevice-&gt;setAddress(advertisedAddress);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    advertisedDevice-&gt;setRSSI(param-&gt;scan_rst.rssi);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    advertisedDevice-&gt;setAdFlag(param-&gt;scan_rst.flag);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    advertisedDevice-&gt;parseAdvertisement((uint8_t*)param-&gt;scan_rst.ble_adv, param-&gt;scan_rst.adv_data_len + param-&gt;scan_rst.scan_rsp_len);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    advertisedDevice-&gt;setScan(<span class="keyword">this</span>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    advertisedDevice-&gt;<a class="code" href="class_b_l_e_advertised_device.html#a5d84a3eb5221ac3e15a636eb0c935715">setAddressType</a>(param-&gt;scan_rst.ble_addr_type);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="keywordflow">if</span> (!found) {   <span class="comment">// If we have previously seen this device, don&#39;t record it again.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        m_scanResults.m_vectorAdvertisedDevices.insert(std::pair&lt;std::string, BLEAdvertisedDevice*&gt;(advertisedAddress.toString(), advertisedDevice));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    <span class="keywordflow">if</span> (m_pAdvertisedDeviceCallbacks) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        m_pAdvertisedDeviceCallbacks-&gt;<a class="code" href="class_b_l_e_advertised_device_callbacks.html#a981732b68c5427f6b58d6af960316b2c">onResult</a>(*advertisedDevice);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    <span class="keywordflow">if</span>(found)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        <span class="keyword">delete</span> advertisedDevice;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                } <span class="comment">// ESP_GAP_SEARCH_INQ_RES_EVT</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            } <span class="comment">// switch - search_evt</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        } <span class="comment">// ESP_GAP_BLE_SCAN_RESULT_EVT</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        } <span class="comment">// default</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    } <span class="comment">// End switch</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;} <span class="comment">// gapEventHandler</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a02e4e5e7297aaa66648e170ebc5ace62">  155</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#a02e4e5e7297aaa66648e170ebc5ace62">BLEScan::setActiveScan</a>(<span class="keywordtype">bool</span> active) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (active) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        m_scan_params.scan_type = BLE_SCAN_TYPE_ACTIVE;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        m_scan_params.scan_type = BLE_SCAN_TYPE_PASSIVE;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;} <span class="comment">// setActiveScan</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a1c6bac2afb7fb0eadab2131d86319316">  169</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#a1c6bac2afb7fb0eadab2131d86319316">BLEScan::setAdvertisedDeviceCallbacks</a>(<a class="code" href="class_b_l_e_advertised_device_callbacks.html">BLEAdvertisedDeviceCallbacks</a>* pAdvertisedDeviceCallbacks, <span class="keywordtype">bool</span> wantDuplicates) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    m_wantDuplicates = wantDuplicates;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    m_pAdvertisedDeviceCallbacks = pAdvertisedDeviceCallbacks;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;} <span class="comment">// setAdvertisedDeviceCallbacks</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#ad8cff030c66cd9f5dbebb4320ca0f446">  179</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#ad8cff030c66cd9f5dbebb4320ca0f446">BLEScan::setInterval</a>(uint16_t intervalMSecs) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    m_scan_params.scan_interval = intervalMSecs / 0.625;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;} <span class="comment">// setInterval</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#ab14d7160a919c1db291d11244dcfd9af">  188</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#ab14d7160a919c1db291d11244dcfd9af">BLEScan::setWindow</a>(uint16_t windowMSecs) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    m_scan_params.scan_window = windowMSecs / 0.625;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;} <span class="comment">// setWindow</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a904d302f0f27360abe75b48e7373e228">  200</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_b_l_e_scan.html#a904d302f0f27360abe75b48e7373e228">BLEScan::start</a>(uint32_t duration, <span class="keywordtype">void</span> (*scanCompleteCB)(<a class="code" href="class_b_l_e_scan_results.html">BLEScanResults</a>), <span class="keywordtype">bool</span> is_continue) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; start(duration=%d)&quot;</span>, duration);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">take</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a>(<span class="stringliteral">&quot;start&quot;</span>));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    m_scanCompleteCB = scanCompleteCB;                  <span class="comment">// Save the callback to be invoked when the scan completes.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">//  if we are connecting to devices that are advertising even after being connected, multiconnecting peripherals</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">//  then we should not clear map or we will connect the same device few times</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span>(!is_continue) {  </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> _dev : m_scanResults.m_vectorAdvertisedDevices){</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keyword">delete</span> _dev.second;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        m_scanResults.m_vectorAdvertisedDevices.clear();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    esp_err_t errRc = ::esp_ble_gap_set_scan_params(&amp;m_scan_params);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_set_scan_params: err: %d, text: %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    errRc = ::esp_ble_gap_start_scanning(duration);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_start_scanning: err: %d, text: %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>();</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    m_stopped = <span class="keyword">false</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; start()&quot;</span>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;} <span class="comment">// start</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#aa892f23387fc65e83a026c3ddf500689">  243</a></span>&#160;<a class="code" href="class_b_l_e_scan_results.html">BLEScanResults</a> <a class="code" href="class_b_l_e_scan.html#a904d302f0f27360abe75b48e7373e228">BLEScan::start</a>(uint32_t duration, <span class="keywordtype">bool</span> is_continue) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_scan.html#a904d302f0f27360abe75b48e7373e228">start</a>(duration, <span class="keyword">nullptr</span>, is_continue)) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">wait</a>(<span class="stringliteral">&quot;start&quot;</span>);   <span class="comment">// Wait for the semaphore to release.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> m_scanResults;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;} <span class="comment">// start</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a7b78f3ca50d83be7a1448b4f5fdafa02">  255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#a7b78f3ca50d83be7a1448b4f5fdafa02">BLEScan::stop</a>() {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; stop()&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    esp_err_t errRc = ::esp_ble_gap_stop_scanning();</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    m_stopped = <span class="keyword">true</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    m_semaphoreScanEnd.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_stop_scanning: err: %d, text: %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; stop()&quot;</span>);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;} <span class="comment">// stop</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">// delete peer device from cache after disconnecting, it is required in case we are connecting to devices with not public address</span></div><div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a7253d090bf2e75530866af06070a4732">  272</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#a7253d090bf2e75530866af06070a4732">BLEScan::erase</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> address) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;erase device: %s&quot;</span>, address.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>().c_str());</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a> *advertisedDevice = m_scanResults.m_vectorAdvertisedDevices.find(address.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>())-&gt;second;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    m_scanResults.m_vectorAdvertisedDevices.erase(address.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>());</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keyword">delete</span> advertisedDevice;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="class_b_l_e_scan_results.html#aadc387bd2ffa7a8e23647d283ab33f04">  283</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan_results.html#aadc387bd2ffa7a8e23647d283ab33f04">BLEScanResults::dump</a>() {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; Dump scan results:&quot;</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>=0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;<a class="code" href="class_b_l_e_scan_results.html#a38bd57b6f5903e31e73eae2e730d051f">getCount</a>(); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;- %s&quot;</span>, <a class="code" href="class_b_l_e_scan_results.html#a84ad6b3dc03a837c5aaf30cd82a6f2e4">getDevice</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>).<a class="code" href="class_b_l_e_remote_characteristic.html#af9ac554d3521539d6618d9d8d55df7e7">toString</a>().c_str());</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;} <span class="comment">// dump</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="class_b_l_e_scan_results.html#a38bd57b6f5903e31e73eae2e730d051f">  295</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_b_l_e_scan_results.html#a38bd57b6f5903e31e73eae2e730d051f">BLEScanResults::getCount</a>() {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">return</span> m_vectorAdvertisedDevices.size();</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;} <span class="comment">// getCount</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="class_b_l_e_scan_results.html#a84ad6b3dc03a837c5aaf30cd82a6f2e4">  306</a></span>&#160;<a class="code" href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a> <a class="code" href="class_b_l_e_scan_results.html#a84ad6b3dc03a837c5aaf30cd82a6f2e4">BLEScanResults::getDevice</a>(uint32_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    uint32_t <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a> = 0;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a> dev = *m_vectorAdvertisedDevices.begin()-&gt;second;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = m_vectorAdvertisedDevices.begin(); <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> != m_vectorAdvertisedDevices.end(); <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>++) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        dev = *<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>-&gt;second;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>==<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>)   <span class="keywordflow">break</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>++;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">return</span> dev;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a4f0c22cd60e635b0296f23bf291e026f">  317</a></span>&#160;<a class="code" href="class_b_l_e_scan_results.html">BLEScanResults</a> <a class="code" href="class_b_l_e_scan.html#a4f0c22cd60e635b0296f23bf291e026f">BLEScan::getResults</a>() {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> m_scanResults;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="class_b_l_e_scan.html#a0743728430be242cff977efeab52cc22">  321</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_scan.html#a0743728430be242cff977efeab52cc22">BLEScan::clearResults</a>() {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> _dev : m_scanResults.m_vectorAdvertisedDevices){</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keyword">delete</span> _dev.second;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    m_scanResults.m_vectorAdvertisedDevices.clear();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CONFIG_BT_ENABLED */</span><span class="preprocessor"></span></div><div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a7253d090bf2e75530866af06070a4732"><div class="ttname"><a href="class_b_l_e_scan.html#a7253d090bf2e75530866af06070a4732">BLEScan::erase</a></div><div class="ttdeci">void erase(BLEAddress address)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00272">BLEScan.cpp:272</a></div></div>
<div class="ttc" id="ignore-content-length_8d_html_a06bf02a476389246deac1e3c53ee7e18"><div class="ttname"><a href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a></div><div class="ttdeci">Long Ignore the Content Length header.This is particularly useful for servers running Apache. x</div><div class="ttdef"><b>Definition:</b> <a href="ignore-content-length_8d_source.html#l00005">ignore-content-length.d:5</a></div></div>
<div class="ttc" id="class_b_l_e_address_html"><div class="ttname"><a href="class_b_l_e_address.html">BLEAddress</a></div><div class="ttdoc">A BLE device address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8h_source.html#l00021">BLEAddress.h:21</a></div></div>
<div class="ttc" id="_b_l_e_utils_8h_html"><div class="ttname"><a href="_b_l_e_utils_8h.html">BLEUtils.h</a></div></div>
<div class="ttc" id="_b_l_e_advertised_device_8h_html"><div class="ttname"><a href="_b_l_e_advertised_device_8h.html">BLEAdvertisedDevice.h</a></div></div>
<div class="ttc" id="class_b_l_e_advertised_device_html_a5d84a3eb5221ac3e15a636eb0c935715"><div class="ttname"><a href="class_b_l_e_advertised_device.html#a5d84a3eb5221ac3e15a636eb0c935715">BLEAdvertisedDevice::setAddressType</a></div><div class="ttdeci">void setAddressType(esp_ble_addr_type_t type)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertised_device_8cpp_source.html#l00518">BLEAdvertisedDevice.cpp:518</a></div></div>
<div class="ttc" id="class_b_l_e_advertised_device_callbacks_html_a981732b68c5427f6b58d6af960316b2c"><div class="ttname"><a href="class_b_l_e_advertised_device_callbacks.html#a981732b68c5427f6b58d6af960316b2c">BLEAdvertisedDeviceCallbacks::onResult</a></div><div class="ttdeci">virtual void onResult(BLEAdvertisedDevice advertisedDevice)=0</div><div class="ttdoc">Called when a new scan result is detected. </div></div>
<div class="ttc" id="connect-to_8d_html_a450c41f520f7661f0a48b8fd2597a74c"><div class="ttname"><a href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">string</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS meaning any host port.HOST2 and PORT2 may also be the empty string</div><div class="ttdef"><b>Definition:</b> <a href="connect-to_8d_source.html#l00014">connect-to.d:14</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a7b78f3ca50d83be7a1448b4f5fdafa02"><div class="ttname"><a href="class_b_l_e_scan.html#a7b78f3ca50d83be7a1448b4f5fdafa02">BLEScan::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Stop an in progress scan. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00255">BLEScan.cpp:255</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_ad1aa158e37d15363b4441482fae82dd8"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">FreeRTOS::Semaphore::give</a></div><div class="ttdeci">void give()</div><div class="ttdoc">Give a semaphore. The Semaphore is given. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00114">FreeRTOS.cpp:114</a></div></div>
<div class="ttc" id="class_b_l_e_scan_results_html"><div class="ttname"><a href="class_b_l_e_scan_results.html">BLEScanResults</a></div><div class="ttdoc">The result of having performed a scan. When a scan completes, we have a set of found devices...</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8h_source.html#l00033">BLEScan.h:33</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a0743728430be242cff977efeab52cc22"><div class="ttname"><a href="class_b_l_e_scan.html#a0743728430be242cff977efeab52cc22">BLEScan::clearResults</a></div><div class="ttdeci">void clearResults()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00321">BLEScan.cpp:321</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_ad8cff030c66cd9f5dbebb4320ca0f446"><div class="ttname"><a href="class_b_l_e_scan.html#ad8cff030c66cd9f5dbebb4320ca0f446">BLEScan::setInterval</a></div><div class="ttdeci">void setInterval(uint16_t intervalMSecs)</div><div class="ttdoc">Set the interval to scan. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00179">BLEScan.cpp:179</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_ab14d7160a919c1db291d11244dcfd9af"><div class="ttname"><a href="class_b_l_e_scan.html#ab14d7160a919c1db291d11244dcfd9af">BLEScan::setWindow</a></div><div class="ttdeci">void setWindow(uint16_t windowMSecs)</div><div class="ttdoc">Set the window to actively scan. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00188">BLEScan.cpp:188</a></div></div>
<div class="ttc" id="class_b_l_e_scan_results_html_a84ad6b3dc03a837c5aaf30cd82a6f2e4"><div class="ttname"><a href="class_b_l_e_scan_results.html#a84ad6b3dc03a837c5aaf30cd82a6f2e4">BLEScanResults::getDevice</a></div><div class="ttdeci">BLEAdvertisedDevice getDevice(uint32_t i)</div><div class="ttdoc">Return the specified device at the given index. The index should be between 0 and getCount()-1...</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00306">BLEScan.cpp:306</a></div></div>
<div class="ttc" id="class_b_l_e_scan_results_html_a38bd57b6f5903e31e73eae2e730d051f"><div class="ttname"><a href="class_b_l_e_scan_results.html#a38bd57b6f5903e31e73eae2e730d051f">BLEScanResults::getCount</a></div><div class="ttdeci">int getCount()</div><div class="ttdoc">Return the count of devices found in the last scan. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00295">BLEScan.cpp:295</a></div></div>
<div class="ttc" id="class_general_utils_html_a25e466e54ff002f54bfb7e1f43bd401b"><div class="ttname"><a href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a></div><div class="ttdeci">static const char * errorToString(esp_err_t errCode)</div><div class="ttdoc">Convert an ESP error code to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_general_utils_8cpp_source.html#l00366">GeneralUtils.cpp:366</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_a023cb404ff897bb39064b454732ccf21"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">FreeRTOS::Semaphore::wait</a></div><div class="ttdeci">uint32_t wait(std::string owner=&quot;&lt;Unknown&gt;&quot;)</div><div class="ttdoc">Wait for a semaphore to be released by trying to take it and then releasing it again. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00064">FreeRTOS.cpp:64</a></div></div>
<div class="ttc" id="class_b_l_e_address_html_a495521811cabfb55acd38e393f701508"><div class="ttname"><a href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">BLEAddress::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Convert a BLE address to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8cpp_source.html#l00085">BLEAddress.cpp:85</a></div></div>
<div class="ttc" id="class_b_l_e_advertised_device_callbacks_html"><div class="ttname"><a href="class_b_l_e_advertised_device_callbacks.html">BLEAdvertisedDeviceCallbacks</a></div><div class="ttdoc">A callback handler for callbacks associated device scanning. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertised_device_8h_source.html#l00110">BLEAdvertisedDevice.h:110</a></div></div>
<div class="ttc" id="class_b_l_e_remote_characteristic_html_af9ac554d3521539d6618d9d8d55df7e7"><div class="ttname"><a href="class_b_l_e_remote_characteristic.html#af9ac554d3521539d6618d9d8d55df7e7">BLERemoteCharacteristic::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Convert a BLERemoteCharacteristic to a string representation;. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_characteristic_8cpp_source.html#l00507">BLERemoteCharacteristic.cpp:507</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a1c6bac2afb7fb0eadab2131d86319316"><div class="ttname"><a href="class_b_l_e_scan.html#a1c6bac2afb7fb0eadab2131d86319316">BLEScan::setAdvertisedDeviceCallbacks</a></div><div class="ttdeci">void setAdvertisedDeviceCallbacks(BLEAdvertisedDeviceCallbacks *pAdvertisedDeviceCallbacks, bool wantDuplicates=false)</div><div class="ttdoc">Set the call backs to be invoked. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00169">BLEScan.cpp:169</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a4f0c22cd60e635b0296f23bf291e026f"><div class="ttname"><a href="class_b_l_e_scan.html#a4f0c22cd60e635b0296f23bf291e026f">BLEScan::getResults</a></div><div class="ttdeci">BLEScanResults getResults()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00317">BLEScan.cpp:317</a></div></div>
<div class="ttc" id="class_b_l_e_scan_results_html_aadc387bd2ffa7a8e23647d283ab33f04"><div class="ttname"><a href="class_b_l_e_scan_results.html#aadc387bd2ffa7a8e23647d283ab33f04">BLEScanResults::dump</a></div><div class="ttdeci">void dump()</div><div class="ttdoc">Dump the scan results to the log. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00283">BLEScan.cpp:283</a></div></div>
<div class="ttc" id="ftp-ssl-ccc-mode_8d_html_ac4f4031531425afe8fbe576a1e1d1642"><div class="ttname"><a href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a></div><div class="ttdeci">Long but instead wait for the server to do it</div><div class="ttdef"><b>Definition:</b> <a href="ftp-ssl-ccc-mode_8d_source.html#l00008">ftp-ssl-ccc-mode.d:8</a></div></div>
<div class="ttc" id="_b_l_e_scan_8h_html"><div class="ttname"><a href="_b_l_e_scan_8h.html">BLEScan.h</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a904d302f0f27360abe75b48e7373e228"><div class="ttname"><a href="class_b_l_e_scan.html#a904d302f0f27360abe75b48e7373e228">BLEScan::start</a></div><div class="ttdeci">bool start(uint32_t duration, void(*scanCompleteCB)(BLEScanResults), bool is_continue=false)</div><div class="ttdoc">Start scanning. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00200">BLEScan.cpp:200</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_a67fa9bf777be48332a30154e006827fd"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">FreeRTOS::Semaphore::take</a></div><div class="ttdeci">bool take(std::string owner=&quot;&lt;Unknown&gt;&quot;)</div><div class="ttdoc">Take a semaphore. Take a semaphore and wait indefinitely. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00159">FreeRTOS.cpp:159</a></div></div>
<div class="ttc" id="class_b_l_e_advertised_device_html"><div class="ttname"><a href="class_b_l_e_advertised_device.html">BLEAdvertisedDevice</a></div><div class="ttdoc">A representation of a BLE advertised device found by a scan. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertised_device_8h_source.html#l00028">BLEAdvertisedDevice.h:28</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html_a02e4e5e7297aaa66648e170ebc5ace62"><div class="ttname"><a href="class_b_l_e_scan.html#a02e4e5e7297aaa66648e170ebc5ace62">BLEScan::setActiveScan</a></div><div class="ttdeci">void setActiveScan(bool active)</div><div class="ttdoc">Should we perform an active or passive scan? The default is a passive scan. An active scan means that...</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8cpp_source.html#l00155">BLEScan.cpp:155</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_b_l_e_scan_8cpp.html">BLEScan.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
