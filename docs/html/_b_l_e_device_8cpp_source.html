<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/BLEDevice.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_b_l_e_device_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLEDevice.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_b_l_e_device_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * BLE.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Mar 16, 2017</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#if defined(CONFIG_BT_ENABLED)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;freertos/FreeRTOS.h&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;freertos/event_groups.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;freertos/task.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;esp_err.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;nvs_flash.h&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;esp_bt.h&gt;</span>            <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;esp_bt_device.h&gt;</span>     <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;esp_bt_main.h&gt;</span>       <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;esp_gap_ble_api.h&gt;</span>   <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;esp_gatts_api.h&gt;</span>     <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;esp_gattc_api.h&gt;</span>     <span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;esp_gatt_common_api.h&gt;</span><span class="comment">// ESP32 BLE</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;esp_err.h&gt;</span>           <span class="comment">// ESP32 ESP-IDF</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span>           <span class="comment">// ESP32 ESP-IDF</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span>                 <span class="comment">// Part of C++ Standard library</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span>             <span class="comment">// Part of C++ Standard library</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span>             <span class="comment">// Part of C++ Standard library</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_device_8h.html">BLEDevice.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_client_8h.html">BLEClient.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_utils_8h.html">BLEUtils.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#ifdef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;esp32-hal-log.h&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;esp32-hal-bt.h&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;BLEDevice&quot;</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<a class="code" href="class_b_l_e_server.html">BLEServer</a>* BLEDevice::m_pServer = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="class_b_l_e_scan.html">BLEScan</a>*   BLEDevice::m_pScan   = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="class_b_l_e_client.html">BLEClient</a>* BLEDevice::m_pClient = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">   44</a></span>&#160;<span class="keywordtype">bool</span>       <a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a>          = <span class="keyword">false</span>;  </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;esp_ble_sec_act_t <a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a> = (esp_ble_sec_act_t)0;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<a class="code" href="class_b_l_e_security_callbacks.html">BLESecurityCallbacks</a>* BLEDevice::m_securityCallbacks = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;uint16_t   <a class="code" href="class_b_l_e_device.html#a7115b4df114617f517f6247396815679">BLEDevice::m_localMTU</a> = 23;  <span class="comment">// not sure if this variable is useful</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="class_b_l_e_advertising.html">BLEAdvertising</a>* BLEDevice::m_bleAdvertising = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;uint16_t <a class="code" href="class_b_l_e_device.html#a9c83ccd1b47eaa043f33688d588429ae">BLEDevice::m_appId</a> = 0;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;std::map&lt;uint16_t, conn_status_t&gt; BLEDevice::m_connectedClientsMap;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<a class="code" href="_b_l_e_device_8h.html#abd9890645a85c288c3fd2b14a6d5a348">gap_event_handler</a> <a class="code" href="class_b_l_e_device.html#aa75a33081ca88f08617281cd907ca02b">BLEDevice::m_customGapHandler</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="_b_l_e_device_8h.html#ab14024e2468ed6aba01673d77dda72b1">gattc_event_handler</a> <a class="code" href="class_b_l_e_device.html#a4b18e4679058dceab8c4f674e181931a">BLEDevice::m_customGattcHandler</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<a class="code" href="_b_l_e_device_8h.html#abb37a4510f0ef411763e86f65dd455c3">gatts_event_handler</a> <a class="code" href="class_b_l_e_device.html#a18e4c8e824054837d7b6a04b5f1c3091">BLEDevice::m_customGattsHandler</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a43c500c5e9bcfb046404e7996ec87d48">   59</a></span>&#160;<span class="comment">/* STATIC */</span> <a class="code" href="class_b_l_e_client.html">BLEClient</a>* <a class="code" href="class_b_l_e_device.html#a43c500c5e9bcfb046404e7996ec87d48">BLEDevice::createClient</a>() {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; createClient&quot;</span>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#ifndef CONFIG_GATTC_ENABLE  // Check that BLE GATTC is enabled in make menuconfig</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;BLE GATTC is not enabled - CONFIG_GATTC_ENABLE not defined&quot;</span>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    abort();</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#endif  // CONFIG_GATTC_ENABLE</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    m_pClient = <span class="keyword">new</span> <a class="code" href="class_b_l_e_client.html">BLEClient</a>();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; createClient&quot;</span>);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">return</span> m_pClient;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;} <span class="comment">// createClient</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a51834f804f8ed7d358aa2ba15f07459f">   75</a></span>&#160;<span class="comment">/* STATIC */</span> <a class="code" href="class_b_l_e_server.html">BLEServer</a>* <a class="code" href="class_b_l_e_device.html#a51834f804f8ed7d358aa2ba15f07459f">BLEDevice::createServer</a>() {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; createServer&quot;</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#ifndef CONFIG_GATTS_ENABLE  // Check that BLE GATTS is enabled in make menuconfig</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;BLE GATTS is not enabled - CONFIG_GATTS_ENABLE not defined&quot;</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    abort();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#endif // CONFIG_GATTS_ENABLE</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    m_pServer = <span class="keyword">new</span> <a class="code" href="class_b_l_e_server.html">BLEServer</a>();</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    m_pServer-&gt;createApp(<a class="code" href="class_b_l_e_device.html#a9c83ccd1b47eaa043f33688d588429ae">m_appId</a>++);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; createServer&quot;</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">return</span> m_pServer;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;} <span class="comment">// createServer</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> BLEDevice::gattServerEventHandler(</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   esp_gatts_cb_event_t      event,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   esp_gatt_if_t             gatts_if,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   esp_ble_gatts_cb_param_t* param</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;gattServerEventHandler [esp_gatt_if: %d] ... %s&quot;</span>,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        gatts_if,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="class_b_l_e_utils.html#acb35970d17947515e04bd77af6a5f0f9">BLEUtils::gattServerEventTypeToString</a>(event).c_str());</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="class_b_l_e_utils.html#a3bc774564d748a26434d556b3991db64">BLEUtils::dumpGattServerEvent</a>(event, gatts_if, param);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_CONNECT_EVT: {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a>){</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                esp_ble_set_encryption(param-&gt;connect.remote_bda, <a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        } <span class="comment">// ESP_GATTS_CONNECT_EVT</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    } <span class="comment">// switch</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (BLEDevice::m_pServer != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        BLEDevice::m_pServer-&gt;handleGATTServerEvent(event, gatts_if, param);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_device.html#a18e4c8e824054837d7b6a04b5f1c3091">m_customGattsHandler</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="class_b_l_e_device.html#a18e4c8e824054837d7b6a04b5f1c3091">m_customGattsHandler</a>(event, gatts_if, param);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} <span class="comment">// gattServerEventHandler</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> BLEDevice::gattClientEventHandler(</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    esp_gattc_cb_event_t      event,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    esp_gatt_if_t             gattc_if,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    esp_ble_gattc_cb_param_t* param) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;gattClientEventHandler [esp_gatt_if: %d] ... %s&quot;</span>,</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        gattc_if, <a class="code" href="class_b_l_e_utils.html#a0cc7ec1c40c17c7f04ed31e2166e656c">BLEUtils::gattClientEventTypeToString</a>(event).c_str());</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="class_b_l_e_utils.html#a734f6e195393214f34ac891a413ad524">BLEUtils::dumpGattClientEvent</a>(event, gattc_if, param);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">switch</span>(event) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">case</span> ESP_GATTC_CONNECT_EVT: {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a>){</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                esp_ble_set_encryption(param-&gt;connect.remote_bda, <a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        } <span class="comment">// ESP_GATTS_CONNECT_EVT</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    } <span class="comment">// switch</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> &amp;myPair : <a class="code" href="class_b_l_e_device.html#a05a1d53d87641fcc35e1c5cd73c1162a">BLEDevice::getPeerDevices</a>(<span class="keyword">true</span>)) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="structconn__status__t.html">conn_status_t</a> conn_status = (<a class="code" href="structconn__status__t.html">conn_status_t</a>)myPair.second;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span>(((<a class="code" href="class_b_l_e_client.html">BLEClient</a>*)conn_status.<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a>)-&gt;getGattcIf() == gattc_if || ((<a class="code" href="class_b_l_e_client.html">BLEClient</a>*)conn_status.<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a>)-&gt;getGattcIf() == ESP_GATT_IF_NONE || gattc_if == ESP_GATT_IF_NONE){</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            ((<a class="code" href="class_b_l_e_client.html">BLEClient</a>*)conn_status.<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a>)-&gt;gattClientEventHandler(event, gattc_if, param);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_device.html#a4b18e4679058dceab8c4f674e181931a">m_customGattcHandler</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="class_b_l_e_device.html#a4b18e4679058dceab8c4f674e181931a">m_customGattcHandler</a>(event, gattc_if, param);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;} <span class="comment">// gattClientEventHandler</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> BLEDevice::gapEventHandler(</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    esp_gap_ble_cb_event_t event,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    esp_ble_gap_cb_param_t *param) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="class_b_l_e_utils.html#aad0760becb846a02bfbf57a400e56443">BLEUtils::dumpGapEvent</a>(event, param);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">switch</span>(event) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_OOB_REQ_EVT:                                <span class="comment">/* OOB request event */</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_OOB_REQ_EVT&quot;</span>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_LOCAL_IR_EVT:                               <span class="comment">/* BLE local IR event */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_LOCAL_IR_EVT&quot;</span>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_LOCAL_ER_EVT:                               <span class="comment">/* BLE local ER event */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_LOCAL_ER_EVT&quot;</span>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_NC_REQ_EVT:                               <span class="comment">/*  NUMERIC CONFIRMATION  */</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_NC_REQ_EVT&quot;</span>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">if</span>(BLEDevice::m_securityCallbacks != <span class="keyword">nullptr</span>){</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                 esp_ble_confirm_reply(param-&gt;ble_security.ble_req.bd_addr, BLEDevice::m_securityCallbacks-&gt;onConfirmPIN(param-&gt;ble_security.key_notif.passkey));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_PASSKEY_REQ_EVT:                           <span class="comment">/* passkey request event */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_PASSKEY_REQ_EVT: &quot;</span>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="comment">// esp_log_buffer_hex(LOG_TAG, m_remote_bda, sizeof(m_remote_bda));</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">if</span>(BLEDevice::m_securityCallbacks != <span class="keyword">nullptr</span>){</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                esp_ble_passkey_reply(param-&gt;ble_security.ble_req.bd_addr, <span class="keyword">true</span>, BLEDevice::m_securityCallbacks-&gt;onPassKeyRequest());</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">             * TODO should we add white/black list comparison?</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_SEC_REQ_EVT:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;             <span class="comment">/* send the positive(true) security response to the peer device to accept the security request.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">             If not accept the security request, should sent the security response with negative(false) accept value*/</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_SEC_REQ_EVT&quot;</span>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">if</span>(BLEDevice::m_securityCallbacks!=<span class="keyword">nullptr</span>){</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                esp_ble_gap_security_rsp(param-&gt;ble_security.ble_req.bd_addr, BLEDevice::m_securityCallbacks-&gt;onSecurityRequest());</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                esp_ble_gap_security_rsp(param-&gt;ble_security.ble_req.bd_addr, <span class="keyword">true</span>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;             <span class="comment">/*</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">              *</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">              */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_PASSKEY_NOTIF_EVT:  <span class="comment">//the app will receive this evt when the IO  has Output capability and the peer device IO has Input capability.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;             <span class="comment">//display the passkey number to the user to input it in the peer deivce within 30 seconds</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_PASSKEY_NOTIF_EVT&quot;</span>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;passKey = %d&quot;</span>, param-&gt;ble_security.key_notif.passkey);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span>(BLEDevice::m_securityCallbacks!=<span class="keyword">nullptr</span>){</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                BLEDevice::m_securityCallbacks-&gt;<a class="code" href="class_b_l_e_security_callbacks.html#a94ef43a832c247440a2c7267cc5e41e3">onPassKeyNotify</a>(param-&gt;ble_security.key_notif.passkey);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_KEY_EVT:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;             <span class="comment">//shows the ble key type info share with peer device to the user.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;             ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_KEY_EVT&quot;</span>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;key type = %s&quot;</span>, <a class="code" href="class_b_l_e_security.html#a911436a4dce7bdff3bd08f90c4f86e76">BLESecurity::esp_key_type_to_str</a>(param-&gt;ble_security.ble_key.key_type));</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;         <span class="keywordflow">case</span> ESP_GAP_BLE_AUTH_CMPL_EVT:</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;             ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;ESP_GAP_BLE_AUTH_CMPL_EVT&quot;</span>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;             <span class="keywordflow">if</span>(BLEDevice::m_securityCallbacks != <span class="keyword">nullptr</span>){</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                 BLEDevice::m_securityCallbacks-&gt;<a class="code" href="class_b_l_e_security_callbacks.html#a8d9987f3d4c6c2850b4533cb76bacc47">onAuthenticationComplete</a>(param-&gt;ble_security.auth_cmpl);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;             }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#endif  // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;             <span class="keywordflow">break</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    } <span class="comment">// switch</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (BLEDevice::m_pClient != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        BLEDevice::m_pClient-&gt;<a class="code" href="class_b_l_e_client.html#a26f856ebef790cc89dc99d3ff5a185b4">handleGAPEvent</a>(event, param);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (BLEDevice::m_pScan != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <a class="code" href="class_b_l_e_device.html#ab33f8aaf0d2cc2d7a9d70f991dec9275">BLEDevice::getScan</a>()-&gt;handleGAPEvent(event, param);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span>(m_bleAdvertising != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">BLEDevice::getAdvertising</a>()-&gt;<a class="code" href="class_b_l_e_advertising.html#aad8a200dddb09656d077bffe267dd27c">handleGAPEvent</a>(event, param);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_b_l_e_device.html#aa75a33081ca88f08617281cd907ca02b">m_customGapHandler</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="class_b_l_e_device.html#aa75a33081ca88f08617281cd907ca02b">BLEDevice::m_customGapHandler</a>(event, param);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;} <span class="comment">// gapEventHandler</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a5eeca24a85afbf0b82fc7db61e42552c">  288</a></span>&#160;<span class="comment">/* STATIC*/</span> <a class="code" href="class_b_l_e_address.html">BLEAddress</a> <a class="code" href="class_b_l_e_device.html#a5eeca24a85afbf0b82fc7db61e42552c">BLEDevice::getAddress</a>() {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keyword">const</span> uint8_t* bdAddr = esp_bt_dev_get_address();</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    esp_bd_addr_t addr;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(addr, bdAddr, <span class="keyword">sizeof</span>(addr));</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_b_l_e_address.html">BLEAddress</a>(addr);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;} <span class="comment">// getAddress</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#ab33f8aaf0d2cc2d7a9d70f991dec9275">  301</a></span>&#160;<span class="comment">/* STATIC */</span> <a class="code" href="class_b_l_e_scan.html">BLEScan</a>* <a class="code" href="class_b_l_e_device.html#ab33f8aaf0d2cc2d7a9d70f991dec9275">BLEDevice::getScan</a>() {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">//ESP_LOGD(LOG_TAG, &quot;&gt;&gt; getScan&quot;);</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (m_pScan == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        m_pScan = <span class="keyword">new</span> <a class="code" href="class_b_l_e_scan.html">BLEScan</a>();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">//ESP_LOGD(LOG_TAG, &quot; - creating a new scan object&quot;);</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">//ESP_LOGD(LOG_TAG, &quot;&lt;&lt; getScan: Returning object at 0x%x&quot;, (uint32_t)m_pScan);</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> m_pScan;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;} <span class="comment">// getScan</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#ae849b214184223a3bdd0c5b30c1d033e">  318</a></span>&#160;<span class="comment">/* STATIC */</span> <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_b_l_e_device.html#ae849b214184223a3bdd0c5b30c1d033e">BLEDevice::getValue</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> bdAddress, <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> serviceUUID, <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> characteristicUUID) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; getValue: bdAddress: %s, serviceUUID: %s, characteristicUUID: %s&quot;</span>, bdAddress.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>().c_str(), serviceUUID.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str(), characteristicUUID.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="class_b_l_e_client.html">BLEClient</a>* pClient = <a class="code" href="class_b_l_e_device.html#a43c500c5e9bcfb046404e7996ec87d48">createClient</a>();</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    pClient-&gt;connect(bdAddress);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> ret = pClient-&gt;getValue(serviceUUID, characteristicUUID);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    pClient-&gt;disconnect();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; getValue&quot;</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;} <span class="comment">// getValue</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a804a83266c71073f9f21eda47b5a3533">  333</a></span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a804a83266c71073f9f21eda47b5a3533">BLEDevice::init</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> deviceName) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a>){</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a> = <span class="keyword">true</span>; <span class="comment">// Set the initialization flag to ensure we are only initialized once.</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        esp_err_t errRc = ESP_OK;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#ifdef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">if</span> (!btStart()) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            errRc = ESP_FAIL;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        errRc = <a class="code" href="connect__with__static__ip_8c.html#a384dacd0c224cb8c2216c22676ba8f5d">::nvs_flash_init</a>();</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;nvs_flash_init: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">#ifndef CLASSIC_BT_ENABLED</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        esp_bt_controller_mem_release(ESP_BT_MODE_CLASSIC_BT);  </div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        esp_bt_controller_config_t bt_cfg = BT_CONTROLLER_INIT_CONFIG_DEFAULT();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        errRc = esp_bt_controller_init(&amp;bt_cfg);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_bt_controller_init: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#ifndef CLASSIC_BT_ENABLED</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        errRc = esp_bt_controller_enable(ESP_BT_MODE_BLE);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_bt_controller_enable: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        errRc = esp_bt_controller_enable(ESP_BT_MODE_BTDM);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_bt_controller_enable: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        esp_bluedroid_status_t bt_state = esp_bluedroid_get_status();</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> (bt_state == ESP_BLUEDROID_STATUS_UNINITIALIZED) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            errRc = esp_bluedroid_init();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_bluedroid_init: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">if</span> (bt_state != ESP_BLUEDROID_STATUS_ENABLED) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            errRc = esp_bluedroid_enable();</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_bluedroid_enable: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        errRc = esp_ble_gap_register_callback(BLEDevice::gapEventHandler);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_register_callback: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor">#ifdef CONFIG_GATTC_ENABLE   // Check that BLE client is configured in make menuconfig</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        errRc = esp_ble_gattc_register_callback(BLEDevice::gattClientEventHandler);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gattc_register_callback: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">#endif   // CONFIG_GATTC_ENABLE</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor">#ifdef CONFIG_GATTS_ENABLE  // Check that BLE server is configured in make menuconfig</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        errRc = esp_ble_gatts_register_callback(BLEDevice::gattServerEventHandler);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gatts_register_callback: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">#endif   // CONFIG_GATTS_ENABLE</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        errRc = ::esp_ble_gap_set_device_name(deviceName.c_str());</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_set_device_name: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        };</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#ifdef CONFIG_BLE_SMP_ENABLE   // Check that BLE SMP (security) is configured in make menuconfig</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        esp_ble_io_cap_t iocap = ESP_IO_CAP_NONE;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        errRc = ::esp_ble_gap_set_security_param(ESP_BLE_SM_IOCAP_MODE, &amp;iocap, <span class="keyword">sizeof</span>(uint8_t));</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_set_security_param: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        };</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#endif // CONFIG_BLE_SMP_ENABLE</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    vTaskDelay(200 / portTICK_PERIOD_MS); <span class="comment">// Delay for 200 msecs as a workaround to an apparent Arduino environment issue.</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;} <span class="comment">// init</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a36e739d565b48ce6c7eeef6d43b4cf18">  446</a></span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a36e739d565b48ce6c7eeef6d43b4cf18">BLEDevice::setPower</a>(esp_power_level_t powerLevel) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setPower: %d&quot;</span>, powerLevel);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    esp_err_t errRc = ::esp_ble_tx_power_set(ESP_BLE_PWR_TYPE_DEFAULT, powerLevel);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_tx_power_set: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    };</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; setPower&quot;</span>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;} <span class="comment">// setPower</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#abc987337d9edfd0d5a859d75b91fef72">  462</a></span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#abc987337d9edfd0d5a859d75b91fef72">BLEDevice::setValue</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> bdAddress, <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> serviceUUID, <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> characteristicUUID, <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setValue: bdAddress: %s, serviceUUID: %s, characteristicUUID: %s&quot;</span>, bdAddress.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>().c_str(), serviceUUID.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str(), characteristicUUID.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="class_b_l_e_client.html">BLEClient</a>* pClient = <a class="code" href="class_b_l_e_device.html#a43c500c5e9bcfb046404e7996ec87d48">createClient</a>();</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    pClient-&gt;connect(bdAddress);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    pClient-&gt;setValue(serviceUUID, characteristicUUID, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    pClient-&gt;disconnect();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;} <span class="comment">// setValue</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">  475</a></span>&#160;<span class="comment">/* STATIC */</span> <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a>() {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;BD Address: &quot;</span> &lt;&lt; <a class="code" href="class_b_l_e_device.html#a5eeca24a85afbf0b82fc7db61e42552c">getAddress</a>().<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span> oss.str();</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;} <span class="comment">// toString</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a7f454eb3eafbc79b11831354158f4814">  486</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a7f454eb3eafbc79b11831354158f4814">BLEDevice::whiteListAdd</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> address) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; whiteListAdd: %s&quot;</span>, address.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>().c_str());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    esp_err_t errRc = esp_ble_gap_update_whitelist(<span class="keyword">true</span>, *address.<a class="code" href="class_b_l_e_address.html#a4c11bcce1d6ebf907e9a3c4f318bde2e">getNative</a>());  <span class="comment">// True to add an entry.</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_update_whitelist: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; whiteListAdd&quot;</span>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;} <span class="comment">// whiteListAdd</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a205edba5bde67d44c6aeaa3b345e22ba">  500</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a205edba5bde67d44c6aeaa3b345e22ba">BLEDevice::whiteListRemove</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> address) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; whiteListRemove: %s&quot;</span>, address.<a class="code" href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">toString</a>().c_str());</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    esp_err_t errRc = esp_ble_gap_update_whitelist(<span class="keyword">false</span>, *address.<a class="code" href="class_b_l_e_address.html#a4c11bcce1d6ebf907e9a3c4f318bde2e">getNative</a>());  <span class="comment">// False to remove an entry.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gap_update_whitelist: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; whiteListRemove&quot;</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;} <span class="comment">// whiteListRemove</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment"> * @brief Set encryption level that will be negotiated with peer device durng connection</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment"> * @param [in] level Requested encryption level</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a4160b81bf7a467f22b13fa72a36daa46">  513</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a4160b81bf7a467f22b13fa72a36daa46">BLEDevice::setEncryptionLevel</a>(esp_ble_sec_act_t level) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a> = level;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment"> * @brief Set callbacks that will be used to handle encryption negotiation events and authentication events</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> * @param [in] cllbacks Pointer to BLESecurityCallbacks class callback</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a0e899cb20ba3cff71eb1aa6d2c3af786">  521</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a0e899cb20ba3cff71eb1aa6d2c3af786">BLEDevice::setSecurityCallbacks</a>(<a class="code" href="class_b_l_e_security_callbacks.html">BLESecurityCallbacks</a>* callbacks) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    BLEDevice::m_securityCallbacks = callbacks;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"> * @brief Setup local mtu that will be used to negotiate mtu during request from client peer</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"> * @param [in] mtu Value to set local mtu, should be larger than 23 and lower or equal to 517</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a4e441297651357bd5685dc74de3c5ec6">  529</a></span>&#160;esp_err_t <a class="code" href="class_b_l_e_device.html#a4e441297651357bd5685dc74de3c5ec6">BLEDevice::setMTU</a>(uint16_t mtu) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setLocalMTU: %d&quot;</span>, mtu);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    esp_err_t err = esp_ble_gatt_set_local_mtu(mtu);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (err == ESP_OK) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="class_b_l_e_device.html#a7115b4df114617f517f6247396815679">m_localMTU</a> = mtu;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;can&#39;t set local mtu value: %d&quot;</span>, mtu);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; setLocalMTU&quot;</span>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">return</span> err;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"> * @brief Get local MTU value set during mtu request or default value</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a7b7e170f9d222323bf813baecd03a92b">  544</a></span>&#160;uint16_t <a class="code" href="class_b_l_e_device.html#a7b7e170f9d222323bf813baecd03a92b">BLEDevice::getMTU</a>() {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_b_l_e_device.html#a7115b4df114617f517f6247396815679">m_localMTU</a>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a438be1748c096dab092bcdb4892d9a1c">  548</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_b_l_e_device.html#a438be1748c096dab092bcdb4892d9a1c">BLEDevice::getInitialized</a>() {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">  552</a></span>&#160;<a class="code" href="class_b_l_e_advertising.html">BLEAdvertising</a>* <a class="code" href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">BLEDevice::getAdvertising</a>() {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span>(m_bleAdvertising == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        m_bleAdvertising = <span class="keyword">new</span> <a class="code" href="class_b_l_e_advertising.html">BLEAdvertising</a>();</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;create advertising&quot;</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;get advertising&quot;</span>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">return</span> m_bleAdvertising; </div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a1f16045c3a431adaff5b51dff9c1c418">  561</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a1f16045c3a431adaff5b51dff9c1c418">BLEDevice::startAdvertising</a>() {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; startAdvertising&quot;</span>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">getAdvertising</a>()-&gt;<a class="code" href="class_b_l_e_advertising.html#ae0f3ec86cac1eb5ea8caa27f273a9f33">start</a>();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; startAdvertising&quot;</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;} <span class="comment">// startAdvertising</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">/* multi connect support */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">/* requires a little more work */</span></div><div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a05a1d53d87641fcc35e1c5cd73c1162a">  569</a></span>&#160;std::map&lt;uint16_t, conn_status_t&gt; <a class="code" href="class_b_l_e_device.html#a05a1d53d87641fcc35e1c5cd73c1162a">BLEDevice::getPeerDevices</a>(<span class="keywordtype">bool</span> _client) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">return</span> m_connectedClientsMap;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#af51447985b28c60af7ca2020667b61ea">  573</a></span>&#160;<a class="code" href="class_b_l_e_client.html">BLEClient</a>* <a class="code" href="class_b_l_e_device.html#af51447985b28c60af7ca2020667b61ea">BLEDevice::getClientByGattIf</a>(uint16_t conn_id) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="class_b_l_e_client.html">BLEClient</a>*)m_connectedClientsMap.find(conn_id)-&gt;second.peer_device;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#ae4ce2ef9c6b3b5db6682dda4912e7915">  577</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#ae4ce2ef9c6b3b5db6682dda4912e7915">BLEDevice::updatePeerDevice</a>(<span class="keywordtype">void</span>* <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, <span class="keywordtype">bool</span> _client, uint16_t conn_id) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;update conn_id: %d, GATT role: %s&quot;</span>, conn_id, _client? <span class="stringliteral">&quot;client&quot;</span>:<span class="stringliteral">&quot;server&quot;</span>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    std::map&lt;uint16_t, conn_status_t&gt;::iterator <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = m_connectedClientsMap.find(ESP_GATT_IF_NONE);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> != m_connectedClientsMap.end()) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        std::swap(m_connectedClientsMap[conn_id], <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>-&gt;second);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        m_connectedClientsMap.erase(<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = m_connectedClientsMap.find(conn_id);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> != m_connectedClientsMap.end()) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <a class="code" href="structconn__status__t.html">conn_status_t</a> _st = <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>-&gt;second;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            _st.<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a> = <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            std::swap(m_connectedClientsMap[conn_id], _st);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a5c7aa94032cc83fb2ac81b4cd7381b8b">  593</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a5c7aa94032cc83fb2ac81b4cd7381b8b">BLEDevice::addPeerDevice</a>(<span class="keywordtype">void</span>* <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, <span class="keywordtype">bool</span> _client, uint16_t conn_id) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;add conn_id: %d, GATT role: %s&quot;</span>, conn_id, _client? <span class="stringliteral">&quot;client&quot;</span>:<span class="stringliteral">&quot;server&quot;</span>);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="structconn__status__t.html">conn_status_t</a> status = {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        .<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a> = <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        .connected = <span class="keyword">true</span>,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        .mtu = 23</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    };</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    m_connectedClientsMap.insert(std::pair&lt;uint16_t, conn_status_t&gt;(conn_id, status));</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a239ac61bffa6e3fbc95a68591de0063b">  604</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a239ac61bffa6e3fbc95a68591de0063b">BLEDevice::removePeerDevice</a>(uint16_t conn_id, <span class="keywordtype">bool</span> _client) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    ESP_LOGI(LOG_TAG, <span class="stringliteral">&quot;remove: %d, GATT role %s&quot;</span>, conn_id, _client?<span class="stringliteral">&quot;client&quot;</span>:<span class="stringliteral">&quot;server&quot;</span>);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span>(m_connectedClientsMap.find(conn_id) != m_connectedClientsMap.end())</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        m_connectedClientsMap.erase(conn_id);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/* multi connect support */</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#ae9d6805c4644e4b7e9940af32e0a3fa4">  616</a></span>&#160;<span class="comment">/* STATIC */</span> <span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#ae9d6805c4644e4b7e9940af32e0a3fa4">BLEDevice::deinit</a>(<span class="keywordtype">bool</span> release_memory) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a>) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    esp_bluedroid_disable();</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    esp_bluedroid_deinit();</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    esp_bt_controller_disable();</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    esp_bt_controller_deinit();</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor">#ifndef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (release_memory) {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        esp_bt_controller_mem_release(ESP_BT_MODE_BTDM);  <span class="comment">// &lt;-- require tests because we released classic BT memory and this can cause crash (most likely not, esp-idf takes care of it)</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <a class="code" href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a> = <span class="keyword">false</span>;   </div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    } </div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a0138f8d2a811a7f60994b5c169649336">  632</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a0138f8d2a811a7f60994b5c169649336">BLEDevice::setCustomGapHandler</a>(<a class="code" href="_b_l_e_device_8h.html#abd9890645a85c288c3fd2b14a6d5a348">gap_event_handler</a> handler) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="class_b_l_e_device.html#aa75a33081ca88f08617281cd907ca02b">m_customGapHandler</a> = handler;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#a331bdf3a0da2e2dd3e6d1e69ff08b98c">  636</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#a331bdf3a0da2e2dd3e6d1e69ff08b98c">BLEDevice::setCustomGattcHandler</a>(<a class="code" href="_b_l_e_device_8h.html#ab14024e2468ed6aba01673d77dda72b1">gattc_event_handler</a> handler) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="class_b_l_e_device.html#a4b18e4679058dceab8c4f674e181931a">m_customGattcHandler</a> = handler;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="class_b_l_e_device.html#af4aca00f817b17d50f5ab92c04290b52">  640</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_device.html#af4aca00f817b17d50f5ab92c04290b52">BLEDevice::setCustomGattsHandler</a>(<a class="code" href="_b_l_e_device_8h.html#abb37a4510f0ef411763e86f65dd455c3">gatts_event_handler</a> handler) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="class_b_l_e_device.html#a18e4c8e824054837d7b6a04b5f1c3091">m_customGattsHandler</a> = handler;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;}</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="preprocessor">#endif // CONFIG_BT_ENABLED</span></div><div class="ttc" id="class_b_l_e_u_u_i_d_html"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html">BLEUUID</a></div><div class="ttdoc">A model of a BLE UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8h_source.html#l00018">BLEUUID.h:18</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a4b18e4679058dceab8c4f674e181931a"><div class="ttname"><a href="class_b_l_e_device.html#a4b18e4679058dceab8c4f674e181931a">BLEDevice::m_customGattcHandler</a></div><div class="ttdeci">static gattc_event_handler m_customGattcHandler</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00093">BLEDevice.h:93</a></div></div>
<div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_advertising_html_aad8a200dddb09656d077bffe267dd27c"><div class="ttname"><a href="class_b_l_e_advertising.html#aad8a200dddb09656d077bffe267dd27c">BLEAdvertising::handleGAPEvent</a></div><div class="ttdeci">void handleGAPEvent(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertising_8cpp_source.html#l00473">BLEAdvertising.cpp:473</a></div></div>
<div class="ttc" id="class_b_l_e_address_html"><div class="ttname"><a href="class_b_l_e_address.html">BLEAddress</a></div><div class="ttdoc">A BLE device address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8h_source.html#l00021">BLEAddress.h:21</a></div></div>
<div class="ttc" id="_b_l_e_utils_8h_html"><div class="ttname"><a href="_b_l_e_utils_8h.html">BLEUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_ae9d6805c4644e4b7e9940af32e0a3fa4"><div class="ttname"><a href="class_b_l_e_device.html#ae9d6805c4644e4b7e9940af32e0a3fa4">BLEDevice::deinit</a></div><div class="ttdeci">static void deinit(bool release_memory=false)</div><div class="ttdoc">de-Initialize the BLE environment. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00616">BLEDevice.cpp:616</a></div></div>
<div class="ttc" id="_b_l_e_device_8h_html"><div class="ttname"><a href="_b_l_e_device_8h.html">BLEDevice.h</a></div></div>
<div class="ttc" id="_b_l_e_device_8h_html_abd9890645a85c288c3fd2b14a6d5a348"><div class="ttname"><a href="_b_l_e_device_8h.html#abd9890645a85c288c3fd2b14a6d5a348">gap_event_handler</a></div><div class="ttdeci">void(* gap_event_handler)(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param)</div><div class="ttdoc">BLE functions. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00027">BLEDevice.h:27</a></div></div>
<div class="ttc" id="connect-to_8d_html_a450c41f520f7661f0a48b8fd2597a74c"><div class="ttname"><a href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">string</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS meaning any host port.HOST2 and PORT2 may also be the empty string</div><div class="ttdef"><b>Definition:</b> <a href="connect-to_8d_source.html#l00014">connect-to.d:14</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a5eeca24a85afbf0b82fc7db61e42552c"><div class="ttname"><a href="class_b_l_e_device.html#a5eeca24a85afbf0b82fc7db61e42552c">BLEDevice::getAddress</a></div><div class="ttdeci">static BLEAddress getAddress()</div><div class="ttdoc">Get the BLE device address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00288">BLEDevice.cpp:288</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_a0cc7ec1c40c17c7f04ed31e2166e656c"><div class="ttname"><a href="class_b_l_e_utils.html#a0cc7ec1c40c17c7f04ed31e2166e656c">BLEUtils::gattClientEventTypeToString</a></div><div class="ttdeci">static std::string gattClientEventTypeToString(esp_gattc_cb_event_t eventType)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l00863">BLEUtils.cpp:863</a></div></div>
<div class="ttc" id="class_b_l_e_security_callbacks_html_a94ef43a832c247440a2c7267cc5e41e3"><div class="ttname"><a href="class_b_l_e_security_callbacks.html#a94ef43a832c247440a2c7267cc5e41e3">BLESecurityCallbacks::onPassKeyNotify</a></div><div class="ttdeci">virtual void onPassKeyNotify(uint32_t pass_key)=0</div><div class="ttdoc">Provide us 6-digits code to perform authentication. It requires that our device is capable to display...</div></div>
<div class="ttc" id="structconn__status__t_html_a094f343c247e14a74ad13a46ebe3acd0"><div class="ttname"><a href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">conn_status_t::peer_device</a></div><div class="ttdeci">void * peer_device</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00029">BLEServer.h:29</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_ae4ce2ef9c6b3b5db6682dda4912e7915"><div class="ttname"><a href="class_b_l_e_device.html#ae4ce2ef9c6b3b5db6682dda4912e7915">BLEDevice::updatePeerDevice</a></div><div class="ttdeci">static void updatePeerDevice(void *peer, bool _client, uint16_t conn_id)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00577">BLEDevice.cpp:577</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_ab33f8aaf0d2cc2d7a9d70f991dec9275"><div class="ttname"><a href="class_b_l_e_device.html#ab33f8aaf0d2cc2d7a9d70f991dec9275">BLEDevice::getScan</a></div><div class="ttdeci">static BLEScan * getScan()</div><div class="ttdoc">Retrieve the Scan object that we use for scanning. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00301">BLEDevice.cpp:301</a></div></div>
<div class="ttc" id="class_b_l_e_security_callbacks_html_a8d9987f3d4c6c2850b4533cb76bacc47"><div class="ttname"><a href="class_b_l_e_security_callbacks.html#a8d9987f3d4c6c2850b4533cb76bacc47">BLESecurityCallbacks::onAuthenticationComplete</a></div><div class="ttdeci">virtual void onAuthenticationComplete(esp_ble_auth_cmpl_t)=0</div></div>
<div class="ttc" id="class_b_l_e_advertising_html"><div class="ttname"><a href="class_b_l_e_advertising.html">BLEAdvertising</a></div><div class="ttdoc">Perform and manage BLE advertising. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertising_8h_source.html#l00047">BLEAdvertising.h:47</a></div></div>
<div class="ttc" id="_b_l_e_device_8h_html_ab14024e2468ed6aba01673d77dda72b1"><div class="ttname"><a href="_b_l_e_device_8h.html#ab14024e2468ed6aba01673d77dda72b1">gattc_event_handler</a></div><div class="ttdeci">void(* gattc_event_handler)(esp_gattc_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gattc_cb_param_t *param)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00028">BLEDevice.h:28</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_acb35970d17947515e04bd77af6a5f0f9"><div class="ttname"><a href="class_b_l_e_utils.html#acb35970d17947515e04bd77af6a5f0f9">BLEUtils::gattServerEventTypeToString</a></div><div class="ttdeci">static std::string gattServerEventTypeToString(esp_gatts_cb_event_t eventType)</div><div class="ttdoc">Return a string representation of a GATT server event code. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l00961">BLEUtils.cpp:961</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a1f16045c3a431adaff5b51dff9c1c418"><div class="ttname"><a href="class_b_l_e_device.html#a1f16045c3a431adaff5b51dff9c1c418">BLEDevice::startAdvertising</a></div><div class="ttdeci">static void startAdvertising()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00561">BLEDevice.cpp:561</a></div></div>
<div class="ttc" id="structconn__status__t_html"><div class="ttname"><a href="structconn__status__t.html">conn_status_t</a></div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00028">BLEServer.h:28</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="class_b_l_e_utils_html_aad0760becb846a02bfbf57a400e56443"><div class="ttname"><a href="class_b_l_e_utils.html#aad0760becb846a02bfbf57a400e56443">BLEUtils::dumpGapEvent</a></div><div class="ttdeci">static void dumpGapEvent(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param)</div><div class="ttdoc">Dump the GAP event to the log. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l01045">BLEUtils.cpp:1045</a></div></div>
<div class="ttc" id="class_b_l_e_security_html_a911436a4dce7bdff3bd08f90c4f86e76"><div class="ttname"><a href="class_b_l_e_security.html#a911436a4dce7bdff3bd08f90c4f86e76">BLESecurity::esp_key_type_to_str</a></div><div class="ttdeci">static char * esp_key_type_to_str(esp_ble_key_type_t key_type)</div><div class="ttdoc">Debug function to display what keys are exchanged by peers. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_security_8cpp_source.html#l00068">BLESecurity.cpp:68</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a239ac61bffa6e3fbc95a68591de0063b"><div class="ttname"><a href="class_b_l_e_device.html#a239ac61bffa6e3fbc95a68591de0063b">BLEDevice::removePeerDevice</a></div><div class="ttdeci">static void removePeerDevice(uint16_t conn_id, bool client)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00604">BLEDevice.cpp:604</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_af3e0271d566f8ddce17db9b71be843b2"><div class="ttname"><a href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a></div><div class="ttdeci">static std::string toString()</div><div class="ttdoc">Return a string representation of the nature of this device. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00475">BLEDevice.cpp:475</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a7115b4df114617f517f6247396815679"><div class="ttname"><a href="class_b_l_e_device.html#a7115b4df114617f517f6247396815679">BLEDevice::m_localMTU</a></div><div class="ttdeci">static uint16_t m_localMTU</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00064">BLEDevice.h:64</a></div></div>
<div class="ttc" id="cacert_8d_html_a2dc1940063b86f9c406c65ac7928ac63"><div class="ttname"><a href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a></div><div class="ttdeci">Long so this option is typically used to alter that default file.curl recognizes the environment variable named CURL_CA_BUNDLE if it is and uses the given path as a path to a CA cert bundle.This option overrides that variable.The windows version of curl will automatically look for a CA certs file named curl ca bundle.either in the same directory as curl.or in the Current Working or in any folder along your PATH.If curl is built against the NSS SSL the NSS PEM then this option is supported for backward compatibility with other SSL but it should not be set.If the option is not then curl will use the certificates in the system and user Keychain to verify the peer</div><div class="ttdef"><b>Definition:</b> <a href="cacert_8d_source.html#l00023">cacert.d:23</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_ae849b214184223a3bdd0c5b30c1d033e"><div class="ttname"><a href="class_b_l_e_device.html#ae849b214184223a3bdd0c5b30c1d033e">BLEDevice::getValue</a></div><div class="ttdeci">static std::string getValue(BLEAddress bdAddress, BLEUUID serviceUUID, BLEUUID characteristicUUID)</div><div class="ttdoc">Get the value of a characteristic of a service on a remote device. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00318">BLEDevice.cpp:318</a></div></div>
<div class="ttc" id="_b_l_e_device_8h_html_abb37a4510f0ef411763e86f65dd455c3"><div class="ttname"><a href="_b_l_e_device_8h.html#abb37a4510f0ef411763e86f65dd455c3">gatts_event_handler</a></div><div class="ttdeci">void(* gatts_event_handler)(esp_gatts_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gatts_cb_param_t *param)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00029">BLEDevice.h:29</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_af51447985b28c60af7ca2020667b61ea"><div class="ttname"><a href="class_b_l_e_device.html#af51447985b28c60af7ca2020667b61ea">BLEDevice::getClientByGattIf</a></div><div class="ttdeci">static BLEClient * getClientByGattIf(uint16_t conn_id)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00573">BLEDevice.cpp:573</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_acbb5c622e4fb754495919d1216e47808"><div class="ttname"><a href="class_b_l_e_device.html#acbb5c622e4fb754495919d1216e47808">BLEDevice::m_securityLevel</a></div><div class="ttdeci">static esp_ble_sec_act_t m_securityLevel</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00065">BLEDevice.h:65</a></div></div>
<div class="ttc" id="class_general_utils_html_a25e466e54ff002f54bfb7e1f43bd401b"><div class="ttname"><a href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a></div><div class="ttdeci">static const char * errorToString(esp_err_t errCode)</div><div class="ttdoc">Convert an ESP error code to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_general_utils_8cpp_source.html#l00366">GeneralUtils.cpp:366</a></div></div>
<div class="ttc" id="_b_l_e_device_8cpp_html_aedeffc7d23da25d52b9a50045189fe2b"><div class="ttname"><a href="_b_l_e_device_8cpp.html#aedeffc7d23da25d52b9a50045189fe2b">initialized</a></div><div class="ttdeci">bool initialized</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00044">BLEDevice.cpp:44</a></div></div>
<div class="ttc" id="class_b_l_e_server_html"><div class="ttname"><a href="class_b_l_e_server.html">BLEServer</a></div><div class="ttdoc">The model of a BLE server. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00063">BLEServer.h:63</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a0e899cb20ba3cff71eb1aa6d2c3af786"><div class="ttname"><a href="class_b_l_e_device.html#a0e899cb20ba3cff71eb1aa6d2c3af786">BLEDevice::setSecurityCallbacks</a></div><div class="ttdeci">static void setSecurityCallbacks(BLESecurityCallbacks *pCallbacks)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00521">BLEDevice.cpp:521</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_aa75a33081ca88f08617281cd907ca02b"><div class="ttname"><a href="class_b_l_e_device.html#aa75a33081ca88f08617281cd907ca02b">BLEDevice::m_customGapHandler</a></div><div class="ttdeci">static gap_event_handler m_customGapHandler</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00092">BLEDevice.h:92</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a5c7aa94032cc83fb2ac81b4cd7381b8b"><div class="ttname"><a href="class_b_l_e_device.html#a5c7aa94032cc83fb2ac81b4cd7381b8b">BLEDevice::addPeerDevice</a></div><div class="ttdeci">static void addPeerDevice(void *peer, bool is_client, uint16_t conn_id)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00593">BLEDevice.cpp:593</a></div></div>
<div class="ttc" id="class_b_l_e_advertising_html_ae0f3ec86cac1eb5ea8caa27f273a9f33"><div class="ttname"><a href="class_b_l_e_advertising.html#ae0f3ec86cac1eb5ea8caa27f273a9f33">BLEAdvertising::start</a></div><div class="ttdeci">void start()</div><div class="ttdoc">Start advertising. Start advertising. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertising_8cpp_source.html#l00183">BLEAdvertising.cpp:183</a></div></div>
<div class="ttc" id="class_b_l_e_address_html_a495521811cabfb55acd38e393f701508"><div class="ttname"><a href="class_b_l_e_address.html#a495521811cabfb55acd38e393f701508">BLEAddress::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Convert a BLE address to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8cpp_source.html#l00085">BLEAddress.cpp:85</a></div></div>
<div class="ttc" id="class_b_l_e_client_html_a26f856ebef790cc89dc99d3ff5a185b4"><div class="ttname"><a href="class_b_l_e_client.html#a26f856ebef790cc89dc99d3ff5a185b4">BLEClient::handleGAPEvent</a></div><div class="ttdeci">void handleGAPEvent(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param)</div><div class="ttdoc">Handle a received GAP event. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_client_8cpp_source.html#l00458">BLEClient.cpp:458</a></div></div>
<div class="ttc" id="_b_l_e_client_8h_html"><div class="ttname"><a href="_b_l_e_client_8h.html">BLEClient.h</a></div></div>
<div class="ttc" id="class_b_l_e_address_html_a4c11bcce1d6ebf907e9a3c4f318bde2e"><div class="ttname"><a href="class_b_l_e_address.html#a4c11bcce1d6ebf907e9a3c4f318bde2e">BLEAddress::getNative</a></div><div class="ttdeci">esp_bd_addr_t * getNative()</div><div class="ttdoc">Return the native representation of the address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8cpp_source.html#l00069">BLEAddress.cpp:69</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a9c83ccd1b47eaa043f33688d588429ae"><div class="ttname"><a href="class_b_l_e_device.html#a9c83ccd1b47eaa043f33688d588429ae">BLEDevice::m_appId</a></div><div class="ttdeci">static uint16_t m_appId</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00053">BLEDevice.h:53</a></div></div>
<div class="ttc" id="class_b_l_e_security_callbacks_html"><div class="ttname"><a href="class_b_l_e_security_callbacks.html">BLESecurityCallbacks</a></div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_security_8h_source.html#l00039">BLESecurity.h:39</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a7b7e170f9d222323bf813baecd03a92b"><div class="ttname"><a href="class_b_l_e_device.html#a7b7e170f9d222323bf813baecd03a92b">BLEDevice::getMTU</a></div><div class="ttdeci">static uint16_t getMTU()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00544">BLEDevice.cpp:544</a></div></div>
<div class="ttc" id="class_b_l_e_client_html"><div class="ttname"><a href="class_b_l_e_client.html">BLEClient</a></div><div class="ttdoc">A model of a BLE client. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_client_8h_source.html#l00031">BLEClient.h:31</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a205edba5bde67d44c6aeaa3b345e22ba"><div class="ttname"><a href="class_b_l_e_device.html#a205edba5bde67d44c6aeaa3b345e22ba">BLEDevice::whiteListRemove</a></div><div class="ttdeci">static void whiteListRemove(BLEAddress address)</div><div class="ttdoc">Remove an entry from the BLE white list. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00500">BLEDevice.cpp:500</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_af4aca00f817b17d50f5ab92c04290b52"><div class="ttname"><a href="class_b_l_e_device.html#af4aca00f817b17d50f5ab92c04290b52">BLEDevice::setCustomGattsHandler</a></div><div class="ttdeci">static void setCustomGattsHandler(gatts_event_handler handler)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00640">BLEDevice.cpp:640</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a36e739d565b48ce6c7eeef6d43b4cf18"><div class="ttname"><a href="class_b_l_e_device.html#a36e739d565b48ce6c7eeef6d43b4cf18">BLEDevice::setPower</a></div><div class="ttdeci">static void setPower(esp_power_level_t powerLevel)</div><div class="ttdoc">Set the transmission power. The power level can be one of: </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00446">BLEDevice.cpp:446</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a18e4c8e824054837d7b6a04b5f1c3091"><div class="ttname"><a href="class_b_l_e_device.html#a18e4c8e824054837d7b6a04b5f1c3091">BLEDevice::m_customGattsHandler</a></div><div class="ttdeci">static gatts_event_handler m_customGattsHandler</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8h_source.html#l00094">BLEDevice.h:94</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a43c500c5e9bcfb046404e7996ec87d48"><div class="ttname"><a href="class_b_l_e_device.html#a43c500c5e9bcfb046404e7996ec87d48">BLEDevice::createClient</a></div><div class="ttdeci">static BLEClient * createClient()</div><div class="ttdoc">Create a new instance of a client. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00059">BLEDevice.cpp:59</a></div></div>
<div class="ttc" id="connect__with__static__ip_8c_html_a384dacd0c224cb8c2216c22676ba8f5d"><div class="ttname"><a href="connect__with__static__ip_8c.html#a384dacd0c224cb8c2216c22676ba8f5d">nvs_flash_init</a></div><div class="ttdeci">nvs_flash_init()</div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="ftp-ssl-ccc-mode_8d_html_ac4f4031531425afe8fbe576a1e1d1642"><div class="ttname"><a href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a></div><div class="ttdeci">Long but instead wait for the server to do it</div><div class="ttdef"><b>Definition:</b> <a href="ftp-ssl-ccc-mode_8d_source.html#l00008">ftp-ssl-ccc-mode.d:8</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a604dc61d03239c3350631babc313bb2e"><div class="ttname"><a href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">BLEDevice::getAdvertising</a></div><div class="ttdeci">static BLEAdvertising * getAdvertising()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00552">BLEDevice.cpp:552</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_abc987337d9edfd0d5a859d75b91fef72"><div class="ttname"><a href="class_b_l_e_device.html#abc987337d9edfd0d5a859d75b91fef72">BLEDevice::setValue</a></div><div class="ttdeci">static void setValue(BLEAddress bdAddress, BLEUUID serviceUUID, BLEUUID characteristicUUID, std::string value)</div><div class="ttdoc">Set the value of a characteristic of a service on a remote device. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00462">BLEDevice.cpp:462</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_a734f6e195393214f34ac891a413ad524"><div class="ttname"><a href="class_b_l_e_utils.html#a734f6e195393214f34ac891a413ad524">BLEUtils::dumpGattClientEvent</a></div><div class="ttdeci">static void dumpGattClientEvent(esp_gattc_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gattc_cb_param_t *evtParam)</div><div class="ttdoc">Decode and dump a GATT client event. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l01276">BLEUtils.cpp:1276</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a51834f804f8ed7d358aa2ba15f07459f"><div class="ttname"><a href="class_b_l_e_device.html#a51834f804f8ed7d358aa2ba15f07459f">BLEDevice::createServer</a></div><div class="ttdeci">static BLEServer * createServer()</div><div class="ttdoc">Create a new instance of a server. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00075">BLEDevice.cpp:75</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a4e441297651357bd5685dc74de3c5ec6"><div class="ttname"><a href="class_b_l_e_device.html#a4e441297651357bd5685dc74de3c5ec6">BLEDevice::setMTU</a></div><div class="ttdeci">static esp_err_t setMTU(uint16_t mtu)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00529">BLEDevice.cpp:529</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a331bdf3a0da2e2dd3e6d1e69ff08b98c"><div class="ttname"><a href="class_b_l_e_device.html#a331bdf3a0da2e2dd3e6d1e69ff08b98c">BLEDevice::setCustomGattcHandler</a></div><div class="ttdeci">static void setCustomGattcHandler(gattc_event_handler handler)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00636">BLEDevice.cpp:636</a></div></div>
<div class="ttc" id="class_b_l_e_u_u_i_d_html_a52e30a254e1ff10a429c2e0a36a6131d"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">BLEUUID::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Get a string representation of the UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8cpp_source.html#l00355">BLEUUID.cpp:355</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a438be1748c096dab092bcdb4892d9a1c"><div class="ttname"><a href="class_b_l_e_device.html#a438be1748c096dab092bcdb4892d9a1c">BLEDevice::getInitialized</a></div><div class="ttdeci">static bool getInitialized()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00548">BLEDevice.cpp:548</a></div></div>
<div class="ttc" id="class_b_l_e_scan_html"><div class="ttname"><a href="class_b_l_e_scan.html">BLEScan</a></div><div class="ttdoc">Perform and manage BLE scans. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_scan_8h_source.html#l00049">BLEScan.h:49</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a05a1d53d87641fcc35e1c5cd73c1162a"><div class="ttname"><a href="class_b_l_e_device.html#a05a1d53d87641fcc35e1c5cd73c1162a">BLEDevice::getPeerDevices</a></div><div class="ttdeci">static std::map&lt; uint16_t, conn_status_t &gt; getPeerDevices(bool client)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00569">BLEDevice.cpp:569</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a4160b81bf7a467f22b13fa72a36daa46"><div class="ttname"><a href="class_b_l_e_device.html#a4160b81bf7a467f22b13fa72a36daa46">BLEDevice::setEncryptionLevel</a></div><div class="ttdeci">static void setEncryptionLevel(esp_ble_sec_act_t level)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00513">BLEDevice.cpp:513</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a804a83266c71073f9f21eda47b5a3533"><div class="ttname"><a href="class_b_l_e_device.html#a804a83266c71073f9f21eda47b5a3533">BLEDevice::init</a></div><div class="ttdeci">static void init(std::string deviceName)</div><div class="ttdoc">Initialize the BLE environment. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00333">BLEDevice.cpp:333</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a0138f8d2a811a7f60994b5c169649336"><div class="ttname"><a href="class_b_l_e_device.html#a0138f8d2a811a7f60994b5c169649336">BLEDevice::setCustomGapHandler</a></div><div class="ttdeci">static void setCustomGapHandler(gap_event_handler handler)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00632">BLEDevice.cpp:632</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a7f454eb3eafbc79b11831354158f4814"><div class="ttname"><a href="class_b_l_e_device.html#a7f454eb3eafbc79b11831354158f4814">BLEDevice::whiteListAdd</a></div><div class="ttdeci">static void whiteListAdd(BLEAddress address)</div><div class="ttdoc">Add an entry to the BLE white list. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00486">BLEDevice.cpp:486</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_a3bc774564d748a26434d556b3991db64"><div class="ttname"><a href="class_b_l_e_utils.html#a3bc774564d748a26434d556b3991db64">BLEUtils::dumpGattServerEvent</a></div><div class="ttdeci">static void dumpGattServerEvent(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t *evtParam)</div><div class="ttdoc">Dump the details of a GATT server event. A GATT Server event is a callback received from the BLE subs...</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l01525">BLEUtils.cpp:1525</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_b_l_e_device_8cpp.html">BLEDevice.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
