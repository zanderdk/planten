<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/TFTP.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_t_f_t_p_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TFTP.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_f_t_p_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * TFTP.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * See also:</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * * https://tools.ietf.org/html/rfc1350</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  Created on: May 21, 2017</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="esp32-snippets_2cpp__utils_2_t_f_t_p_8h.html">TFTP.h</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_free_r_t_o_s_8h.html">FreeRTOS.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_socket_8h.html">Socket.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keyword">extern</span> uint16_t <a class="code" href="_t_f_t_p_8cpp.html#aee0c3c901bd90b3760c5e69dff6c5f58">lwip_ntohs</a>(uint16_t);</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keyword">extern</span> uint32_t <a class="code" href="_t_f_t_p_8cpp.html#a7e4133c98661e1e258f6c636e3c1245c">lwip_ntohl</a>(uint32_t);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">extern</span> uint16_t <a class="code" href="_t_f_t_p_8cpp.html#a5f9d3d3ad8fc8c55f29bfad1e862d2f8">lwip_htons</a>(uint16_t);</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">extern</span> uint32_t <a class="code" href="_t_f_t_p_8cpp.html#a379424b6bc52498c9dca693c6aea3549">lwip_htonl</a>(uint32_t);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;TFTP&quot;</span>;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158e">   31</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158e">opcode</a> {</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50">   32</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50">TFTP_OPCODE_RRQ</a>   = 1, <span class="comment">// Read request</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564">   33</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564">TFTP_OPCODE_WRQ</a>   = 2, <span class="comment">// Write request</span></div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eacc8676e38f10ee4663ec5068328784c1">   34</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eacc8676e38f10ee4663ec5068328784c1">TFTP_OPCODE_DATA</a>  = 3, <span class="comment">// Data</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">   35</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">TFTP_OPCODE_ACK</a>   = 4, <span class="comment">// Acknowledgement</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ead285a1bbae4f74fafc9e2595dc291d45">   36</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ead285a1bbae4f74fafc9e2595dc291d45">TFTP_OPCODE_ERROR</a> = 5  <span class="comment">// Error</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;};</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8">   39</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8">ERRORCODE</a> {</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a41b1dc3a8baf9903c096e9a998993437">   40</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a41b1dc3a8baf9903c096e9a998993437">ERROR_CODE_NOTDEFINED</a>        = 0,</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acc9d8141e59c51a28493647347c4142b">   41</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acc9d8141e59c51a28493647347c4142b">ERROR_CODE_FILE_NOT_FOUND</a>    = 1,</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acdd8ade3bb87692a9ed8d35efbde043f">   42</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acdd8ade3bb87692a9ed8d35efbde043f">ERROR_CODE_ACCESS_VIOLATION</a>  = 2,</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a28419e3ef0250550b73b23f9290a25d4">   43</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a28419e3ef0250550b73b23f9290a25d4">ERROR_CODE_NO_SPACE</a>          = 3,</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a33c3c6d31c350a93fc3ffd0baf3e21c5">   44</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a33c3c6d31c350a93fc3ffd0baf3e21c5">ERROR_CODE_ILLEGAL_OPERATION</a> = 4,</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a2e750b74958e48ccfc63d9a7acdd5e5d">   45</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a2e750b74958e48ccfc63d9a7acdd5e5d">ERROR_CODE_UNKNOWN_ID</a>        = 5,</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a34a000563ff11118ea577ec7d57c6ebb">   46</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a34a000563ff11118ea577ec7d57c6ebb">ERROR_CODE_FILE_EXISTS</a>       = 6,</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a91421d1bfb4bcb308f01519b0e81c07f">   47</a></span>&#160;    <a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a91421d1bfb4bcb308f01519b0e81c07f">ERROR_CODE_UNKNOWN_USER</a>      = 7</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;};</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">   53</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a> = 512;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">struct </span>data_packet {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    uint16_t blockNumber;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;};</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="class_t_f_t_p.html#ad6e05e26661d78de97cc9aefe8966013">   62</a></span>&#160;<a class="code" href="class_t_f_t_p.html#ad6e05e26661d78de97cc9aefe8966013">TFTP::TFTP</a>() {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    m_baseDir = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="class_t_f_t_p.html#acdb8a0f76650981c53c6793e88e9732c">   66</a></span>&#160;<a class="code" href="class_t_f_t_p.html#acdb8a0f76650981c53c6793e88e9732c">TFTP::~TFTP</a>() {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab952bccc72460fbb123c8bfbd30b4a56">   73</a></span>&#160;<a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab952bccc72460fbb123c8bfbd30b4a56">TFTP::TFTP_Transaction::TFTP_Transaction</a>() {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    m_baseDir  = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    m_filename = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    m_mode     = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    m_opCode   = -1;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;} <span class="comment">// TFTP_Transaction</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a0b8e83b447d6c8321354a040f4f6a7c6">   86</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a0b8e83b447d6c8321354a040f4f6a7c6">TFTP::TFTP_Transaction::processRRQ</a>() {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> *   2 bytes     2 bytes     n bytes</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> *  ----------------------------------</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> * | Opcode |   Block #  |   Data     |</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> *  ----------------------------------</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">FILE</a>* <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Reading TFTP data from file: %s&quot;</span>, m_filename.c_str());</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> tmpName = m_baseDir + <span class="stringliteral">&quot;/&quot;</span> + m_filename;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">    struct stat buf;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    if (stat(tmpName.c_str(), &amp;buf) != 0) {</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">        ESP_LOGE(LOG_TAG, &quot;Stat file: %s: %s&quot;, tmpName.c_str(), strerror(errno));</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">        return;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">    int length = buf.st_size;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">int</span> blockNumber = 1;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a> = fopen(tmpName.c_str(), <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;Failed to open file for reading: %s: %s&quot;</span>, tmpName.c_str(), <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        sendError(<a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acc9d8141e59c51a28493647347c4142b">ERROR_CODE_FILE_NOT_FOUND</a>, tmpName);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keyword">struct </span>{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        uint16_t opCode;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        uint16_t blockNumber;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        uint8_t <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[<a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a>];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    } record;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    record.opCode = htons(<a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eacc8676e38f10ee4663ec5068328784c1">TFTP_OPCODE_DATA</a>); <span class="comment">// Set the op code to be DATA.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">while</span> (!finished) {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        record.blockNumber = htons(blockNumber);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordtype">int</span> sizeRead = <a class="code" href="stdcheaders_8h.html#aae22dd41ebe1e64904429c5a31e7e642">fread</a>(record.buf, 1, <a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a>, <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Sending data to %s, blockNumber=%d, size=%d&quot;</span>,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <a class="code" href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">Socket::addressToString</a>(&amp;m_partnerAddress).c_str(), blockNumber, sizeRead);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        m_partnerSocket.sendTo((uint8_t*) &amp;record, sizeRead + 4, &amp;m_partnerAddress);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> (sizeRead &lt; <a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a>) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            finished = <span class="keyword">true</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            waitForAck(blockNumber);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        blockNumber++; <span class="comment">// Increment the block number.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;File sent&quot;</span>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;} <span class="comment">// processRRQ</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a98ea42d7912e6ccc33948e7adadf7259">  151</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a98ea42d7912e6ccc33948e7adadf7259">TFTP::TFTP_Transaction::processWRQ</a>() {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> *        2 bytes    2 bytes       n bytes</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> *        ---------------------------------</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> * DATA  |  03   |   Block #  |    Data    |</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"> *        ---------------------------------</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"> * The opcode for data is 0x03 - TFTP_OPCODE_DATA</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">struct </span>recv_data {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        uint16_t opCode;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        uint16_t blockNumber;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        uint8_t  <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    } *pRecv_data;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">struct </span>sockaddr recvAddr;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    uint8_t dataBuffer[<a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a> + 2 + 2];</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">FILE</a>* <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Writing TFTP data to file: %s&quot;</span>, m_filename.c_str());</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> tmpName = m_baseDir + <span class="stringliteral">&quot;/&quot;</span> + m_filename;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a> = fopen(tmpName.c_str(), <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;Failed to open file for writing: %s: %s&quot;</span>, tmpName.c_str(), <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">while</span>(!finished) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        pRecv_data = (<span class="keyword">struct </span>recv_data*) dataBuffer;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordtype">int</span> receivedSize = m_partnerSocket.receiveFrom(dataBuffer, <span class="keyword">sizeof</span>(dataBuffer), &amp;recvAddr);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span> (receivedSize == -1) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;rc == -1 from receive_from&quot;</span>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">struct </span>data_packet dp;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        dp.blockNumber = ntohs(pRecv_data-&gt;blockNumber);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        dp.data = <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a>((<span class="keywordtype">char</span>*) &amp;pRecv_data-&gt;data, receivedSize - 4);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(dp.data.data(), dp.data.length(), 1, <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        sendAck(dp.blockNumber);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Block size: %d&quot;</span>, dp.data.length());</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> (dp.data.length() &lt; <a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a>) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            finished = <span class="keyword">true</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    } <span class="comment">// Finished</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    fclose(<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    m_partnerSocket.close();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;} <span class="comment">// process</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a46521d26eb68aac975fbb58e706804e8">  206</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a46521d26eb68aac975fbb58e706804e8">TFTP::TFTP_Transaction::sendAck</a>(uint16_t blockNumber) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">struct </span>{</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        uint16_t opCode;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        uint16_t blockNumber;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    } ackData;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    ackData.opCode      = htons(<a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">TFTP_OPCODE_ACK</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    ackData.blockNumber = htons(blockNumber);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Sending ack to %s, blockNumber=%d&quot;</span>, <a class="code" href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">Socket::addressToString</a>(&amp;m_partnerAddress).c_str(), blockNumber);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    m_partnerSocket.sendTo((uint8_t*) &amp;ackData, <span class="keyword">sizeof</span>(ackData), &amp;m_partnerAddress);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;} <span class="comment">// sendAck</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="class_t_f_t_p.html#a8a8386ee01e4bad105cb1fee4e7aae51">  228</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p.html#a8a8386ee01e4bad105cb1fee4e7aae51">TFTP::start</a>(uint16_t port) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> * Loop forever.  At the start of the loop we block waiting for an incoming client request.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> * The requests that we are expecting are either a request to read a file from the server</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> * or write a file to the server.  Once we have received a request we then call the appropriate</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> * handler to handle that type of request.  When the request has been completed, we start again.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Starting TFTP::start() on port %d&quot;</span>, port);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="class_socket.html">Socket</a> serverSocket;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    serverSocket.<a class="code" href="class_socket.html#a893bb9a6107d2139cfb088f0c82ac5ae">listen</a>(port, <span class="keyword">true</span>); <span class="comment">// Create a listening socket that is a datagram.</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">// This would be a good place to start a transaction in the background.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html">TFTP_Transaction</a>* pTFTPTransaction = <span class="keyword">new</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html">TFTP_Transaction</a>();</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        pTFTPTransaction-&gt;<a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab1dc0909b4d9416f2148a0ba68453a76">setBaseDir</a>(m_baseDir);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        uint16_t receivedOpCode = pTFTPTransaction-&gt;<a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a107d19467cce9f8437e8af166737070a">waitForRequest</a>(&amp;serverSocket);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">switch</span> (receivedOpCode) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="comment">// Handle the write request (client file upload)</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564">opcode::TFTP_OPCODE_WRQ</a>: {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                pTFTPTransaction-&gt;<a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a98ea42d7912e6ccc33948e7adadf7259">processWRQ</a>();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="comment">// Handle the read request (server file download)</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50">opcode::TFTP_OPCODE_RRQ</a>: {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                pTFTPTransaction-&gt;<a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a0b8e83b447d6c8321354a040f4f6a7c6">processRRQ</a>();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;Unknown opcode: %d&quot;</span>, receivedOpCode);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keyword">delete</span> pTFTPTransaction;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    } <span class="comment">// End while loop</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;} <span class="comment">// run</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab1dc0909b4d9416f2148a0ba68453a76">  270</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab1dc0909b4d9416f2148a0ba68453a76">TFTP::TFTP_Transaction::setBaseDir</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> baseDir) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    m_baseDir = baseDir;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;} <span class="comment">// setBaseDir</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="class_t_f_t_p.html#a13a7562a16fea3acabafc3c0811cabef">  281</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p.html#a13a7562a16fea3acabafc3c0811cabef">TFTP::setBaseDir</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> baseDir) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    m_baseDir = baseDir;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;} <span class="comment">// setBaseDir</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a4aa35c73d2f586e07e63ee7746e75e9e">  291</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a4aa35c73d2f586e07e63ee7746e75e9e">TFTP::TFTP_Transaction::waitForAck</a>(uint16_t blockNumber) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keyword">struct </span>{</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        uint16_t opCode;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        uint16_t blockNumber;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    } ackData;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;TFTP: Waiting for an acknowledgment request&quot;</span>);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordtype">int</span> sizeRead = m_partnerSocket.receiveFrom((uint8_t*) &amp;ackData, <span class="keyword">sizeof</span>(ackData), &amp;m_partnerAddress);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;TFTP: Received some data.&quot;</span>);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (sizeRead != <span class="keyword">sizeof</span>(ackData)) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;waitForAck: Received %d but expected %d&quot;</span>, sizeRead, <span class="keyword">sizeof</span>(ackData));</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        sendError(<a class="code" href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a41b1dc3a8baf9903c096e9a998993437">ERROR_CODE_NOTDEFINED</a>, <span class="stringliteral">&quot;Ack not correct size&quot;</span>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    ackData.opCode      = ntohs(ackData.opCode);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    ackData.blockNumber = ntohs(ackData.blockNumber);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span> (ackData.opCode != <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">opcode::TFTP_OPCODE_ACK</a>) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;waitForAck: Received opcode %d but expected %d&quot;</span>, ackData.opCode, <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">opcode::TFTP_OPCODE_ACK</a>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (ackData.blockNumber != blockNumber) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;waitForAck: Blocknumber received %d but expected %d&quot;</span>, ackData.blockNumber, blockNumber);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;} <span class="comment">// waitForAck</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> *        2 bytes    string   1 byte     string   1 byte</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> *        -----------------------------------------------</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> * RRQ/  | 01/02 |  Filename  |   0  |    Mode    |   0  |</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> * WRQ    -----------------------------------------------</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a107d19467cce9f8437e8af166737070a">  337</a></span>&#160;uint16_t <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a107d19467cce9f8437e8af166737070a">TFTP::TFTP_Transaction::waitForRequest</a>(<a class="code" href="class_socket.html">Socket</a>* pServerSocket) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keyword">union </span>{</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        uint8_t <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[<a class="code" href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a>];</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        uint16_t opCode;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    } record;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">size_t</span> length = 100;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;TFTP: Waiting for a request&quot;</span>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    pServerSocket-&gt;<a class="code" href="class_socket.html#afc27706410db610051b84cb3c969daa3">receiveFrom</a>(record.buf, length, &amp;m_partnerAddress);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// Save the filename, mode and op code.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    m_filename = <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a>((<span class="keywordtype">char</span>*) (record.buf + 2));</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    m_mode   = <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a>((<span class="keywordtype">char</span>*) (record.buf + 3 + m_filename.length()));</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    m_opCode   = ntohs(record.opCode);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">switch</span> (m_opCode) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">// Handle the Write Request command.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564">TFTP_OPCODE_WRQ</a>: {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            m_partnerSocket.createSocket(<span class="keyword">true</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            m_partnerSocket.bind(0, <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            sendAck(0);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment">// Handle the Read request command.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50">TFTP_OPCODE_RRQ</a>: {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            m_partnerSocket.createSocket(<span class="keyword">true</span>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            m_partnerSocket.bind(0, <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Un-handled opcode: %d&quot;</span>, m_opCode);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">return</span> m_opCode;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;} <span class="comment">// waitForRequest</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a503c474a79b6b88c36b108bba9236e01">  382</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a503c474a79b6b88c36b108bba9236e01">TFTP::TFTP_Transaction::sendError</a>(uint16_t <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>, <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> message) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> *  2 bytes     2 bytes      string    1 byte</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> *  -----------------------------------------</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> * | Opcode |  ErrorCode |   ErrMsg   |   0  |</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> *  -----------------------------------------</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = 2  + 2 + message.length() + 1;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    uint8_t* <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = (uint8_t*) <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    *(uint16_t*) (&amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[0]) = htons(<a class="code" href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ead285a1bbae4f74fafc9e2595dc291d45">opcode::TFTP_OPCODE_ERROR</a>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    *(uint16_t*) (&amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[2]) = htons(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    strcpy((<span class="keywordtype">char</span>*) (&amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[4]), message.c_str());</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    m_partnerSocket.sendTo(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, &amp;m_partnerAddress);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;} <span class="comment">// sendError</span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="class_t_f_t_p_html_a13a7562a16fea3acabafc3c0811cabef"><div class="ttname"><a href="class_t_f_t_p.html#a13a7562a16fea3acabafc3c0811cabef">TFTP::setBaseDir</a></div><div class="ttdeci">void setBaseDir(std::string baseDir)</div><div class="ttdoc">Set the base dir for file access. If we are asked to put a file to the file system, this is the base relative directory. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00281">TFTP.cpp:281</a></div></div>
<div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8acdd8ade3bb87692a9ed8d35efbde043f"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acdd8ade3bb87692a9ed8d35efbde043f">ERROR_CODE_ACCESS_VIOLATION</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00042">TFTP.cpp:42</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8">ERRORCODE</a></div><div class="ttdeci">ERRORCODE</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00039">TFTP.cpp:39</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html">TFTP::TFTP_Transaction</a></div><div class="ttdoc">Internal class for TFTP processing. </div><div class="ttdef"><b>Definition:</b> <a href="esp32-snippets_2cpp__utils_2_t_f_t_p_8h_source.html#l00044">TFTP.h:44</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea384b091233466a21aed4b36a93bf1d50">TFTP_OPCODE_RRQ</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00032">TFTP.cpp:32</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a4aa35c73d2f586e07e63ee7746e75e9e"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a4aa35c73d2f586e07e63ee7746e75e9e">TFTP::TFTP_Transaction::waitForAck</a></div><div class="ttdeci">void waitForAck(uint16_t blockNumber)</div><div class="ttdoc">Wait for an acknowledgment from the client. After having sent data to the client, we expect an acknow...</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00291">TFTP.cpp:291</a></div></div>
<div class="ttc" id="unit1608_8c_html_afb9ed1b8a27eb20854efe6e23e297683"><div class="ttname"><a href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a></div><div class="ttdeci">CURLcode code</div><div class="ttdef"><b>Definition:</b> <a href="unit1608_8c_source.html#l00047">unit1608.c:47</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eaa0ce42ae7c3db3296276f484a9ea084a">TFTP_OPCODE_ACK</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00035">TFTP.cpp:35</a></div></div>
<div class="ttc" id="connect-to_8d_html_a450c41f520f7661f0a48b8fd2597a74c"><div class="ttname"><a href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">string</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS meaning any host port.HOST2 and PORT2 may also be the empty string</div><div class="ttdef"><b>Definition:</b> <a href="connect-to_8d_source.html#l00014">connect-to.d:14</a></div></div>
<div class="ttc" id="class_socket_html_aa0aa0b437ca534447e335b58e8a30254"><div class="ttname"><a href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">Socket::addressToString</a></div><div class="ttdeci">static std::string addressToString(struct sockaddr *addr)</div><div class="ttdoc">Convert a socket address to a string representation. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00092">Socket.cpp:92</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a33c3c6d31c350a93fc3ffd0baf3e21c5"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a33c3c6d31c350a93fc3ffd0baf3e21c5">ERROR_CODE_ILLEGAL_OPERATION</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00044">TFTP.cpp:44</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_aee0c3c901bd90b3760c5e69dff6c5f58"><div class="ttname"><a href="_t_f_t_p_8cpp.html#aee0c3c901bd90b3760c5e69dff6c5f58">lwip_ntohs</a></div><div class="ttdeci">uint16_t lwip_ntohs(uint16_t)</div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a91421d1bfb4bcb308f01519b0e81c07f"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a91421d1bfb4bcb308f01519b0e81c07f">ERROR_CODE_UNKNOWN_USER</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00047">TFTP.cpp:47</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="class_t_f_t_p_html_a8a8386ee01e4bad105cb1fee4e7aae51"><div class="ttname"><a href="class_t_f_t_p.html#a8a8386ee01e4bad105cb1fee4e7aae51">TFTP::start</a></div><div class="ttdeci">void start(uint16_t port=TFTP_DEFAULT_PORT)</div><div class="ttdoc">Start being a TFTP server. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00228">TFTP.cpp:228</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a503c474a79b6b88c36b108bba9236e01"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a503c474a79b6b88c36b108bba9236e01">TFTP::TFTP_Transaction::sendError</a></div><div class="ttdeci">void sendError(uint16_t code, std::string message)</div><div class="ttdoc">Send an error indication to the client. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00382">TFTP.cpp:382</a></div></div>
<div class="ttc" id="class_socket_html_afc27706410db610051b84cb3c969daa3"><div class="ttname"><a href="class_socket.html#afc27706410db610051b84cb3c969daa3">Socket::receiveFrom</a></div><div class="ttdeci">int receiveFrom(uint8_t *data, size_t length, struct sockaddr *pAddr)</div><div class="ttdoc">Receive data with the address. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00400">Socket.cpp:400</a></div></div>
<div class="ttc" id="_socket_8h_html"><div class="ttname"><a href="_socket_8h.html">Socket.h</a></div></div>
<div class="ttc" id="esp32-snippets_2cpp__utils_2_t_f_t_p_8h_html"><div class="ttname"><a href="esp32-snippets_2cpp__utils_2_t_f_t_p_8h.html">TFTP.h</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_ab952bccc72460fbb123c8bfbd30b4a56"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab952bccc72460fbb123c8bfbd30b4a56">TFTP::TFTP_Transaction::TFTP_Transaction</a></div><div class="ttdeci">TFTP_Transaction()</div><div class="ttdoc">Start a TFTP transaction. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00073">TFTP.cpp:73</a></div></div>
<div class="ttc" id="config_8d_html_aea53e62b3bb322f5a6bf4ceb58066a37"><div class="ttname"><a href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are r and v.A backslash preceding any other letter is ignored.If the first column of a config line is a the rest of the line will be treated as a comment.Only write one option per physical line in the config file.Specify the filename to config as to make curl read the file from stdin.Note that to be able to specify a URL in the config file</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a379424b6bc52498c9dca693c6aea3549"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a379424b6bc52498c9dca693c6aea3549">lwip_htonl</a></div><div class="ttdeci">uint32_t lwip_htonl(uint32_t)</div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ea615e060a29a1a318043e718cb3f65564">TFTP_OPCODE_WRQ</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00033">TFTP.cpp:33</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a5f9d3d3ad8fc8c55f29bfad1e862d2f8"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a5f9d3d3ad8fc8c55f29bfad1e862d2f8">lwip_htons</a></div><div class="ttdeci">uint16_t lwip_htons(uint16_t)</div></div>
<div class="ttc" id="class_t_f_t_p_html_ad6e05e26661d78de97cc9aefe8966013"><div class="ttname"><a href="class_t_f_t_p.html#ad6e05e26661d78de97cc9aefe8966013">TFTP::TFTP</a></div><div class="ttdeci">TFTP()</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00062">TFTP.cpp:62</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a39700278c72c34bf9996618dbd36572a"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a39700278c72c34bf9996618dbd36572a">TFTP_DATA_SIZE</a></div><div class="ttdeci">const int TFTP_DATA_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00053">TFTP.cpp:53</a></div></div>
<div class="ttc" id="class_socket_html"><div class="ttname"><a href="class_socket.html">Socket</a></div><div class="ttdoc">Encapsulate a socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8h_source.html#l00062">Socket.h:62</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a98ea42d7912e6ccc33948e7adadf7259"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a98ea42d7912e6ccc33948e7adadf7259">TFTP::TFTP_Transaction::processWRQ</a></div><div class="ttdeci">void processWRQ()</div><div class="ttdoc">Process a client write request. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00151">TFTP.cpp:151</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a41b1dc3a8baf9903c096e9a998993437"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a41b1dc3a8baf9903c096e9a998993437">ERROR_CODE_NOTDEFINED</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00040">TFTP.cpp:40</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a0b8e83b447d6c8321354a040f4f6a7c6"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a0b8e83b447d6c8321354a040f4f6a7c6">TFTP::TFTP_Transaction::processRRQ</a></div><div class="ttdeci">void processRRQ()</div><div class="ttdoc">Process a client read request. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00086">TFTP.cpp:86</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a46521d26eb68aac975fbb58e706804e8"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a46521d26eb68aac975fbb58e706804e8">TFTP::TFTP_Transaction::sendAck</a></div><div class="ttdeci">void sendAck(uint16_t blockNumber)</div><div class="ttdoc">Send an acknowledgment back to the partner. A TFTP acknowledgment packet contains an opcode (4) and a...</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00206">TFTP.cpp:206</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="stdcheaders_8h_html_aae22dd41ebe1e64904429c5a31e7e642"><div class="ttname"><a href="stdcheaders_8h.html#aae22dd41ebe1e64904429c5a31e7e642">fread</a></div><div class="ttdeci">size_t fread(void *, size_t, size_t, FILE *)</div></div>
<div class="ttc" id="_console_8h_html_ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719"><div class="ttname"><a href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">ArgType_t::FILE</a></div></div>
<div class="ttc" id="_free_r_t_o_s_8h_html"><div class="ttname"><a href="_free_r_t_o_s_8h.html">FreeRTOS.h</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_a107d19467cce9f8437e8af166737070a"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#a107d19467cce9f8437e8af166737070a">TFTP::TFTP_Transaction::waitForRequest</a></div><div class="ttdeci">uint16_t waitForRequest(Socket *pServerSocket)</div><div class="ttdoc">Wait for a client request. A TFTP server waits for requests to send or receive files. A request can be either WRQ (write request) which is a request from the client to write a new local file or it can be a RRQ (read request) which is a request from the client to read a local file. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00337">TFTP.cpp:337</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a34a000563ff11118ea577ec7d57c6ebb"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a34a000563ff11118ea577ec7d57c6ebb">ERROR_CODE_FILE_EXISTS</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00046">TFTP.cpp:46</a></div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158ead285a1bbae4f74fafc9e2595dc291d45"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158ead285a1bbae4f74fafc9e2595dc291d45">TFTP_OPCODE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00036">TFTP.cpp:36</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a7e4133c98661e1e258f6c636e3c1245c"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a7e4133c98661e1e258f6c636e3c1245c">lwip_ntohl</a></div><div class="ttdeci">uint32_t lwip_ntohl(uint32_t)</div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_a69d5b2daf8dd402fc8b43abb4ffbd44e"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">impacket.nmb.INADDR_ANY</a></div><div class="ttdeci">string INADDR_ANY</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00048">nmb.py:48</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8acc9d8141e59c51a28493647347c4142b"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8acc9d8141e59c51a28493647347c4142b">ERROR_CODE_FILE_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00041">TFTP.cpp:41</a></div></div>
<div class="ttc" id="class_t_f_t_p_1_1_t_f_t_p___transaction_html_ab1dc0909b4d9416f2148a0ba68453a76"><div class="ttname"><a href="class_t_f_t_p_1_1_t_f_t_p___transaction.html#ab1dc0909b4d9416f2148a0ba68453a76">TFTP::TFTP_Transaction::setBaseDir</a></div><div class="ttdeci">void setBaseDir(std::string baseDir)</div><div class="ttdoc">Set the base dir for file access. If we are asked to put a file to the file system, this is the base relative directory. </div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00270">TFTP.cpp:270</a></div></div>
<div class="ttc" id="class_socket_html_a893bb9a6107d2139cfb088f0c82ac5ae"><div class="ttname"><a href="class_socket.html#a893bb9a6107d2139cfb088f0c82ac5ae">Socket::listen</a></div><div class="ttdeci">int listen(uint16_t port, bool isDatagram=false, bool reuseAddress=false)</div><div class="ttdoc">Create a listening socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00259">Socket.cpp:259</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a2e750b74958e48ccfc63d9a7acdd5e5d"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a2e750b74958e48ccfc63d9a7acdd5e5d">ERROR_CODE_UNKNOWN_ID</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00045">TFTP.cpp:45</a></div></div>
<div class="ttc" id="get_8d_html_a38b0ef81b65f2aee282c8c217a123176"><div class="ttname"><a href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a></div><div class="ttdeci">Long this option will make all data specified with data</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="stdcheaders_8h_html_ae791f89cbd418b3074b1349d8f5075dd"><div class="ttname"><a href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a></div><div class="ttdeci">size_t fwrite(const void *, size_t, size_t, FILE *)</div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158e"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158e">opcode</a></div><div class="ttdeci">opcode</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00031">TFTP.cpp:31</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a299fc707c775371e0b2b0495ccb6158eacc8676e38f10ee4663ec5068328784c1"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a299fc707c775371e0b2b0495ccb6158eacc8676e38f10ee4663ec5068328784c1">TFTP_OPCODE_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00034">TFTP.cpp:34</a></div></div>
<div class="ttc" id="_t_f_t_p_8cpp_html_a03e116969a86fddb757c9e02ef94eee8a28419e3ef0250550b73b23f9290a25d4"><div class="ttname"><a href="_t_f_t_p_8cpp.html#a03e116969a86fddb757c9e02ef94eee8a28419e3ef0250550b73b23f9290a25d4">ERROR_CODE_NO_SPACE</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00043">TFTP.cpp:43</a></div></div>
<div class="ttc" id="class_t_f_t_p_html_acdb8a0f76650981c53c6793e88e9732c"><div class="ttname"><a href="class_t_f_t_p.html#acdb8a0f76650981c53c6793e88e9732c">TFTP::~TFTP</a></div><div class="ttdeci">virtual ~TFTP()</div><div class="ttdef"><b>Definition:</b> <a href="_t_f_t_p_8cpp_source.html#l00066">TFTP.cpp:66</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_t_f_t_p_8cpp.html">TFTP.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
