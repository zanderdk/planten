<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/tests/server/tftpd.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tftpd_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tftpd.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tftpd_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Trivial file transfer protocol server.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This code includes many modifications by Jim Guyton &lt;guyton@rand-unix&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * This source file was started based on netkit-tftpd 0.17</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Heavily modified for curl&#39;s test suite</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Copyright (c) 1983 Regents of the University of California.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * All rights reserved.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * are met:</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in the</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *    documentation and/or other materials provided with the distribution.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * 3. All advertising materials mentioning features or use of this software</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *    must display the following acknowledgement:</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *      This product includes software developed by the University of</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *      California, Berkeley and its contributors.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * 4. Neither the name of the University nor the names of its contributors</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *    may be used to endorse or promote products derived from this software</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *    without specific prior written permission.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS&#39;&#39; AND</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * SUCH DAMAGE.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__setup_8h.html">server_setup.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#ifdef HAVE_SYS_IOCTL_H</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL_H</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#ifdef HAVE_FCNTL_H</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_TFTP_H</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;arpa/tftp.h&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html">tftp.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#ifdef HAVE_SYS_FILIO_H</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/* FIONREAD on Solaris 7 */</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &lt;sys/filio.h&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &lt;setjmp.h&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#ifdef HAVE_PWD_H</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &lt;pwd.h&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a4858ee8b549f158fb5eb37dc7dad537e">   86</a></span>&#160;<span class="preprocessor">#define ENABLE_CURLX_PRINTF</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">/* make the curlx header define all printf() functions to use the curlx_*</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">   versions instead */</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curlx_8h.html">curlx.h</a>&quot;</span> <span class="comment">/* from the private lib dir */</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="getpart_8h.html">getpart.h</a>&quot;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__sockaddr_8h.html">server_sockaddr.h</a>&quot;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">/* include memdebug.h last */</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">*                      STRUCT DECLARATIONS AND DEFINES                       *</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#ifndef PKTSIZE</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="tftpd_8c.html#ac50973a1441c64f8d9e484d776f323c6">  102</a></span>&#160;<span class="preprocessor">#define PKTSIZE (SEGSIZE + 4)  </span><span class="comment">/* SEGSIZE defined in arpa/tftp.h */</span><span class="preprocessor"></span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">struct </span><a class="code" href="structtestcase.html">testcase</a> {</div><div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="structtestcase.html#a4d43162c85ee6039f2dd482ae1cbfd58">  106</a></span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="structtestcase.html#a4d43162c85ee6039f2dd482ae1cbfd58">buffer</a>;   <span class="comment">/* holds the file data to send to the client */</span></div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structtestcase.html#a50472da17d1c1c3afbafae48b4d75324">  107</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structtestcase.html#a50472da17d1c1c3afbafae48b4d75324">bufsize</a>; <span class="comment">/* size of the data in buffer */</span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structtestcase.html#a7b78ee2eed07a98bc459f221c011ca1a">  108</a></span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="structtestcase.html#a7b78ee2eed07a98bc459f221c011ca1a">rptr</a>;     <span class="comment">/* read pointer into the buffer */</span></div><div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="structtestcase.html#aa057e2b113b2ba17e85c78f7e859904b">  109</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structtestcase.html#aa057e2b113b2ba17e85c78f7e859904b">rcount</a>;  <span class="comment">/* amount of data left to read of the file */</span></div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="structtestcase.html#a49f93e46fe26ac2c17154a14be68359a">  110</a></span>&#160;  <span class="keywordtype">long</span> <a class="code" href="structtestcase.html#a49f93e46fe26ac2c17154a14be68359a">testno</a>;    <span class="comment">/* test case number */</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="structtestcase.html#a9712d9ff41ed82873dbdce34c2c52bf5">  111</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structtestcase.html#a9712d9ff41ed82873dbdce34c2c52bf5">ofile</a>;      <span class="comment">/* file descriptor for output file when uploading to us */</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="structtestcase.html#ab291b77650b54b13ec8695feba15b529">  113</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structtestcase.html#ab291b77650b54b13ec8695feba15b529">writedelay</a>; <span class="comment">/* number of seconds between each packet */</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;};</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="structformats.html">  116</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structformats.html">formats</a> {</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">  117</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">f_mode</a>;</div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">  118</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;};</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structerrmsg.html">  121</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structerrmsg.html">errmsg</a> {</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">  122</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">e_code</a>;</div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">  123</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">e_msg</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;};</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="uniontftphdr__storage__t.html">  126</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span>{</div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">  127</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> hdr;</div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">  128</a></span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1309_8c.html#a91ca015b939fb544779ada32485b26a2">storage</a>[<a class="code" href="tftpd_8c.html#ac50973a1441c64f8d9e484d776f323c6">PKTSIZE</a>];</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;} <a class="code" href="uniontftphdr__storage__t.html">tftphdr_storage_t</a>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> * bf.counter values in range [-1 .. SEGSIZE] represents size of data in the</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> * bf.buf buffer. Additionally it can also hold flags BF_ALLOC or BF_FREE.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structbf.html">  136</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structbf.html">bf</a> {</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="structbf.html#acb37771babb785889da162a2e787f1ac">  137</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a>;            <span class="comment">/* size of data in buffer, or flag */</span></div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="structbf.html#a0f442217351716d6607e0815a43d653d">  138</a></span>&#160;  <a class="code" href="uniontftphdr__storage__t.html">tftphdr_storage_t</a> <a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>;  <span class="comment">/* room for data packet */</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;};</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a7ca90f532529cc787ebefcfaf03423d6">  141</a></span>&#160;<span class="preprocessor">#define BF_ALLOC -3       </span><span class="comment">/* alloc&#39;d but not yet filled */</span><span class="preprocessor"></span></div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">  142</a></span>&#160;<span class="preprocessor">#define BF_FREE  -2       </span><span class="comment">/* free */</span><span class="preprocessor"></span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a0c76423f6cd7f7423dc4063564553496">  144</a></span>&#160;<span class="preprocessor">#define opcode_RRQ   1</span></div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a3a54965252f573f132d8892767416cb6">  145</a></span>&#160;<span class="preprocessor">#define opcode_WRQ   2</span></div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="tftpd_8c.html#acc255f37851004eafe350a7cb9cff824">  146</a></span>&#160;<span class="preprocessor">#define opcode_DATA  3</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a5b82306eaf23dcb998fdffd90e5c028c">  147</a></span>&#160;<span class="preprocessor">#define opcode_ACK   4</span></div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="tftpd_8c.html#aac807d46475eca1f79a5f99737838ed2">  148</a></span>&#160;<span class="preprocessor">#define opcode_ERROR 5</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">  150</a></span>&#160;<span class="preprocessor">#define TIMEOUT      5</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#undef MIN</span></div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a74e75242132eaabbc1c512488a135926">  153</a></span>&#160;<span class="preprocessor">#define MIN(x,y) ((x)&lt;(y)?(x):(y))</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#ifndef DEFAULT_LOGFILE</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a4d68235dfa433dea9c42f14784f80f6a">  156</a></span>&#160;<span class="preprocessor">#define DEFAULT_LOGFILE &quot;log/tftpd.log&quot;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a8f2abe1d4a220962be19a09283940e55">  159</a></span>&#160;<span class="preprocessor">#define REQUEST_DUMP  &quot;log/server.input&quot;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a16b710f592bf8f7900666392adc444dc">  161</a></span>&#160;<span class="preprocessor">#define DEFAULT_PORT 8999 </span><span class="comment">/* UDP */</span><span class="preprocessor"></span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">*                              GLOBAL VARIABLES                              *</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structerrmsg.html">errmsg</a> errmsgs[] = {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a8cce80703a689ddd9db586cb12b0d580">EUNDEF</a>,       <span class="stringliteral">&quot;Undefined error code&quot;</span> },</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a336192df37d88239b5e051adc1e23dff">ENOTFOUND</a>,    <span class="stringliteral">&quot;File not found&quot;</span> },</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>,      <span class="stringliteral">&quot;Access violation&quot;</span> },</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a0bf3e9d049a9238dc4639ec4f9999e4a">ENOSPACE</a>,     <span class="stringliteral">&quot;Disk full or allocation exceeded&quot;</span> },</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a687872934e0143c93337ffab4b25a594">EBADOP</a>,       <span class="stringliteral">&quot;Illegal TFTP operation&quot;</span> },</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a7136776690bd6d68702f2056084030d9">EBADID</a>,       <span class="stringliteral">&quot;Unknown transfer ID&quot;</span> },</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#ab9dd091c0eee6a4e12a44298c338038f">EEXISTS</a>,      <span class="stringliteral">&quot;File already exists&quot;</span> },</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  { <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a0279fec0034c425e117295697283b890">ENOUSER</a>,      <span class="stringliteral">&quot;No such user&quot;</span> },</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  { -1,           0 }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;};</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structformats.html">formats</a> formata[] = {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  { <span class="stringliteral">&quot;netascii&quot;</span>,   1 },</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  { <span class="stringliteral">&quot;octet&quot;</span>,      0 },</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  { NULL,         0 }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;};</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structbf.html">bf</a> bfs[2];</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> nextone;     <span class="comment">/* index of next buffer to use */</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> current;     <span class="comment">/* index of buffer in use */</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                           <span class="comment">/* control flags for crlf conversions */</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> newline = 0;    <span class="comment">/* fillbuf: in middle of newline expansion */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> prevchar = -1;  <span class="comment">/* putbuf: previous char (cr check) */</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keyword">static</span> <a class="code" href="uniontftphdr__storage__t.html">tftphdr_storage_t</a> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword">static</span> <a class="code" href="uniontftphdr__storage__t.html">tftphdr_storage_t</a> ackbuf;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">static</span> <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> from;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keyword">static</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> fromlen;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxtimeout = 5 * <a class="code" href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">TIMEOUT</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> use_ipv6 = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ipv_inuse = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a97a20211ff266e7b4180dd6c49c06eed">  210</a></span>&#160;<span class="keyword">const</span>  <span class="keywordtype">char</span> *<a class="code" href="tftpd_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = <a class="code" href="tftpd_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *pidname = <span class="stringliteral">&quot;.tftpd.pid&quot;</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> serverlogslocked = 0;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> wrotepidfile = 0;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGSETJMP</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keyword">static</span> sigjmp_buf timeoutbuf;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rexmtval = <a class="code" href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">TIMEOUT</a>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">/* do-nothing macro replacement for systems which lack siginterrupt() */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">#ifndef HAVE_SIGINTERRUPT</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="tftpd_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">  226</a></span>&#160;<span class="preprocessor">#define siginterrupt(x,y) do {} while(0)</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/* vars used to keep around previous signal handlers */</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">  231</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> (*<a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a>)(int);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keyword">static</span> <a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sighup_handler  = SIG_ERR;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">static</span> <a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigpipe_handler = SIG_ERR;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keyword">static</span> <a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigint_handler  = SIG_ERR;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keyword">static</span> <a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigterm_handler = SIG_ERR;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keyword">static</span> <a class="code" href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigbreak_handler = SIG_ERR;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">/* var which if set indicates that the program should finish execution */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">  255</a></span>&#160;<a class="code" href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a> <a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 0;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">/* if next is set indicates the first signal handled in exit_signal_handler */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> exit_signal = 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">*                            FUNCTION PROTOTYPES                             *</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *rw_init(<span class="keywordtype">int</span>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *w_init(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *r_init(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> read_ahead(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keywordtype">int</span> convert);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> write_behind(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keywordtype">int</span> convert);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> synchnet(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a>);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_tftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structtftphdr.html">tftphdr</a> *tp, <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> validate_access(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *fname, <span class="keywordtype">int</span> mode);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sendtftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structformats.html">formats</a> *pf);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> recvtftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structformats.html">formats</a> *pf);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> nak(<span class="keywordtype">int</span> error);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mysignal(<span class="keywordtype">int</span> sig, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="asiohiper_8cpp.html#a6363ad0c2267201dc689dbbbc4ae4305">timer</a>(<span class="keywordtype">int</span> signum);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> justtimeout(<span class="keywordtype">int</span> signum);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_ALARM &amp;&amp; SIGALRM */</span><span class="preprocessor"></span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">static</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> exit_signal_handler(<span class="keywordtype">int</span> signum);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> install_signal_handlers(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> restore_signal_handlers(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">*                          FUNCTION IMPLEMENTATIONS                          *</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">*****************************************************************************/</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"> * Like signal(), but with well-defined semantics.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mysignal(<span class="keywordtype">int</span> sig, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">int</span>))</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;{</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keyword">struct </span>sigaction sa;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;sa, 0, <span class="keyword">sizeof</span>(sa));</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  sa.sa_handler = handler;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  sigaction(sig, &amp;sa, NULL);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="asiohiper_8cpp.html#a6363ad0c2267201dc689dbbbc4ae4305">timer</a>(<span class="keywordtype">int</span> signum)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  (void)signum;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;alarm!&quot;</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> += rexmtval;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> &gt;= maxtimeout) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">if</span>(wrotepidfile) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      wrotepidfile = 0;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      unlink(pidname);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(serverlogslocked) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      serverlogslocked = 0;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    exit(1);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGSETJMP</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  siglongjmp(timeoutbuf, 1);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> justtimeout(<span class="keywordtype">int</span> signum)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  (void)signum;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_ALARM &amp;&amp; SIGALRM */</span><span class="preprocessor"></span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">/* signal handler that will be triggered to indicate that the program</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">  should finish its execution in a controlled manner as soon as possible.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">  The first time this is called it will set got_exit_signal to one and</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">  store in exit_signal the signal that triggered its execution. */</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keyword">static</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> exit_signal_handler(<span class="keywordtype">int</span> signum)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;{</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">int</span> old_errno = errno;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> == 0) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 1;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    exit_signal = signum;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  (void)signal(signum, exit_signal_handler);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  errno = old_errno;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> install_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;{</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">/* ignore SIGHUP signal */</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  old_sighup_handler = signal(SIGHUP, SIG_IGN);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">if</span>(old_sighup_handler == SIG_ERR)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGHUP handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">/* ignore SIGPIPE signal */</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  old_sigpipe_handler = signal(SIGPIPE, SIG_IGN);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span>(old_sigpipe_handler == SIG_ERR)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGPIPE handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">/* handle SIGINT signal with our exit_signal_handler */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  old_sigint_handler = signal(SIGINT, exit_signal_handler);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">if</span>(old_sigint_handler == SIG_ERR)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGINT handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <a class="code" href="tftpd_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGINT, 1);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">/* handle SIGTERM signal with our exit_signal_handler */</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  old_sigterm_handler = signal(SIGTERM, exit_signal_handler);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span>(old_sigterm_handler == SIG_ERR)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGTERM handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="tftpd_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGTERM, 1);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">/* handle SIGBREAK signal with our exit_signal_handler */</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  old_sigbreak_handler = signal(SIGBREAK, exit_signal_handler);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span>(old_sigbreak_handler == SIG_ERR)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGBREAK handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="tftpd_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGBREAK, 1);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> restore_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;{</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sighup_handler)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    (void)signal(SIGHUP, old_sighup_handler);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigpipe_handler)</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    (void)signal(SIGPIPE, old_sigpipe_handler);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigint_handler)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    (void)signal(SIGINT, old_sigint_handler);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigterm_handler)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    (void)signal(SIGTERM, old_sigterm_handler);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigbreak_handler)</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    (void)signal(SIGBREAK, old_sigbreak_handler);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> * init for either read-ahead or write-behind.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> * zero for write-behind, one for read-head.</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *rw_init(<span class="keywordtype">int</span> <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  newline = 0;                    <span class="comment">/* init crlf flag */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  prevchar = -1;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  bfs[0].<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> =  <a class="code" href="tftpd_8c.html#a7ca90f532529cc787ebefcfaf03423d6">BF_ALLOC</a>;     <span class="comment">/* pass out the first buffer */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  current = 0;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  bfs[1].<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  nextone = <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>;                    <span class="comment">/* ahead or behind? */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">return</span> &amp;bfs[0].<a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *w_init(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;{</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">return</span> rw_init(0); <span class="comment">/* write-behind */</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *r_init(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">return</span> rw_init(1); <span class="comment">/* read-ahead */</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">/* Have emptied current buffer by sending to net and getting ack.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">   Free it and return next buffer filled with data.</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> readit(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structtftphdr.html">tftphdr</a> **dpp,</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                  <span class="keywordtype">int</span> convert <span class="comment">/* if true, convert to ascii */</span>)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;{</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keyword">struct </span><a class="code" href="structbf.html">bf</a> *b;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  bfs[current].<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>; <span class="comment">/* free old one */</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  current = !current;             <span class="comment">/* &quot;incr&quot; current */</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  b = &amp;bfs[current];              <span class="comment">/* look at new buffer */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span>(b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> == <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>)      <span class="comment">/* if it&#39;s empty */</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    read_ahead(<a class="code" href="structtest.html">test</a>, convert);    <span class="comment">/* fill it */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  *dpp = &amp;b-&gt;<a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;             <span class="comment">/* set caller&#39;s ptr */</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">return</span> b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> * fill the input buffer, doing ascii conversions if requested</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> * conversions are  lf -&gt; cr, lf  and cr -&gt; cr, nul</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> read_ahead(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>,</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                       <span class="keywordtype">int</span> convert <span class="comment">/* if true, convert to ascii */</span>)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;{</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordtype">int</span> c;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keyword">struct </span><a class="code" href="structbf.html">bf</a> *b;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *dp;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  b = &amp;bfs[nextone];              <span class="comment">/* look at &quot;next&quot; buffer */</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">if</span>(b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> != <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>)      <span class="comment">/* nop if not free */</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  nextone = !nextone;             <span class="comment">/* &quot;incr&quot; next buffer ptr */</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  dp = &amp;b-&gt;<a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span>(convert == 0) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">/* The former file reading code did this:</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">       b-&gt;counter = read(fileno(file), dp-&gt;th_data, SEGSIZE); */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">size_t</span> copy_n = <a class="code" href="tftpd_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a>(<a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#abda91b30cf0d9a14329126ece2738fa2">SEGSIZE</a>, <a class="code" href="structtest.html">test</a>-&gt;rcount);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(dp-&gt;<a class="code" href="structtftphdr.html#a343cdc267d423afbba6ed9d0f72ef4c6">th_data</a>, <a class="code" href="structtest.html">test</a>-&gt;rptr, copy_n);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">/* decrease amount, advance pointer */</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;rcount -= copy_n;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;rptr += copy_n;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = (int)copy_n;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> = dp-&gt;<a class="code" href="structtftphdr.html#a343cdc267d423afbba6ed9d0f72ef4c6">th_data</a>;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0 ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#abda91b30cf0d9a14329126ece2738fa2">SEGSIZE</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span>(newline) {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">if</span>(prevchar == <span class="charliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        c = <span class="charliteral">&#39;\n&#39;</span>;       <span class="comment">/* lf to cr,lf */</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        c = <span class="charliteral">&#39;\0&#39;</span>;       <span class="comment">/* cr to cr,nul */</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      newline = 0;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>-&gt;rcount) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        c = <a class="code" href="structtest.html">test</a>-&gt;rptr[0];</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <a class="code" href="structtest.html">test</a>-&gt;rptr++;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="structtest.html">test</a>-&gt;rcount--;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keywordflow">if</span>(c == <span class="charliteral">&#39;\n&#39;</span> || c == <span class="charliteral">&#39;\r&#39;</span>) {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        prevchar = c;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        c = <span class="charliteral">&#39;\r&#39;</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        newline = 1;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>++ = (char)c;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = (int)(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> - dp-&gt;<a class="code" href="structtftphdr.html#a343cdc267d423afbba6ed9d0f72ef4c6">th_data</a>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;}</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">/* Update count associated with the buffer, get new buffer from the queue.</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">   Calls write_behind only if next buffer not available.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> writeit(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structtftphdr.html">tftphdr</a> * <span class="keyword">volatile</span> *dpp,</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                   <span class="keywordtype">int</span> ct, <span class="keywordtype">int</span> convert)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;{</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  bfs[current].<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = ct;      <span class="comment">/* set size of data to write */</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  current = !current;             <span class="comment">/* switch to other buffer */</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordflow">if</span>(bfs[current].counter != <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>)     <span class="comment">/* if not free */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    write_behind(<a class="code" href="structtest.html">test</a>, convert);     <span class="comment">/* flush it */</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  bfs[current].<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = <a class="code" href="tftpd_8c.html#a7ca90f532529cc787ebefcfaf03423d6">BF_ALLOC</a>;        <span class="comment">/* mark as alloc&#39;d */</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  *dpp =  &amp;bfs[current].<a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">return</span> ct;                      <span class="comment">/* this is a lie of course */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> * Output a buffer to a file, converting from netascii if requested.</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"> * CR, NUL -&gt; CR  and CR, LF =&gt; LF.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment"> * Note spec is undefined if we get CR as last byte of file or a</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"> * CR followed by anything else.  In this case we leave it alone.</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> write_behind(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keywordtype">int</span> convert)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;{</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">char</span> *writebuf;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">int</span> count;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordtype">int</span> ct;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordtype">int</span> c;                          <span class="comment">/* current character */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keyword">struct </span><a class="code" href="structbf.html">bf</a> *b;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *dp;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  b = &amp;bfs[nextone];</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span>(b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> &lt; -1)            <span class="comment">/* anything to flush? */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">return</span> 0;                     <span class="comment">/* just nop if nothing to do */</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="structtest.html">test</a>-&gt;ofile) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordtype">char</span> outfile[256];</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(outfile, <span class="keyword">sizeof</span>(outfile), <span class="stringliteral">&quot;log/upload.%ld&quot;</span>, <a class="code" href="structtest.html">test</a>-&gt;testno);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;ofile = open(outfile, O_CREAT|O_RDWR|<a class="code" href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>, 0777);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;ofile = open(outfile, O_CREAT|O_RDWR, 0777);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>-&gt;ofile == -1) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Couldn&#39;t create and/or open file %s for upload!&quot;</span>, outfile);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">return</span> -1; <span class="comment">/* failure! */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  count = b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a>;             <span class="comment">/* remember byte count */</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  b-&gt;<a class="code" href="structbf.html#acb37771babb785889da162a2e787f1ac">counter</a> = <a class="code" href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a>;           <span class="comment">/* reset flag */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  dp = &amp;b-&gt;<a class="code" href="structbf.html#a0f442217351716d6607e0815a43d653d">buf</a>.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  nextone = !nextone;             <span class="comment">/* incr for next time */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  writebuf = dp-&gt;<a class="code" href="structtftphdr.html#a343cdc267d423afbba6ed9d0f72ef4c6">th_data</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">if</span>(count &lt;= 0)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">return</span> -1;                    <span class="comment">/* nak logic? */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">if</span>(convert == 0)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">return</span> write(<a class="code" href="structtest.html">test</a>-&gt;ofile, writebuf, count);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> = writebuf;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  ct = count;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">while</span>(ct--) {                   <span class="comment">/* loop over the buffer */</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    c = *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>++;                     <span class="comment">/* pick up a character */</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span>(prevchar == <span class="charliteral">&#39;\r&#39;</span>) {        <span class="comment">/* if prev char was cr */</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">if</span>(c == <span class="charliteral">&#39;\n&#39;</span>)               <span class="comment">/* if have cr,lf then just */</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        lseek(<a class="code" href="structtest.html">test</a>-&gt;ofile, -1, SEEK_CUR); <span class="comment">/* smash lf on top of the cr */</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span>(c == <span class="charliteral">&#39;\0&#39;</span>)             <span class="comment">/* if have cr,nul then */</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="keywordflow">goto</span> skipit;            <span class="comment">/* just skip over the putc */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">/* else just fall through and allow it */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">/* formerly</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">       putc(c, file); */</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span>(1 != write(<a class="code" href="structtest.html">test</a>-&gt;ofile, &amp;c, 1))</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    skipit:</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    prevchar = c;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">return</span> count;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">/* When an error has occurred, it is possible that the two sides are out of</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"> * synch.  Ie: that what I think is the other side&#39;s response to packet N is</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"> * really their response to packet N-1.</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"> * So, to try to prevent that, we flush all the input queued up for us on the</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * network connection on our host.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> * We return the number of packets we flushed (mostly for reporting when trace</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> * is active).</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> synchnet(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> f <span class="comment">/* socket to flush */</span>)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;{</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="preprocessor">#if defined(HAVE_IOCTLSOCKET)</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordtype">char</span> rbuf[<a class="code" href="tftpd_8c.html#ac50973a1441c64f8d9e484d776f323c6">PKTSIZE</a>];</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> fromaddr;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> fromaddrlen;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">#if defined(HAVE_IOCTLSOCKET)</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    (void) ioctlsocket(f, FIONREAD, &amp;<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    (void) ioctl(f, FIONREAD, &amp;<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">if</span>(!use_ipv6)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        fromaddrlen = <span class="keyword">sizeof</span>(fromaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        fromaddrlen = <span class="keyword">sizeof</span>(fromaddr.sa6);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      (void) <a class="code" href="setup-os400_8h.html#a3102fdddc55c0c8906c40365b5b2fa71">recvfrom</a>(f, rbuf, <span class="keyword">sizeof</span>(rbuf), 0,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                      &amp;fromaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, &amp;fromaddrlen);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;}</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="tftpd_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">  667</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="tftpd_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> me;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *tp;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = 0;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordtype">int</span> arg = 1;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = <a class="code" href="tftpd_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordtype">long</span> pid;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtestcase.html">testcase</a> <a class="code" href="structtest.html">test</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 0;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;<a class="code" href="structtest.html">test</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structtest.html">test</a>));</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">while</span>(argc&gt;arg) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--version&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <a class="code" href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;tftpd IPv4%s\n&quot;</span>,</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;#ifdef <a class="code" href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;             <span class="stringliteral">&quot;/IPv6&quot;</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;             <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;#endif</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;             );</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--pidfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      arg++;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        pidname = argv[arg++];</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--logfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      arg++;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <a class="code" href="tftpd_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = argv[arg++];</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv4&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      ipv_inuse = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      use_ipv6 = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      arg++;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv6&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      ipv_inuse = <span class="stringliteral">&quot;IPv6&quot;</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      use_ipv6 = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      arg++;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--port&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      arg++;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulnum = strtoul(argv[arg], &amp;endptr, 10);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">if</span>((endptr != argv[arg] + strlen(argv[arg])) ||</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;           (ulnum &lt; 1025UL) || (ulnum &gt; 65535UL)) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;          <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(stderr, <span class="stringliteral">&quot;tftpd: invalid --port argument (%s)\n&quot;</span>,</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                  argv[arg]);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a> = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(ulnum);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        arg++;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--srcdir&quot;</span>, argv[arg])) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      arg++;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a> = argv[arg];</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        arg++;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <a class="code" href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a>(<span class="stringliteral">&quot;Usage: tftpd [option]\n&quot;</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;           <span class="stringliteral">&quot; --version\n&quot;</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;           <span class="stringliteral">&quot; --logfile [file]\n&quot;</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;           <span class="stringliteral">&quot; --pidfile [file]\n&quot;</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;           <span class="stringliteral">&quot; --ipv4\n&quot;</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;           <span class="stringliteral">&quot; --ipv6\n&quot;</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;           <span class="stringliteral">&quot; --port [port]\n&quot;</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;           <span class="stringliteral">&quot; --srcdir [path]&quot;</span>);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  win32_init();</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  atexit(win32_cleanup);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  install_signal_handlers();</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  pid = (long)getpid();</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">if</span>(!use_ipv6)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    sock = socket(AF_INET, SOCK_DGRAM, 0);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    sock = socket(AF_INET6, SOCK_DGRAM, 0);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == sock) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error creating socket: (%d) %s&quot;</span>,</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">goto</span> tftpd_cleanup;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  flag = 1;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span>(0 != setsockopt(sock, SOL_SOCKET, SO_REUSEADDR,</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag))) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;setsockopt(SO_REUSEADDR) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">goto</span> tftpd_cleanup;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">if</span>(!use_ipv6) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>, 0, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr.s_addr = <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port = htons(<a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a>);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.sa6, 0, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    me.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    me.sa6.sin6_addr = in6addr_any;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    me.sa6.sin6_port = htons(<a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a>);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket on port %hu: (%d) %s&quot;</span>,</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;           <a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">goto</span> tftpd_cleanup;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  wrotepidfile = <a class="code" href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a>(pidname);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">if</span>(!wrotepidfile) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">goto</span> tftpd_cleanup;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Running %s version on port UDP/%d&quot;</span>, ipv_inuse, (<span class="keywordtype">int</span>)<a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    fromlen = <span class="keyword">sizeof</span>(from);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">if</span>(!use_ipv6)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      fromlen = <span class="keyword">sizeof</span>(from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      fromlen = <span class="keyword">sizeof</span>(from.sa6);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)<a class="code" href="setup-os400_8h.html#a3102fdddc55c0c8906c40365b5b2fa71">recvfrom</a>(sock, &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage[0], <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage), 0,</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                          &amp;from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, &amp;fromlen);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &lt; 0) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;recvfrom&quot;</span>);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 3;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <a class="code" href="util_8c.html#a88279b927418889863e8247e98cb5d17">set_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    serverlogslocked = 1;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span>(!use_ipv6) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> = socket(AF_INET, SOCK_DGRAM, 0);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;socket&quot;</span>);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 2;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>)) &lt; 0) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;connect: fail&quot;</span>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      from.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> = socket(AF_INET6, SOCK_DGRAM, 0);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>) {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;socket&quot;</span>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 2;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;from.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(from.sa6)) &lt; 0) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;connect: fail&quot;</span>);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = 1;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    maxtimeout = 5*<a class="code" href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">TIMEOUT</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    tp = &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.hdr;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = ntohs(tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span>(tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#a0c76423f6cd7f7423dc4063564553496">opcode_RRQ</a> || tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#a3a54965252f573f132d8892767416cb6">opcode_WRQ</a>) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;<a class="code" href="structtest.html">test</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structtest.html">test</a>));</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">if</span>(do_tftp(&amp;<a class="code" href="structtest.html">test</a>, tp, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>) &lt; 0)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structtest.html">test</a>.buffer);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>.ofile &gt; 0) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      close(<a class="code" href="structtest.html">test</a>.ofile);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="structtest.html">test</a>.ofile = 0;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span>(serverlogslocked) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      serverlogslocked = 0;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;end of one transfer&quot;</span>);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;tftpd_cleanup:</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>.ofile &gt; 0)</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    close(<a class="code" href="structtest.html">test</a>.ofile);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">if</span>((<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> != sock) &amp;&amp; (<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a> != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>))</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span>(sock != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>)</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die&quot;</span>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">if</span>(wrotepidfile)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    unlink(pidname);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span>(serverlogslocked) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    serverlogslocked = 0;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <a class="code" href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  restore_signal_handlers();</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;========&gt; %s tftpd (port: %d pid: %ld) exits with signal (%d)&quot;</span>,</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;           ipv_inuse, (<span class="keywordtype">int</span>)<a class="code" href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">port</a>, pid, exit_signal);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">     * To properly set the return status of the process we</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">     * must raise the same signal SIGINT or SIGTERM that we</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">     * caught and let the old handler take care of it.</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keyword">raise</span>(exit_signal);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;========&gt; tftpd quits&quot;</span>);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment"> * Handle initial connection protocol.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_tftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structtftphdr.html">tftphdr</a> *tp, <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;{</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordtype">char</span> *cp;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordtype">int</span> first = 1, ecode;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keyword">struct </span><a class="code" href="structformats.html">formats</a> *pf;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, *mode = NULL;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  DWORD recvtimeout, recvtimeoutbak;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a> = <span class="stringliteral">&quot;mode&quot;</span>; <span class="comment">/* mode is implicit */</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordtype">int</span> toggle = 1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">/* Open request dump file. */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">FILE</a> *<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a> = fopen(<a class="code" href="tftpd_8c.html#a8f2abe1d4a220962be19a09283940e55">REQUEST_DUMP</a>, <span class="stringliteral">&quot;ab&quot;</span>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordtype">int</span> error = errno;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error opening file: %s&quot;</span>, <a class="code" href="tftpd_8c.html#a8f2abe1d4a220962be19a09283940e55">REQUEST_DUMP</a>);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">/* store input protocol */</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>, <span class="stringliteral">&quot;opcode: %x\n&quot;</span>, tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  cp = (<span class="keywordtype">char</span> *)&amp;tp-&gt;th_stuff;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = cp;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">bool</span> endofit = <span class="keyword">true</span>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">while</span>(cp &lt; &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage[<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>]) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordflow">if</span>(*cp == <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        endofit = <span class="keyword">false</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      cp++;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    }</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">if</span>(endofit)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="comment">/* no more options */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">/* before increasing pointer, make sure it is still within the legal</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">       space */</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">if</span>((cp + 1) &lt; &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage[<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>]) {</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      ++cp;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">if</span>(first) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment">/* store the mode since we need it later */</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        mode = cp;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        first = 0;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span>(toggle)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="comment">/* name/value pair: */</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, <a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a>, cp);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">/* store the name pointer */</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a> = cp;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      }</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      toggle ^= 1;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <span class="comment">/* No more options */</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  } <span class="keywordflow">while</span>(1);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordflow">if</span>(*cp) {</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    nak(<a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a687872934e0143c93337ffab4b25a594">EBADOP</a>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    fclose(<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">return</span> 3;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">/* store input protocol */</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>, <span class="stringliteral">&quot;filename: %s\n&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordflow">for</span>(cp = mode; cp &amp;&amp; *cp; cp++)</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl__ctype_8h.html#a66e6e47e8d70dd61ccae33e7bff0b909">ISUPPER</a>(*cp))</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      *cp = (char)tolower((<span class="keywordtype">int</span>)*cp);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">/* store input protocol */</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  fclose(<a class="code" href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">for</span>(pf = formata; pf-&gt;<a class="code" href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">f_mode</a>; pf++)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span>(strcmp(pf-&gt;<a class="code" href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">f_mode</a>, mode) == 0)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">if</span>(!pf-&gt;<a class="code" href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">f_mode</a>) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    nak(<a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a687872934e0143c93337ffab4b25a594">EBADOP</a>);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  ecode = validate_access(<a class="code" href="structtest.html">test</a>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a>);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">if</span>(ecode) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    nak(ecode);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  recvtimeout = <span class="keyword">sizeof</span>(recvtimeoutbak);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  getsockopt(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, SOL_SOCKET, SO_RCVTIMEO,</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;             (<span class="keywordtype">char</span> *)&amp;recvtimeoutbak, (<span class="keywordtype">int</span> *)&amp;recvtimeout);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  recvtimeout = <a class="code" href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">TIMEOUT</a>*1000;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  setsockopt(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, SOL_SOCKET, SO_RCVTIMEO,</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;             (<span class="keyword">const</span> <span class="keywordtype">char</span> *)&amp;recvtimeout, <span class="keyword">sizeof</span>(recvtimeout));</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">if</span>(tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#a3a54965252f573f132d8892767416cb6">opcode_WRQ</a>)</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    recvtftp(<a class="code" href="structtest.html">test</a>, pf);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    sendtftp(<a class="code" href="structtest.html">test</a>, pf);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  recvtimeout = recvtimeoutbak;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  setsockopt(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, SOL_SOCKET, SO_RCVTIMEO,</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;             (<span class="keyword">const</span> <span class="keywordtype">char</span> *)&amp;recvtimeout, <span class="keyword">sizeof</span>(recvtimeout));</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;}</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">/* Based on the testno, parse the correct server commands. */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> parse_servercmd(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *req)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;{</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">FILE</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = <a class="code" href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a>(req-&gt;<a class="code" href="structtestcase.html#a49f93e46fe26ac2c17154a14be68359a">testno</a>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = fopen(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    error = errno;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  [1] Error opening file: %s&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  Couldn&#39;t open test file %ld&quot;</span>, req-&gt;<a class="code" href="structtestcase.html#a49f93e46fe26ac2c17154a14be68359a">testno</a>);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordtype">char</span> *orgcmd = NULL;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordtype">char</span> *cmd = NULL;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordtype">size_t</span> cmdsize = 0;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">int</span> num = 0;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">/* get the custom server control &quot;commands&quot; */</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    error = <a class="code" href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a>(&amp;orgcmd, &amp;cmdsize, <span class="stringliteral">&quot;reply&quot;</span>, <span class="stringliteral">&quot;servercmd&quot;</span>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    fclose(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getpart() failed with error: %d&quot;</span>, error);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    cmd = orgcmd;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">while</span>(cmd &amp;&amp; cmdsize) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordtype">char</span> *check;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="keywordflow">if</span>(1 == sscanf(cmd, <span class="stringliteral">&quot;writedelay: %d&quot;</span>, &amp;num)) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to delay %d secs between packets&quot;</span>, num);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        req-&gt;<a class="code" href="structtestcase.html#ab291b77650b54b13ec8695feba15b529">writedelay</a> = num;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Unknown &lt;servercmd&gt; instruction found: %s&quot;</span>, cmd);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="comment">/* try to deal with CRLF or just LF */</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      check = strchr(cmd, <span class="charliteral">&#39;\r&#39;</span>);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">if</span>(!check)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        check = strchr(cmd, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordflow">if</span>(check) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="comment">/* get to the letter following the newline */</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">while</span>((*check == <span class="charliteral">&#39;\r&#39;</span>) || (*check == <span class="charliteral">&#39;\n&#39;</span>))</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;          check++;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span>(!*check)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          <span class="comment">/* if we reached a zero, get out */</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        cmd = check;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    }</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(orgcmd);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordflow">return</span> 0; <span class="comment">/* OK! */</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;}</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"> * Validate file access.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> validate_access(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="keywordtype">int</span> mode)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;{</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;trying to get file: %s mode %x&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, mode);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordflow">if</span>(!strncmp(<span class="stringliteral">&quot;verifiedserver&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, 14)) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordtype">char</span> weare[128];</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordtype">size_t</span> count = <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(weare, <span class="keyword">sizeof</span>(weare),</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                             <span class="stringliteral">&quot;WE ROOLZ: %ld\r\n&quot;</span>, (<span class="keywordtype">long</span>)getpid());</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Are-we-friendly question received&quot;</span>);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;buffer = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(weare);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;rptr = <a class="code" href="structtest.html">test</a>-&gt;buffer; <span class="comment">/* set read pointer */</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;bufsize = count;    <span class="comment">/* set total count */</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;rcount = count;     <span class="comment">/* set data left to read */</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordflow">return</span> 0; <span class="comment">/* fine */</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="comment">/* find the last slash */</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strrchr(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">char</span> partbuf[80]=<span class="stringliteral">&quot;data&quot;</span>;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordtype">long</span> partno;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordtype">long</span> testno;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++; <span class="comment">/* skip the slash */</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">/* skip all non-numericals following the slash */</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; !<a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">/* get the number */</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    testno = strtol(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 10);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span>(testno &gt; 10000) {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      partno = testno % 10000;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      testno /= 10000;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      partno = 0;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;requested test number %ld part %ld&quot;</span>, testno, partno);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="structtest.html">test</a>-&gt;testno = testno;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    (void)parse_servercmd(<a class="code" href="structtest.html">test</a>);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a> = <a class="code" href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a>(testno);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span>(0 != partno)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(partbuf, <span class="keyword">sizeof</span>(partbuf), <span class="stringliteral">&quot;data%ld&quot;</span>, partno);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <a class="code" href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">FILE</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = fopen(<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordtype">int</span> error = errno;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error opening file: %s&quot;</span>, <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Couldn&#39;t open test file: %s&quot;</span>, <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="keywordtype">size_t</span> count;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="keywordtype">int</span> error = <a class="code" href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a>(&amp;<a class="code" href="structtest.html">test</a>-&gt;buffer, &amp;count, <span class="stringliteral">&quot;reply&quot;</span>, partbuf, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        fclose(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getpart() failed with error: %d&quot;</span>, error);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        }</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>-&gt;buffer) {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;          <a class="code" href="structtest.html">test</a>-&gt;rptr = <a class="code" href="structtest.html">test</a>-&gt;buffer; <span class="comment">/* set read pointer */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          <a class="code" href="structtest.html">test</a>-&gt;bufsize = count;    <span class="comment">/* set total count */</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          <a class="code" href="structtest.html">test</a>-&gt;rcount = count;     <span class="comment">/* set data left to read */</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        }</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    }</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;no slash found in path&quot;</span>);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a>; <span class="comment">/* failure */</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;file opened and all is good&quot;</span>);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;}</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment"> * Send the requested file.</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sendtftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structformats.html">formats</a> *pf)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;{</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">/* These are volatile to live through a siglongjmp */</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sendblock; <span class="comment">/* block count */</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> * <span class="keyword">volatile</span> sdp = r_init(); <span class="comment">/* data buffer */</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> * <span class="keyword">const</span> sap = &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>; <span class="comment">/* ack buffer */</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  sendblock = 1;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  mysignal(SIGALRM, <a class="code" href="asiohiper_8cpp.html#a6363ad0c2267201dc689dbbbc4ae4305">timer</a>);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = readit(<a class="code" href="structtest.html">test</a>, (<span class="keyword">struct</span> <a class="code" href="structtftphdr.html">tftphdr</a> **)&amp;sdp, pf-&gt;<a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> &lt; 0) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      nak(errno + 100);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    sdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="tftpd_8c.html#acc255f37851004eafe350a7cb9cff824">opcode_DATA</a>);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    sdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> = htons(sendblock);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = 0;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGSETJMP</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    (void) sigsetjmp(timeoutbuf, 1);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structtest.html">test</a>-&gt;writedelay) {</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Pausing %d seconds before %d bytes&quot;</span>, <a class="code" href="structtest.html">test</a>-&gt;writedelay,</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;             <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(1000*<a class="code" href="structtest.html">test</a>-&gt;writedelay);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    }</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    send_data:</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">if</span>(swrite(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, sdp, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> + 4) != <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> + 4) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;write&quot;</span>);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    read_ahead(<a class="code" href="structtest.html">test</a>, pf-&gt;<a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">#ifdef HAVE_ALARM</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      alarm(rexmtval);        <span class="comment">/* read the ack */</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = sread(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">storage</a>[0], <span class="keyword">sizeof</span>(ackbuf.<a class="code" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">storage</a>));</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">#ifdef HAVE_ALARM</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      alarm(0);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &lt; 0) {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;read: fail&quot;</span>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      }</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      sap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = ntohs((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)sap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a>);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      sap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> = ntohs(sap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a>);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">if</span>(sap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#aac807d46475eca1f79a5f99737838ed2">opcode_ERROR</a>) {</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;got ERROR&quot;</span>);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      }</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="keywordflow">if</span>(sap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#a5b82306eaf23dcb998fdffd90e5c028c">opcode_ACK</a>) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="keywordflow">if</span>(sap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> == sendblock) {</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="comment">/* Re-synchronize with the other side */</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        (void) synchnet(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">if</span>(sap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> == (sendblock-1)) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          <span class="keywordflow">goto</span> send_data;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    sendblock++;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  } <span class="keywordflow">while</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> == <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#abda91b30cf0d9a14329126ece2738fa2">SEGSIZE</a>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;}</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment"> * Receive a file.</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> recvtftp(<span class="keyword">struct</span> <a class="code" href="structtestcase.html">testcase</a> *<a class="code" href="structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="structformats.html">formats</a> *pf)</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;{</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="comment">/* These are volatile to live through a siglongjmp */</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> recvblock; <span class="comment">/* block count */</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> * <span class="keyword">volatile</span> rdp;     <span class="comment">/* data buffer */</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *rap;      <span class="comment">/* ack buffer */</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  recvblock = 0;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  rdp = w_init();</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  mysignal(SIGALRM, <a class="code" href="asiohiper_8cpp.html#a6363ad0c2267201dc689dbbbc4ae4305">timer</a>);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  rap = &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">hdr</a>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = 0;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    rap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="tftpd_8c.html#a5b82306eaf23dcb998fdffd90e5c028c">opcode_ACK</a>);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    rap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> = htons(recvblock);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    recvblock++;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGSETJMP</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    (void) sigsetjmp(timeoutbuf, 1);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;send_ack:</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">if</span>(swrite(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">storage</a>[0], 4) != 4) {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;write: fail\n&quot;</span>);</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    }</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    write_behind(<a class="code" href="structtest.html">test</a>, pf-&gt;<a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="preprocessor">#ifdef HAVE_ALARM</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      alarm(rexmtval);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = sread(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, rdp, <a class="code" href="tftpd_8c.html#ac50973a1441c64f8d9e484d776f323c6">PKTSIZE</a>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor">#ifdef HAVE_ALARM</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      alarm(0);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &lt; 0) {                       <span class="comment">/* really? */</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;read: fail\n&quot;</span>);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      rdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = ntohs((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)rdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      rdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> = ntohs(rdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a>);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <span class="keywordflow">if</span>(rdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#aac807d46475eca1f79a5f99737838ed2">opcode_ERROR</a>)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="keywordflow">if</span>(rdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#acc255f37851004eafe350a7cb9cff824">opcode_DATA</a>) {</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keywordflow">if</span>(rdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> == recvblock) {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;          <span class="keywordflow">break</span>;                         <span class="comment">/* normal */</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="comment">/* Re-synchronize with the other side */</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        (void) synchnet(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordflow">if</span>(rdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> == (recvblock-1))</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          <span class="keywordflow">goto</span> send_ack;                 <span class="comment">/* rexmit */</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      }</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    }</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = writeit(<a class="code" href="structtest.html">test</a>, &amp;rdp, (<span class="keywordtype">int</span>)(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> - 4), pf-&gt;<a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> != (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>-4)) {                 <span class="comment">/* ahem */</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> &lt; 0)</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        nak(errno + 100);</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        nak(<a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a0bf3e9d049a9238dc4639ec4f9999e4a">ENOSPACE</a>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  } <span class="keywordflow">while</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> == <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#abda91b30cf0d9a14329126ece2738fa2">SEGSIZE</a>);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  write_behind(<a class="code" href="structtest.html">test</a>, pf-&gt;<a class="code" href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">f_convert</a>);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  rap-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="tftpd_8c.html#a5b82306eaf23dcb998fdffd90e5c028c">opcode_ACK</a>);  <span class="comment">/* send the &quot;final&quot;</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">                                                          ack */</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  rap-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a> = htons(recvblock);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  (void) swrite(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">storage</a>[0], 4);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="preprocessor">#if defined(HAVE_ALARM) &amp;&amp; defined(SIGALRM)</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  mysignal(SIGALRM, justtimeout);        <span class="comment">/* just abort read on timeout */</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  alarm(rexmtval);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="comment">/* normally times out and quits */</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = sread(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage[0], <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage));</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#ifdef HAVE_ALARM</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  alarm(0);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">goto</span> abort;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &gt;= 4 &amp;&amp;                               <span class="comment">/* if read some data */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;     rdp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> == <a class="code" href="tftpd_8c.html#acc255f37851004eafe350a7cb9cff824">opcode_DATA</a> &amp;&amp;        <span class="comment">/* and got a data block */</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;     recvblock == rdp-&gt;<a class="code" href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">th_block</a>) {           <span class="comment">/* then my last ack was lost */</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    (void) swrite(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;ackbuf.<a class="code" href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">storage</a>[0], 4);  <span class="comment">/* resend final ack */</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  }</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;abort:</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;}</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment"> * Send a nak packet (error message).  Error code passed in is one of the</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment"> * standard TFTP codes, or a Unix errno offset by 100.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> nak(<span class="keywordtype">int</span> error)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;{</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtftphdr.html">tftphdr</a> *tp;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="keywordtype">int</span> length;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keyword">struct </span><a class="code" href="structerrmsg.html">errmsg</a> *pe;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  tp = &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.hdr;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  tp-&gt;<a class="code" href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">th_opcode</a> = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="tftpd_8c.html#aac807d46475eca1f79a5f99737838ed2">opcode_ERROR</a>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  tp-&gt;th_code = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)error);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordflow">for</span>(pe = errmsgs; pe-&gt;<a class="code" href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">e_code</a> &gt;= 0; pe++)</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordflow">if</span>(pe-&gt;<a class="code" href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">e_code</a> == error)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordflow">if</span>(pe-&gt;<a class="code" href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">e_code</a> &lt; 0) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    pe-&gt;<a class="code" href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">e_msg</a> = <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error - 100);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    tp-&gt;th_code = <a class="code" href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a8cce80703a689ddd9db586cb12b0d580">EUNDEF</a>;   <span class="comment">/* set &#39;undef&#39; errorcode */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  length = (int)strlen(pe-&gt;<a class="code" href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">e_msg</a>);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="comment">/* we use memcpy() instead of strcpy() in order to avoid buffer overflow</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">   * report from glibc with FORTIFY_SOURCE */</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(tp-&gt;th_msg, pe-&gt;<a class="code" href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">e_msg</a>, length + 1);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  length += 5;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">if</span>(swrite(<a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, &amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>.storage[0], length) != length)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;nak: fail\n&quot;</span>);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;}</div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="tftpd_8c_html_acc255f37851004eafe350a7cb9cff824"><div class="ttname"><a href="tftpd_8c.html#acc255f37851004eafe350a7cb9cff824">opcode_DATA</a></div><div class="ttdeci">#define opcode_DATA</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00146">tftpd.c:146</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_abda91b30cf0d9a14329126ece2738fa2"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#abda91b30cf0d9a14329126ece2738fa2">SEGSIZE</a></div><div class="ttdeci">#define SEGSIZE</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00029">tftp.h:29</a></div></div>
<div class="ttc" id="setup-os400_8h_html_af65cc88d9ccb2274b94e0025d25d965f"><div class="ttname"><a href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a></div><div class="ttdeci">#define bind</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00211">setup-os400.h:211</a></div></div>
<div class="ttc" id="ignore-content-length_8d_html_a06bf02a476389246deac1e3c53ee7e18"><div class="ttname"><a href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a></div><div class="ttdeci">Long Ignore the Content Length header.This is particularly useful for servers running Apache. x</div><div class="ttdef"><b>Definition:</b> <a href="ignore-content-length_8d_source.html#l00005">ignore-content-length.d:5</a></div></div>
<div class="ttc" id="structtestcase_html_a9712d9ff41ed82873dbdce34c2c52bf5"><div class="ttname"><a href="structtestcase.html#a9712d9ff41ed82873dbdce34c2c52bf5">testcase::ofile</a></div><div class="ttdeci">int ofile</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00111">tftpd.c:111</a></div></div>
<div class="ttc" id="structtestcase_html_ab291b77650b54b13ec8695feba15b529"><div class="ttname"><a href="structtestcase.html#ab291b77650b54b13ec8695feba15b529">testcase::writedelay</a></div><div class="ttdeci">int writedelay</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00113">tftpd.c:113</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a0bf3e9d049a9238dc4639ec4f9999e4a"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a0bf3e9d049a9238dc4639ec4f9999e4a">ENOSPACE</a></div><div class="ttdeci">#define ENOSPACE</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00055">tftp.h:55</a></div></div>
<div class="ttc" id="unit1309_8c_html_a9e2730b68a97dbfb591cdc0e802bb4f5"><div class="ttname"><a href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a></div><div class="ttdeci">puts(&quot;Result:&quot;)</div></div>
<div class="ttc" id="curl__setup__once_8h_html_abc0fa768a42a766f444259b91e5c6c0f"><div class="ttname"><a href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a></div><div class="ttdeci">#define sclose(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00264">curl_setup_once.h:264</a></div></div>
<div class="ttc" id="unit1309_8c_html_a91ca015b939fb544779ada32485b26a2"><div class="ttname"><a href="unit1309_8c.html#a91ca015b939fb544779ada32485b26a2">storage</a></div><div class="ttdeci">size_t storage[NUM_NODES *3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1309_8c_source.html#l00076">unit1309.c:76</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a336192df37d88239b5e051adc1e23dff"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a336192df37d88239b5e051adc1e23dff">ENOTFOUND</a></div><div class="ttdeci">#define ENOTFOUND</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00053">tftp.h:53</a></div></div>
<div class="ttc" id="structtftphdr_html_aedd151adcecc7f0f697d1f3c60108dae"><div class="ttname"><a href="structtftphdr.html#aedd151adcecc7f0f697d1f3c60108dae">tftphdr::th_opcode</a></div><div class="ttdeci">short th_opcode</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00043">tftp.h:43</a></div></div>
<div class="ttc" id="tftpd_8c_html_aec67ea35c886267fb4518f150e80808b"><div class="ttname"><a href="tftpd_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a></div><div class="ttdeci">RETSIGTYPE(* SIGHANDLER_T)(int)</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00231">tftpd.c:231</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a687872934e0143c93337ffab4b25a594"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a687872934e0143c93337ffab4b25a594">EBADOP</a></div><div class="ttdeci">#define EBADOP</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00056">tftp.h:56</a></div></div>
<div class="ttc" id="structbf_html"><div class="ttname"><a href="structbf.html">bf</a></div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00136">tftpd.c:136</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="config-dos_8h_html_adbe5dcee9c146b338794974137c55e70"><div class="ttname"><a href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a></div><div class="ttdeci">#define RETSIGTYPE</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00087">config-dos.h:87</a></div></div>
<div class="ttc" id="structtestcase_html_a4d43162c85ee6039f2dd482ae1cbfd58"><div class="ttname"><a href="structtestcase.html#a4d43162c85ee6039f2dd482ae1cbfd58">testcase::buffer</a></div><div class="ttdeci">char * buffer</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00106">tftpd.c:106</a></div></div>
<div class="ttc" id="structbf_html_a0f442217351716d6607e0815a43d653d"><div class="ttname"><a href="structbf.html#a0f442217351716d6607e0815a43d653d">bf::buf</a></div><div class="ttdeci">tftphdr_storage_t buf</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00138">tftpd.c:138</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="structtestcase_html"><div class="ttname"><a href="structtestcase.html">testcase</a></div><div class="ttdef"><b>Definition:</b> <a href="lib1560_8c_source.html#l00105">lib1560.c:105</a></div></div>
<div class="ttc" id="tftpd_8c_html_aac807d46475eca1f79a5f99737838ed2"><div class="ttname"><a href="tftpd_8c.html#aac807d46475eca1f79a5f99737838ed2">opcode_ERROR</a></div><div class="ttdeci">#define opcode_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00148">tftpd.c:148</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="first_8c_html_ad9df668cd7e7913338d1919a8520f76f"><div class="ttname"><a href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a></div><div class="ttdeci">void wait_ms(int ms)</div><div class="ttdef"><b>Definition:</b> <a href="first_8c_source.html#l00066">first.c:66</a></div></div>
<div class="ttc" id="tftpd_8c_html_a4a9d8a1ce1202fc103170f815364076b"><div class="ttname"><a href="tftpd_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a></div><div class="ttdeci">SIG_ATOMIC_T got_exit_signal</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00255">tftpd.c:255</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="util_8c_html_a4ed279d3ab8f2e8b9d8c3f051e514783"><div class="ttname"><a href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a></div><div class="ttdeci">int write_pidfile(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00260">util.c:260</a></div></div>
<div class="ttc" id="structtftphdr_html_a343cdc267d423afbba6ed9d0f72ef4c6"><div class="ttname"><a href="structtftphdr.html#a343cdc267d423afbba6ed9d0f72ef4c6">tftphdr::th_data</a></div><div class="ttdeci">char th_data[1]</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00045">tftp.h:45</a></div></div>
<div class="ttc" id="config-os400_8h_html_a7a1524cf833450776ffc81c38a78c370"><div class="ttname"><a href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="ttdeci">#define ENABLE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00071">config-os400.h:71</a></div></div>
<div class="ttc" id="setup-os400_8h_html_a3102fdddc55c0c8906c40365b5b2fa71"><div class="ttname"><a href="setup-os400_8h.html#a3102fdddc55c0c8906c40365b5b2fa71">recvfrom</a></div><div class="ttdeci">#define recvfrom</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00213">setup-os400.h:213</a></div></div>
<div class="ttc" id="tftpd_8c_html_a5b82306eaf23dcb998fdffd90e5c028c"><div class="ttname"><a href="tftpd_8c.html#a5b82306eaf23dcb998fdffd90e5c028c">opcode_ACK</a></div><div class="ttdeci">#define opcode_ACK</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00147">tftpd.c:147</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a8cce80703a689ddd9db586cb12b0d580"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a8cce80703a689ddd9db586cb12b0d580">EUNDEF</a></div><div class="ttdeci">#define EUNDEF</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00052">tftp.h:52</a></div></div>
<div class="ttc" id="structtestcase_html_a7b78ee2eed07a98bc459f221c011ca1a"><div class="ttname"><a href="structtestcase.html#a7b78ee2eed07a98bc459f221c011ca1a">testcase::rptr</a></div><div class="ttdeci">char * rptr</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00108">tftpd.c:108</a></div></div>
<div class="ttc" id="structtftphdr_html"><div class="ttname"><a href="structtftphdr.html">tftphdr</a></div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00042">tftp.h:42</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_acced044f00f1982f06fc02cc44fbbdca"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#acced044f00f1982f06fc02cc44fbbdca">EACCESS</a></div><div class="ttdeci">#define EACCESS</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00054">tftp.h:54</a></div></div>
<div class="ttc" id="util_8c_html_ad313740f510df6ccee72c71c03cf9c66"><div class="ttname"><a href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a></div><div class="ttdeci">void clear_advisor_read_lock(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00300">util.c:300</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="unit1394_8c_html_a0fb9c3165f64b5b79f3928b404818be9"><div class="ttname"><a href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a></div><div class="ttdeci">const char ** p</div><div class="ttdef"><b>Definition:</b> <a href="unit1394_8c_source.html#l00079">unit1394.c:79</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="smooth-gtk-thread_8c_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="smooth-gtk-thread_8c_source.html#l00047">smooth-gtk-thread.c:47</a></div></div>
<div class="ttc" id="quote_8d_html_a69d5aa4d733b2b50a0834bb67eff84cf"><div class="ttname"><a href="quote_8d.html#a69d5aa4d733b2b50a0834bb67eff84cf">server</a></div><div class="ttdeci">Long to be exact.To make commands take place after a successful prefix them with a dash.To make commands be sent after curl has changed the working just before the transfer prefix the command with the entire operation will be aborted.You must send syntactically correct FTP commands as RFC defines to FTP or one of the commands listed below to SFTP servers.This option can be used multiple times.When speaking to an FTP server</div><div class="ttdef"><b>Definition:</b> <a href="quote_8d_source.html#l00017">quote.d:17</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html">tftp.h</a></div></div>
<div class="ttc" id="tool__operate_8c_html_a36fa9b2e726512bc17a7a6d3e39002be"><div class="ttname"><a href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a></div><div class="ttdeci">#define O_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="tool__operate_8c_source.html#l00087">tool_operate.c:87</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="util_8h_html_a52cb8153a3777a126985be9c268311eb"><div class="ttname"><a href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a></div><div class="ttdeci">#define SERVERLOGS_LOCK</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00032">util.h:32</a></div></div>
<div class="ttc" id="form_8d_html_a2ff994e16bf9521154de4cf659a3b689"><div class="ttname"><a href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a></div><div class="ttdeci">filename</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00057">form.d:57</a></div></div>
<div class="ttc" id="tftpd_8c_html_a3a54965252f573f132d8892767416cb6"><div class="ttname"><a href="tftpd_8c.html#a3a54965252f573f132d8892767416cb6">opcode_WRQ</a></div><div class="ttdeci">#define opcode_WRQ</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00145">tftpd.c:145</a></div></div>
<div class="ttc" id="tftpd_8c_html_a45ba202b05caf39795aeca91b0ae547e"><div class="ttname"><a href="tftpd_8c.html#a45ba202b05caf39795aeca91b0ae547e">TIMEOUT</a></div><div class="ttdeci">#define TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00150">tftpd.c:150</a></div></div>
<div class="ttc" id="tftpd_8c_html_ace295fd44db3027ed2f037b85f1d717c"><div class="ttname"><a href="tftpd_8c.html#ace295fd44db3027ed2f037b85f1d717c">BF_FREE</a></div><div class="ttdeci">#define BF_FREE</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00142">tftpd.c:142</a></div></div>
<div class="ttc" id="curlx_8h_html"><div class="ttname"><a href="curlx_8h.html">curlx.h</a></div></div>
<div class="ttc" id="warnless_8c_html_a5cda9889c201b12398833787bff13e6e"><div class="ttname"><a href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a></div><div class="ttdeci">unsigned short curlx_ultous(unsigned long ulnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00124">warnless.c:124</a></div></div>
<div class="ttc" id="structbf_html_acb37771babb785889da162a2e787f1ac"><div class="ttname"><a href="structbf.html#acb37771babb785889da162a2e787f1ac">bf::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00137">tftpd.c:137</a></div></div>
<div class="ttc" id="tftpd_8c_html_a7ca90f532529cc787ebefcfaf03423d6"><div class="ttname"><a href="tftpd_8c.html#a7ca90f532529cc787ebefcfaf03423d6">BF_ALLOC</a></div><div class="ttdeci">#define BF_ALLOC</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00141">tftpd.c:141</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="structerrmsg_html"><div class="ttname"><a href="structerrmsg.html">errmsg</a></div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00121">tftpd.c:121</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_a66e6e47e8d70dd61ccae33e7bff0b909"><div class="ttname"><a href="curl__ctype_8h.html#a66e6e47e8d70dd61ccae33e7bff0b909">ISUPPER</a></div><div class="ttdeci">#define ISUPPER(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00071">curl_ctype.h:71</a></div></div>
<div class="ttc" id="util_8c_html_a9fab34cec25b3714a6b19cc623733954"><div class="ttname"><a href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a></div><div class="ttdeci">void logmsg(const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00099">util.c:99</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="cacert_8d_html_a2dc1940063b86f9c406c65ac7928ac63"><div class="ttname"><a href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a></div><div class="ttdeci">Long so this option is typically used to alter that default file.curl recognizes the environment variable named CURL_CA_BUNDLE if it is and uses the given path as a path to a CA cert bundle.This option overrides that variable.The windows version of curl will automatically look for a CA certs file named curl ca bundle.either in the same directory as curl.or in the Current Working or in any folder along your PATH.If curl is built against the NSS SSL the NSS PEM then this option is supported for backward compatibility with other SSL but it should not be set.If the option is not then curl will use the certificates in the system and user Keychain to verify the peer</div><div class="ttdef"><b>Definition:</b> <a href="cacert_8d_source.html#l00023">cacert.d:23</a></div></div>
<div class="ttc" id="config_8d_html_aea53e62b3bb322f5a6bf4ceb58066a37"><div class="ttname"><a href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are r and v.A backslash preceding any other letter is ignored.If the first column of a config line is a the rest of the line will be treated as a comment.Only write one option per physical line in the config file.Specify the filename to config as to make curl read the file from stdin.Note that to be able to specify a URL in the config file</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="structtestcase_html_aa057e2b113b2ba17e85c78f7e859904b"><div class="ttname"><a href="structtestcase.html#aa057e2b113b2ba17e85c78f7e859904b">testcase::rcount</a></div><div class="ttdeci">size_t rcount</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00109">tftpd.c:109</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a0071bfd21ec79c6616e860f8b4c20015"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">srvr_sockaddr_union_t::sa</a></div><div class="ttdeci">struct sockaddr sa</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00031">server_sockaddr.h:31</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="create-dirs_8d_html_a80cfb6b82f50850fe3824288a2e3a40c"><div class="ttname"><a href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a></div><div class="ttdeci">Long curl will create the necessary local directory hierarchy as needed.This option creates the dirs mentioned with the output option</div><div class="ttdef"><b>Definition:</b> <a href="create-dirs_8d_source.html#l00004">create-dirs.d:4</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3cb9f0894fab1c8fbb0753c9c7c2a8d9"><div class="ttname"><a href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a></div><div class="ttdeci">#define printf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00040">curl_printf.h:40</a></div></div>
<div class="ttc" id="asiohiper_8cpp_html_a6363ad0c2267201dc689dbbbc4ae4305"><div class="ttname"><a href="asiohiper_8cpp.html#a6363ad0c2267201dc689dbbbc4ae4305">timer</a></div><div class="ttdeci">boost::asio::deadline_timer timer(io_service)</div></div>
<div class="ttc" id="tftpd_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="tftpd_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00667">tftpd.c:667</a></div></div>
<div class="ttc" id="structtestcase_html_a50472da17d1c1c3afbafae48b4d75324"><div class="ttname"><a href="structtestcase.html#a50472da17d1c1c3afbafae48b4d75324">testcase::bufsize</a></div><div class="ttdeci">size_t bufsize</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00107">tftpd.c:107</a></div></div>
<div class="ttc" id="tftpd_8c_html_a8f2abe1d4a220962be19a09283940e55"><div class="ttname"><a href="tftpd_8c.html#a8f2abe1d4a220962be19a09283940e55">REQUEST_DUMP</a></div><div class="ttdeci">#define REQUEST_DUMP</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00159">tftpd.c:159</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a0279fec0034c425e117295697283b890"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a0279fec0034c425e117295697283b890">ENOUSER</a></div><div class="ttdeci">#define ENOUSER</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00059">tftp.h:59</a></div></div>
<div class="ttc" id="structerrmsg_html_aaef0f92e024377f6865e5e70fd9099c2"><div class="ttname"><a href="structerrmsg.html#aaef0f92e024377f6865e5e70fd9099c2">errmsg::e_msg</a></div><div class="ttdeci">const char * e_msg</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00123">tftpd.c:123</a></div></div>
<div class="ttc" id="server__sockaddr_8h_html"><div class="ttname"><a href="server__sockaddr_8h.html">server_sockaddr.h</a></div></div>
<div class="ttc" id="data-binary_8d_html_a3ac969eb89029f16e1971dc874d41dab"><div class="ttname"><a href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a></div><div class="ttdeci">Long the rest should be a filename.Data is posted in a similar manner as data except that newlines and carriage returns are preserved and conversions are never done.Like data the default content type sent to the server is application x www form urlencoded.If you want the data to be treated as arbitrary binary data by the server then set the content type to octet stream</div><div class="ttdef"><b>Definition:</b> <a href="data-binary_8d_source.html#l00008">data-binary.d:8</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="setup-os400_8h_html_adfd4ee688142ebda1142c1b0c7577e91"><div class="ttname"><a href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a></div><div class="ttdeci">#define connect</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00210">setup-os400.h:210</a></div></div>
<div class="ttc" id="structformats_html"><div class="ttname"><a href="structformats.html">formats</a></div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00116">tftpd.c:116</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a></div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00030">server_sockaddr.h:30</a></div></div>
<div class="ttc" id="tftpd_8c_html_ad5a1ca718c29b220d382e70a5913f7a4"><div class="ttname"><a href="tftpd_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a></div><div class="ttdeci">#define siginterrupt(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00226">tftpd.c:226</a></div></div>
<div class="ttc" id="unit1652_8c_html_a1d19b0eef3b3acd31be88886a0277c2e"><div class="ttname"><a href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a></div><div class="ttdeci">memset(input, '\0', sizeof(input))</div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a7ddf85b622bfeaf8d3b158e18ed6794a"><div class="ttname"><a href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a></div><div class="ttdeci">#define SIG_ATOMIC_T</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00370">curl_setup_once.h:370</a></div></div>
<div class="ttc" id="tftpd_8c_html_a97a20211ff266e7b4180dd6c49c06eed"><div class="ttname"><a href="tftpd_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a></div><div class="ttdeci">const char * serverlogfile</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00210">tftpd.c:210</a></div></div>
<div class="ttc" id="getpart_8h_html"><div class="ttname"><a href="getpart_8h.html">getpart.h</a></div></div>
<div class="ttc" id="_console_8h_html_ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719"><div class="ttname"><a href="_console_8h.html#ae07e7f0f3d76ae1309217641da872eb2a9fc5887c030f7a3e19821ebec457e719">ArgType_t::FILE</a></div></div>
<div class="ttc" id="structtestcase_html_ac8fc433917a9ed6f026b323f900c8d37"><div class="ttname"><a href="structtestcase.html#ac8fc433917a9ed6f026b323f900c8d37">testcase::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="unit1607_8c_source.html#l00066">unit1607.c:66</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="structtest_html"><div class="ttname"><a href="structtest.html">test</a></div><div class="ttdef"><b>Definition:</b> <a href="unit1396_8c_source.html#l00041">unit1396.c:41</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_ab9dd091c0eee6a4e12a44298c338038f"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#ab9dd091c0eee6a4e12a44298c338038f">EEXISTS</a></div><div class="ttdeci">#define EEXISTS</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00058">tftp.h:58</a></div></div>
<div class="ttc" id="server__setup_8h_html"><div class="ttname"><a href="server__setup_8h.html">server_setup.h</a></div></div>
<div class="ttc" id="tftpd_8c_html_a0c76423f6cd7f7423dc4063564553496"><div class="ttname"><a href="tftpd_8c.html#a0c76423f6cd7f7423dc4063564553496">opcode_RRQ</a></div><div class="ttdeci">#define opcode_RRQ</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00144">tftpd.c:144</a></div></div>
<div class="ttc" id="tftpd_8c_html_a16b710f592bf8f7900666392adc444dc"><div class="ttname"><a href="tftpd_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a></div><div class="ttdeci">#define DEFAULT_PORT</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00161">tftpd.c:161</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_acc3e9b1176bd8c62c4fe0e017007e719"><div class="ttname"><a href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a></div><div class="ttdeci">#define ISDIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00065">curl_ctype.h:65</a></div></div>
<div class="ttc" id="structformats_html_a2d87e02f0c9d6447e8e3872d5affb4cd"><div class="ttname"><a href="structformats.html#a2d87e02f0c9d6447e8e3872d5affb4cd">formats::f_convert</a></div><div class="ttdeci">int f_convert</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00118">tftpd.c:118</a></div></div>
<div class="ttc" id="structerrmsg_html_ab12ef1bffd26250da5feabb3d384aff0"><div class="ttname"><a href="structerrmsg.html#ab12ef1bffd26250da5feabb3d384aff0">errmsg::e_code</a></div><div class="ttdeci">int e_code</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00122">tftpd.c:122</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a5bc1a3f8c40f644488914bfd7707afb8"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">srvr_sockaddr_union_t::sa4</a></div><div class="ttdeci">struct sockaddr_in sa4</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00032">server_sockaddr.h:32</a></div></div>
<div class="ttc" id="util_8c_html_aad214ae87462a3193220c3165758f91d"><div class="ttname"><a href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a></div><div class="ttdeci">char * test2file(long testno)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00196">util.c:196</a></div></div>
<div class="ttc" id="tftpd_8c_html_ac50973a1441c64f8d9e484d776f323c6"><div class="ttname"><a href="tftpd_8c.html#ac50973a1441c64f8d9e484d776f323c6">PKTSIZE</a></div><div class="ttdeci">#define PKTSIZE</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00102">tftpd.c:102</a></div></div>
<div class="ttc" id="tftpd_8c_html_a74e75242132eaabbc1c512488a135926"><div class="ttname"><a href="tftpd_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a></div><div class="ttdeci">#define MIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00153">tftpd.c:153</a></div></div>
<div class="ttc" id="curl__printf_8h_html_aab6e63106cf29e5160e5c2d63db86d27"><div class="ttname"><a href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a></div><div class="ttdeci">#define fprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00041">curl_printf.h:41</a></div></div>
<div class="ttc" id="uniontftphdr__storage__t_html_aa770cce013a5fb0fce46f8dee9311c67"><div class="ttname"><a href="uniontftphdr__storage__t.html#aa770cce013a5fb0fce46f8dee9311c67">tftphdr_storage_t::hdr</a></div><div class="ttdeci">struct tftphdr hdr</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00127">tftpd.c:127</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_a69d5b2daf8dd402fc8b43abb4ffbd44e"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">impacket.nmb.INADDR_ANY</a></div><div class="ttdeci">string INADDR_ANY</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00048">nmb.py:48</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="getpart_8c_html_ad3165ecba75413cf3d2eedef212975a1"><div class="ttname"><a href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a></div><div class="ttdeci">int getpart(char **outbuf, size_t *outlen, const char *main, const char *sub, FILE *stream)</div><div class="ttdef"><b>Definition:</b> <a href="getpart_8c_source.html#l00278">getpart.c:278</a></div></div>
<div class="ttc" id="tftpd_8c_html_a4d68235dfa433dea9c42f14784f80f6a"><div class="ttname"><a href="tftpd_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a></div><div class="ttdeci">#define DEFAULT_LOGFILE</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00156">tftpd.c:156</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="structtestcase_html_a49f93e46fe26ac2c17154a14be68359a"><div class="ttname"><a href="structtestcase.html#a49f93e46fe26ac2c17154a14be68359a">testcase::testno</a></div><div class="ttdeci">long testno</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00110">tftpd.c:110</a></div></div>
<div class="ttc" id="structtftphdr_html_ae97fecf6ac1d8d82dfafacc68d374a2b"><div class="ttname"><a href="structtftphdr.html#ae97fecf6ac1d8d82dfafacc68d374a2b">tftphdr::th_block</a></div><div class="ttdeci">unsigned short th_block</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00044">tftp.h:44</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_af89f74b4f46628d93e3cc829fcd69801"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_SOCKLEN_T curl_socklen_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00436">system.h:436</a></div></div>
<div class="ttc" id="components_2curl_2tests_2server_2_t_f_t_p_8h_html_a7136776690bd6d68702f2056084030d9"><div class="ttname"><a href="components_2curl_2tests_2server_2_t_f_t_p_8h.html#a7136776690bd6d68702f2056084030d9">EBADID</a></div><div class="ttdeci">#define EBADID</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2tests_2server_2_t_f_t_p_8h_source.html#l00057">tftp.h:57</a></div></div>
<div class="ttc" id="util_8c_html_a88279b927418889863e8247e98cb5d17"><div class="ttname"><a href="util_8c.html#a88279b927418889863e8247e98cb5d17">set_advisor_read_lock</a></div><div class="ttdeci">void set_advisor_read_lock(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00277">util.c:277</a></div></div>
<div class="ttc" id="uniontftphdr__storage__t_html"><div class="ttname"><a href="uniontftphdr__storage__t.html">tftphdr_storage_t</a></div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00126">tftpd.c:126</a></div></div>
<div class="ttc" id="uniontftphdr__storage__t_html_a1631ae9d15d118a7eb8f34999978ae9d"><div class="ttname"><a href="uniontftphdr__storage__t.html#a1631ae9d15d118a7eb8f34999978ae9d">tftphdr_storage_t::storage</a></div><div class="ttdeci">char storage[PKTSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00128">tftpd.c:128</a></div></div>
<div class="ttc" id="util_8c_html_a3b02c6de5c049804444a246f7fdf46b4"><div class="ttname"><a href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a></div><div class="ttdeci">const char * path</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00194">util.c:194</a></div></div>
<div class="ttc" id="structformats_html_a5adf2b6cfb25d2d7dbffbc9229998f3e"><div class="ttname"><a href="structformats.html#a5adf2b6cfb25d2d7dbffbc9229998f3e">formats::f_mode</a></div><div class="ttdeci">const char * f_mode</div><div class="ttdef"><b>Definition:</b> <a href="tftpd_8c_source.html#l00117">tftpd.c:117</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_c8a2a421f641dc9212666197c7c3274f.html">tests</a></li><li class="navelem"><a class="el" href="dir_a56cf240bd760590f7435b1cc527e3dc.html">server</a></li><li class="navelem"><a class="el" href="tftpd_8c.html">tftpd.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
