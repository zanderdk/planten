<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/socks.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('socks_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">socks.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="socks_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#if !defined(CURL_DISABLE_PROXY)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="timeval_8h.html">timeval.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="socks_8h.html">socks.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">/* The last #include file should be: */</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * Helper read-from-socket functions. Does the same as Curl_read() but it</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * blocks until all bytes amount of buffersize will be read. No more, no less.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * This is STUPID BLOCKING behaviour which we frown upon, but right now this</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * is what we have...</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="socks_8h.html#a152d06ec15540b2bcc2cbaa0088fd42d">   51</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="comment">/* connection data */</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                       <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd,     <span class="comment">/* read from this socket */</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                       <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,                <span class="comment">/* store read data here */</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                       <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> buffersize,       <span class="comment">/* max amount to read */</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                       <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> *<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>)               <span class="comment">/* amount bytes read */</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> allread = 0;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  *<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = 0;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> timeleft = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span>(timeleft &lt; 0) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="comment">/* we already got the timeout */</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(sockfd, timeleft) &lt;= 0) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ~<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#a00c49d227c9a5f1b8f1df9e8c7204102">Curl_read_plain</a>(sockfd, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, buffersize, &amp;nread);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a> == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span>(buffersize == nread) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      allread += nread;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      *<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = allread;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span>(!nread) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ~<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    buffersize -= nread;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> += nread;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    allread += nread;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">* This function logs in to a SOCKS4 proxy and sends the specifics to the final</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">* destination server.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">* Reference :</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">*   https://www.openssh.com/txt/socks4.protocol</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">* Note :</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">*   Set protocol4a=true for  &quot;SOCKS 4A (Simple Extension to SOCKS 4 Protocol)&quot;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">*   Nonsupport &quot;Identification Protocol (RFC1413)&quot;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="socks_8h.html#a09723d5923bcd2dd1018541c3cc96939">  107</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="socks_8c.html#a3be50ccf1e4b3f649dd36ba7ed7cf572">Curl_SOCKS4</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *proxy_user,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                     <span class="keywordtype">int</span> remote_port,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                     <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                     <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;{</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> protocol4a =</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    (conn-&gt;<a class="code" href="structconnectdata.html#a44ea1ec223e43a877daac8a34167096a">socks_proxy</a>.<a class="code" href="structproxy__info.html#a1bc66a2c41e16eb2138fc7bc4f96021a">proxytype</a> == <a class="code" href="curl_8h.html#a8ebcd4e614f222aca6352ad5052634f8a57108a90bd6ce44c3d94fdfd53c775fd">CURLPROXY_SOCKS4A</a>) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#define SOCKS4REQLEN 262</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> socksreq[<a class="code" href="socks_8c.html#ab399c8db1cea4a7268f1d731a7090281">SOCKS4REQLEN</a>]; <span class="comment">/* room for SOCKS4 request incl. user</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">                                           id */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) &lt; 0) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">/* time-out, bail out, go home */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Connection time-out&quot;</span>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7a7b20d08be448324d83ed41df90adfb">httpproxy</a>)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS4%s: connecting to HTTP proxy %s port %d\n&quot;</span>,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          protocol4a ? <span class="stringliteral">&quot;a&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="structhostname.html">hostname</a>, remote_port);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS4 communication to %s:%d\n&quot;</span>, <a class="code" href="structhostname.html">hostname</a>, remote_port);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">   * Compose socks4 request</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   * Request format</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">   *     +----+----+----+----+----+----+----+----+----+----+....+----+</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">   *     | VN | CD | DSTPORT |      DSTIP        | USERID       |NULL|</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">   *     +----+----+----+----+----+----+----+----+----+----+....+----+</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">   * # of bytes:  1    1      2              4           variable       1</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  socksreq[0] = 4; <span class="comment">/* version (SOCKS4) */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  socksreq[1] = 1; <span class="comment">/* connect */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  socksreq[2] = (<span class="keywordtype">unsigned</span> char)((remote_port &gt;&gt; 8) &amp; 0xff); <span class="comment">/* PORT MSB */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  socksreq[3] = (<span class="keywordtype">unsigned</span> char)(remote_port &amp; 0xff);        <span class="comment">/* PORT LSB */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">/* DNS resolve only for SOCKS4, not SOCKS4a */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span>(!protocol4a) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *hp = NULL;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, <a class="code" href="structhostname.html">hostname</a>, remote_port, &amp;dns);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd">CURLE_COULDNT_RESOLVE_PROXY</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="comment">/* ignores the return code, but &#39;dns&#39; remains NULL on failure */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      (void)<a class="code" href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a>(conn, &amp;dns);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">     * We cannot use &#39;hostent&#39; as a struct that Curl_resolv() returns.  It</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">     * returns a Curl_addrinfo pointer that may not always look the same.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span>(dns)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      hp = dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span>(hp) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[64];</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a>(hp, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>));</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordflow">if</span>(hp-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a> == AF_INET) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keyword">struct </span>sockaddr_in *saddr_in;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        saddr_in = (<span class="keyword">struct </span>sockaddr_in *)(<span class="keywordtype">void</span> *)hp-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        socksreq[4] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in-&gt;sin_addr.s_addr)[0];</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        socksreq[5] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in-&gt;sin_addr.s_addr)[1];</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        socksreq[6] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in-&gt;sin_addr.s_addr)[2];</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        socksreq[7] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in-&gt;sin_addr.s_addr)[3];</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS4 connect to IPv4 %s (locally resolved)\n&quot;</span>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        hp = NULL; <span class="comment">/* fail! */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS4 connection to %s not supported\n&quot;</span>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<a class="code" href="structdata.html">data</a>, dns); <span class="comment">/* not used anymore from now on */</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span>(!hp) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to resolve \&quot;%s\&quot; for SOCKS4 connect.&quot;</span>,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <a class="code" href="structhostname.html">hostname</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ad09d0102a75633a97e1f58be1abaf630">CURLE_COULDNT_RESOLVE_HOST</a>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">   * This is currently not supporting &quot;Identification Protocol (RFC1413)&quot;.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  socksreq[8] = 0; <span class="comment">/* ensure empty userid is NUL-terminated */</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span>(proxy_user) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">size_t</span> plen = strlen(proxy_user);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span>(plen &gt;= <span class="keyword">sizeof</span>(socksreq) - 8) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Too long SOCKS proxy name, can&#39;t use!\n&quot;</span>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">/* copy the proxy name WITH trailing zero */</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(socksreq + 8, proxy_user, plen + 1);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">   * Make connection</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> actualread;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> hostnamelen = 0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> packetsize = 9 +</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      strlen((<span class="keywordtype">char</span> *)socksreq + 8); <span class="comment">/* size including NUL */</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">/* If SOCKS4a, set special invalid IP address 0.0.0.x */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span>(protocol4a) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      socksreq[4] = 0;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      socksreq[5] = 0;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      socksreq[6] = 0;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      socksreq[7] = 1;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">/* If still enough room in buffer, also append hostname */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      hostnamelen = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)strlen(<a class="code" href="structhostname.html">hostname</a>) + 1; <span class="comment">/* length including NUL */</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">if</span>(packetsize + hostnamelen &lt;= <a class="code" href="socks_8c.html#ab399c8db1cea4a7268f1d731a7090281">SOCKS4REQLEN</a>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        strcpy((<span class="keywordtype">char</span> *)socksreq + packetsize, <a class="code" href="structhostname.html">hostname</a>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        hostnamelen = 0; <span class="comment">/* Flag: hostname did not fit in buffer */</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">/* Send request */</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                            packetsize + hostnamelen,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                            &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> || (<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> != packetsize + hostnamelen)) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to send SOCKS4 connect request.&quot;</span>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span>(protocol4a &amp;&amp; hostnamelen == 0) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">/* SOCKS4a with very long hostname - send that name separately */</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      hostnamelen = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)strlen(<a class="code" href="structhostname.html">hostname</a>) + 1;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, sock, (<span class="keywordtype">char</span> *)<a class="code" href="structhostname.html">hostname</a>, hostnamelen,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                              &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> || (<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> != hostnamelen)) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to send SOCKS4 connect request.&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    packetsize = 8; <span class="comment">/* receive data size */</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">/* Receive response */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, packetsize,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                &amp;actualread);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (actualread != packetsize)) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to receive SOCKS4 connect request ack.&quot;</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     * Response format</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">     *     +----+----+----+----+----+----+----+----+</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">     *     | VN | CD | DSTPORT |      DSTIP        |</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">     *     +----+----+----+----+----+----+----+----+</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">     * # of bytes:  1    1      2              4</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">     * VN is the version of the reply code and should be 0. CD is the result</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">     * code with one of the following values:</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * 90: request granted</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     * 91: request rejected or failed</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">     * 92: request rejected because SOCKS server cannot connect to</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">     *     identd on the client</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">     * 93: request rejected because the client program and identd</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">     *     report different user-ids</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">/* wrong version ? */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span>(socksreq[0] != 0) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="stringliteral">&quot;SOCKS4 reply has wrong version, version should be 4.&quot;</span>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">/* Result */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">switch</span>(socksreq[1]) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">case</span> 90:</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS4%s request granted.\n&quot;</span>, protocol4a?<span class="stringliteral">&quot;a&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">case</span> 91:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS4 connection to %d.%d.%d.%d:%d. (%d)&quot;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="stringliteral">&quot;, request rejected or failed.&quot;</span>,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[2] &lt;&lt; 8) | (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[3]),</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">case</span> 92:</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS4 connection to %d.%d.%d.%d:%d. (%d)&quot;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="stringliteral">&quot;, request rejected because SOCKS server cannot connect to &quot;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="stringliteral">&quot;identd on the client.&quot;</span>,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[2] &lt;&lt; 8) | (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[3]),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">case</span> 93:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS4 connection to %d.%d.%d.%d:%d. (%d)&quot;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="stringliteral">&quot;, request rejected because the client program and identd &quot;</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="stringliteral">&quot;report different user-ids.&quot;</span>,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[2] &lt;&lt; 8) | (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[3]),</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS4 connection to %d.%d.%d.%d:%d. (%d)&quot;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="stringliteral">&quot;, Unknown.&quot;</span>,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[2] &lt;&lt; 8) | (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[3]),</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>; <span class="comment">/* Proxy was successful! */</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> * This function logs in to a SOCKS5 proxy and sends the specifics to the final</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"> * destination server.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="socks_8h.html#aa058cf0f6be44720f25ba46067820640">  352</a></span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="socks_8c.html#af99ed172552352b248657b6fe870f513">Curl_SOCKS5</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *proxy_user,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *proxy_password,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                     <span class="keywordtype">int</span> remote_port,</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                     <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                     <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;{</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">    According to the RFC1928, section &quot;6.  Replies&quot;. This is what a SOCK5</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">    replies:</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">        +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">        |VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">        +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">        | 1  |  1  | X&#39;00&#39; |  1   | Variable |    2     |</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">        +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">    Where:</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    o  VER    protocol version: X&#39;05&#39;</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">    o  REP    Reply field:</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">    o  X&#39;00&#39; succeeded</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> socksreq[600]; <span class="comment">/* room for large user/pw (255 max each) */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> actualread;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <a class="code" href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">bool</span> socks5_resolve_local =</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    (conn-&gt;<a class="code" href="structconnectdata.html#a44ea1ec223e43a877daac8a34167096a">socks_proxy</a>.<a class="code" href="structproxy__info.html#a1bc66a2c41e16eb2138fc7bc4f96021a">proxytype</a> == <a class="code" href="curl_8h.html#a8ebcd4e614f222aca6352ad5052634f8a0221f060e5533f00d79538b80dc7b386">CURLPROXY_SOCKS5</a>) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> hostname_len = strlen(<a class="code" href="structhostname.html">hostname</a>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structauth.html">auth</a> = <a class="code" href="structdata.html">data</a>-&gt;set.socks5auth;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">bool</span> allow_gssapi = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a7a7b20d08be448324d83ed41df90adfb">httpproxy</a>)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5: connecting to HTTP proxy %s port %d\n&quot;</span>,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          <a class="code" href="structhostname.html">hostname</a>, remote_port);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">/* RFC1928 chapter 5 specifies max 255 chars for domain name in packet */</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span>(!socks5_resolve_local &amp;&amp; hostname_len &gt; 255) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5: server resolving disabled for hostnames of &quot;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="stringliteral">&quot;length &gt; 255 [actual len=%zu]\n&quot;</span>, hostname_len);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    socks5_resolve_local = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">/* get timeout */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> &lt; 0) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">/* time-out, bail out, go home */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Connection time-out&quot;</span>);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">/* wait until socket gets connected */</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="select_8h.html#a37ba9e16d56d14378d82ef5318e4bbd8">SOCKET_WRITABLE</a>(sock, <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span>(-1 == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5: no connection here&quot;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span>(0 == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5: connection timeout&quot;</span>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp; <a class="code" href="multi_8h.html#ac2f6404b4a34b0b43b61315b3c214912">CURL_CSELECT_ERR</a>) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5: error occurred during connection&quot;</span>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structauth.html">auth</a> &amp; ~(<a class="code" href="curl_8h.html#a71a1fde704d583a1f5dc57f77f1e957b">CURLAUTH_BASIC</a> | <a class="code" href="curl_8h.html#a6e1c7ccb4abbac621636c8583e5041cb">CURLAUTH_GSSAPI</a>))</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="stringliteral">&quot;warning: unsupported value passed to CURLOPT_SOCKS5_AUTH: %lu\n&quot;</span>,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="structauth.html">auth</a>);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span>(!(<a class="code" href="structauth.html">auth</a> &amp; <a class="code" href="curl_8h.html#a71a1fde704d583a1f5dc57f77f1e957b">CURLAUTH_BASIC</a>))</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">/* disable username/password auth */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    proxy_user = NULL;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structauth.html">auth</a> &amp; <a class="code" href="curl_8h.html#a6e1c7ccb4abbac621636c8583e5041cb">CURLAUTH_GSSAPI</a>)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    allow_gssapi = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  idx = 0;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  socksreq[idx++] = 5;   <span class="comment">/* version */</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  idx++;                 <span class="comment">/* reserve for the number of authentication methods */</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  socksreq[idx++] = 0;   <span class="comment">/* no authentication */</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span>(allow_gssapi)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    socksreq[idx++] = 1; <span class="comment">/* GSS-API */</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span>(proxy_user)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    socksreq[idx++] = 2; <span class="comment">/* username/password */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="comment">/* write the number of authentication methods */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  socksreq[1] = (<span class="keywordtype">unsigned</span> char) (idx - 2);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 communication to %s:%d\n&quot;</span>, <a class="code" href="structhostname.html">hostname</a>, remote_port);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, (2 + (<span class="keywordtype">int</span>)socksreq[1]),</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                          &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> || (<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> != (2 + (<span class="keywordtype">int</span>)socksreq[1]))) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unable to send initial SOCKS5 request.&quot;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(sock, <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">if</span>(-1 == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5 nothing to read&quot;</span>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">if</span>(0 == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5 read timeout&quot;</span>);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp; <a class="code" href="multi_8h.html#ac2f6404b4a34b0b43b61315b3c214912">CURL_CSELECT_ERR</a>) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SOCKS5 read error occurred&quot;</span>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, 2, &amp;actualread);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (actualread != 2)) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unable to receive initial SOCKS5 response.&quot;</span>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span>(socksreq[0] != 5) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Received invalid version in initial SOCKS5 response.&quot;</span>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span>(socksreq[1] == 0) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">/* Nothing to do, no authentication needed */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    ;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(allow_gssapi &amp;&amp; (socksreq[1] == 1)) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = Curl_SOCKS5_gssapi_negotiate(sockindex, conn);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unable to negotiate SOCKS5 GSS-API context.&quot;</span>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(socksreq[1] == 2) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">/* Needs user name and password */</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">size_t</span> proxy_user_len, proxy_password_len;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span>(proxy_user &amp;&amp; proxy_password) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      proxy_user_len = strlen(proxy_user);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      proxy_password_len = strlen(proxy_password);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      proxy_user_len = 0;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      proxy_password_len = 0;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">/*   username/password request looks like</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">     * +----+------+----------+------+----------+</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">     * |VER | ULEN |  UNAME   | PLEN |  PASSWD  |</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">     * +----+------+----------+------+----------+</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">     * | 1  |  1   | 1 to 255 |  1   | 1 to 255 |</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">     * +----+------+----------+------+----------+</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 1;    <span class="comment">/* username/pw subnegotiation version */</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = (<span class="keywordtype">unsigned</span> char) proxy_user_len;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span>(proxy_user &amp;&amp; proxy_user_len)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(socksreq + <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, proxy_user, proxy_user_len);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> += proxy_user_len;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = (<span class="keywordtype">unsigned</span> char) proxy_password_len;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span>(proxy_password &amp;&amp; proxy_password_len)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(socksreq + <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, proxy_password, proxy_password_len);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> += proxy_password_len;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> || (<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> != <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>)) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to send SOCKS5 sub-negotiation request.&quot;</span>);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, 2, &amp;actualread);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (actualread != 2)) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unable to receive SOCKS5 sub-negotiation response.&quot;</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">/* ignore the first (VER) byte */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span>(socksreq[1] != 0) { <span class="comment">/* status */</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;User was rejected by the SOCKS5 server (%d %d).&quot;</span>,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            socksreq[0], socksreq[1]);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">/* Everything is good so far, user was authenticated! */</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">/* error */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span>(!allow_gssapi &amp;&amp; (socksreq[1] == 1)) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="stringliteral">&quot;SOCKS5 GSSAPI per-message authentication is not supported.&quot;</span>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    }</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span>(socksreq[1] == 255) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">if</span>(!proxy_user || !*proxy_user) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;              <span class="stringliteral">&quot;No authentication method was acceptable. (It is quite likely&quot;</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;              <span class="stringliteral">&quot; that the SOCKS5 server wanted a username/password, since none&quot;</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;              <span class="stringliteral">&quot; was supplied to the server on this connection.)&quot;</span>);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;No authentication method was acceptable.&quot;</span>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      }</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="stringliteral">&quot;Undocumented SOCKS5 mode attempted to be used by server.&quot;</span>);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">/* Authentication is complete, now specify destination to the proxy */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 5; <span class="comment">/* version (SOCKS5) */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 1; <span class="comment">/* connect */</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 0; <span class="comment">/* must be zero */</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordflow">if</span>(!socks5_resolve_local) {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 3; <span class="comment">/* ATYP: domain name = 3 */</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = (char) hostname_len; <span class="comment">/* address length */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>], <a class="code" href="structhostname.html">hostname</a>, hostname_len); <span class="comment">/* address str w/o NULL */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> += hostname_len;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_curl__dns__entry.html">Curl_dns_entry</a> *dns;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="struct_curl__addrinfo.html">Curl_addrinfo</a> *hp = NULL;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a>(conn, <a class="code" href="structhostname.html">hostname</a>, remote_port, &amp;dns);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a>)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ad09d0102a75633a97e1f58be1abaf630">CURLE_COULDNT_RESOLVE_HOST</a>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == <a class="code" href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a>) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">/* this requires that we&#39;re in &quot;wait for resolve&quot; state */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a>(conn, &amp;dns);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">     * We cannot use &#39;hostent&#39; as a struct that Curl_resolv() returns.  It</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">     * returns a Curl_addrinfo pointer that may not always look the same.</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span>(dns)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      hp = dns-&gt;<a class="code" href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">addr</a>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span>(hp) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[64];</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <a class="code" href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a>(hp, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>));</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">if</span>(hp-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a> == AF_INET) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keyword">struct </span>sockaddr_in *saddr_in;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 1; <span class="comment">/* ATYP: IPv4 = 1 */</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        saddr_in = (<span class="keyword">struct </span>sockaddr_in *)(<span class="keywordtype">void</span> *)hp-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 4; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in-&gt;sin_addr.s_addr)[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 connect to IPv4 %s (locally resolved)\n&quot;</span>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(hp-&gt;<a class="code" href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">ai_family</a> == AF_INET6) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keyword">struct </span>sockaddr_in6 *saddr_in6;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = 4; <span class="comment">/* ATYP: IPv6 = 4 */</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        saddr_in6 = (<span class="keyword">struct </span>sockaddr_in6 *)(<span class="keywordtype">void</span> *)hp-&gt;<a class="code" href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">ai_addr</a>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 16; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] =</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;saddr_in6-&gt;sin6_addr.s6_addr)[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 connect to IPv6 %s (locally resolved)\n&quot;</span>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        hp = NULL; <span class="comment">/* fail! */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 connection to %s not supported\n&quot;</span>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <a class="code" href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a>(<a class="code" href="structdata.html">data</a>, dns); <span class="comment">/* not used anymore from now on */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span>(!hp) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to resolve \&quot;%s\&quot; for SOCKS5 connect.&quot;</span>,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <a class="code" href="structhostname.html">hostname</a>);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ad09d0102a75633a97e1f58be1abaf630">CURLE_COULDNT_RESOLVE_HOST</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = (<span class="keywordtype">unsigned</span> char)((remote_port &gt;&gt; 8) &amp; 0xff); <span class="comment">/* PORT MSB */</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>++] = (<span class="keywordtype">unsigned</span> char)(remote_port &amp; 0xff);        <span class="comment">/* PORT LSB */</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;socks5_gssapi_enctype) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 GSS-API protection not yet implemented.&quot;</span>);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> || (<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> != <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>)) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to send SOCKS5 connect request.&quot;</span>);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 10; <span class="comment">/* minimum packet size is 10 */</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;socks5_gssapi_enctype) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 GSS-API protection not yet implemented.&quot;</span>);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(conn, sock, (<span class="keywordtype">char</span> *)socksreq,</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;actualread);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> != actualread)) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to receive SOCKS5 connect request ack.&quot;</span>);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">if</span>(socksreq[0] != 5) { <span class="comment">/* version */</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          <span class="stringliteral">&quot;SOCKS5 reply has wrong version, version should be 5.&quot;</span>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="comment">/* Fix: in general, returned BND.ADDR is variable length parameter by RFC</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">     1928, so the reply packet should be read until the end to avoid errors at</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">     subsequent protocol level.</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">    +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">    |VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">    +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">    | 1  |  1  | X&#39;00&#39; |  1   | Variable |    2     |</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">    +----+-----+-------+------+----------+----------+</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">     ATYP:</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">     o  IP v4 address: X&#39;01&#39;, BND.ADDR = 4 byte</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">     o  domain name:  X&#39;03&#39;, BND.ADDR = [ 1 byte length, string ]</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">     o  IP v6 address: X&#39;04&#39;, BND.ADDR = 16 byte</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">/* Calculate real packet size */</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordflow">if</span>(socksreq[3] == 3) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="comment">/* domain name */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordtype">int</span> addrlen = (int) socksreq[4];</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 5 + addrlen + 2;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(socksreq[3] == 4) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">/* IPv6 */</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 4 + 16 + 2;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">/* At this point we already read first 10 bytes */</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;socks5_gssapi_enctype) {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">/* decrypt_gssapi_blockread already read the whole packet */</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 10) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a>(conn, sock, (<span class="keywordtype">char</span> *)&amp;socksreq[10],</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 10, &amp;actualread);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || ((<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 10) != actualread)) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to receive SOCKS5 connect request ack.&quot;</span>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor">#if defined(HAVE_GSSAPI) || defined(USE_WINDOWS_SSPI)</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">if</span>(socksreq[1] != 0) { <span class="comment">/* Anything besides 0 is an error */</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span>(socksreq[3] == 1) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS5 connection to %d.%d.%d.%d:%d. (%d)&quot;</span>,</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[8] &lt;&lt; 8) |</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[9]),</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(socksreq[3] == 3) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> port_upper = (<span class="keywordtype">unsigned</span> char)socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 2];</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 2] = 0;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS5 connection to %s:%d. (%d)&quot;</span>,</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            (<span class="keywordtype">char</span> *)&amp;socksreq[5],</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            ((port_upper &lt;&lt; 8) |</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 1]),</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      socksreq[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> - 2] = port_upper;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(socksreq[3] == 4) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="stringliteral">&quot;Can&#39;t complete SOCKS5 connection to %02x%02x:%02x%02x:&quot;</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="stringliteral">&quot;%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%d. (%d)&quot;</span>,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[4], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[5],</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[6], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[7],</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[8], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[9],</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[10], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[11],</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[12], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[13],</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[14], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[15],</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[16], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[17],</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[18], (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[19],</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[20] &lt;&lt; 8) |</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[21]),</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)socksreq[1]);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SOCKS5 request granted.\n&quot;</span>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  (void)<a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>; <span class="comment">/* Proxy was successful! */</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;}</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_DISABLE_PROXY */</span><span class="preprocessor"></span></div><div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00498">curl.h:498</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ad09d0102a75633a97e1f58be1abaf630"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ad09d0102a75633a97e1f58be1abaf630">CURLE_COULDNT_RESOLVE_HOST</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00465">curl.h:465</a></div></div>
<div class="ttc" id="url_8d_html_a1bc9666de113dffcfaf5d5c84eac6469"><div class="ttname"><a href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a></div><div class="ttdeci">Long POP3 or SMTP then that protocol will be otherwise HTTP will be used.Since..guessing can be disabled by setting a default see proto default for details.This option may be used any number of times.To control where this URL is written</div><div class="ttdef"><b>Definition:</b> <a href="url_8d_source.html#l00010">url.d:10</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a7a7b20d08be448324d83ed41df90adfb"><div class="ttname"><a href="struct_connect_bits.html#a7a7b20d08be448324d83ed41df90adfb">ConnectBits::httpproxy</a></div><div class="ttdeci">bool httpproxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00388">urldata.h:388</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00527">curl.h:527</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="curl_8h_html_a71a1fde704d583a1f5dc57f77f1e957b"><div class="ttname"><a href="curl_8h.html#a71a1fde704d583a1f5dc57f77f1e957b">CURLAUTH_BASIC</a></div><div class="ttdeci">#define CURLAUTH_BASIC</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00706">curl.h:706</a></div></div>
<div class="ttc" id="socks_8c_html_af99ed172552352b248657b6fe870f513"><div class="ttname"><a href="socks_8c.html#af99ed172552352b248657b6fe870f513">Curl_SOCKS5</a></div><div class="ttdeci">CURLcode Curl_SOCKS5(const char *proxy_user, const char *proxy_password, const char *hostname, int remote_port, int sockindex, struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="socks_8c_source.html#l00352">socks.c:352</a></div></div>
<div class="ttc" id="sendf_8c_html_a22e207bc5193c73143f3445e788204c2"><div class="ttname"><a href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a></div><div class="ttdeci">CURLcode Curl_write_plain(struct connectdata *conn, curl_socket_t sockfd, const void *mem, size_t len, ssize_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00428">sendf.c:428</a></div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="unit1608_8c_html_afb9ed1b8a27eb20854efe6e23e297683"><div class="ttname"><a href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a></div><div class="ttdeci">CURLcode code</div><div class="ttdef"><b>Definition:</b> <a href="unit1608_8c_source.html#l00047">unit1608.c:47</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="hostip_8h_html_ac32022a9b31aaa164578cb4d487cfc7d"><div class="ttname"><a href="hostip_8h.html#ac32022a9b31aaa164578cb4d487cfc7d">CURLRESOLV_PENDING</a></div><div class="ttdeci">#define CURLRESOLV_PENDING</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00085">hostip.h:85</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00564">curl.h:564</a></div></div>
<div class="ttc" id="curl_8h_html_a6e1c7ccb4abbac621636c8583e5041cb"><div class="ttname"><a href="curl_8h.html#a6e1c7ccb4abbac621636c8583e5041cb">CURLAUTH_GSSAPI</a></div><div class="ttdeci">#define CURLAUTH_GSSAPI</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00712">curl.h:712</a></div></div>
<div class="ttc" id="structhostname_html"><div class="ttname"><a href="structhostname.html">hostname</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00446">urldata.h:446</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="socks_8c_html_ab399c8db1cea4a7268f1d731a7090281"><div class="ttname"><a href="socks_8c.html#ab399c8db1cea4a7268f1d731a7090281">SOCKS4REQLEN</a></div><div class="ttdeci">#define SOCKS4REQLEN</div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="socks_8c_html_a3be50ccf1e4b3f649dd36ba7ed7cf572"><div class="ttname"><a href="socks_8c.html#a3be50ccf1e4b3f649dd36ba7ed7cf572">Curl_SOCKS4</a></div><div class="ttdeci">CURLcode Curl_SOCKS4(const char *proxy_user, const char *hostname, int remote_port, int sockindex, struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="socks_8c_source.html#l00107">socks.c:107</a></div></div>
<div class="ttc" id="curl_8h_html_a8ebcd4e614f222aca6352ad5052634f8a0221f060e5533f00d79538b80dc7b386"><div class="ttname"><a href="curl_8h.html#a8ebcd4e614f222aca6352ad5052634f8a0221f060e5533f00d79538b80dc7b386">CURLPROXY_SOCKS5</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00680">curl.h:680</a></div></div>
<div class="ttc" id="nonblock_8c_html_a0b0747a29eed9acae52471c25a66e042"><div class="ttname"><a href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a></div><div class="ttdeci">int curlx_nonblock(curl_socket_t sockfd, int nonblock)</div><div class="ttdef"><b>Definition:</b> <a href="nonblock_8c_source.html#l00047">nonblock.c:47</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9492950b668aee96f09e54a328d762fd">CURLE_COULDNT_RESOLVE_PROXY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00464">curl.h:464</a></div></div>
<div class="ttc" id="sendf_8c_html_a00c49d227c9a5f1b8f1df9e8c7204102"><div class="ttname"><a href="sendf_8c.html#a00c49d227c9a5f1b8f1df9e8c7204102">Curl_read_plain</a></div><div class="ttdeci">CURLcode Curl_read_plain(curl_socket_t sockfd, char *buf, size_t bytesfromsocket, ssize_t *n)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00682">sendf.c:682</a></div></div>
<div class="ttc" id="timeval_8h_html"><div class="ttname"><a href="timeval_8h.html">timeval.h</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="structauth_html"><div class="ttname"><a href="structauth.html">auth</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01172">urldata.h:1172</a></div></div>
<div class="ttc" id="multi_8h_html_ac2f6404b4a34b0b43b61315b3c214912"><div class="ttname"><a href="multi_8h.html#ac2f6404b4a34b0b43b61315b3c214912">CURL_CSELECT_ERR</a></div><div class="ttdeci">#define CURL_CSELECT_ERR</div><div class="ttdef"><b>Definition:</b> <a href="multi_8h_source.html#l00268">multi.h:268</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html_a606b5303ecd260663dbf9b1f9f7f98dd"><div class="ttname"><a href="struct_curl__dns__entry.html#a606b5303ecd260663dbf9b1f9f7f98dd">Curl_dns_entry::addr</a></div><div class="ttdeci">Curl_addrinfo * addr</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00067">hostip.h:67</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_ab72a36e22c2c7cb539df0351f59359ca"><div class="ttname"><a href="struct_curl__addrinfo.html#ab72a36e22c2c7cb539df0351f59359ca">Curl_addrinfo::ai_addr</a></div><div class="ttdeci">struct sockaddr * ai_addr</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00058">curl_addrinfo.h:58</a></div></div>
<div class="ttc" id="struct_curl__dns__entry_html"><div class="ttname"><a href="struct_curl__dns__entry.html">Curl_dns_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00066">hostip.h:66</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="connect_8c_html_aed32c0fb99c80a40c097c98a3eb03c74"><div class="ttname"><a href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a></div><div class="ttdeci">timediff_t Curl_timeleft(struct Curl_easy *data, struct curltime *nowp, bool duringconnect)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l00184">connect.c:184</a></div></div>
<div class="ttc" id="select_8h_html_a7e89e8a851eb27402914a0d5beb58d99"><div class="ttname"><a href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a></div><div class="ttdeci">#define SOCKET_READABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00079">select.h:79</a></div></div>
<div class="ttc" id="hostip_8h_html_a983c878e70ef48673b790b47d2668b1d"><div class="ttname"><a href="hostip_8h.html#a983c878e70ef48673b790b47d2668b1d">CURLRESOLV_ERROR</a></div><div class="ttdeci">#define CURLRESOLV_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8h_source.html#l00083">hostip.h:83</a></div></div>
<div class="ttc" id="hostip_8c_html_a9682d744b66312d5f6ceaa8a6a02aff7"><div class="ttname"><a href="hostip_8c.html#a9682d744b66312d5f6ceaa8a6a02aff7">Curl_printable_address</a></div><div class="ttdeci">const char * Curl_printable_address(const Curl_addrinfo *ai, char *buf, size_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00172">hostip.c:172</a></div></div>
<div class="ttc" id="select_8h_html_a37ba9e16d56d14378d82ef5318e4bbd8"><div class="ttname"><a href="select_8h.html#a37ba9e16d56d14378d82ef5318e4bbd8">SOCKET_WRITABLE</a></div><div class="ttdeci">#define SOCKET_WRITABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00081">select.h:81</a></div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html_abadfae881af6425a56ff823ef0bb1a70"><div class="ttname"><a href="struct_curl__addrinfo.html#abadfae881af6425a56ff823ef0bb1a70">Curl_addrinfo::ai_family</a></div><div class="ttdeci">int ai_family</div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00053">curl_addrinfo.h:53</a></div></div>
<div class="ttc" id="hostip_8c_html_ad81776a26da21671062cbf5ccd11be23"><div class="ttname"><a href="hostip_8c.html#ad81776a26da21671062cbf5ccd11be23">Curl_resolv</a></div><div class="ttdeci">int Curl_resolv(struct connectdata *conn, const char *hostname, int port, struct Curl_dns_entry **entry)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00521">hostip.c:521</a></div></div>
<div class="ttc" id="hostip_8c_html_a47fa53659ab4a0c796ea2fd58629674c"><div class="ttname"><a href="hostip_8c.html#a47fa53659ab4a0c796ea2fd58629674c">Curl_resolv_unlock</a></div><div class="ttdeci">void Curl_resolv_unlock(struct Curl_easy *data, struct Curl_dns_entry *dns)</div><div class="ttdef"><b>Definition:</b> <a href="hostip_8c_source.html#l00814">hostip.c:814</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="structconnectdata_html_a44ea1ec223e43a877daac8a34167096a"><div class="ttname"><a href="structconnectdata.html#a44ea1ec223e43a877daac8a34167096a">connectdata::socks_proxy</a></div><div class="ttdeci">struct proxy_info socks_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00836">urldata.h:836</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="socks_8c_html_a152d06ec15540b2bcc2cbaa0088fd42d"><div class="ttname"><a href="socks_8c.html#a152d06ec15540b2bcc2cbaa0088fd42d">Curl_blockread_all</a></div><div class="ttdeci">int Curl_blockread_all(struct connectdata *conn, curl_socket_t sockfd, char *buf, ssize_t buffersize, ssize_t *n)</div><div class="ttdef"><b>Definition:</b> <a href="socks_8c_source.html#l00051">socks.c:51</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00466">curl.h:466</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="curl_8h_html_a8ebcd4e614f222aca6352ad5052634f8a57108a90bd6ce44c3d94fdfd53c775fd"><div class="ttname"><a href="curl_8h.html#a8ebcd4e614f222aca6352ad5052634f8a57108a90bd6ce44c3d94fdfd53c775fd">CURLPROXY_SOCKS4A</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00681">curl.h:681</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="struct_curl__addrinfo_html"><div class="ttname"><a href="struct_curl__addrinfo.html">Curl_addrinfo</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__addrinfo_8h_source.html#l00051">curl_addrinfo.h:51</a></div></div>
<div class="ttc" id="asyn_8h_html_ad14e13eb0e765d0d2b825ae8d0ad7c00"><div class="ttname"><a href="asyn_8h.html#ad14e13eb0e765d0d2b825ae8d0ad7c00">Curl_resolver_wait_resolv</a></div><div class="ttdeci">CURLcode Curl_resolver_wait_resolv(struct connectdata *conn, struct Curl_dns_entry **dnsentry)</div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="structproxy__info_html_a1bc66a2c41e16eb2138fc7bc4f96021a"><div class="ttname"><a href="structproxy__info.html#a1bc66a2c41e16eb2138fc7bc4f96021a">proxy_info::proxytype</a></div><div class="ttdeci">curl_proxytype proxytype</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00754">urldata.h:754</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="socks_8h_html"><div class="ttname"><a href="socks_8h.html">socks.h</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="timeval_8h_html_aeb19832fd3e7f11c8d047d6824300e87"><div class="ttname"><a href="timeval_8h.html#aeb19832fd3e7f11c8d047d6824300e87">timediff_t</a></div><div class="ttdeci">int timediff_t</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00028">timeval.h:28</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="socks_8c.html">socks.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
