<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/Socket.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_socket_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Socket.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_socket_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Socket.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Mar 5, 2017</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;streambuf&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;cctype&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;lwip/sockets.h&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_s_s_l_utils_8h.html">SSLUtils.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_socket_8h.html">Socket.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;Socket&quot;</span>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#undef bind</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> my_debug(</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   <span class="keywordtype">void</span>* ctx,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;   <span class="keywordtype">int</span> level,</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>,</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>,</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;   ((void) level);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   ((void) ctx);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   <a class="code" href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;%s:%04d: %s&quot;</span>, <a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_socket.html#a7c3256c4fc6e2c603df73201049fae5a">   44</a></span>&#160;<a class="code" href="class_socket.html#a7c3256c4fc6e2c603df73201049fae5a">Socket::Socket</a>() {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    m_sock   = -1;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    m_useSSL = <span class="keyword">false</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="class_socket.html#aeac4eb6379a543d38ed88977d3b6630a">   49</a></span>&#160;<a class="code" href="class_socket.html#aeac4eb6379a543d38ed88977d3b6630a">Socket::~Socket</a>() {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">//close_cpp(); // When the class instance has ended, delete the socket.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_socket.html#a3f749d9a206e48a875e8c24f29500a93">   57</a></span>&#160;<a class="code" href="class_socket.html">Socket</a> <a class="code" href="class_socket.html#a3f749d9a206e48a875e8c24f29500a93">Socket::accept</a>() {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keyword">struct </span>sockaddr addr;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="class_socket.html#a6b59f7b6e3be56f4d4a27558bde48e85">getBind</a>(&amp;addr);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; accept: Accepting on %s; sockFd: %d, using SSL: %d&quot;</span>, <a class="code" href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">addressToString</a>(&amp;addr).c_str(), m_sock, <a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>());</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">struct </span>sockaddr_in client_addr;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    socklen_t sin_size;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> clientSockFD = ::lwip_accept_r(m_sock,  (<span class="keyword">struct</span> sockaddr*) &amp;client_addr, &amp;sin_size);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">//printf(&quot;------&gt; new connection client %s:%d\n&quot;, inet_ntoa(client_addr.sin_addr), ntohs(client_addr.sin_port));</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (clientSockFD == -1) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="class_socket_exception.html">SocketException</a> se(errno);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;accept(): %s, m_sock=%d&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno), m_sock);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">throw</span> se;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot; - accept: Received new client!: sockFd: %d&quot;</span>, clientSockFD);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="class_socket.html">Socket</a> newSocket;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    newSocket.m_sock = clientSockFD;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        newSocket.<a class="code" href="class_socket.html#a73d0af1a733ff70a622eac54a997f887">setSSL</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        newSocket.m_sslSock.fd = clientSockFD;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        newSocket.sslHandshake();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;DEBUG DEBUG &quot;</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        uint8_t <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>;   <span class="comment">// What is going on here???</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        newSocket.<a class="code" href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">receive</a>(&amp;<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>, 1, 0); <span class="comment">// FIX FIX FIX</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; accept: sockFd: %d&quot;</span>, clientSockFD);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> newSocket;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;} <span class="comment">// accept</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">   92</a></span>&#160;<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">Socket::addressToString</a>(<span class="keyword">struct</span> sockaddr* addr) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">struct </span>sockaddr_in* pInAddr = (<span class="keyword">struct </span>sockaddr_in*) addr;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a>[30];</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">char</span> ip[20];</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    inet_ntop(AF_INET, &amp;pInAddr-&gt;sin_addr, ip, <span class="keyword">sizeof</span>(ip));</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    sprintf(<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a>, <span class="stringliteral">&quot;%s [%d]&quot;</span>, ip, ntohs(pInAddr-&gt;sin_port));</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a>(<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;} <span class="comment">// addressToString</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="class_socket.html#adc1e8efb9384ac637d42e93008debb6a">  110</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#adc1e8efb9384ac637d42e93008debb6a">Socket::bind</a>(uint16_t port, uint32_t address) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; bind: port=%d, address=0x%x&quot;</span>, port, address);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (m_sock == -1) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;bind: Socket is not initialized.&quot;</span>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">struct </span>sockaddr_in serverAddress;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    serverAddress.sin_family      = AF_INET;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    serverAddress.sin_addr.s_addr = htonl(address);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    serverAddress.sin_port        = htons(port);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_bind_r(m_sock, (<span class="keyword">struct</span> sockaddr*) &amp;serverAddress, <span class="keyword">sizeof</span>(serverAddress));</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != 0) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; bind: bind[socket=%d]: %d: %s&quot;</span>, m_sock, errno, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; bind&quot;</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;} <span class="comment">// bind</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="class_socket.html#aef06605c6725958004116983f1a2051f">  135</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#aef06605c6725958004116983f1a2051f">Socket::close</a>() {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;close: m_sock=%d, ssl: %d&quot;</span>, m_sock, <a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>());</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = mbedtls_ssl_close_notify(&amp;m_sslContext);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_ssl_close_notify: %d&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = 0;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (m_sock != -1) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Calling lwip_close on %d&quot;</span>, m_sock);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_close_r(m_sock);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != 0) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;Error with lwip_close: %d&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    m_sock = -1;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;} <span class="comment">// close</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="class_socket.html#ae537e61bb9f64b0322c6e9c39bb24fde">  164</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#ae537e61bb9f64b0322c6e9c39bb24fde">Socket::connect</a>(<span class="keyword">struct</span> in_addr address, uint16_t port) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">struct </span>sockaddr_in serverAddress;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    serverAddress.sin_family = AF_INET;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    serverAddress.sin_addr   = address;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    serverAddress.sin_port   = htons(port);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">char</span> msg[50];</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    inet_ntop(AF_INET, &amp;address, msg, <span class="keyword">sizeof</span>(msg));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Connecting to %s:[%d]&quot;</span>, msg, port);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="class_socket.html#a788b0d2a4070a64fb38d2c6e6289f96e">createSocket</a>();</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_connect_r(m_sock, (<span class="keyword">struct</span> sockaddr*) &amp;serverAddress, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;connect_cpp: Error: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="class_socket.html#aef06605c6725958004116983f1a2051f">close</a>();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Connected to partner&quot;</span>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;} <span class="comment">// connect_cpp</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_socket.html#a426b128c26cee34ed153c1402cf4a5fc">  192</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#ae537e61bb9f64b0322c6e9c39bb24fde">Socket::connect</a>(<span class="keywordtype">char</span>* strAddress, uint16_t port) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">struct </span>in_addr address;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="connect__with__static__ip_8c.html#a4a705192be3844fa0fe58f6337391983">inet_pton</a>(AF_INET, strAddress, &amp;address);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_socket.html#ae537e61bb9f64b0322c6e9c39bb24fde">connect</a>(address, port);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="class_socket.html#a788b0d2a4070a64fb38d2c6e6289f96e">  204</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#a788b0d2a4070a64fb38d2c6e6289f96e">Socket::createSocket</a>(<span class="keywordtype">bool</span> isDatagram) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; createSocket: isDatagram: %d&quot;</span>, isDatagram);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> (isDatagram) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        m_sock = ::socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        m_sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (m_sock == -1) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; createSocket: socket: %d&quot;</span>, errno);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">return</span> m_sock;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; createSocket: sockFd: %d&quot;</span>, m_sock);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">return</span> m_sock;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;} <span class="comment">// createSocket</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="class_socket.html#a6b59f7b6e3be56f4d4a27558bde48e85">  225</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_socket.html#a6b59f7b6e3be56f4d4a27558bde48e85">Socket::getBind</a>(<span class="keyword">struct</span> sockaddr* pAddr) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (m_sock == -1) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;getBind: Socket is not initialized.&quot;</span>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    socklen_t nameLen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::getsockname(m_sock, pAddr, &amp;nameLen);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != 0) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;Error with getsockname in getBind: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;} <span class="comment">// getBind</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="class_socket.html#a2ba81037cc4a722e155c7bbbfef58b0d">  241</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#a2ba81037cc4a722e155c7bbbfef58b0d">Socket::getFD</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> m_sock;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;} <span class="comment">// getFD</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">  245</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">Socket::getSSL</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">return</span> m_useSSL;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="class_socket.html#a5ccaf81da2b6f25dded056e6dbf7f410">  249</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_socket.html#a5ccaf81da2b6f25dded056e6dbf7f410">Socket::isValid</a>() {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> m_sock != -1;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;} <span class="comment">// isValid</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="class_socket.html#a893bb9a6107d2139cfb088f0c82ac5ae">  259</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#a893bb9a6107d2139cfb088f0c82ac5ae">Socket::listen</a>(uint16_t port, <span class="keywordtype">bool</span> isDatagram, <span class="keywordtype">bool</span> reuseAddress) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; listen: port: %d, isDatagram: %d&quot;</span>, port, isDatagram);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="class_socket.html#a788b0d2a4070a64fb38d2c6e6289f96e">createSocket</a>(isDatagram);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="class_socket.html#ad435a8a36e2759203db8b4b2c67e4e85">setReuseAddress</a>(reuseAddress);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="class_socket.html#adc1e8efb9384ac637d42e93008debb6a">bind</a>(port, 0);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != 0) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; listen: Error in bind: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// For a datagram socket, we don&#39;t execute a listen call.  That is is only for connection oriented</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// sockets.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (!isDatagram) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_listen_r(m_sock, 5);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; listen: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; listen&quot;</span>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;} <span class="comment">// listen</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="class_socket.html#a9ceb18eb59288e2fc1eb31d631f9dee0">  282</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_socket.html#a9ceb18eb59288e2fc1eb31d631f9dee0">Socket::operator &lt;</a>(<span class="keyword">const</span> <a class="code" href="class_socket.html">Socket</a>&amp; other)<span class="keyword"> const </span>{</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> m_sock &lt; other.m_sock;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">  290</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">Socket::setSocketOption</a>(<span class="keywordtype">int</span> <a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a>, <span class="keywordtype">void</span>* <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordtype">int</span> res = ::setsockopt(m_sock, SOL_SOCKET, <a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;%X : %d&quot;</span>, <a class="code" href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a>, errno);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;} <span class="comment">// setSocketOption</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_socket.html#aef6249eaa9b2be5a386f85cb828c2b4a">  303</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#aef6249eaa9b2be5a386f85cb828c2b4a">Socket::setTimeout</a>(uint32_t seconds) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtimeval.html">timeval</a> tv;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    tv.<a class="code" href="structtimeval.html#a3599199839a89e99a2ce29d45312b5cf">tv_sec</a> = seconds;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    tv.<a class="code" href="structtimeval.html#aa8396731f2914f9ed2a457d3da602b80">tv_usec</a> = 0;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">setSocketOption</a>(SO_RCVTIMEO, (<span class="keywordtype">char</span>*) &amp;tv, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtimeval.html">timeval</a>)) &lt; 0) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">setSocketOption</a>(SO_SNDTIMEO, (<span class="keywordtype">char</span>*) &amp;tv, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtimeval.html">timeval</a>));</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="class_socket.html#a893006a5a02363d31017ad4f1275e23a">  314</a></span>&#160;<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_socket.html#a893006a5a02363d31017ad4f1275e23a">Socket::readToDelim</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> delim) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> ret;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="structpart.html">part</a>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">auto</span> <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = delim.begin();</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        uint8_t val;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">receive</a>(&amp;val, 1);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 0) <span class="keywordflow">return</span> ret + <a class="code" href="structpart.html">part</a>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (*<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> == val) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <a class="code" href="structpart.html">part</a>+= val;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            ++<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> == delim.end()) <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="structpart.html">part</a>.empty()) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                ret += <a class="code" href="structpart.html">part</a>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <a class="code" href="structpart.html">part</a>.clear();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = delim.begin();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            ret += val;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    } <span class="comment">// While</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;} <span class="comment">// readToDelim</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">  349</a></span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">Socket::receive</a>(uint8_t* <a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> length, <span class="keywordtype">bool</span> exact) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">//ESP_LOGD(LOG_TAG, &quot;&gt;&gt; receive: sockFd: %d, length: %d, exact: %d&quot;, m_sock, length, exact);</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (!exact) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = mbedtls_ssl_read(&amp;m_sslContext, <a class="code" href="structdata.html">data</a>, length);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;rc=%d, MBEDTLS_ERR_SSL_WANT_READ=%d&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>, MBEDTLS_ERR_SSL_WANT_READ);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            } <span class="keywordflow">while</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == MBEDTLS_ERR_SSL_WANT_WRITE || <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == MBEDTLS_ERR_SSL_WANT_READ);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_recv_r(m_sock, <a class="code" href="structdata.html">data</a>, length, 0);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;receive: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">//GeneralUtils::hexDump(data, rc);</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">//ESP_LOGD(LOG_TAG, &quot;&lt;&lt; receive: rc: %d&quot;, rc);</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">return</span> (<span class="keywordtype">size_t</span>) <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    } <span class="comment">// Read what we can, doesn&#39;t need to be an exact amount.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">size_t</span> amountToRead = length;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">while</span> (amountToRead &gt; 0) {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = mbedtls_ssl_read(&amp;m_sslContext, <a class="code" href="structdata.html">data</a>, amountToRead);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            } <span class="keywordflow">while</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == MBEDTLS_ERR_SSL_WANT_WRITE || <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == MBEDTLS_ERR_SSL_WANT_READ);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_recv_r(m_sock, <a class="code" href="structdata.html">data</a>, amountToRead, 0);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;receive: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        amountToRead -= <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="structdata.html">data</a> += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">//GeneralUtils::hexDump(data, length);</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">//ESP_LOGD(LOG_TAG, &quot;&lt;&lt; receive: %d&quot;, length);</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">return</span> length;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;} <span class="comment">// receive_cpp</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="class_socket.html#afc27706410db610051b84cb3c969daa3">  400</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#afc27706410db610051b84cb3c969daa3">Socket::receiveFrom</a>(uint8_t* <a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> length, <span class="keyword">struct</span> sockaddr *pAddr) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    socklen_t addrLen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#a3102fdddc55c0c8906c40365b5b2fa71">::recvfrom</a>(m_sock, <a class="code" href="structdata.html">data</a>, length, 0, pAddr, &amp;addrLen);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;} <span class="comment">// receiveFrom</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="class_socket.html#a6d6e3f6b1d0f355575a1bfb350b6477d">  415</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">Socket::send</a>(<span class="keyword">const</span> uint8_t* <a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> length)<span class="keyword"> const </span>{</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;send: Raw binary of length: %d&quot;</span>, length);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">//GeneralUtils::hexDump(data, length);</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ERR_OK;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">while</span> (length &gt; 0) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = mbedtls_ssl_write((mbedtls_ssl_context*)&amp;m_sslContext, <a class="code" href="structdata.html">data</a>, length);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="comment">// retry with same parameters if MBEDTLS_ERR_SSL_WANT_WRITE or MBEDTLS_ERR_SSL_WANT_READ</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != MBEDTLS_ERR_SSL_WANT_WRITE) &amp;&amp; (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != MBEDTLS_ERR_SSL_WANT_READ)) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    <span class="comment">// no cure for other errors - log and exit</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                    ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;send: SSL write error %d&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    <span class="comment">// not all data was written, try again for the remainder</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    length -= <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    <a class="code" href="structdata.html">data</a> += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = ::lwip_send_r(m_sock, <a class="code" href="structdata.html">data</a>, length, 0);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) &amp;&amp; (errno != <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>)) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="comment">// no cure for errors other than EAGAIN - log and exit</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;send: socket=%d, %s&quot;</span>, m_sock, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &gt; 0) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="comment">// not all data was written, try again for the remainder</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                length -= <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <a class="code" href="structdata.html">data</a> += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;} <span class="comment">// send</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">  457</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">Socket::send</a>(<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>)<span class="keyword"> const </span>{</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;send: Binary of length: %d&quot;</span>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>.length());</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">send</a>((uint8_t*) <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>.data(), <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>.size());</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;} <span class="comment">// send</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="class_socket.html#a04f60fe51e2db3db27b2f7731e66e772">  463</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">Socket::send</a>(uint16_t <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;send: 16bit value: %.2x&quot;</span>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">send</a>((uint8_t*) &amp;<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>));</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;} <span class="comment">// send_cpp</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="class_socket.html#a76de86d175282e3273f932f6f66aa8fe">  469</a></span>&#160;<span class="keywordtype">int</span>  <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">Socket::send</a>(uint32_t <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;send: 32bit value: %.2x&quot;</span>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">send</a>((uint8_t*) &amp;<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>));</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;} <span class="comment">// send</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="class_socket.html#a44a41324fbee63de97bdadc7de03bda3">  481</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_socket.html#a44a41324fbee63de97bdadc7de03bda3">Socket::sendTo</a>(<span class="keyword">const</span> uint8_t* <a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> length, <span class="keyword">struct</span> sockaddr* pAddr) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">getSSL</a>()) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = mbedtls_ssl_write(&amp;m_sslContext, <a class="code" href="structdata.html">data</a>, length);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#a41f9a86568fee1d3e923e08583a37e83">::sendto</a>(m_sock, <a class="code" href="structdata.html">data</a>, length, 0, pAddr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr));</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;sendto: socket=%d %s&quot;</span>, m_sock, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;} <span class="comment">// sendTo</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="class_socket.html#ad435a8a36e2759203db8b4b2c67e4e85">  498</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_socket.html#ad435a8a36e2759203db8b4b2c67e4e85">Socket::setReuseAddress</a>(<span class="keywordtype">bool</span> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setReuseAddress: %d&quot;</span>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">int</span> val = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> ? 1 : 0;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">setSocketOption</a>(SO_REUSEADDR, &amp;val, <span class="keyword">sizeof</span>(val));</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; setReuseAddress&quot;</span>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;} <span class="comment">// setReuseAddress</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="class_socket.html#a73d0af1a733ff70a622eac54a997f887">  510</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_socket.html#a73d0af1a733ff70a622eac54a997f887">Socket::setSSL</a>(<span class="keywordtype">bool</span> sslValue) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* pers = <span class="stringliteral">&quot;ssl_server&quot;</span>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setSSL: %s&quot;</span>, sslValue?<span class="stringliteral">&quot;Yes&quot;</span>:<span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    m_useSSL = sslValue;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (sslValue) {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordtype">char</span> *pvtKey = <a class="code" href="class_s_s_l_utils.html#ae13c69d141b447847c9f94672a9b35c5">SSLUtils::getKey</a>();</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordtype">char</span> *certificate = <a class="code" href="class_s_s_l_utils.html#a07afed306b3a429076a62d1acf071782">SSLUtils::getCertificate</a>();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (pvtKey == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;No private key file&quot;</span>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> (certificate == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;No certificate file&quot;</span>);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        mbedtls_net_init(&amp;m_sslSock);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        mbedtls_ssl_init(&amp;m_sslContext);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        mbedtls_ssl_config_init(&amp;m_conf);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        mbedtls_x509_crt_init(&amp;m_srvcert);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        mbedtls_pk_init(&amp;m_pkey);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        mbedtls_entropy_init(&amp;m_entropy);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        mbedtls_ctr_drbg_init(&amp;m_ctr_drbg);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordtype">int</span> ret = mbedtls_x509_crt_parse(&amp;m_srvcert, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) certificate, strlen(certificate) + 1);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_x509_crt_parse returned 0x%x&quot;</span>, -ret);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        ret = mbedtls_pk_parse_key(&amp;m_pkey, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) pvtKey, strlen(pvtKey) + 1, NULL, 0);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_pk_parse_key returned 0x%x&quot;</span>, -ret);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        ret = mbedtls_ctr_drbg_seed(&amp;m_ctr_drbg, mbedtls_entropy_func, &amp;m_entropy, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) pers, strlen(pers));</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;! mbedtls_ctr_drbg_seed returned %d\n&quot;</span>, ret);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        ret = mbedtls_ssl_config_defaults(&amp;m_conf,</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                MBEDTLS_SSL_IS_SERVER,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                MBEDTLS_SSL_TRANSPORT_STREAM,</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                MBEDTLS_SSL_PRESET_DEFAULT);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_ssl_config_defaults returned %d\n\n&quot;</span>, ret);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        mbedtls_ssl_conf_authmode(&amp;m_conf, MBEDTLS_SSL_VERIFY_NONE);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        mbedtls_ssl_conf_rng(&amp;m_conf, mbedtls_ctr_drbg_random, &amp;m_ctr_drbg);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">//  mbedtls_ssl_conf_ca_chain( &amp;m_conf, m_srvcert.next, NULL);</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        ret = mbedtls_ssl_conf_own_cert(&amp;m_conf, &amp;m_srvcert, &amp;m_pkey);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_ssl_conf_own_cert returned %d\n\n&quot;</span>, ret);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        mbedtls_ssl_conf_dbg(&amp;m_conf, my_debug, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">#ifdef CONFIG_MBEDTLS_DEBUG</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        mbedtls_debug_set_threshold(4);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        ret = mbedtls_ssl_setup(&amp;m_sslContext, &amp;m_conf);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_ssl_setup returned %d\n\n&quot;</span>, ret);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;exit:</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;} <span class="comment">// setSSL</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="keywordtype">void</span> Socket::sslHandshake() {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; sslHandshake: sock: %d&quot;</span>, m_sslSock.fd);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    mbedtls_ssl_session_reset(&amp;m_sslContext);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot; - Reset complete&quot;</span>);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    mbedtls_ssl_set_bio(&amp;m_sslContext, &amp;m_sslSock, mbedtls_net_send, mbedtls_net_recv, NULL);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordtype">int</span> ret = mbedtls_ssl_handshake(&amp;m_sslContext);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> (ret == 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">if</span> (ret != MBEDTLS_ERR_SSL_WANT_READ &amp;&amp; ret != MBEDTLS_ERR_SSL_WANT_WRITE) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;mbedtls_ssl_handshake returned %d\n\n&quot;</span>, ret);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    } <span class="comment">// End while</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; sslHandshake&quot;</span>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;} <span class="comment">// sslHandshake</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno"><a class="line" href="class_socket.html#a377ac3bcbf52e36dc08bca6ad0c8a97f">  614</a></span>&#160;<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_socket.html#a377ac3bcbf52e36dc08bca6ad0c8a97f">Socket::toString</a>() {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;fd: &quot;</span> &lt;&lt; m_sock;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">return</span> oss.str();</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;} <span class="comment">// toString</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno"><a class="line" href="class_socket_input_record_streambuf.html#a0ed684a3ce6c98cd806c35fd551937c3">  627</a></span>&#160;<a class="code" href="class_socket_input_record_streambuf.html#a0ed684a3ce6c98cd806c35fd551937c3">SocketInputRecordStreambuf::SocketInputRecordStreambuf</a>(</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="class_socket.html">Socket</a>  socket,</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordtype">size_t</span>  dataLength,</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordtype">size_t</span>  bufferSize) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    m_socket     = socket;    <span class="comment">// The socket we will be reading from</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    m_dataLength = dataLength; <span class="comment">// The size of the record we wish to read.</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    m_bufferSize = bufferSize; <span class="comment">// The size of the buffer used to hold data</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    m_sizeRead   = 0;          <span class="comment">// The size of data read from the socket</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    m_buffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[bufferSize]; <span class="comment">// Create the buffer used to hold the data read from the socket.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    setg(m_buffer, m_buffer, m_buffer); <span class="comment">// Set the initial get buffer pointers to no data.</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;} <span class="comment">// SocketInputRecordStreambuf</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="class_socket_input_record_streambuf.html#a8afc3b99b9a1269facea30e70b54e8cf">  641</a></span>&#160;<a class="code" href="class_socket_input_record_streambuf.html#a8afc3b99b9a1269facea30e70b54e8cf">SocketInputRecordStreambuf::~SocketInputRecordStreambuf</a>() {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keyword">delete</span>[] m_buffer;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;} <span class="comment">// ~SocketInputRecordStreambuf</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno"><a class="line" href="class_socket_input_record_streambuf.html#a87d321805e116126cd2ded9e748cd25d">  650</a></span>&#160;SocketInputRecordStreambuf::int_type <a class="code" href="class_socket_input_record_streambuf.html#a87d321805e116126cd2ded9e748cd25d">SocketInputRecordStreambuf::underflow</a>() {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (m_sizeRead &gt;= m_dataLength) <span class="keywordflow">return</span> EOF;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordtype">int</span> bytesRead = m_socket.<a class="code" href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">receive</a>((uint8_t*) m_buffer, m_bufferSize, <span class="keyword">true</span>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span> (bytesRead == 0) <span class="keywordflow">return</span> EOF;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    m_sizeRead += bytesRead;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    setg(m_buffer, m_buffer, m_buffer + bytesRead);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">return</span> traits_type::to_int_type(*gptr());</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;} <span class="comment">// underflow</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="class_socket_exception.html#abb427e8ccc153b50f85fcc5552083f0a">  660</a></span>&#160;<a class="code" href="class_socket_exception.html#abb427e8ccc153b50f85fcc5552083f0a">SocketException::SocketException</a>(<span class="keywordtype">int</span> myErrno) {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    m_errno = myErrno;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div><div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="class_socket_html_a5ccaf81da2b6f25dded056e6dbf7f410"><div class="ttname"><a href="class_socket.html#a5ccaf81da2b6f25dded056e6dbf7f410">Socket::isValid</a></div><div class="ttdeci">bool isValid()</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00249">Socket.cpp:249</a></div></div>
<div class="ttc" id="class_socket_html_abeb5751e47f3fa96755aba55d29c300a"><div class="ttname"><a href="class_socket.html#abeb5751e47f3fa96755aba55d29c300a">Socket::receive</a></div><div class="ttdeci">size_t receive(uint8_t *data, size_t length, bool exact=false)</div><div class="ttdoc">Receive data from the partner. Receive data from the socket partner. If exact = false, we read as much data as is available without blocking up to length. If exact = true, we will block until we have received exactly length bytes or there are no more bytes to read. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00349">Socket.cpp:349</a></div></div>
<div class="ttc" id="ignore-content-length_8d_html_a06bf02a476389246deac1e3c53ee7e18"><div class="ttname"><a href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a></div><div class="ttdeci">Long Ignore the Content Length header.This is particularly useful for servers running Apache. x</div><div class="ttdef"><b>Definition:</b> <a href="ignore-content-length_8d_source.html#l00005">ignore-content-length.d:5</a></div></div>
<div class="ttc" id="_s_s_l_utils_8h_html"><div class="ttname"><a href="_s_s_l_utils_8h.html">SSLUtils.h</a></div></div>
<div class="ttc" id="class_socket_html_aef6249eaa9b2be5a386f85cb828c2b4a"><div class="ttname"><a href="class_socket.html#aef6249eaa9b2be5a386f85cb828c2b4a">Socket::setTimeout</a></div><div class="ttdeci">int setTimeout(uint32_t seconds)</div><div class="ttdoc">Socket timeout. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00303">Socket.cpp:303</a></div></div>
<div class="ttc" id="structtimeval_html_a3599199839a89e99a2ce29d45312b5cf"><div class="ttname"><a href="structtimeval.html#a3599199839a89e99a2ce29d45312b5cf">timeval::tv_sec</a></div><div class="ttdeci">long tv_sec</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00110">curl_setup_once.h:110</a></div></div>
<div class="ttc" id="class_socket_input_record_streambuf_html_a0ed684a3ce6c98cd806c35fd551937c3"><div class="ttname"><a href="class_socket_input_record_streambuf.html#a0ed684a3ce6c98cd806c35fd551937c3">SocketInputRecordStreambuf::SocketInputRecordStreambuf</a></div><div class="ttdeci">SocketInputRecordStreambuf(Socket socket, size_t dataLength, size_t bufferSize=512)</div><div class="ttdoc">Create a socket input record streambuf. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00627">Socket.cpp:627</a></div></div>
<div class="ttc" id="connect__with__static__ip_8c_html_a4a705192be3844fa0fe58f6337391983"><div class="ttname"><a href="connect__with__static__ip_8c.html#a4a705192be3844fa0fe58f6337391983">inet_pton</a></div><div class="ttdeci">inet_pton(AF_INET, DEVICE_IP, &amp;ipInfo.ip)</div></div>
<div class="ttc" id="connect-to_8d_html_a450c41f520f7661f0a48b8fd2597a74c"><div class="ttname"><a href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">string</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS meaning any host port.HOST2 and PORT2 may also be the empty string</div><div class="ttdef"><b>Definition:</b> <a href="connect-to_8d_source.html#l00014">connect-to.d:14</a></div></div>
<div class="ttc" id="class_s_s_l_utils_html_ae13c69d141b447847c9f94672a9b35c5"><div class="ttname"><a href="class_s_s_l_utils.html#ae13c69d141b447847c9f94672a9b35c5">SSLUtils::getKey</a></div><div class="ttdeci">static char * getKey()</div><div class="ttdef"><b>Definition:</b> <a href="_s_s_l_utils_8cpp_source.html#l00039">SSLUtils.cpp:39</a></div></div>
<div class="ttc" id="class_socket_html_aef06605c6725958004116983f1a2051f"><div class="ttname"><a href="class_socket.html#aef06605c6725958004116983f1a2051f">Socket::close</a></div><div class="ttdeci">int close()</div><div class="ttdoc">Close the socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00135">Socket.cpp:135</a></div></div>
<div class="ttc" id="class_socket_html_aa0aa0b437ca534447e335b58e8a30254"><div class="ttname"><a href="class_socket.html#aa0aa0b437ca534447e335b58e8a30254">Socket::addressToString</a></div><div class="ttdeci">static std::string addressToString(struct sockaddr *addr)</div><div class="ttdoc">Convert a socket address to a string representation. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00092">Socket.cpp:92</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="class_socket_html_ad9757badfe9d9903d07ef7c70279ad77"><div class="ttname"><a href="class_socket.html#ad9757badfe9d9903d07ef7c70279ad77">Socket::send</a></div><div class="ttdeci">int send(std::string value) const</div><div class="ttdoc">Send a string to the partner. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00457">Socket.cpp:457</a></div></div>
<div class="ttc" id="class_socket_html_a44a41324fbee63de97bdadc7de03bda3"><div class="ttname"><a href="class_socket.html#a44a41324fbee63de97bdadc7de03bda3">Socket::sendTo</a></div><div class="ttdeci">void sendTo(const uint8_t *data, size_t length, struct sockaddr *pAddr)</div><div class="ttdoc">Send data to a specific address. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00481">Socket.cpp:481</a></div></div>
<div class="ttc" id="class_socket_html_a7c3256c4fc6e2c603df73201049fae5a"><div class="ttname"><a href="class_socket.html#a7c3256c4fc6e2c603df73201049fae5a">Socket::Socket</a></div><div class="ttdeci">Socket()</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00044">Socket.cpp:44</a></div></div>
<div class="ttc" id="class_socket_html_a73d0af1a733ff70a622eac54a997f887"><div class="ttname"><a href="class_socket.html#a73d0af1a733ff70a622eac54a997f887">Socket::setSSL</a></div><div class="ttdeci">void setSSL(bool sslValue=true)</div><div class="ttdoc">Flag the socket as using SSL. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00510">Socket.cpp:510</a></div></div>
<div class="ttc" id="setup-os400_8h_html_a3102fdddc55c0c8906c40365b5b2fa71"><div class="ttname"><a href="setup-os400_8h.html#a3102fdddc55c0c8906c40365b5b2fa71">recvfrom</a></div><div class="ttdeci">#define recvfrom</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00213">setup-os400.h:213</a></div></div>
<div class="ttc" id="class_socket_html_aeac4eb6379a543d38ed88977d3b6630a"><div class="ttname"><a href="class_socket.html#aeac4eb6379a543d38ed88977d3b6630a">Socket::~Socket</a></div><div class="ttdeci">virtual ~Socket()</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00049">Socket.cpp:49</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="class_socket_html_a377ac3bcbf52e36dc08bca6ad0c8a97f"><div class="ttname"><a href="class_socket.html#a377ac3bcbf52e36dc08bca6ad0c8a97f">Socket::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Get the string representation of this socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00614">Socket.cpp:614</a></div></div>
<div class="ttc" id="setup-os400_8h_html_a41f9a86568fee1d3e923e08583a37e83"><div class="ttname"><a href="setup-os400_8h.html#a41f9a86568fee1d3e923e08583a37e83">sendto</a></div><div class="ttdeci">#define sendto</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00212">setup-os400.h:212</a></div></div>
<div class="ttc" id="class_socket_html_a893006a5a02363d31017ad4f1275e23a"><div class="ttname"><a href="class_socket.html#a893006a5a02363d31017ad4f1275e23a">Socket::readToDelim</a></div><div class="ttdeci">std::string readToDelim(std::string delim)</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00314">Socket.cpp:314</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="class_socket_html_afc27706410db610051b84cb3c969daa3"><div class="ttname"><a href="class_socket.html#afc27706410db610051b84cb3c969daa3">Socket::receiveFrom</a></div><div class="ttdeci">int receiveFrom(uint8_t *data, size_t length, struct sockaddr *pAddr)</div><div class="ttdoc">Receive data with the address. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00400">Socket.cpp:400</a></div></div>
<div class="ttc" id="structtimeval_html_aa8396731f2914f9ed2a457d3da602b80"><div class="ttname"><a href="structtimeval.html#aa8396731f2914f9ed2a457d3da602b80">timeval::tv_usec</a></div><div class="ttdeci">long tv_usec</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00111">curl_setup_once.h:111</a></div></div>
<div class="ttc" id="class_socket_exception_html_abb427e8ccc153b50f85fcc5552083f0a"><div class="ttname"><a href="class_socket_exception.html#abb427e8ccc153b50f85fcc5552083f0a">SocketException::SocketException</a></div><div class="ttdeci">SocketException(int myErrno)</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00660">Socket.cpp:660</a></div></div>
<div class="ttc" id="_socket_8h_html"><div class="ttname"><a href="_socket_8h.html">Socket.h</a></div></div>
<div class="ttc" id="output_8d_html_a7bcb6a773be04cbd4890bfe10fa42696"><div class="ttname"><a href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a></div><div class="ttdeci">Long you can use specifier.That variable will be replaced with the current string for the URL being fetched.Like if you specify two URLs on the same command line</div><div class="ttdef"><b>Definition:</b> <a href="output_8d_source.html#l00008">output.d:8</a></div></div>
<div class="ttc" id="unit1398_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00033">unit1398.c:33</a></div></div>
<div class="ttc" id="config_8d_html_aea53e62b3bb322f5a6bf4ceb58066a37"><div class="ttname"><a href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are r and v.A backslash preceding any other letter is ignored.If the first column of a config line is a the rest of the line will be treated as a comment.Only write one option per physical line in the config file.Specify the filename to config as to make curl read the file from stdin.Note that to be able to specify a URL in the config file</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="class_s_s_l_utils_html_a07afed306b3a429076a62d1acf071782"><div class="ttname"><a href="class_s_s_l_utils.html#a07afed306b3a429076a62d1acf071782">SSLUtils::getCertificate</a></div><div class="ttdeci">static char * getCertificate()</div><div class="ttdef"><b>Definition:</b> <a href="_s_s_l_utils_8cpp_source.html#l00028">SSLUtils.cpp:28</a></div></div>
<div class="ttc" id="create-dirs_8d_html_a80cfb6b82f50850fe3824288a2e3a40c"><div class="ttname"><a href="create-dirs_8d.html#a80cfb6b82f50850fe3824288a2e3a40c">option</a></div><div class="ttdeci">Long curl will create the necessary local directory hierarchy as needed.This option creates the dirs mentioned with the output option</div><div class="ttdef"><b>Definition:</b> <a href="create-dirs_8d_source.html#l00004">create-dirs.d:4</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_af0fac1cea1165b4debec7f686edf3313"><div class="ttname"><a href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a></div><div class="ttdeci">#define EAGAIN</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00444">config-win32ce.h:444</a></div></div>
<div class="ttc" id="class_socket_exception_html"><div class="ttname"><a href="class_socket_exception.html">SocketException</a></div><div class="ttdef"><b>Definition:</b> <a href="_socket_8h_source.html#l00045">Socket.h:45</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3cb9f0894fab1c8fbb0753c9c7c2a8d9"><div class="ttname"><a href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a></div><div class="ttdeci">#define printf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00040">curl_printf.h:40</a></div></div>
<div class="ttc" id="class_socket_html_ae537e61bb9f64b0322c6e9c39bb24fde"><div class="ttname"><a href="class_socket.html#ae537e61bb9f64b0322c6e9c39bb24fde">Socket::connect</a></div><div class="ttdeci">int connect(struct in_addr address, uint16_t port)</div><div class="ttdoc">Connect to a partner. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00164">Socket.cpp:164</a></div></div>
<div class="ttc" id="structtimeval_html"><div class="ttname"><a href="structtimeval.html">timeval</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00109">curl_setup_once.h:109</a></div></div>
<div class="ttc" id="class_socket_html_ac6445aa3f7bd41c6f4466a8b31f2cecd"><div class="ttname"><a href="class_socket.html#ac6445aa3f7bd41c6f4466a8b31f2cecd">Socket::getSSL</a></div><div class="ttdeci">bool getSSL() const</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00245">Socket.cpp:245</a></div></div>
<div class="ttc" id="class_socket_html"><div class="ttname"><a href="class_socket.html">Socket</a></div><div class="ttdoc">Encapsulate a socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8h_source.html#l00062">Socket.h:62</a></div></div>
<div class="ttc" id="class_socket_html_a0bee77d0779e5d3a0f62ef7d37e5033d"><div class="ttname"><a href="class_socket.html#a0bee77d0779e5d3a0f62ef7d37e5033d">Socket::setSocketOption</a></div><div class="ttdeci">int setSocketOption(int option, void *value, size_t len)</div><div class="ttdoc">Set the socket option. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00290">Socket.cpp:290</a></div></div>
<div class="ttc" id="class_socket_input_record_streambuf_html_a8afc3b99b9a1269facea30e70b54e8cf"><div class="ttname"><a href="class_socket_input_record_streambuf.html#a8afc3b99b9a1269facea30e70b54e8cf">SocketInputRecordStreambuf::~SocketInputRecordStreambuf</a></div><div class="ttdeci">~SocketInputRecordStreambuf()</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00641">Socket.cpp:641</a></div></div>
<div class="ttc" id="class_socket_html_a3f749d9a206e48a875e8c24f29500a93"><div class="ttname"><a href="class_socket.html#a3f749d9a206e48a875e8c24f29500a93">Socket::accept</a></div><div class="ttdeci">Socket accept()</div><div class="ttdoc">Accept a new socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00057">Socket.cpp:57</a></div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="ftp-ssl-ccc-mode_8d_html_ac4f4031531425afe8fbe576a1e1d1642"><div class="ttname"><a href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a></div><div class="ttdeci">Long but instead wait for the server to do it</div><div class="ttdef"><b>Definition:</b> <a href="ftp-ssl-ccc-mode_8d_source.html#l00008">ftp-ssl-ccc-mode.d:8</a></div></div>
<div class="ttc" id="_b_l_e_eddystone_t_l_m_8h_html_a36142ddde297ed1d5577c81230997301"><div class="ttname"><a href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a></div><div class="ttdeci">uint16_t temp</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_eddystone_t_l_m_8h_source.html#l00043">BLEEddystoneTLM.h:43</a></div></div>
<div class="ttc" id="class_socket_html_a788b0d2a4070a64fb38d2c6e6289f96e"><div class="ttname"><a href="class_socket.html#a788b0d2a4070a64fb38d2c6e6289f96e">Socket::createSocket</a></div><div class="ttdeci">int createSocket(bool isDatagram=false)</div><div class="ttdoc">Create the socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00204">Socket.cpp:204</a></div></div>
<div class="ttc" id="class_socket_html_adc1e8efb9384ac637d42e93008debb6a"><div class="ttname"><a href="class_socket.html#adc1e8efb9384ac637d42e93008debb6a">Socket::bind</a></div><div class="ttdeci">int bind(uint16_t port, uint32_t address)</div><div class="ttdoc">Bind an address/port to a socket. Specify a port of 0 to have a local port allocated. Specify an address of INADDR_ANY to use the local server IP. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00110">Socket.cpp:110</a></div></div>
<div class="ttc" id="class_socket_html_a2ba81037cc4a722e155c7bbbfef58b0d"><div class="ttname"><a href="class_socket.html#a2ba81037cc4a722e155c7bbbfef58b0d">Socket::getFD</a></div><div class="ttdeci">int getFD() const</div><div class="ttdoc">Get the underlying socket file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00241">Socket.cpp:241</a></div></div>
<div class="ttc" id="class_socket_html_a893bb9a6107d2139cfb088f0c82ac5ae"><div class="ttname"><a href="class_socket.html#a893bb9a6107d2139cfb088f0c82ac5ae">Socket::listen</a></div><div class="ttdeci">int listen(uint16_t port, bool isDatagram=false, bool reuseAddress=false)</div><div class="ttdoc">Create a listening socket. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00259">Socket.cpp:259</a></div></div>
<div class="ttc" id="class_socket_input_record_streambuf_html_a87d321805e116126cd2ded9e748cd25d"><div class="ttname"><a href="class_socket_input_record_streambuf.html#a87d321805e116126cd2ded9e748cd25d">SocketInputRecordStreambuf::underflow</a></div><div class="ttdeci">int_type underflow()</div><div class="ttdoc">Handle the request to read data from the stream but we need more data from the source. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00650">Socket.cpp:650</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="class_socket_html_ad435a8a36e2759203db8b4b2c67e4e85"><div class="ttname"><a href="class_socket.html#ad435a8a36e2759203db8b4b2c67e4e85">Socket::setReuseAddress</a></div><div class="ttdeci">void setReuseAddress(bool value)</div><div class="ttdoc">Flag the socket address as re-usable. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00498">Socket.cpp:498</a></div></div>
<div class="ttc" id="class_socket_html_a6b59f7b6e3be56f4d4a27558bde48e85"><div class="ttname"><a href="class_socket.html#a6b59f7b6e3be56f4d4a27558bde48e85">Socket::getBind</a></div><div class="ttdeci">void getBind(struct sockaddr *pAddr)</div><div class="ttdoc">Get the bound address. </div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00225">Socket.cpp:225</a></div></div>
<div class="ttc" id="class_socket_html_a9ceb18eb59288e2fc1eb31d631f9dee0"><div class="ttname"><a href="class_socket.html#a9ceb18eb59288e2fc1eb31d631f9dee0">Socket::operator&lt;</a></div><div class="ttdeci">bool operator&lt;(const Socket &amp;other) const</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8cpp_source.html#l00282">Socket.cpp:282</a></div></div>
<div class="ttc" id="structpart_html"><div class="ttname"><a href="structpart.html">part</a></div><div class="ttdef"><b>Definition:</b> <a href="lib1560_8c_source.html#l00037">lib1560.c:37</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_socket_8cpp.html">Socket.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
