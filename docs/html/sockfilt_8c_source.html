<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/tests/server/sockfilt.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sockfilt_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sockfilt.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sockfilt_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__setup_8h.html">server_setup.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/* Purpose</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * 1. Accept a TCP connection on a custom port (IPv4 or IPv6), or connect</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *    to a given (localhost) port.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * 2. Get commands on STDIN. Pass data on to the TCP stream.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *    Get data from TCP stream and pass on to STDOUT.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * This program is made to perform all the socket/stream/connection stuff for</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * the test suite&#39;s (perl) FTP server. Previously the perl code did all of</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * this by its own, but I decided to let this program do the socket layer</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * because of several things:</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * o We want the perl code to work with rather old perl installations, thus</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *   we cannot use recent perl modules or features.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * o We want IPv6 support for systems that provide it, and doing optional IPv6</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *   support in perl seems if not impossible so at least awkward.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * o We want FTP-SSL support, which means that a connection that starts with</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> *   plain sockets needs to be able to &quot;go SSL&quot; in the midst. This would also</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *   require some nasty perl stuff I&#39;d rather avoid.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * (Source originally based on sws.c)</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> * Signal handling notes for sockfilt</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * ----------------------------------</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> * This program is a single-threaded process.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> * This program is intended to be highly portable and as such it must be kept</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * as simple as possible, due to this the only signal handling mechanisms used</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * will be those of ANSI C, and used only in the most basic form which is good</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * enough for the purpose of this program.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> * For the above reason and the specific needs of this program signals SIGHUP,</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> * SIGPIPE and SIGALRM will be simply ignored on systems where this can be</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> * done.  If possible, signals SIGINT and SIGTERM will be handled by this</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> * program as an indication to cleanup and finish execution as soon as</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * possible.  This will be achieved with a single signal handler</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> * &#39;exit_signal_handler&#39; for both signals.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> * The &#39;exit_signal_handler&#39; upon the first SIGINT or SIGTERM received signal</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"> * will just set to one the global var &#39;got_exit_signal&#39; storing in global var</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"> * &#39;exit_signal&#39; the signal that triggered this change.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"> * Nothing fancy that could introduce problems is used, the program at certain</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"> * points in its normal flow checks if var &#39;got_exit_signal&#39; is set and in</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"> * case this is true it just makes its way out of loops and functions in</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"> * structured and well behaved manner to achieve proper program cleanup and</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"> * termination.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * Even with the above mechanism implemented it is worthwile to note that</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> * other signals might still be received, or that there might be systems on</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> * which it is not possible to trap and ignore some of the above signals.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * This implies that for increased portability and reliability the program</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> * must be coded as if no signal was being ignored or handled at all.  Enjoy</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> * it!</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL_H</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN6_H</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &lt;netinet/in6.h&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a4858ee8b549f158fb5eb37dc7dad537e">  102</a></span>&#160;<span class="preprocessor">#define ENABLE_CURLX_PRINTF</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">/* make the curlx header define all printf() functions to use the curlx_*</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">   versions instead */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curlx_8h.html">curlx.h</a>&quot;</span> <span class="comment">/* from the private lib dir */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="getpart_8h.html">getpart.h</a>&quot;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__pton_8h.html">inet_pton.h</a>&quot;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__sockaddr_8h.html">server_sockaddr.h</a>&quot;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">/* include memdebug.h last */</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#undef  EINTR</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#define EINTR    4 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#undef  EAGAIN</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#define EAGAIN  11 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#undef  ENOMEM</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#define ENOMEM  12 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#undef  EINVAL</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#define EINVAL  22 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a16b710f592bf8f7900666392adc444dc">  126</a></span>&#160;<span class="preprocessor">#define DEFAULT_PORT 8999</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#ifndef DEFAULT_LOGFILE</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a4d68235dfa433dea9c42f14784f80f6a">  129</a></span>&#160;<span class="preprocessor">#define DEFAULT_LOGFILE &quot;log/sockfilt.log&quot;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a97a20211ff266e7b4180dd6c49c06eed">  132</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sockfilt_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = <a class="code" href="sockfilt_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="next_8d.html#abe10eb0831ec028e893494fafede8ed9">verbose</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> bind_only = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> use_ipv6 = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ipv_inuse = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = <a class="code" href="sockfilt_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> connectport = 0; <span class="comment">/* if non-zero, we activate this mode */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577">  143</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577">sockmode</a> {</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">  144</a></span>&#160;  <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>,    <span class="comment">/* as a server waiting for connections */</span></div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">  145</a></span>&#160;  <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a>,   <span class="comment">/* as a server, connected to a client */</span></div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f">  146</a></span>&#160;  <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a>,            <span class="comment">/* as a client, connected to a server */</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">  147</a></span>&#160;  <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">ACTIVE_DISCONNECT</a>  <span class="comment">/* as a client, disconnected from server */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;};</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/* do-nothing macro replacement for systems which lack siginterrupt() */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#ifndef HAVE_SIGINTERRUPT</span></div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">  153</a></span>&#160;<span class="preprocessor">#define siginterrupt(x,y) do {} while(0)</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/* vars used to keep around previous signal handlers */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">  158</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> (*<a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a>)(int);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sighup_handler  = SIG_ERR;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigpipe_handler = SIG_ERR;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigalrm_handler = SIG_ERR;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigint_handler  = SIG_ERR;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigterm_handler = SIG_ERR;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keyword">static</span> <a class="code" href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigbreak_handler = SIG_ERR;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">/* var which if set indicates that the program should finish execution */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">  186</a></span>&#160;<a class="code" href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a> <a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">/* if next is set indicates the first signal handled in exit_signal_handler */</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> exit_signal = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">/* signal handler that will be triggered to indicate that the program</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">  should finish its execution in a controlled manner as soon as possible.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">  The first time this is called it will set got_exit_signal to one and</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  store in exit_signal the signal that triggered its execution. */</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">static</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> exit_signal_handler(<span class="keywordtype">int</span> signum)</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">int</span> old_errno = errno;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> == 0) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 1;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    exit_signal = signum;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  (void)signal(signum, exit_signal_handler);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  errno = old_errno;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> install_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">/* ignore SIGHUP signal */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  old_sighup_handler = signal(SIGHUP, SIG_IGN);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span>(old_sighup_handler == SIG_ERR)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGHUP handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">/* ignore SIGPIPE signal */</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  old_sigpipe_handler = signal(SIGPIPE, SIG_IGN);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span>(old_sigpipe_handler == SIG_ERR)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGPIPE handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">/* ignore SIGALRM signal */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  old_sigalrm_handler = signal(SIGALRM, SIG_IGN);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span>(old_sigalrm_handler == SIG_ERR)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGALRM handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="comment">/* handle SIGINT signal with our exit_signal_handler */</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  old_sigint_handler = signal(SIGINT, exit_signal_handler);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span>(old_sigint_handler == SIG_ERR)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGINT handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="sockfilt_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGINT, 1);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">/* handle SIGTERM signal with our exit_signal_handler */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  old_sigterm_handler = signal(SIGTERM, exit_signal_handler);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span>(old_sigterm_handler == SIG_ERR)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGTERM handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="sockfilt_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGTERM, 1);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">/* handle SIGBREAK signal with our exit_signal_handler */</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  old_sigbreak_handler = signal(SIGBREAK, exit_signal_handler);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">if</span>(old_sigbreak_handler == SIG_ERR)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGBREAK handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="sockfilt_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGBREAK, 1);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> restore_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sighup_handler)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    (void)signal(SIGHUP, old_sighup_handler);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigpipe_handler)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    (void)signal(SIGPIPE, old_sigpipe_handler);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigalrm_handler)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    (void)signal(SIGALRM, old_sigalrm_handler);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigint_handler)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    (void)signal(SIGINT, old_sigint_handler);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigterm_handler)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    (void)signal(SIGTERM, old_sigterm_handler);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigbreak_handler)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    (void)signal(SIGBREAK, old_sigbreak_handler);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> * read-wrapper to support reading from stdin on Windows.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> read_wincon(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> count)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  HANDLE handle = NULL;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  DWORD mode, rcount = 0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  BOOL success;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">if</span>(fd == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>)) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    handle = GetStdHandle(STD_INPUT_HANDLE);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">return</span> read(fd, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, count);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">if</span>(GetConsoleMode(handle, &amp;mode)) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    success = ReadConsole(handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="warnless_8c.html#ad0930c920793fcd2c82920bc135d0222">curlx_uztoul</a>(count), &amp;rcount, NULL);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    success = ReadFile(handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="warnless_8c.html#ad0930c920793fcd2c82920bc135d0222">curlx_uztoul</a>(count), &amp;rcount, NULL);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span>(success) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> rcount;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  errno = GetLastError();</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#undef  read</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#define read(a,b,c) read_wincon(a,b,c)</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"> * write-wrapper to support writing to stdout and stderr on Windows.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> write_wincon(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> count)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;{</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  HANDLE handle = NULL;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  DWORD mode, wcount = 0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  BOOL success;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span>(fd == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stdout)) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    handle = GetStdHandle(STD_OUTPUT_HANDLE);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fd == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stderr)) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    handle = GetStdHandle(STD_ERROR_HANDLE);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">return</span> write(fd, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, count);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">if</span>(GetConsoleMode(handle, &amp;mode)) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    success = WriteConsole(handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="warnless_8c.html#ad0930c920793fcd2c82920bc135d0222">curlx_uztoul</a>(count), &amp;wcount, NULL);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    success = WriteFile(handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="warnless_8c.html#ad0930c920793fcd2c82920bc135d0222">curlx_uztoul</a>(count), &amp;wcount, NULL);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span>(success) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">return</span> wcount;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  errno = GetLastError();</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">#undef  write</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#define write(a,b,c) write_wincon(a,b,c)</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"> * fullread is a wrapper around the read() function. This will repeat the call</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"> * to read() until it actually has read the complete number of bytes indicated</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment"> * in nbytes or it fails with a condition that cannot be handled with a simple</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"> * retry of the read call.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> fullread(<span class="keywordtype">int</span> filedes, <span class="keywordtype">void</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> nbytes)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread = 0;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = read(filedes,</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                      (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> + nread, nbytes - nread);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die&quot;</span>);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      error = errno;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">if</span>((error == EINTR) || (error == <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>))</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;reading from file descriptor: %d,&quot;</span>, filedes);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;unrecoverable read() failure: (%d) %s&quot;</span>,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;             error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 0) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;got 0 reading from stdin&quot;</span>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    nread += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  } <span class="keywordflow">while</span>((<span class="keywordtype">size_t</span>)nread &lt; nbytes);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="next_8d.html#abe10eb0831ec028e893494fafede8ed9">verbose</a>)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;read %zd bytes&quot;</span>, nread);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordflow">return</span> nread;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"> * fullwrite is a wrapper around the write() function. This will repeat the</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"> * call to write() until it actually has written the complete number of bytes</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"> * indicated in nbytes or it fails with a condition that cannot be handled</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"> * with a simple retry of the write call.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> fullwrite(<span class="keywordtype">int</span> filedes, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> nbytes)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nwrite = 0;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> wc = write(filedes, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> + nwrite,</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                       nbytes - nwrite);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die&quot;</span>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span>(wc &lt; 0) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      error = errno;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">if</span>((error == EINTR) || (error == <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>))</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;writing to file descriptor: %d,&quot;</span>, filedes);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;unrecoverable write() failure: (%d) %s&quot;</span>,</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;             error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span>(wc == 0) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;put 0 writing to stdout&quot;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    nwrite += wc;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  } <span class="keywordflow">while</span>((<span class="keywordtype">size_t</span>)nwrite &lt; nbytes);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="next_8d.html#abe10eb0831ec028e893494fafede8ed9">verbose</a>)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;wrote %zd bytes&quot;</span>, nwrite);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">return</span> nwrite;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> * read_stdin tries to read from stdin nbytes into the given buffer. This is a</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> * blocking function that will only return TRUE when nbytes have actually been</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> * read or FALSE when an unrecoverable error has been detected. Failure of this</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"> * function is an indication that the sockfilt process should terminate.</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> read_stdin(<span class="keywordtype">void</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> nbytes)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread = fullread(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>), <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, nbytes);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">if</span>(nread != (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)nbytes) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;exiting...&quot;</span>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> * write_stdout tries to write to stdio nbytes from the given buffer. This is a</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> * blocking function that will only return TRUE when nbytes have actually been</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * written or FALSE when an unrecoverable error has been detected. Failure of</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> * this function is an indication that the sockfilt process should terminate.</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> write_stdout(<span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> nbytes)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nwrite = fullwrite(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stdout), <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, nbytes);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">if</span>(nwrite != (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)nbytes) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;exiting...&quot;</span>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> lograw(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;{</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="structdata.html">data</a>[120];</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordtype">char</span> *optr = <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> = 0;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordtype">int</span> left = <span class="keyword">sizeof</span>(<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(optr, left, <span class="stringliteral">&quot;\\n&quot;</span>);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> += 2;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      optr += 2;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      left -= 2;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;\r&#39;</span>:</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(optr, left, <span class="stringliteral">&quot;\\r&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> += 2;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      optr += 2;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      left -= 2;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(optr, left, <span class="stringliteral">&quot;%c&quot;</span>, (<a class="code" href="curl__ctype_8h.html#aff5da85872d542fca69aa535244b2694">ISGRAPH</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) ||</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                   <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] == 0x20) ?<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]:<span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>++;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      optr++;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      left--;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>&gt;60) {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;&#39;%s&#39;&quot;</span>, <a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a> = 0;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      optr = <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      left = <span class="keyword">sizeof</span>(<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a>)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;&#39;%s&#39;&quot;</span>, <a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"> * WinSock select() does not support standard file descriptors,</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"> * it can only check SOCKETs. The following function is an attempt</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"> * to re-create a select() function with support for other handle types.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"> * select() function with support for WINSOCK2 sockets and all</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"> * other handle types supported by WaitForMultipleObjectsEx() as</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"> * well as disk files, anonymous and names pipes, and character input.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment"> * https://msdn.microsoft.com/en-us/library/windows/desktop/ms687028.aspx</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment"> * https://msdn.microsoft.com/en-us/library/windows/desktop/ms741572.aspx</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="keyword">struct </span>select_ws_wait_data {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  HANDLE handle; <span class="comment">/* actual handle to wait for during select */</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  HANDLE event;  <span class="comment">/* internal event to abort waiting thread */</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;};</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="keyword">static</span> DWORD WINAPI select_ws_wait_thread(LPVOID lpParameter)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;{</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keyword">struct </span>select_ws_wait_data *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  HANDLE handle, handles[2];</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  INPUT_RECORD inputrecord;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  LARGE_INTEGER <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, pos;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  DWORD <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, length;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">/* retrieve handles from internal structure */</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="structdata.html">data</a> = (<span class="keyword">struct </span>select_ws_wait_data *) lpParameter;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    handle = <a class="code" href="structdata.html">data</a>-&gt;handle;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    handles[0] = <a class="code" href="structdata.html">data</a>-&gt;event;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    handles[1] = handle;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">return</span> (DWORD)-1;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">/* retrieve the type of file to wait on */</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a> = GetFileType(handle);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>) {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">case</span> FILE_TYPE_DISK:</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;       <span class="comment">/* The handle represents a file on disk, this means:</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">        * - WaitForMultipleObjectsEx will always be signalled for it.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">        * - comparison of current position in file and total size of</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">        *   the file can be used to check if we reached the end yet.</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">        *</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">        * Approach: Loop till either the internal event is signalled</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">        *           or if the end of the file has already been reached.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">while</span>(WaitForMultipleObjectsEx(1, handles, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, 0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            == WAIT_TIMEOUT) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">/* get total size of file */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        length = 0;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>.QuadPart = 0;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>.LowPart = GetFileSize(handle, &amp;length);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">if</span>((<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>.LowPart != INVALID_FILE_SIZE) ||</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;           (GetLastError() == NO_ERROR)) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>.HighPart = length;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          <span class="comment">/* get the current position within the file */</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          pos.QuadPart = 0;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          pos.LowPart = SetFilePointer(handle, 0, &amp;pos.HighPart,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                       FILE_CURRENT);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="keywordflow">if</span>((pos.LowPart != INVALID_SET_FILE_POINTER) ||</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;             (GetLastError() == NO_ERROR)) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="comment">/* compare position with size, abort if not equal */</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>.QuadPart == pos.QuadPart) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;              <span class="comment">/* sleep and continue waiting */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;              SleepEx(0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;          }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">/* there is some data available, stop waiting */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">case</span> FILE_TYPE_CHAR:</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;       <span class="comment">/* The handle represents a character input, this means:</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">        * - WaitForMultipleObjectsEx will be signalled on any kind of input,</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">        *   including mouse and window size events we do not care about.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">        *</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">        * Approach: Loop till either the internal event is signalled</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">        *           or we get signalled for an actual key-event.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">while</span>(WaitForMultipleObjectsEx(2, handles, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, INFINITE, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            == WAIT_OBJECT_0 + 1) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">/* check if this is an actual console handle */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        length = 0;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span>(GetConsoleMode(handle, &amp;length)) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          <span class="comment">/* retrieve an event from the console buffer */</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          length = 0;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          <span class="keywordflow">if</span>(PeekConsoleInput(handle, &amp;inputrecord, 1, &amp;length)) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="comment">/* check if the event is not an actual key-event */</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">if</span>(length == 1 &amp;&amp; inputrecord.EventType != KEY_EVENT) {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;              <span class="comment">/* purge the non-key-event and continue waiting */</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;              ReadConsoleInput(handle, &amp;inputrecord, 1, &amp;length);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">/* there is some data available, stop waiting */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">case</span> FILE_TYPE_PIPE:</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;       <span class="comment">/* The handle represents an anonymous or named pipe, this means:</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">        * - WaitForMultipleObjectsEx will always be signalled for it.</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">        * - peek into the pipe and retrieve the amount of data available.</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">        *</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">        * Approach: Loop till either the internal event is signalled</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">        *           or there is data in the pipe available for reading.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">while</span>(WaitForMultipleObjectsEx(1, handles, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, 0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            == WAIT_TIMEOUT) {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">/* peek into the pipe and retrieve the amount of data available */</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        length = 0;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">if</span>(PeekNamedPipe(handle, NULL, 0, NULL, &amp;length, NULL)) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <span class="comment">/* if there is no data available, sleep and continue waiting */</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          <span class="keywordflow">if</span>(length == 0) {</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            SleepEx(0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          <span class="comment">/* if the pipe has been closed, sleep and continue waiting */</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="keywordflow">if</span>(GetLastError() == ERROR_BROKEN_PIPE) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            SleepEx(0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment">/* there is some data available, stop waiting */</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">/* The handle has an unknown type, try to wait on it */</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      WaitForMultipleObjectsEx(2, handles, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, INFINITE, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;}</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keyword">static</span> HANDLE select_ws_wait(HANDLE handle, HANDLE event)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keyword">struct </span>select_ws_wait_data *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  HANDLE thread = NULL;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">/* allocate internal waiting data structure */</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <a class="code" href="structdata.html">data</a> = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> select_ws_wait_data));</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;handle = handle;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;event = event;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">/* launch waiting thread */</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    thread = CreateThread(NULL, 0,</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                          &amp;select_ws_wait_thread,</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                          <a class="code" href="structdata.html">data</a>, 0, NULL);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">/* free data if thread failed to launch */</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">if</span>(!thread) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">return</span> thread;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;}</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="keyword">struct </span>select_ws_data {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd;      <span class="comment">/* the original input handle   (indexed by fds) */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> wsasock; <span class="comment">/* the internal socket handle  (indexed by wsa) */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  WSAEVENT wsaevent;     <span class="comment">/* the internal WINSOCK2 event (indexed by wsa) */</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  HANDLE thread;         <span class="comment">/* the internal threads handle (indexed by thd) */</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;};</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> select_ws(<span class="keywordtype">int</span> nfds, fd_set *readfds, fd_set *writefds,</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                     fd_set *exceptfds, <span class="keyword">struct</span> <a class="code" href="structtimeval.html">timeval</a> *<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;{</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  DWORD milliseconds, wait, idx;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  WSANETWORKEVENTS wsanetevents;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keyword">struct </span>select_ws_data *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  HANDLE handle, *handles;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  WSAEVENT wsaevent;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">int</span> error, fds;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  HANDLE waitevent = NULL;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  DWORD nfd = 0, thd = 0, wsa = 0;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">/* check if the input value is valid */</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordflow">if</span>(nfds &lt; 0) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    errno = EINVAL;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">/* check if we got descriptors, sleep in case we got none */</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordflow">if</span>(!nfds) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    Sleep((<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>-&gt;tv_sec*1000)+(DWORD)(((<span class="keywordtype">double</span>)<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>-&gt;tv_usec)/1000.0));</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="comment">/* create internal event to signal waiting threads */</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  waitevent = CreateEvent(NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">if</span>(!waitevent) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    errno = <a class="code" href="config-win32ce_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">/* allocate internal array for the internal data */</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="structdata.html">data</a> = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(nfds, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> select_ws_data));</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a> == NULL) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    CloseHandle(waitevent);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    errno = <a class="code" href="config-win32ce_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="comment">/* allocate internal array for the internal event handles */</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  handles = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(nfds, <span class="keyword">sizeof</span>(HANDLE));</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">if</span>(handles == NULL) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    CloseHandle(waitevent);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    errno = <a class="code" href="config-win32ce_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="comment">/* loop over the handles in the input descriptor sets */</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">for</span>(fds = 0; fds &lt; nfds; fds++) {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">long</span> networkevents = 0;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    handles[nfd] = 0;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, readfds))</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      networkevents |= FD_READ|FD_ACCEPT|FD_CLOSE;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, writefds))</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      networkevents |= FD_WRITE|FD_CONNECT;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, exceptfds))</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      networkevents |= FD_OOB|FD_CLOSE;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">/* only wait for events for which we actually care */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span>(networkevents) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="structdata.html">data</a>[nfd].fd = curlx_sitosk(fds);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">if</span>(fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>)) {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        handle = GetStdHandle(STD_INPUT_HANDLE);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        handle = select_ws_wait(handle, waitevent);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        handles[nfd] = handle;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <a class="code" href="structdata.html">data</a>[thd].thread = handle;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        thd++;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stdout)) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        handles[nfd] = GetStdHandle(STD_OUTPUT_HANDLE);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stderr)) {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        handles[nfd] = GetStdHandle(STD_ERROR_HANDLE);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      }</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        wsaevent = WSACreateEvent();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">if</span>(wsaevent != WSA_INVALID_EVENT) {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;          error = WSAEventSelect(fds, wsaevent, networkevents);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <span class="keywordflow">if</span>(error != <a class="code" href="transport_8c.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            handle = (HANDLE) wsaevent;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            handles[nfd] = handle;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <a class="code" href="structdata.html">data</a>[wsa].wsasock = curlx_sitosk(fds);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <a class="code" href="structdata.html">data</a>[wsa].wsaevent = wsaevent;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            wsa++;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          <span class="keywordflow">else</span> {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> socket = curlx_sitosk(fds);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            WSACloseEvent(wsaevent);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            handle = (HANDLE) socket;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            handle = select_ws_wait(handle, waitevent);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            handles[nfd] = handle;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <a class="code" href="structdata.html">data</a>[thd].thread = handle;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            thd++;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;          }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      nfd++;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  }</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">/* convert struct timeval to milliseconds */</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>) {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    milliseconds = ((<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>-&gt;tv_sec * 1000) + (<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>-&gt;tv_usec / 1000));</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    milliseconds = INFINITE;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">/* wait for one of the internal handles to trigger */</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  wait = WaitForMultipleObjectsEx(nfd, handles, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, milliseconds, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">/* signal the event handle for the waiting threads */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  SetEvent(waitevent);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">/* loop over the internal handles returned in the descriptors */</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">for</span>(idx = 0; idx &lt; nfd; idx++) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = <a class="code" href="structdata.html">data</a>[idx].fd;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    handle = handles[idx];</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    fds = curlx_sktosi(sock);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">/* check if the current internal handle was triggered */</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span>(wait != WAIT_FAILED &amp;&amp; (wait - WAIT_OBJECT_0) &lt;= idx &amp;&amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;       WaitForSingleObjectEx(handle, 0, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == WAIT_OBJECT_0) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="comment">/* first handle stdin, stdout and stderr */</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">if</span>(fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>)) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="comment">/* stdin is never ready for write or exceptional */</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        FD_CLR(sock, writefds);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        FD_CLR(sock, exceptfds);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stdout) || fds == <a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stderr)) {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="comment">/* stdout and stderr are never ready for read or exceptional */</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        FD_CLR(sock, readfds);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        FD_CLR(sock, exceptfds);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="comment">/* try to handle the event with the WINSOCK2 functions */</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        wsanetevents.lNetworkEvents = 0;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        error = WSAEnumNetworkEvents(fds, handle, &amp;wsanetevents);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span>(error != <a class="code" href="transport_8c.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;          <span class="comment">/* remove from descriptor set if not ready for read/accept/close */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          <span class="keywordflow">if</span>(!(wsanetevents.lNetworkEvents &amp; (FD_READ|FD_ACCEPT|FD_CLOSE)))</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            FD_CLR(sock, readfds);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;          <span class="comment">/* remove from descriptor set if not ready for write/connect */</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;          <span class="keywordflow">if</span>(!(wsanetevents.lNetworkEvents &amp; (FD_WRITE|FD_CONNECT)))</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            FD_CLR(sock, writefds);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          <span class="comment">/* HACK:</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">           * use exceptfds together with readfds to signal</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">           * that the connection was closed by the client.</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">           *</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">           * Reason: FD_CLOSE is only signaled once, sometimes</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">           * at the same time as FD_READ with data being available.</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">           * This means that recv/sread is not reliable to detect</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">           * that the connection is closed.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">           */</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;          <span class="comment">/* remove from descriptor set if not exceptional */</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          <span class="keywordflow">if</span>(!(wsanetevents.lNetworkEvents &amp; (FD_OOB|FD_CLOSE)))</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            FD_CLR(sock, exceptfds);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="comment">/* check if the event has not been filtered using specific tests */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordflow">if</span>(FD_ISSET(sock, readfds) || FD_ISSET(sock, writefds) ||</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;         FD_ISSET(sock, exceptfds)) {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        ret++;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="comment">/* remove from all descriptor sets since this handle did not trigger */</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      FD_CLR(sock, readfds);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      FD_CLR(sock, writefds);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      FD_CLR(sock, exceptfds);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">for</span>(fds = 0; fds &lt; nfds; fds++) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, readfds))</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;select_ws: %d is readable&quot;</span>, fds);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, writefds))</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;select_ws: %d is writable&quot;</span>, fds);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(fds, exceptfds))</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;select_ws: %d is excepted&quot;</span>, fds);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">for</span>(idx = 0; idx &lt; wsa; idx++) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    WSAEventSelect(<a class="code" href="structdata.html">data</a>[idx].wsasock, NULL, 0);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    WSACloseEvent(<a class="code" href="structdata.html">data</a>[idx].wsaevent);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">for</span>(idx = 0; idx &lt; thd; idx++) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    WaitForSingleObject(<a class="code" href="structdata.html">data</a>[idx].thread, INFINITE);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    CloseHandle(<a class="code" href="structdata.html">data</a>[idx].thread);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  CloseHandle(waitevent);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(handles);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">#define select(a,b,c,d,e) select_ws(a,b,c,d,e)</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* USE_WINSOCK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">  sockfdp is a pointer to an established stream or CURL_SOCKET_BAD</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">  if sockfd is CURL_SOCKET_BAD, listendfd is a listening socket we must</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">  accept()</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> juggle(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *sockfdp,</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                   <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> listenfd,</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                   <span class="keyword">enum</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577">sockmode</a> *mode)</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;{</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keyword">struct </span><a class="code" href="structtimeval.html">timeval</a> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  fd_set fds_read;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  fd_set fds_write;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  fd_set fds_err;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordtype">int</span> maxfd = -99;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordtype">int</span> error = 0;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; <span class="comment">/* &#39;buffer&#39; is this excessively large only to be able to support things like</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">    test 1003 which tests exceedingly large server response lines */</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[17010];</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="structdata.html">data</a>[16];</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die, exiting...&quot;</span>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#ifdef HAVE_GETPPID</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">/* As a last resort, quit if sockfilt process becomes orphan. Just in case</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">     parent ftpserver process has died without killing its sockfilt children */</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordflow">if</span>(getppid() &lt;= 1) {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;process becomes orphan, exiting&quot;</span>);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>.tv_sec = 120;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>.tv_usec = 0;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  FD_ZERO(&amp;fds_read);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  FD_ZERO(&amp;fds_write);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  FD_ZERO(&amp;fds_err);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  FD_SET((<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a>)<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>), &amp;fds_read);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">switch</span>(*mode) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>:</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">/* server mode */</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    sockfd = listenfd;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">/* there&#39;s always a socket to wait for */</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    FD_SET(sockfd, &amp;fds_read);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    maxfd = (int)sockfd;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a>:</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    sockfd = *sockfdp;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == sockfd) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="comment">/* eeek, we are supposedly connected and then this cannot be -1 ! */</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;socket is -1! on %s:%d&quot;</span>, __FILE__, __LINE__);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      maxfd = 0; <span class="comment">/* stdin */</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">/* there&#39;s always a socket to wait for */</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      FD_SET(sockfd, &amp;fds_read);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      FD_SET(sockfd, &amp;fds_err);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      maxfd = (int)sockfd;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a>:</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    sockfd = *sockfdp;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">/* sockfd turns CURL_SOCKET_BAD when our connection has been closed */</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> != sockfd) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      FD_SET(sockfd, &amp;fds_read);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      FD_SET(sockfd, &amp;fds_err);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      maxfd = (int)sockfd;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;No socket to read on&quot;</span>);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      maxfd = 0;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">ACTIVE_DISCONNECT</a>:</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;disconnected, no socket to read on&quot;</span>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    maxfd = 0;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    sockfd = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  } <span class="comment">/* switch(*mode) */</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">/* select() blocking behavior call on blocking descriptors please */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = select(maxfd + 1, &amp;fds_read, &amp;fds_write, &amp;fds_err, &amp;<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die, exiting...&quot;</span>);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  } <span class="keywordflow">while</span>((<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == -1) &amp;&amp; ((error = errno) == EINTR));</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;select() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 0)</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="comment">/* timeout */</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">if</span>(FD_ISSET(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>), &amp;fds_read)) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> buffer_len;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="comment">/* read from stdin, commands/data to be dealt with and possibly passed on</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">       to the socket</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">       protocol:</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">       4 letter command + LF [mandatory]</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">       4-digit hexadecimal data length + LF [if the command takes data]</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">       data                       [the data being as long as set above]</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">       Commands:</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">       DATA - plain pass-through data</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span>(!read_stdin(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 5))</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Received %c%c%c%c (on stdin)&quot;</span>,</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;           <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0], <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1], <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2], <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3]);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">if</span>(!memcmp(<span class="stringliteral">&quot;PING&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4)) {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="comment">/* send reply on stdout, just proving we are alive */</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<span class="stringliteral">&quot;PONG\n&quot;</span>, 5))</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    }</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!memcmp(<span class="stringliteral">&quot;PORT&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4)) {</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="comment">/* Question asking us what PORT number we are listening to.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">         Replies to PORT with &quot;IPv[num]/[port]&quot; */</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>((<span class="keywordtype">char</span> *)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>), <span class="stringliteral">&quot;%s/%hu\n&quot;</span>, ipv_inuse, port);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      buffer_len = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)strlen((<span class="keywordtype">char</span> *)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">sizeof</span>(<a class="code" href="structdata.html">data</a>), <span class="stringliteral">&quot;PORT\n%04zx\n&quot;</span>, buffer_len);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<a class="code" href="structdata.html">data</a>, 10))</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, buffer_len))</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!memcmp(<span class="stringliteral">&quot;QUIT&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4)) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="comment">/* just die */</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;quits&quot;</span>);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!memcmp(<span class="stringliteral">&quot;DATA&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4)) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="comment">/* data IN =&gt; data OUT */</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">if</span>(!read_stdin(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 5))</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[5] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      buffer_len = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)strtol((<span class="keywordtype">char</span> *)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, NULL, 16);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">if</span>(buffer_len &gt; (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)<span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>)) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;ERROR: Buffer size (%zu bytes) too small for data size &quot;</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;               <span class="stringliteral">&quot;(%zd bytes)&quot;</span>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>), buffer_len);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;&gt; %zd bytes data, server =&gt; client&quot;</span>, buffer_len);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">if</span>(!read_stdin(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, buffer_len))</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      lograw(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, buffer_len);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordflow">if</span>(*mode == <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;*** We are disconnected!&quot;</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">if</span>(!write_stdout(<span class="stringliteral">&quot;DISC\n&quot;</span>, 5))</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="comment">/* send away on the socket */</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> bytes_written = swrite(sockfd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, buffer_len);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">if</span>(bytes_written != buffer_len) {</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Not all data was sent. Bytes to send: %zd sent: %zd&quot;</span>,</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                 buffer_len, bytes_written);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    }</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!memcmp(<span class="stringliteral">&quot;DISC&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4)) {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="comment">/* disconnect! */</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<span class="stringliteral">&quot;DISC\n&quot;</span>, 5))</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">if</span>(sockfd != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client forcibly disconnected&quot;</span>);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sockfd);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        *sockfdp = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">if</span>(*mode == <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a>)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;          *mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;          *mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">ACTIVE_DISCONNECT</a>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      }</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;attempt to close already dead connection&quot;</span>);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  }</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordflow">if</span>((sockfd != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) &amp;&amp; (FD_ISSET(sockfd, &amp;fds_read)) ) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread_socket;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">if</span>(*mode == <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>) {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="comment">/* there&#39;s no stream set up yet, this is an indication that there&#39;s a</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">         client connecting. */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> newfd = accept(sockfd, NULL, NULL);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == newfd) {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;accept(%d, NULL, NULL) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;               sockfd, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client connect&quot;</span>);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="keywordflow">if</span>(!write_stdout(<span class="stringliteral">&quot;CNCT\n&quot;</span>, 5))</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        *sockfdp = newfd; <span class="comment">/* store the new socket */</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        *mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a>; <span class="comment">/* we have connected */</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">/* read from socket, pass on data to stdout */</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    nread_socket = sread(sockfd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>));</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span>(nread_socket &gt; 0) {</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="structdata.html">data</a>, <span class="keyword">sizeof</span>(<a class="code" href="structdata.html">data</a>), <span class="stringliteral">&quot;DATA\n%04zx\n&quot;</span>, nread_socket);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<a class="code" href="structdata.html">data</a>, 10))</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, nread_socket))</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;&lt; %zd bytes data, client =&gt; server&quot;</span>, nread_socket);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      lograw(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, nread_socket);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordflow">if</span>(nread_socket &lt;= 0</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;#ifdef USE_WINSOCK</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;       || FD_ISSET(sockfd, &amp;fds_err)</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;#endif</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;       ) {</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client disconnect&quot;</span>);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">if</span>(!write_stdout(<span class="stringliteral">&quot;DISC\n&quot;</span>, 5))</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sockfd);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      *sockfdp = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordflow">if</span>(*mode == <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a>)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        *mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        *mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">ACTIVE_DISCONNECT</a>;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;}</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockdaemon(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock,</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *listenport)</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;{</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="comment">/* passive daemon style */</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> listener;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordtype">int</span> totdelay = 0;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordtype">int</span> maxretr = 10;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="tests_8cpp.html#a524f992188578dc1b5b0baed174bec0a">delay</a> = 20;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordtype">int</span> attempt = 0;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordtype">int</span> error = 0;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    attempt++;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    flag = 1;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = setsockopt(sock, SOL_SOCKET, SO_REUSEADDR,</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;         (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag));</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;setsockopt(SO_REUSEADDR) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;             error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">if</span>(maxretr) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(<a class="code" href="tests_8cpp.html#a524f992188578dc1b5b0baed174bec0a">delay</a>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="comment">/* should not happen */</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          error = errno;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;wait_ms() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                 error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die, exiting...&quot;</span>);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        totdelay += <a class="code" href="tests_8cpp.html#a524f992188578dc1b5b0baed174bec0a">delay</a>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <a class="code" href="tests_8cpp.html#a524f992188578dc1b5b0baed174bec0a">delay</a> *= 2; <span class="comment">/* double the sleep for next attempt */</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    }</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  } <span class="keywordflow">while</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &amp;&amp; maxretr--);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;setsockopt(SO_REUSEADDR) failed %d times in %d ms. Error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;           attempt, totdelay, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Continuing anyway...&quot;</span>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">/* When the specified listener port is zero, it is actually a</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">     request to let the system choose a non-zero available port. */</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="keywordflow">if</span>(!use_ipv6) {</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>, 0, <span class="keyword">sizeof</span>(listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr.s_addr = <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port = htons(*listenport);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;listener.sa6, 0, <span class="keyword">sizeof</span>(listener.sa6));</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    listener.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    listener.sa6.sin6_addr = in6addr_any;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    listener.sa6.sin6_port = htons(*listenport);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;listener.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(listener.sa6));</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  }</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket on port %hu: (%d) %s&quot;</span>,</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;           *listenport, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">if</span>(!*listenport) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="comment">/* The system was supposed to choose a port number, figure out which</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">       port we actually got and update the listener port value with it. */</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> la_size;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> localaddr;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">if</span>(!use_ipv6)</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      la_size = <span class="keyword">sizeof</span>(localaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      la_size = <span class="keyword">sizeof</span>(localaddr.sa6);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;localaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, 0, (<span class="keywordtype">size_t</span>)la_size);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="keywordflow">if</span>(getsockname(sock, &amp;localaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, &amp;la_size) &lt; 0) {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getsockname() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;             error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">switch</span>(localaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>.sa_family) {</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      *listenport = ntohs(localaddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      *listenport = ntohs(localaddr.sa6.sin6_port);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span>(!*listenport) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="comment">/* Real failure, listener port shall not be zero beyond this point. */</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Apparently getsockname() succeeded, with listener port zero.&quot;</span>);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;A valid reason for this failure is a binary built without&quot;</span>);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;proper network library linkage. This might not be the only&quot;</span>);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;reason, but double check it before anything else.&quot;</span>);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    }</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="comment">/* bindonly option forces no listening */</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">if</span>(bind_only) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to bind port without listening&quot;</span>);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">return</span> sock;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="comment">/* start accepting connections */</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = listen(sock, 5);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;listen(%d, 5) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;           sock, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  }</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">return</span> sock;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;}</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"><a class="line" href="sockfilt_8c.html#a0ddf1224851353fc92bfbff6f499fa97"> 1331</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="sockfilt_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;{</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> me;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> msgsock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordtype">int</span> wrotepidfile = 0;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *pidname = <span class="stringliteral">&quot;.sockfilt.pid&quot;</span>;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordtype">bool</span> juggle_again;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordtype">int</span> arg = 1;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <span class="keyword">enum</span> <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577">sockmode</a> mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a>; <span class="comment">/* default */</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *addr = NULL;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">while</span>(argc&gt;arg) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--version&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <a class="code" href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;sockfilt IPv4%s\n&quot;</span>,</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;#ifdef <a class="code" href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;             <span class="stringliteral">&quot;/IPv6&quot;</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;             <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;#endif</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;             );</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--verbose&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <a class="code" href="next_8d.html#abe10eb0831ec028e893494fafede8ed9">verbose</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      arg++;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    }</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--pidfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      arg++;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        pidname = argv[arg++];</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    }</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--logfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      arg++;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <a class="code" href="sockfilt_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = argv[arg++];</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv6&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      ipv_inuse = <span class="stringliteral">&quot;IPv6&quot;</span>;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      use_ipv6 = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      arg++;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv4&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="comment">/* for completeness, we support this option as well */</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      ipv_inuse = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      use_ipv6 = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      arg++;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--bindonly&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      bind_only = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      arg++;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    }</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--port&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      arg++;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulnum = strtoul(argv[arg], &amp;endptr, 10);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="keywordflow">if</span>((endptr != argv[arg] + strlen(argv[arg])) ||</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;           ((ulnum != 0UL) &amp;&amp; ((ulnum &lt; 1025UL) || (ulnum &gt; 65535UL)))) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(stderr, <span class="stringliteral">&quot;sockfilt: invalid --port argument (%s)\n&quot;</span>,</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                  argv[arg]);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        }</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        port = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(ulnum);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        arg++;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      }</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--connect&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="comment">/* Asked to actively connect to the specified local port instead of</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">         doing a passive server-style listening. */</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      arg++;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulnum = strtoul(argv[arg], &amp;endptr, 10);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="keywordflow">if</span>((endptr != argv[arg] + strlen(argv[arg])) ||</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;           (ulnum &lt; 1025UL) || (ulnum &gt; 65535UL)) {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;          <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(stderr, <span class="stringliteral">&quot;sockfilt: invalid --connect argument (%s)\n&quot;</span>,</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                  argv[arg]);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        }</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        connectport = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(ulnum);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        arg++;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      }</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    }</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--addr&quot;</span>, argv[arg])) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="comment">/* Set an IP address to use with --connect; otherwise use localhost */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      arg++;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        addr = argv[arg];</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        arg++;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <a class="code" href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a>(<span class="stringliteral">&quot;Usage: sockfilt [option]\n&quot;</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;           <span class="stringliteral">&quot; --version\n&quot;</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;           <span class="stringliteral">&quot; --verbose\n&quot;</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;           <span class="stringliteral">&quot; --logfile [file]\n&quot;</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;           <span class="stringliteral">&quot; --pidfile [file]\n&quot;</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;           <span class="stringliteral">&quot; --ipv4\n&quot;</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;           <span class="stringliteral">&quot; --ipv6\n&quot;</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;           <span class="stringliteral">&quot; --bindonly\n&quot;</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;           <span class="stringliteral">&quot; --port [port]\n&quot;</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;           <span class="stringliteral">&quot; --connect [port]\n&quot;</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;           <span class="stringliteral">&quot; --addr [address]&quot;</span>);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  win32_init();</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  atexit(win32_cleanup);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  setmode(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(<a class="code" href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a>), <a class="code" href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  setmode(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stdout), <a class="code" href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  setmode(<a class="code" href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a>(stderr), <a class="code" href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  install_signal_handlers();</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  <span class="keywordflow">if</span>(!use_ipv6)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    sock = socket(AF_INET, SOCK_STREAM, 0);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    sock = socket(AF_INET6, SOCK_STREAM, 0);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == sock) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error creating socket: (%d) %s&quot;</span>,</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    write_stdout(<span class="stringliteral">&quot;FAIL\n&quot;</span>, 5);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keywordflow">goto</span> sockfilt_cleanup;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordflow">if</span>(connectport) {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">/* Active mode, we should connect to the given port number */</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    mode = <a class="code" href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span>(!use_ipv6) {</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>, 0, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port = htons(connectport);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr.s_addr = <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">if</span>(!addr)</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        addr = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET, addr, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.sa6, 0, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      me.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      me.sa6.sin6_port = htons(connectport);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      <span class="keywordflow">if</span>(!addr)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        addr = <span class="stringliteral">&quot;::1&quot;</span>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, addr, &amp;me.sa6.sin6_addr);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error connecting to port %hu: (%d) %s&quot;</span>,</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;             connectport, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      write_stdout(<span class="stringliteral">&quot;FAIL\n&quot;</span>, 5);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="keywordflow">goto</span> sockfilt_cleanup;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    }</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client connect&quot;</span>);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    msgsock = sock; <span class="comment">/* use this as stream */</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  }</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="comment">/* passive daemon style */</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    sock = sockdaemon(sock, &amp;port);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == sock) {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      write_stdout(<span class="stringliteral">&quot;FAIL\n&quot;</span>, 5);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordflow">goto</span> sockfilt_cleanup;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    }</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    msgsock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>; <span class="comment">/* no stream socket yet */</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Running %s version&quot;</span>, ipv_inuse);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordflow">if</span>(connectport)</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Connected to port %hu&quot;</span>, connectport);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bind_only)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Bound without listening on port %hu&quot;</span>, port);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Listening on port %hu&quot;</span>, port);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  wrotepidfile = <a class="code" href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a>(pidname);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="keywordflow">if</span>(!wrotepidfile) {</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    write_stdout(<span class="stringliteral">&quot;FAIL\n&quot;</span>, 5);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">goto</span> sockfilt_cleanup;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  }</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    juggle_again = juggle(&amp;msgsock, sock, &amp;mode);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  } <span class="keywordflow">while</span>(juggle_again);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;sockfilt_cleanup:</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keywordflow">if</span>((msgsock != sock) &amp;&amp; (msgsock != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>))</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(msgsock);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">if</span>(sock != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>)</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keywordflow">if</span>(wrotepidfile)</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    unlink(pidname);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  restore_signal_handlers();</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;============&gt; sockfilt exits with signal (%d)&quot;</span>, exit_signal);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">     * To properly set the return status of the process we</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">     * must raise the same signal SIGINT or SIGTERM that we</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">     * caught and let the old handler take care of it.</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keyword">raise</span>(exit_signal);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  }</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;============&gt; sockfilt quits&quot;</span>);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;}</div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="setup-os400_8h_html_af65cc88d9ccb2274b94e0025d25d965f"><div class="ttname"><a href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a></div><div class="ttdeci">#define bind</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00211">setup-os400.h:211</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02"><div class="ttname"><a href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a401980666e1bd8791331d82e897dde02">ACTIVE_DISCONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00147">sockfilt.c:147</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a16b710f592bf8f7900666392adc444dc"><div class="ttname"><a href="sockfilt_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a></div><div class="ttdeci">#define DEFAULT_PORT</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00126">sockfilt.c:126</a></div></div>
<div class="ttc" id="unit1309_8c_html_a9e2730b68a97dbfb591cdc0e802bb4f5"><div class="ttname"><a href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a></div><div class="ttdeci">puts(&quot;Result:&quot;)</div></div>
<div class="ttc" id="curl__setup__once_8h_html_abc0fa768a42a766f444259b91e5c6c0f"><div class="ttname"><a href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a></div><div class="ttdeci">#define sclose(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00264">curl_setup_once.h:264</a></div></div>
<div class="ttc" id="transport_8c_html_a633b0396ff93d336a088412a190a5072"><div class="ttname"><a href="transport_8c.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a></div><div class="ttdeci">#define SOCKET_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="transport_8c_source.html#l00022">transport.c:22</a></div></div>
<div class="ttc" id="sockfilt_8c_html_ad5a1ca718c29b220d382e70a5913f7a4"><div class="ttname"><a href="sockfilt_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a></div><div class="ttdeci">#define siginterrupt(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00153">sockfilt.c:153</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="config-dos_8h_html_adbe5dcee9c146b338794974137c55e70"><div class="ttname"><a href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a></div><div class="ttdeci">#define RETSIGTYPE</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00087">config-dos.h:87</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="tests_8cpp_html_a524f992188578dc1b5b0baed174bec0a"><div class="ttname"><a href="tests_8cpp.html#a524f992188578dc1b5b0baed174bec0a">delay</a></div><div class="ttdeci">#define delay(x)</div><div class="ttdef"><b>Definition:</b> <a href="tests_8cpp_source.html#l00030">tests.cpp:30</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_aff5da85872d542fca69aa535244b2694"><div class="ttname"><a href="curl__ctype_8h.html#aff5da85872d542fca69aa535244b2694">ISGRAPH</a></div><div class="ttdeci">#define ISGRAPH(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00068">curl_ctype.h:68</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="sockfilt_8c_html_aec67ea35c886267fb4518f150e80808b"><div class="ttname"><a href="sockfilt_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a></div><div class="ttdeci">RETSIGTYPE(* SIGHANDLER_T)(int)</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00158">sockfilt.c:158</a></div></div>
<div class="ttc" id="first_8c_html_ad9df668cd7e7913338d1919a8520f76f"><div class="ttname"><a href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a></div><div class="ttdeci">void wait_ms(int ms)</div><div class="ttdef"><b>Definition:</b> <a href="first_8c_source.html#l00066">first.c:66</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="util_8c_html_a4ed279d3ab8f2e8b9d8c3f051e514783"><div class="ttname"><a href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a></div><div class="ttdeci">int write_pidfile(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00260">util.c:260</a></div></div>
<div class="ttc" id="config-os400_8h_html_a7a1524cf833450776ffc81c38a78c370"><div class="ttname"><a href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="ttdeci">#define ENABLE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00071">config-os400.h:71</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="tool__operate_8c_html_a36fa9b2e726512bc17a7a6d3e39002be"><div class="ttname"><a href="tool__operate_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a></div><div class="ttdeci">#define O_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="tool__operate_8c_source.html#l00087">tool_operate.c:87</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="curlx_8h_html"><div class="ttname"><a href="curlx_8h.html">curlx.h</a></div></div>
<div class="ttc" id="warnless_8c_html_a5cda9889c201b12398833787bff13e6e"><div class="ttname"><a href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a></div><div class="ttdeci">unsigned short curlx_ultous(unsigned long ulnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00124">warnless.c:124</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a97a20211ff266e7b4180dd6c49c06eed"><div class="ttname"><a href="sockfilt_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a></div><div class="ttdeci">const char * serverlogfile</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00132">sockfilt.c:132</a></div></div>
<div class="ttc" id="inet__pton_8h_html"><div class="ttname"><a href="inet__pton_8h.html">inet_pton.h</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb"><div class="ttname"><a href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a88781ebca40cbd3c0db525e9537471cb">PASSIVE_LISTEN</a></div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00144">sockfilt.c:144</a></div></div>
<div class="ttc" id="form_8d_html_a7aead736a07eaf25623ad7bfa1f0ee2d"><div class="ttname"><a href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00048">form.d:48</a></div></div>
<div class="ttc" id="warnless_8c_html_ad0930c920793fcd2c82920bc135d0222"><div class="ttname"><a href="warnless_8c.html#ad0930c920793fcd2c82920bc135d0222">curlx_uztoul</a></div><div class="ttdeci">unsigned long curlx_uztoul(size_t uznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00222">warnless.c:222</a></div></div>
<div class="ttc" id="util_8c_html_a9fab34cec25b3714a6b19cc623733954"><div class="ttname"><a href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a></div><div class="ttdeci">void logmsg(const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00099">util.c:99</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f"><div class="ttname"><a href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00146">sockfilt.c:146</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a0071bfd21ec79c6616e860f8b4c20015"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">srvr_sockaddr_union_t::sa</a></div><div class="ttdeci">struct sockaddr sa</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00031">server_sockaddr.h:31</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_af0fac1cea1165b4debec7f686edf3313"><div class="ttname"><a href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a></div><div class="ttdeci">#define EAGAIN</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00444">config-win32ce.h:444</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3cb9f0894fab1c8fbb0753c9c7c2a8d9"><div class="ttname"><a href="curl__printf_8h.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a></div><div class="ttdeci">#define printf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00040">curl_printf.h:40</a></div></div>
<div class="ttc" id="server__sockaddr_8h_html"><div class="ttname"><a href="server__sockaddr_8h.html">server_sockaddr.h</a></div></div>
<div class="ttc" id="structtimeval_html"><div class="ttname"><a href="structtimeval.html">timeval</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00109">curl_setup_once.h:109</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="next_8d_html_abe10eb0831ec028e893494fafede8ed9"><div class="ttname"><a href="next_8d.html#abe10eb0831ec028e893494fafede8ed9">verbose</a></div><div class="ttdeci">Short each with their own specific for such as different user names or custom requests for each.next will reset all local options and only global ones will have their values survive over to the operation following the next instruction.Global options include verbose</div><div class="ttdef"><b>Definition:</b> <a href="next_8d_source.html#l00010">next.d:10</a></div></div>
<div class="ttc" id="setup-os400_8h_html_adfd4ee688142ebda1142c1b0c7577e91"><div class="ttname"><a href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a></div><div class="ttdeci">#define connect</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00210">setup-os400.h:210</a></div></div>
<div class="ttc" id="inet__pton_8c_html_a8d1e996e3cc6d70e844c787b1a8614cc"><div class="ttname"><a href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a></div><div class="ttdeci">int Curl_inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="inet__pton_8c_source.html#l00066">inet_pton.c:66</a></div></div>
<div class="ttc" id="unit1398_8c_html_a5558ace5433f9aabbf0a0ec059900d94"><div class="ttname"><a href="unit1398_8c.html#a5558ace5433f9aabbf0a0ec059900d94">width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00034">unit1398.c:34</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a></div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00030">server_sockaddr.h:30</a></div></div>
<div class="ttc" id="unit1652_8c_html_a1d19b0eef3b3acd31be88886a0277c2e"><div class="ttname"><a href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a></div><div class="ttdeci">memset(input, '\0', sizeof(input))</div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_a6a05c923dad0c1208043e9c20a58c8e5"><div class="ttname"><a href="config-win32ce_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a></div><div class="ttdeci">#define ENOMEM</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00443">config-win32ce.h:443</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a7ddf85b622bfeaf8d3b158e18ed6794a"><div class="ttname"><a href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a></div><div class="ttdeci">#define SIG_ATOMIC_T</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00370">curl_setup_once.h:370</a></div></div>
<div class="ttc" id="getpart_8h_html"><div class="ttname"><a href="getpart_8h.html">getpart.h</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="sockfilt_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l01331">sockfilt.c:1331</a></div></div>
<div class="ttc" id="server__setup_8h_html"><div class="ttname"><a href="server__setup_8h.html">server_setup.h</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="sockfilt_8c_html_a4a9d8a1ce1202fc103170f815364076b"><div class="ttname"><a href="sockfilt_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a></div><div class="ttdeci">SIG_ATOMIC_T got_exit_signal</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00186">sockfilt.c:186</a></div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="anyauth_8d_html_a1d461998550d329666033ab94bf67c6a"><div class="ttname"><a href="anyauth_8d.html#a1d461998550d329666033ab94bf67c6a">stdin</a></div><div class="ttdeci">Long and use the most secure one the remote site claims to support.This is done by first doing a request and checking the response thus possibly inducing an extra network round trip.This is used instead of setting a specific authentication which you can do with and negotiate.Using anyauth is not recommended if you do uploads from stdin</div><div class="ttdef"><b>Definition:</b> <a href="anyauth_8d_source.html#l00006">anyauth.d:6</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c"><div class="ttname"><a href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577a257181caac36df1d01eb02958c28d68c">PASSIVE_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00145">sockfilt.c:145</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a5bc1a3f8c40f644488914bfd7707afb8"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">srvr_sockaddr_union_t::sa4</a></div><div class="ttdeci">struct sockaddr_in sa4</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00032">server_sockaddr.h:32</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="curl__printf_8h_html_aab6e63106cf29e5160e5c2d63db86d27"><div class="ttname"><a href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a></div><div class="ttdeci">#define fprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00041">curl_printf.h:41</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_a69d5b2daf8dd402fc8b43abb4ffbd44e"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">impacket.nmb.INADDR_ANY</a></div><div class="ttdeci">string INADDR_ANY</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00048">nmb.py:48</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="curl__setup_8h_html_af86fa14728c9bad5418a6d29cad9f9ff"><div class="ttname"><a href="curl__setup_8h.html#af86fa14728c9bad5418a6d29cad9f9ff">fileno</a></div><div class="ttdeci">int fileno(FILE *stream)</div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a5c96afeb8c84cc2e33f232a482c56577"><div class="ttname"><a href="sockfilt_8c.html#a5c96afeb8c84cc2e33f232a482c56577">sockmode</a></div><div class="ttdeci">sockmode</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00143">sockfilt.c:143</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_af89f74b4f46628d93e3cc829fcd69801"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_SOCKLEN_T curl_socklen_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00436">system.h:436</a></div></div>
<div class="ttc" id="get_8d_html_a38b0ef81b65f2aee282c8c217a123176"><div class="ttname"><a href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a></div><div class="ttdeci">Long this option will make all data specified with data</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="sockfilt_8c_html_a4d68235dfa433dea9c42f14784f80f6a"><div class="ttname"><a href="sockfilt_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a></div><div class="ttdeci">#define DEFAULT_LOGFILE</div><div class="ttdef"><b>Definition:</b> <a href="sockfilt_8c_source.html#l00129">sockfilt.c:129</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_c8a2a421f641dc9212666197c7c3274f.html">tests</a></li><li class="navelem"><a class="el" href="dir_a56cf240bd760590f7435b1cc527e3dc.html">server</a></li><li class="navelem"><a class="el" href="sockfilt_8c.html">sockfilt.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
