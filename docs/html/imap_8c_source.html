<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/imap.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('imap_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">imap.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="imap_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * RFC2195 CRAM-MD5 authentication</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * RFC2595 Using TLS with IMAP, POP3 and ACAP</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * RFC2831 DIGEST-MD5 authentication</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * RFC3501 IMAPv4 protocol</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * RFC4422 Simple Authentication and Security Layer (SASL)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * RFC4616 PLAIN authentication</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * RFC4752 The Kerberos V5 (&quot;GSSAPI&quot;) SASL Mechanism</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * RFC4959 IMAP Extension for SASL Initial Client Response</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * RFC5092 IMAP URL Scheme</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * RFC6749 OAuth 2.0 Authorization Framework</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * Draft   LOGIN SASL Mechanism &lt;draft-murchison-sasl-login-00.txt&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_IMAP</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef HAVE_UTSNAME_H</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;sys/utsname.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifdef __VMS</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;in.h&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;inet.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if (defined(NETWARE) &amp;&amp; defined(__NOVELL_LIBC__))</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#undef in_addr_t</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#define in_addr_t unsigned long</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="curl_8h.html">curl/curl.h</a>&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hostip_8h.html">hostip.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="progress_8h.html">progress.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="transfer_8h.html">transfer.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="escape_8h.html">escape.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="http_8h.html">http.h</a>&quot;</span> <span class="comment">/* for HTTP proxy tunnel stuff */</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="socks_8h.html">socks.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="imap_8h.html">imap.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mime_8h.html">mime.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strtoofft_8h.html">strtoofft.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vtls_8h.html">vtls/vtls.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strerror_8h.html">strerror.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="multiif_8h.html">multiif.h</a>&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="url_8h.html">url.h</a>&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__sasl_8h.html">curl_sasl.h</a>&quot;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/* Local API functions */</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_regular_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_do(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> status,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                          <span class="keywordtype">bool</span> premature);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_disconnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> dead);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_multi_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> imap_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        <span class="keywordtype">int</span> numsocks);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_doing(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *dophase_done);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_setup_connection(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *imap_atom(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="keywordtype">bool</span> escape_only);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_sendf(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_url_options(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_url_path(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_custom_request(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_authenticate(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *mech,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *initresp);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_continue_authenticate(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">char</span> *resp);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> imap_get_message(<span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">char</span> **outptr);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * IMAP protocol handler.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="imap_8h.html#ae276e4e81c4afa813d9324d62421bff8">  117</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> <a class="code" href="imap_8c.html#ae276e4e81c4afa813d9324d62421bff8">Curl_handler_imap</a> = {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="stringliteral">&quot;IMAP&quot;</span>,                           <span class="comment">/* scheme */</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  imap_setup_connection,            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  imap_do,                          <span class="comment">/* do_it */</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  imap_done,                        <span class="comment">/* done */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* do_more */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  imap_connect,                     <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  imap_multi_statemach,             <span class="comment">/* connecting */</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  imap_doing,                       <span class="comment">/* doing */</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  imap_getsock,                     <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  imap_getsock,                     <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  imap_disconnect,                  <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="urldata_8h.html#a0ea7effcf0508ef4153127d686fabdcb">PORT_IMAP</a>,                        <span class="comment">/* defport */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="curl_8h.html#a30d3c27b363600b6748798f8b3a1ec75">CURLPROTO_IMAP</a>,                   <span class="comment">/* protocol */</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a>|              <span class="comment">/* flags */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="urldata_8h.html#a7dc3bffda7491b001e405e434493b896">PROTOPT_URLOPTIONS</a></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;};</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#ifdef USE_SSL</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> * IMAPS protocol handler.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__handler.html">Curl_handler</a> <a class="code" href="imap_8h.html#aba3ad26835d0af88926a323546998304">Curl_handler_imaps</a> = {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="stringliteral">&quot;IMAPS&quot;</span>,                          <span class="comment">/* scheme */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  imap_setup_connection,            <span class="comment">/* setup_connection */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  imap_do,                          <span class="comment">/* do_it */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  imap_done,                        <span class="comment">/* done */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* do_more */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  imap_connect,                     <span class="comment">/* connect_it */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  imap_multi_statemach,             <span class="comment">/* connecting */</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  imap_doing,                       <span class="comment">/* doing */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  imap_getsock,                     <span class="comment">/* proto_getsock */</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  imap_getsock,                     <span class="comment">/* doing_getsock */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* domore_getsock */</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* perform_getsock */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  imap_disconnect,                  <span class="comment">/* disconnect */</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* readwrite */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>,                        <span class="comment">/* connection_check */</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="urldata_8h.html#a6e968b2dddd9a08d21f730c57b9ae0d6">PORT_IMAPS</a>,                       <span class="comment">/* defport */</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="curl_8h.html#a2431e24f2138b8074ffe85acace52384">CURLPROTO_IMAPS</a>,                  <span class="comment">/* protocol */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a> | <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a> | <span class="comment">/* flags */</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="urldata_8h.html#a7dc3bffda7491b001e405e434493b896">PROTOPT_URLOPTIONS</a></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;};</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">  167</a></span>&#160;<span class="preprocessor">#define IMAP_RESP_OK       1</span></div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="imap_8c.html#af0481802b10618d47e7c6ba936f300ea">  168</a></span>&#160;<span class="preprocessor">#define IMAP_RESP_NOT_OK   2</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="imap_8c.html#a12c4bcee933e8e06bacbee077813de2c">  169</a></span>&#160;<span class="preprocessor">#define IMAP_RESP_PREAUTH  3</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">/* SASL parameters for the imap protocol */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_s_a_s_lproto.html">SASLproto</a> saslimap = {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="stringliteral">&quot;imap&quot;</span>,                     <span class="comment">/* The service name */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="charliteral">&#39;+&#39;</span>,                        <span class="comment">/* Code received when continuation is expected */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>,               <span class="comment">/* Code to receive upon authentication success */</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  0,                          <span class="comment">/* Maximum initial response length (no max) */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  imap_perform_authenticate,  <span class="comment">/* Send authentication command */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  imap_continue_authenticate, <span class="comment">/* Send authentication continuation */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  imap_get_message            <span class="comment">/* Get SASL response message */</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;};</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#ifdef USE_SSL</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="imap_8c.html#a36b324474a9d2730691634beebff39f7">imap_to_imaps</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">/* Change the connection handler */</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a> = &amp;<a class="code" href="imap_8h.html#aba3ad26835d0af88926a323546998304">Curl_handler_imaps</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">/* Set the connection&#39;s upgraded to TLS flag */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a67243eae05daae35cf8e0d3a49b9b8b9">tls_upgraded</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="imap_8c.html#a36b324474a9d2730691634beebff39f7">  193</a></span>&#160;<span class="preprocessor">#define imap_to_imaps(x) Curl_nop_stmt</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> * imap_matchresp()</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> * Determines whether the untagged response is related to the specified</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> * command by checking if it is in format &quot;* &lt;command-name&gt; ...&quot; or</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"> * &quot;* &lt;number&gt; &lt;command-name&gt; ...&quot;.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"> * The &quot;* &quot; marker is assumed to have already been checked by the caller.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> imap_matchresp(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;{</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *end = <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> + <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">size_t</span> cmd_len = strlen(cmd);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">/* Skip the untagged response marker */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> += 2;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">/* Do we have a number after the marker? */</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> &lt; end &amp;&amp; <a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>)) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">/* Skip the number */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>++;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">while</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> &lt; end &amp;&amp; <a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>));</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">/* Do we have the space character? */</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> == end || *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> != <span class="charliteral">&#39; &#39;</span>)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>++;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">/* Does the command name match and is it followed by a space character or at</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">     the end of line? */</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> + cmd_len &lt;= end &amp;&amp; <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, cmd, cmd_len) &amp;&amp;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;     (<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[cmd_len] == <span class="charliteral">&#39; &#39;</span> || <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> + cmd_len + 2 == end))</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"> * imap_endofresp()</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> * Checks whether the given string is a valid tagged, untagged or continuation</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> * response which can be processed by the response handler.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> imap_endofresp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                           <span class="keywordtype">int</span> *resp)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = imapc-&gt;<a class="code" href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">resptag</a>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordtype">size_t</span> id_len = strlen(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">/* Do we have a tagged command response? */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt;= id_len + 1 &amp;&amp; !memcmp(<span class="keywordtype">id</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, id_len) &amp;&amp; <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[id_len] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> += id_len + 1;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= id_len + 1;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt;= 2 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;OK&quot;</span>, 2))</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      *resp = <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt;= 7 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;PREAUTH&quot;</span>, 7))</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      *resp = <a class="code" href="imap_8c.html#a12c4bcee933e8e06bacbee077813de2c">IMAP_RESP_PREAUTH</a>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      *resp = <a class="code" href="imap_8c.html#af0481802b10618d47e7c6ba936f300ea">IMAP_RESP_NOT_OK</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">/* Do we have an untagged command response? */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt;= 2 &amp;&amp; !memcmp(<span class="stringliteral">&quot;* &quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, 2)) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">switch</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">/* States which are interested in untagged responses */</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaca3968b75d65a456f48347d212d316a0">IMAP_CAPABILITY</a>:</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span>(!imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot;CAPABILITY&quot;</span>))</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaacbce467d1755f2653c268562a9c7a100">IMAP_LIST</a>:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">if</span>((!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; !imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot;LIST&quot;</span>)) ||</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          (imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; !imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>) &amp;&amp;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;           (!<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;STORE&quot;</span>) ||</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            !imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot;FETCH&quot;</span>)) &amp;&amp;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;SELECT&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;EXAMINE&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;SEARCH&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;EXPUNGE&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;LSUB&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;UID&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;           !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, <span class="stringliteral">&quot;NOOP&quot;</span>)))</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa380a71f52c42edbafe4a66ec2ba26619">IMAP_SELECT</a>:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">/* SELECT is special in that its untagged responses do not have a</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">           common prefix so accept anything! */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1bfe1b2026d0357ee6ba25ea009a7f66">IMAP_FETCH</a>:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span>(!imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot;FETCH&quot;</span>))</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaef4439450032e719930d3db4cb1b74ac">IMAP_SEARCH</a>:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span>(!imap_matchresp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="stringliteral">&quot;SEARCH&quot;</span>))</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="comment">/* Ignore other untagged responses */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    *resp = <span class="charliteral">&#39;*&#39;</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">/* Do we have a continuation response? This should be a + symbol followed by</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">     a space and optionally some text as per RFC-3501 for the AUTHENTICATE and</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">     APPEND commands and as outlined in Section 4. Examples of RFC-4959 but</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">     some e-mail servers ignore this and only send a single + instead. */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span>(imap &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; ((<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> == 3 &amp;&amp; !memcmp(<span class="stringliteral">&quot;+&quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, 1)) ||</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;     (<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt;= 2 &amp;&amp; !memcmp(<span class="stringliteral">&quot;+ &quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, 2)))) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">switch</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">/* States which are interested in continuation responses */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa4b7258cc80f22b67f224f2ac97e703eb">IMAP_AUTHENTICATE</a>:</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1d6b765d7df319a1b12e1ff92edc9f50">IMAP_APPEND</a>:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        *resp = <span class="charliteral">&#39;+&#39;</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Unexpected continuation response&quot;</span>);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        *resp = -1;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* Nothing for us */</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment"> * imap_get_message()</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> * Gets the authentication message from the response buffer.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> imap_get_message(<span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">char</span> **outptr)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = strlen(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">char</span> *message = NULL;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 2) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">/* Find the start of the message */</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= 2;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span>(message = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> + 2; *message == <span class="charliteral">&#39; &#39;</span> || *message == <span class="charliteral">&#39;\t&#39;</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        message++, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>--)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      ;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">/* Find the end of the message */</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">for</span>(; <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>--;)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">if</span>(message[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; message[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; message[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] != <span class="charliteral">&#39; &#39;</span> &amp;&amp;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;         message[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] != <span class="charliteral">&#39;\t&#39;</span>)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">/* Terminate the message */</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span>(++<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      message[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/* junk input =&gt; zero length output */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    message = &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>];</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  *outptr = message;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> * state()</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"> * This is the ONLY way to change IMAP state!</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> newstate)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;{</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">#if defined(DEBUGBUILD) &amp;&amp; !defined(CURL_DISABLE_VERBOSE_STRINGS)</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">/* for debug purposes */</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> names[]={</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="stringliteral">&quot;STOP&quot;</span>,</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="stringliteral">&quot;SERVERGREET&quot;</span>,</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="stringliteral">&quot;CAPABILITY&quot;</span>,</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="stringliteral">&quot;STARTTLS&quot;</span>,</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="stringliteral">&quot;UPGRADETLS&quot;</span>,</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="stringliteral">&quot;AUTHENTICATE&quot;</span>,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="stringliteral">&quot;LOGIN&quot;</span>,</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="stringliteral">&quot;LIST&quot;</span>,</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="stringliteral">&quot;SELECT&quot;</span>,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="stringliteral">&quot;FETCH&quot;</span>,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="stringliteral">&quot;FETCH_FINAL&quot;</span>,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="stringliteral">&quot;APPEND&quot;</span>,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="stringliteral">&quot;APPEND_FINAL&quot;</span>,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="stringliteral">&quot;SEARCH&quot;</span>,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="stringliteral">&quot;LOGOUT&quot;</span>,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">/* LAST */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  };</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> != newstate)</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;IMAP %p state change from %s to %s\n&quot;</span>,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          (<span class="keywordtype">void</span> *)imapc, names[imapc-&gt;state], names[newstate]);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> = newstate;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"> * imap_perform_capability()</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> * Sends the CAPABILITY command in order to obtain a list of server side</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> * supported capabilities.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_capability(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#a85feab732c5c647f44a98be0879b4c07">authmechs</a> = <a class="code" href="curl__sasl_8h.html#a0d17b662c34d62263c4ac37d6409a231">SASL_AUTH_NONE</a>; <span class="comment">/* No known auth. mechanisms yet */</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#aa0c7b537da5cdc37aa0b99dd760a281b">authused</a> = <a class="code" href="curl__sasl_8h.html#a0d17b662c34d62263c4ac37d6409a231">SASL_AUTH_NONE</a>;  <span class="comment">/* Clear the auth. mechanism used */</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#af67d2b9f56c485d016107263531d9fc6">tls_supported</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;           <span class="comment">/* Clear the TLS capability */</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">/* Send the CAPABILITY command */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;CAPABILITY&quot;</span>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaca3968b75d65a456f48347d212d316a0">IMAP_CAPABILITY</a>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> * imap_perform_starttls()</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> * Sends the STARTTLS command to start the upgrade to TLS.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_starttls(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">/* Send the STARTTLS command */</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;STARTTLS&quot;</span>);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa05191306d5de2126c93f02a62665a548">IMAP_STARTTLS</a>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"> * imap_perform_upgrade_tls()</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> * Performs the upgrade to TLS.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_upgrade_tls(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;{</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">/* Start the SSL connection */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#a5ee046324452a0fe07e54818257fe04c">Curl_ssl_connect_nonblocking</a>(conn, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, &amp;imapc-&gt;<a class="code" href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">ssldone</a>);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> != <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaad84f9beee436b2ca50801981333797b7">IMAP_UPGRADETLS</a>)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaad84f9beee436b2ca50801981333797b7">IMAP_UPGRADETLS</a>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">ssldone</a>) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <a class="code" href="imap_8c.html#a36b324474a9d2730691634beebff39f7">imap_to_imaps</a>(conn);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_capability(conn);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"> * imap_perform_login()</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"> * Sends a clear text LOGIN command to authenticate with.</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_login(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordtype">char</span> *user;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordtype">char</span> *passwd;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">/* Check we have a username and password to authenticate with and end the</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">     connect phase if we don&#39;t */</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a3bfd8a5d78dc98e435348b877e19f619">user_passwd</a>) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">/* Make sure the username and password are in the correct atom format */</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  user = imap_atom(conn-&gt;<a class="code" href="structconnectdata.html#a85cb9da7776d42c440612d2940a7fcb4">user</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  passwd = imap_atom(conn-&gt;<a class="code" href="structconnectdata.html#a4bb3a85b09c8a63a0b526a24f9b1897a">passwd</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">/* Send the LOGIN command */</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;LOGIN %s %s&quot;</span>, user ? user : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                      passwd ? passwd : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(user);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(passwd);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa9c6ca16e6c5af045bb8fcbc4ced2c796">IMAP_LOGIN</a>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;}</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"> * imap_perform_authenticate()</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"> * Sends an AUTHENTICATE command allowing the client to login with the given</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"> * SASL authentication mechanism.</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_authenticate(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *mech,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *initresp)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;{</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span>(initresp) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">/* Send the AUTHENTICATE command with the initial response */</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;AUTHENTICATE %s %s&quot;</span>, mech, initresp);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">/* Send the AUTHENTICATE command */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;AUTHENTICATE %s&quot;</span>, mech);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"> * imap_continue_authenticate()</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"> * Sends SASL continuation data or cancellation.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_continue_authenticate(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">char</span> *resp)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;{</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, resp);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"> * imap_perform_authentication()</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"> * Initiates the authentication sequence, with the appropriate SASL</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"> * authentication mechanism, falling back to clear text should a common</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"> * mechanism not be available between the client and server.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_authentication(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;{</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <a class="code" href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6e">saslprogress</a> progress;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">/* Check if already authenticated OR if there is enough data to authenticate</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">     with and end the connect phase if we don&#39;t */</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#afb7c402c854fcd5bb02fafc0ac0bed3a">preauth</a> ||</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;     !<a class="code" href="curl__sasl_8c.html#a0b0d042ef268f40c3ff3568c4769c077">Curl_sasl_can_authenticate</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>, conn)) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">/* Calculate the SASL login details */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl__sasl_8c.html#a371e800af2726fd2bfffbe509fcc97ac">Curl_sasl_start</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>, conn, imapc-&gt;<a class="code" href="structimap__conn.html#ac7e06fca7ab2f13f020fa5a5c15864a7">ir_supported</a>, &amp;progress);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span>(progress == <a class="code" href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea031a2f7c13d80a40be33526d4577c843">SASL_INPROGRESS</a>)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa4b7258cc80f22b67f224f2ac97e703eb">IMAP_AUTHENTICATE</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!imapc-&gt;<a class="code" href="structimap__conn.html#a409ee6664f95ae2631ba41d5e2e16a26">login_disabled</a> &amp;&amp; (imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> &amp; <a class="code" href="imap_8h.html#ae3f0ff2a0a47eab3b443d1ada554b70b">IMAP_TYPE_CLEARTEXT</a>))</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="comment">/* Perform clear text authentication */</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_login(conn);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">/* Other mechanisms not supported */</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;No known authentication mechanisms supported!\n&quot;</span>);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment"> * imap_perform_list()</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"> * Sends a LIST command or an alternative custom request.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_list(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;{</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>)</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">/* Send the custom request */</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;%s%s&quot;</span>, imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>,</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        imap-&gt;<a class="code" href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">custom_params</a> ? imap-&gt;<a class="code" href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">custom_params</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">/* Make sure the mailbox is in the correct atom format if necessary */</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> = imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> ? imap_atom(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, <span class="keyword">true</span>)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                  : <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">/* Send the LIST command */</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;LIST \&quot;%s\&quot; *&quot;</span>, <a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaacbce467d1755f2653c268562a9c7a100">IMAP_LIST</a>);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment"> * imap_perform_select()</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"> * Sends a SELECT command to ask the server to change the selected mailbox.</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_select(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;{</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">/* Invalidate old information as we are switching mailboxes */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imapc-&gt;<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">/* Check we have a mailbox */</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Cannot SELECT without a mailbox.&quot;</span>);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">/* Make sure the mailbox is in the correct atom format */</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a> = imap_atom(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">/* Send the SELECT command */</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;SELECT %s&quot;</span>, <a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa380a71f52c42edbafe4a66ec2ba26619">IMAP_SELECT</a>);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;}</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"> * imap_perform_fetch()</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment"> * Sends a FETCH command to initiate the download of a message.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_fetch(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;{</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">/* Check we have a UID */</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a>) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">/* Send the FETCH command */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;UID FETCH %s BODY[%s]&lt;%s&gt;&quot;</span>,</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a>,</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> ? imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;UID FETCH %s BODY[%s]&quot;</span>,</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a>,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> ? imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="comment">/* Send the FETCH command */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;FETCH %s BODY[%s]&lt;%s&gt;&quot;</span>,</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>,</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> ? imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;FETCH %s BODY[%s]&quot;</span>,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>,</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                            imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> ? imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Cannot FETCH without a UID.&quot;</span>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1bfe1b2026d0357ee6ba25ea009a7f66">IMAP_FETCH</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> * imap_perform_append()</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> * Sends an APPEND command to initiate the upload of a message.</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_append(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;{</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="comment">/* Check we have a mailbox */</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Cannot APPEND without a mailbox.&quot;</span>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">/* Prepare the mime data if some. */</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.mimepost.kind != <a class="code" href="mime_8h.html#a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b">MIMEKIND_NONE</a>) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">/* Use the whole structure as data. */</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;set.mimepost.flags &amp;= ~<a class="code" href="mime_8h.html#ae6faa301cc4b37f4112e9acc984db066">MIME_BODY_ONLY</a>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">/* Add external headers and mime version. */</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="curl_8h.html#adbc451757ed5aeebdff70d9517e9ff49">curl_mime_headers</a>(&amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost, <a class="code" href="structdata.html">data</a>-&gt;set.headers, 0);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="mime_8c.html#aa3774f4f669549973a0ff85d5372dc8f">Curl_mime_prepare_headers</a>(&amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost, NULL,</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                       NULL, <a class="code" href="mime_8h.html#afdc5138da8e131f5e919d4f8e67ae172a52e324a18fd8b30fa3c3801991ecbded">MIMESTRATEGY_MAIL</a>);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="transfer_8c.html#a0649a25288fefe787c7bedddadb8a31d">Curl_checkheaders</a>(conn, <span class="stringliteral">&quot;Mime-Version&quot;</span>))</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="mime_8c.html#a18951691569e3c259cba64edf1d3bd4b">Curl_mime_add_header</a>(&amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost.curlheaders,</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                      <span class="stringliteral">&quot;Mime-Version: 1.0&quot;</span>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">/* Make sure we will read the entire mime structure. */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="mime_8c.html#a16da9e4dbf38be0096a6c63bd408c39c">Curl_mime_rewind</a>(&amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.infilesize = <a class="code" href="mime_8c.html#a5d447429cc681c949f0a2b9c60bebdae">Curl_mime_size</a>(&amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">/* Read from mime structure. */</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.fread_func = (<a class="code" href="curl_8h.html#a7516630ec17f247697dd3272be7ada74">curl_read_callback</a>) <a class="code" href="mime_8c.html#a421afd16d330a7d51f13ec1aecca05be">Curl_mime_read</a>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.in = (<span class="keywordtype">void</span> *) &amp;<a class="code" href="structdata.html">data</a>-&gt;set.mimepost;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">/* Check we know the size of the upload */</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.infilesize &lt; 0) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Cannot APPEND with unknown input file size\n&quot;</span>);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">/* Make sure the mailbox is in the correct atom format */</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> = imap_atom(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">/* Send the APPEND command */</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;APPEND %s (\\Seen) {%&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot;}&quot;</span>,</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                      <a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, <a class="code" href="structdata.html">data</a>-&gt;state.infilesize);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1d6b765d7df319a1b12e1ff92edc9f50">IMAP_APPEND</a>);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * imap_perform_search()</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * Sends a SEARCH command.</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_search(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;{</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">/* Check we have a query string */</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Cannot SEARCH without a query string.&quot;</span>);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">/* Send the SEARCH command */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;SEARCH %s&quot;</span>, imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaef4439450032e719930d3db4cb1b74ac">IMAP_SEARCH</a>);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"> * imap_perform_logout()</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment"> * Performs the logout action prior to sclose() being called.</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform_logout(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;{</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">/* Send the LOGOUT command */</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_sendf(conn, <span class="stringliteral">&quot;LOGOUT&quot;</span>);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa7a03ad57f81e95a60b8840401861ced2">IMAP_LOGOUT</a>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">/* For the initial server greeting */</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_servergreet_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                            <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                            <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;{</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordflow">if</span>(imapcode == <a class="code" href="imap_8c.html#a12c4bcee933e8e06bacbee077813de2c">IMAP_RESP_PREAUTH</a>) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">/* PREAUTH */</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    imapc-&gt;<a class="code" href="structimap__conn.html#afb7c402c854fcd5bb02fafc0ac0bed3a">preauth</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;PREAUTH connection, already authenticated!\n&quot;</span>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Got unexpected imap-server response&quot;</span>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordflow">return</span> imap_perform_capability(conn);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">/* For CAPABILITY responses */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_capability_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                           <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                           <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;{</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">/* Do we have a untagged response? */</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span>(imapcode == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> += 2;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">/* Loop through the data line */</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="keywordtype">size_t</span> wordlen;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordflow">while</span>(*<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> &amp;&amp;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            (*<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> == <span class="charliteral">&#39; &#39;</span> || *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> == <span class="charliteral">&#39;\t&#39;</span> ||</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;              *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> == <span class="charliteral">&#39;\r&#39;</span> || *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> == <span class="charliteral">&#39;\n&#39;</span>)) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>++;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      }</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">if</span>(!*<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="comment">/* Extract the word */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">for</span>(wordlen = 0; <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[wordlen] &amp;&amp; <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[wordlen] != <span class="charliteral">&#39; &#39;</span> &amp;&amp;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[wordlen] != <span class="charliteral">&#39;\t&#39;</span> &amp;&amp; <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[wordlen] != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[wordlen] != <span class="charliteral">&#39;\n&#39;</span>;)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        wordlen++;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="comment">/* Does the server support the STARTTLS capability? */</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">if</span>(wordlen == 8 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;STARTTLS&quot;</span>, 8))</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        imapc-&gt;<a class="code" href="structimap__conn.html#af67d2b9f56c485d016107263531d9fc6">tls_supported</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="comment">/* Has the server explicitly disabled clear text authentication? */</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(wordlen == 13 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;LOGINDISABLED&quot;</span>, 13))</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        imapc-&gt;<a class="code" href="structimap__conn.html#a409ee6664f95ae2631ba41d5e2e16a26">login_disabled</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="comment">/* Does the server support the SASL-IR capability? */</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(wordlen == 7 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;SASL-IR&quot;</span>, 7))</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        imapc-&gt;<a class="code" href="structimap__conn.html#ac7e06fca7ab2f13f020fa5a5c15864a7">ir_supported</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="comment">/* Do we have a SASL based authentication mechanism? */</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(wordlen &gt; 5 &amp;&amp; !memcmp(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;AUTH=&quot;</span>, 5)) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordtype">size_t</span> llen;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mechbit;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> += 5;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        wordlen -= 5;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="comment">/* Test the word for a matching authentication mechanism */</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        mechbit = <a class="code" href="curl__sasl_8c.html#ab5ca8ef10cc46798d01ef17b0babb957">Curl_sasl_decode_mech</a>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, wordlen, &amp;llen);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">if</span>(mechbit &amp;&amp; llen == wordlen)</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#a85feab732c5c647f44a98be0879b4c07">authmechs</a> |= mechbit;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> += wordlen;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imapcode == <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl &amp;&amp; !conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a>) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="comment">/* We don&#39;t have a SSL/TLS connection yet, but SSL is requested */</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#af67d2b9f56c485d016107263531d9fc6">tls_supported</a>)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">/* Switch to TLS connection now */</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_starttls(conn);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl == <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986">CURLUSESSL_TRY</a>)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="comment">/* Fallback and carry on with authentication */</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_authentication(conn);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;STARTTLS not supported.&quot;</span>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_authentication(conn);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_authentication(conn);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;}</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">/* For STARTTLS responses */</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_starttls_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                         <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                         <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;{</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.use_ssl != <a class="code" href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986">CURLUSESSL_TRY</a>) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;STARTTLS denied&quot;</span>);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a>;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    }</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_authentication(conn);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_upgrade_tls(conn);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;}</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">/* For SASL authentication responses */</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_auth_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                                     <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                     <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <a class="code" href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6e">saslprogress</a> progress;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl__sasl_8c.html#a0318109baab696da473aef3b184fe185">Curl_sasl_continue</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>, conn, imapcode, &amp;progress);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">switch</span>(progress) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea1de9500c71f5d22637fce8b383c8cf19">SASL_DONE</a>:</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);  <span class="comment">/* Authenticated */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea17835c0cce72df2710536ee19b53ddb4">SASL_IDLE</a>:            <span class="comment">/* No mechanism left after cancellation */</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span>((!imapc-&gt;<a class="code" href="structimap__conn.html#a409ee6664f95ae2631ba41d5e2e16a26">login_disabled</a>) &amp;&amp; (imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> &amp; <a class="code" href="imap_8h.html#ae3f0ff2a0a47eab3b443d1ada554b70b">IMAP_TYPE_CLEARTEXT</a>))</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="comment">/* Perform clear text authentication */</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_login(conn);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Authentication cancelled&quot;</span>);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    }</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;}</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">/* For LOGIN responses */</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_login_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                                      <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                                      <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Access denied. %c&quot;</span>, imapcode);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">/* End of connect phase */</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;}</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">/* For LIST and SEARCH responses */</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_listsearch_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                           <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                           <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;{</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a049af7985a282087c2a21aa90cee0e1c">buffer</a>;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = strlen(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  (void)instate; <span class="comment">/* No use for this yet */</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">if</span>(imapcode == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">/* Temporarily add the LF character back and send as body to the client */</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(conn, <a class="code" href="sendf_8h.html#aae18389dfefc98a5057629f6a46fd78f">CLIENTWRITE_BODY</a>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> + 1);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb">CURLE_QUOTE_ERROR</a>; <span class="comment">/* TODO: Fix error code */</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="comment">/* End of DO phase */</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;}</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">/* For SELECT responses */</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_select_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                                       <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;{</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">if</span>(imapcode == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">/* See if this is an UIDVALIDITY response */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordtype">char</span> tmp[20];</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span>(sscanf(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> + 2, <span class="stringliteral">&quot;OK [UIDVALIDITY %19[0123456789]]&quot;</span>, tmp) == 1) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(tmp);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imapcode == <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">/* Check if the UIDVALIDITY has been specified and matches */</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a> &amp;&amp; imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a> &amp;&amp;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;       !<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a>, imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a>)) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Mailbox UIDVALIDITY has changed&quot;</span>);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="comment">/* Note the currently opened mailbox on this connection */</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      imapc-&gt;<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>)</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_list(conn);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_search(conn);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_fetch(conn);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Select failed&quot;</span>);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  }</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;}</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">/* For the (first line of the) FETCH responses */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_fetch_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                                      <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;{</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="structdata.html">data</a>-&gt;state.buffer;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordtype">bool</span> parsed = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = 0;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  (void)instate; <span class="comment">/* no use for this yet */</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="keywordflow">if</span>(imapcode != <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, -1);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a>; <span class="comment">/* TODO: Fix error code */</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">/* Something like this is received &quot;* 1 FETCH (BODY[TEXT] {2021}\r&quot; so parse</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">     the continuation data contained within the curly brackets */</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; (*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;{&#39;</span>))</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordflow">if</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> == <span class="charliteral">&#39;{&#39;</span>) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="strtoofft_8c.html#a3c9f5c063165fc15454feac4def889d7">curlx_strtoofft</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 1, &amp;endptr, 10, &amp;<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">if</span>(endptr - <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &gt; 1 &amp;&amp; endptr[0] == <span class="charliteral">&#39;}&#39;</span> &amp;&amp;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;         endptr[1] == <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; endptr[2] == <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        parsed = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keywordflow">if</span>(parsed) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Found %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a> <span class="stringliteral">&quot; bytes to download\n&quot;</span>,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;          <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>) {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="comment">/* At this point there is a bunch of data in the header &quot;cache&quot; that is</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">         actually body content, send it as body and then skip it. Do note</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">         that there may even be additional &quot;headers&quot; after the body. */</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <span class="keywordtype">size_t</span> chunk = pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a>;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keywordflow">if</span>(chunk &gt; (<span class="keywordtype">size_t</span>)<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment">/* The conversion from curl_off_t to size_t is always fine here */</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        chunk = (size_t)<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordflow">if</span>(!chunk) {</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="comment">/* no size, we&#39;re done with the data */</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="sendf_8h.html#aae18389dfefc98a5057629f6a46fd78f">CLIENTWRITE_BODY</a>, pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>, chunk);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;req.bytecount += chunk;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Written %zu bytes, %&quot;</span> <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#a263820a96504b97e1a6143aa4835a8b9">CURL_FORMAT_CURL_OFF_TU</a></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            <span class="stringliteral">&quot; bytes are left for transfer\n&quot;</span>, chunk, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> - chunk);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="comment">/* Have we used the entire cache or just part of it?*/</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a> &gt; chunk) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="comment">/* Only part of it so shrink the cache to fit the trailing data */</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        memmove(pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>, pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a> + chunk, pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a> - chunk);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a> -= chunk;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="comment">/* Free the cache */</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(pp-&gt;<a class="code" href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">cache</a>);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="comment">/* Reset the cache size */</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        pp-&gt;<a class="code" href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">cache_size</a> = 0;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      }</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;req.bytecount == <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      <span class="comment">/* The entire data is already transferred! */</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="comment">/* IMAP download */</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <a class="code" href="structdata.html">data</a>-&gt;req.maxdownload = <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    }</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  }</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">/* We don&#39;t know how to parse this line */</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(pp-&gt;<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed to parse FETCH response.&quot;</span>);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="comment">/* End of DO phase */</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">/* For final FETCH responses performed after the download */</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_fetch_final_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>,</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                                            <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                                            <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;{</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  (void)instate; <span class="comment">/* No use for this yet */</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="comment">/* End of DONE phase */</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;}</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">/* For APPEND responses */</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_append_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                       <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  (void)instate; <span class="comment">/* No use for this yet */</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="keywordflow">if</span>(imapcode != <span class="charliteral">&#39;+&#39;</span>) {</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">/* Set the progress upload size */</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <a class="code" href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="structdata.html">data</a>-&gt;state.infilesize);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="comment">/* IMAP upload */</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, NULL);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">/* End of DO phase */</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;}</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">/* For final APPEND responses performed after the upload */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_state_append_final_resp(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                             <span class="keywordtype">int</span> imapcode,</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                             <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a> instate)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;{</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  (void)instate; <span class="comment">/* No use for this yet */</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keywordflow">if</span>(imapcode != <a class="code" href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a>)</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a>;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="comment">/* End of DONE phase */</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_statemach_act(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;{</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordtype">int</span> imapcode;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordtype">size_t</span> nread = 0;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">/* Busy upgrading the connection; right now all I/O is SSL/TLS, not IMAP */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> == <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaad84f9beee436b2ca50801981333797b7">IMAP_UPGRADETLS</a>)</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">return</span> imap_perform_upgrade_tls(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">/* Flush any data that needs to be sent */</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="structpingpong.html#a4f9a725e7d24dbfe7b0574ce14671048">sendleft</a>)</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#a2f6c579918627b1add05e82015bad826">Curl_pp_flushsend</a>(pp);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">/* Read the response from the server */</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a37bd477ec46526ae33926df9e61e7051">Curl_pp_readresp</a>(sock, pp, &amp;imapcode, &amp;nread);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">/* Was there an error parsing the response line? */</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">if</span>(imapcode == -1)</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">if</span>(!imapcode)</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="comment">/* We have now received a full IMAP server response */</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordflow">switch</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaf6d1e90b5fcecb4a9baf757df9815110">IMAP_SERVERGREET</a>:</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_servergreet_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaca3968b75d65a456f48347d212d316a0">IMAP_CAPABILITY</a>:</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_capability_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa05191306d5de2126c93f02a62665a548">IMAP_STARTTLS</a>:</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_starttls_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa4b7258cc80f22b67f224f2ac97e703eb">IMAP_AUTHENTICATE</a>:</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_auth_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa9c6ca16e6c5af045bb8fcbc4ced2c796">IMAP_LOGIN</a>:</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_login_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaacbce467d1755f2653c268562a9c7a100">IMAP_LIST</a>:</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_listsearch_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa380a71f52c42edbafe4a66ec2ba26619">IMAP_SELECT</a>:</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_select_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1bfe1b2026d0357ee6ba25ea009a7f66">IMAP_FETCH</a>:</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_fetch_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaafe669e271a40f798003fd76c0eaf6e63">IMAP_FETCH_FINAL</a>:</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_fetch_final_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1d6b765d7df319a1b12e1ff92edc9f50">IMAP_APPEND</a>:</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_append_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaab873db8c58df0effed9d3fe4e0c5ae54">IMAP_APPEND_FINAL</a>:</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_append_final_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaef4439450032e719930d3db4cb1b74ac">IMAP_SEARCH</a>:</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_state_listsearch_resp(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, imapcode, imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a>);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa7a03ad57f81e95a60b8840401861ced2">IMAP_LOGOUT</a>:</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="comment">/* fallthrough, just stop! */</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="comment">/* internal error */</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    }</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  } <span class="keywordflow">while</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> != <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a> &amp;&amp; <a class="code" href="pingpong_8c.html#a73961c0abe7e8733e6b7364af2e84cfa">Curl_pp_moredata</a>(pp));</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">/* Called repeatedly until done from multi.c */</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_multi_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;{</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="keywordflow">if</span>((conn-&gt;<a class="code" href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">handler</a>-&gt;<a class="code" href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">flags</a> &amp; <a class="code" href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a>) &amp;&amp; !imapc-&gt;<a class="code" href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">ssldone</a>) {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="vtls_8h.html#a5ee046324452a0fe07e54818257fe04c">Curl_ssl_connect_nonblocking</a>(conn, <a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>, &amp;imapc-&gt;<a class="code" href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">ssldone</a>);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || !imapc-&gt;<a class="code" href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">ssldone</a>)</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  *done = (imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> == <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a>) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_block_statemach(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;{</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="keywordflow">while</span>(imapc-&gt;<a class="code" href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">state</a> != <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a> &amp;&amp; !<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">/* Allocate and initialize the struct IMAP for the current Curl_easy if</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">   required */</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_init(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;{</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_i_m_a_p.html">IMAP</a>), 1);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordflow">if</span>(!imap)</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;}</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">/* For the IMAP &quot;protocol connect&quot; and &quot;doing&quot; phases only */</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> imap_getsock(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *socks,</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                        <span class="keywordtype">int</span> numsocks)</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;{</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="pingpong_8c.html#aafa087a3d539d9b5e1257c083a4e93d2">Curl_pp_getsock</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>.<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, socks, numsocks);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;}</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment"> * imap_connect()</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment"> * This function should do everything that is to be considered a part of the</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment"> * connection phase.</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment"> * The variable &#39;done&#39; points to will be TRUE if the protocol-layer connect</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment"> * phase is done when this function returns, or FALSE if not.</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;{</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="keyword">struct </span><a class="code" href="structpingpong.html">pingpong</a> *pp = &amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to not done yet */</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">/* We always support persistent connections in IMAP */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <a class="code" href="connect_8h.html#acdca2a91749c4f2ca1805e482bad0f90">connkeep</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <span class="stringliteral">&quot;IMAP default&quot;</span>);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="comment">/* Set the default response time-out */</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">response_time</a> = <a class="code" href="urldata_8h.html#a0320d3ae0f4915a179d877818b3e2a05">RESP_TIMEOUT</a>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#a124ea1f6b5aa08b8938cdd3d8a5c4b9f">statemach_act</a> = imap_statemach_act;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#ad13b684e9f73f8d93d077003c97f5b43">endofresp</a> = imap_endofresp;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  pp-&gt;<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a> = <a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="comment">/* Set the default preferred authentication type and mechanism */</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> = <a class="code" href="imap_8h.html#aab02bcecc6c88fc5f85e458604f63ed3">IMAP_TYPE_ANY</a>;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <a class="code" href="curl__sasl_8c.html#a581b4391538871e4df80a243ec49d6a3">Curl_sasl_init</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>, &amp;saslimap);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="comment">/* Initialise the pingpong layer */</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <a class="code" href="pingpong_8c.html#afa377ab63385678cbf3059b1cd3f9aaa">Curl_pp_init</a>(pp);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="comment">/* Parse the URL options */</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_parse_url_options(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="comment">/* Start off waiting for the server greeting response */</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaf6d1e90b5fcecb4a9baf757df9815110">IMAP_SERVERGREET</a>);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">/* Start off with an response id of &#39;*&#39; */</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  strcpy(imapc-&gt;<a class="code" href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">resptag</a>, <span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_multi_statemach(<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, done);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;}</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment"> * imap_done()</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"> * The DONE function. This does what needs to be done after a single DO has</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"> * performed.</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment"> * Input argument is already checked for validity.</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> status,</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                          <span class="keywordtype">bool</span> premature)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;{</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  (void)premature;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <span class="keywordflow">if</span>(!imap)</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordflow">if</span>(status) {</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <a class="code" href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a>(conn, <span class="stringliteral">&quot;IMAP done with bad status&quot;</span>); <span class="comment">/* marked for closure */</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = status;         <span class="comment">/* use the already set error code */</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>-&gt;set.connect_only &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          (imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a> || imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a> || <a class="code" href="structdata.html">data</a>-&gt;set.upload ||</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;          <a class="code" href="structdata.html">data</a>-&gt;set.mimepost.kind != <a class="code" href="mime_8h.html#a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b">MIMEKIND_NONE</a>)) {</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="comment">/* Handle responses after FETCH or APPEND transfer has finished */</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>-&gt;set.upload &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;set.mimepost.kind == <a class="code" href="mime_8h.html#a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b">MIMEKIND_NONE</a>)</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaafe669e271a40f798003fd76c0eaf6e63">IMAP_FETCH_FINAL</a>);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">/* End the APPEND command first by sending an empty line */</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a>(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>.<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>(conn, <a class="code" href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaab873db8c58df0effed9d3fe4e0c5ae54">IMAP_APPEND_FINAL</a>);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    }</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="comment">/* Run the state-machine</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">       TODO: when the multi interface is used, this _really_ should be using</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">       the imap_multi_statemach function but we have no general support for</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">       non-blocking DONE operations!</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_block_statemach(conn);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  }</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">/* Cleanup our per-request based variables */</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a>);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a>);</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a>);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">custom_params</a>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">/* Clear the transfer mode for the next request */</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae843604f745769d50ec667afe96d10c5">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;}</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment"> * imap_perform()</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment"> * This is the actual DO function for IMAP. Fetch or append a message, or do</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment"> * other things according to the options previously setup.</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_perform(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *connected,</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                             <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;{</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="comment">/* This is IMAP and no proxy */</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="keywordtype">bool</span> selected = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase starts\n&quot;</span>));</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a5e855dcf947888f8f1730b0e9fc03c32">opt_no_body</a>) {</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="comment">/* Requested no body means no transfer */</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae843604f745769d50ec667afe96d10c5">transfer</a> = <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a>;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  }</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  *dophase_done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* not done yet */</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="comment">/* Determine if the requested mailbox (with the same UIDVALIDITY if set)</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">     has already been selected on this connection */</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> &amp;&amp; imapc-&gt;<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a> &amp;&amp;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;     <a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, imapc-&gt;<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>) &amp;&amp;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;     (!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a> || !imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a> ||</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      <a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a>, imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a>)))</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    selected = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="comment">/* Start the first command in the DO phase */</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#aff15b3af2d0a7aebbe20243098811fda">upload</a> || <a class="code" href="structdata.html">data</a>-&gt;set.mimepost.kind != <a class="code" href="mime_8h.html#a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b">MIMEKIND_NONE</a>)</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">/* APPEND can be executed directly */</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_append(conn);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; (selected || !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>))</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">/* Custom command using the same mailbox or no mailbox */</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_list(conn);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; selected &amp;&amp; (imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a> || imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>))</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">/* FETCH from the same mailbox */</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_fetch(conn);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> &amp;&amp; selected &amp;&amp; imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>)</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="comment">/* SEARCH the current mailbox */</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_search(conn);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> &amp;&amp; !selected &amp;&amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;         (imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> || imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a> || imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a> || imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>))</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="comment">/* SELECT the mailbox */</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_select(conn);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">/* LIST */</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform_list(conn);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="comment">/* Run the state-machine */</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_multi_statemach(conn, dophase_done);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  *connected = conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">tcpconnect</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="keywordflow">if</span>(*dophase_done)</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase is complete\n&quot;</span>));</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;}</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment"> * imap_do()</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment"> * This function is registered as &#39;curl_do&#39; function. It decodes the path</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"> * parts etc as a wrapper to the actual DO function (imap_perform).</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment"> * The input argument is already checked for validity.</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_do(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;{</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* default to false */</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="comment">/* Parse the URL path */</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_parse_url_path(conn);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="comment">/* Parse the custom request */</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_parse_custom_request(conn);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_regular_transfer(conn, done);</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;}</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment"> * imap_disconnect()</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment"> * Disconnect from an IMAP server. Cleanup protocol-specific per-connection</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment"> * resources. BLOCKING.</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_disconnect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> dead_connection)</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;{</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="comment">/* We cannot send quit unconditionally. If this connection is stale or</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">     bad in any way, sending quit and waiting around here will make the</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">     disconnect wait in vain and cause more problems than we need to. */</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="comment">/* The IMAP session may or may not have been allocated/setup at this</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">     point! */</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="keywordflow">if</span>(!dead_connection &amp;&amp; imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>.<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a> &amp;&amp; imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>.<a class="code" href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">conn</a>-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a6fbb8f80996d3921279d0314179a4958">protoconnstart</a>)</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordflow">if</span>(!imap_perform_logout(conn))</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      (void)imap_block_statemach(conn); <span class="comment">/* ignore errors on LOGOUT */</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="comment">/* Disconnect from the server */</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <a class="code" href="pingpong_8c.html#a6ba0ccd2a13cada0cffd6fa6c2ea98f6">Curl_pp_disconnect</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="comment">/* Cleanup the SASL module */</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <a class="code" href="curl__sasl_8c.html#a623ca310726f3a1e75c0aa92322d7f2a">Curl_sasl_cleanup</a>(conn, imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#aa0c7b537da5cdc37aa0b99dd760a281b">authused</a>);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="comment">/* Cleanup our connection based variables */</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imapc-&gt;<a class="code" href="structimap__conn.html#a30046f4126be10473e114d3036027b85">mailbox</a>);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(imapc-&gt;<a class="code" href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">mailbox_uidvalidity</a>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;}</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">/* Call this when the DO phase has completed */</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_dophase_done(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> connected)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;{</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">req</a>.<a class="code" href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">protop</a>;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  (void)connected;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae843604f745769d50ec667afe96d10c5">transfer</a> != <a class="code" href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a>)</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="comment">/* no data to transfer */</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <a class="code" href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a>(conn, -1, -1, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL, -1, NULL);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;}</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment">/* Called from multi.c while DOing */</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_doing(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;{</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_multi_statemach(conn, dophase_done);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase failed\n&quot;</span>));</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*dophase_done) {</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_dophase_done(conn, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> <span class="comment">/* not connected */</span>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;DO phase is complete\n&quot;</span>));</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  }</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;}</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment"> * imap_regular_transfer()</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment"> * The input argument is already checked for validity.</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment"> * Performs all commands done before a regular transfer between a local and a</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment"> * remote host.</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_regular_transfer(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                      <span class="keywordtype">bool</span> *dophase_done)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;{</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="keywordtype">bool</span> connected = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="comment">/* Make sure size is unknown at this point */</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;req.size = -1;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="comment">/* Set the progress data */</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <a class="code" href="progress_8c.html#a9458c724bbe21e16b9abf8f696a3916a">Curl_pgrsSetUploadCounter</a>(<a class="code" href="structdata.html">data</a>, 0);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <a class="code" href="progress_8c.html#afd65889574fb7bde6ffcec48b0d8debb">Curl_pgrsSetDownloadCounter</a>(<a class="code" href="structdata.html">data</a>, 0);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <a class="code" href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a>(<a class="code" href="structdata.html">data</a>, -1);</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <a class="code" href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a>(<a class="code" href="structdata.html">data</a>, -1);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="comment">/* Carry out the perform */</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_perform(conn, &amp;connected, dophase_done);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="comment">/* Perform post DO phase operations if necessary */</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; *dophase_done)</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_dophase_done(conn, connected);</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;}</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_setup_connection(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;{</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="comment">/* Initialise the IMAP layer */</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = imap_init(conn);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="comment">/* Clear the TLS upgraded flag */</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a67243eae05daae35cf8e0d3a49b9b8b9">tls_upgraded</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;}</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment"> * imap_sendf()</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment"> * Sends the formatted string as an IMAP command to the server.</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment"> * Designed to never block.</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_sendf(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;{</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordtype">char</span> *taggedfmt;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  va_list ap;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(fmt);</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="comment">/* Calculate the next command ID wrapping at 3 digits */</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#a67a2f8a87d834b5a00fc16b4f517ca30">cmdid</a> = (imapc-&gt;<a class="code" href="structimap__conn.html#a67a2f8a87d834b5a00fc16b4f517ca30">cmdid</a> + 1) % 1000;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="comment">/* Calculate the tag based on the connection ID and command ID */</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(imapc-&gt;<a class="code" href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">resptag</a>, <span class="keyword">sizeof</span>(imapc-&gt;<a class="code" href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">resptag</a>), <span class="stringliteral">&quot;%c%03d&quot;</span>,</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            <span class="charliteral">&#39;A&#39;</span> + <a class="code" href="warnless_8c.html#ad00eb8c7d08a3af99f84038736057606">curlx_sltosi</a>(conn-&gt;<a class="code" href="structconnectdata.html#a23709f8003b50c28fb59cd977ee23632">connection_id</a> % 26), imapc-&gt;<a class="code" href="structimap__conn.html#a67a2f8a87d834b5a00fc16b4f517ca30">cmdid</a>);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="comment">/* Prefix the format with the tag */</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  taggedfmt = <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s %s&quot;</span>, imapc-&gt;<a class="code" href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">resptag</a>, fmt);</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="keywordflow">if</span>(!taggedfmt)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="comment">/* Send the data with the tag */</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  va_start(ap, fmt);</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="pingpong_8c.html#a77b3262b262d7bb8d51c131078cd0f31">Curl_pp_vsendf</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">pp</a>, taggedfmt, ap);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  va_end(ap);</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(taggedfmt);</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;}</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment"> * imap_atom()</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"> * Checks the input string for characters that need escaping and returns an</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment"> * atom ready for sending to the server.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment"> * The returned string needs to be freed.</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *imap_atom(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="keywordtype">bool</span> escape_only)</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;{</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="comment">/* !checksrc! disable PARENBRACE 1 */</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> atom_specials[] = <span class="stringliteral">&quot;(){ %*]&quot;</span>;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *p1;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="keywordtype">char</span> *p2;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="keywordtype">size_t</span> backsp_count = 0;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="keywordtype">size_t</span> quote_count = 0;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordtype">bool</span> others_exists = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordtype">size_t</span> newlen = 0;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordtype">char</span> *newstr = NULL;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">/* Look for &quot;atom-specials&quot;, counting the backslash and quote characters as</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">     these will need escapping */</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  p1 = <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="keywordflow">while</span>(*p1) {</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">if</span>(*p1 == <span class="charliteral">&#39;\\&#39;</span>)</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      backsp_count++;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*p1 == <span class="charliteral">&#39;&quot;&#39;</span>)</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      quote_count++;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!escape_only) {</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *p3 = atom_specials;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keywordflow">while</span>(*p3 &amp;&amp; !others_exists) {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="keywordflow">if</span>(*p1 == *p3)</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;          others_exists = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        p3++;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      }</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    p1++;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="comment">/* Does the input contain any &quot;atom-special&quot; characters? */</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordflow">if</span>(!backsp_count &amp;&amp; !quote_count &amp;&amp; !others_exists)</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>);</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="comment">/* Calculate the new string length */</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  newlen = strlen(<a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) + backsp_count + quote_count + (escape_only ? 0 : 2);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">/* Allocate the new string */</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  newstr = (<span class="keywordtype">char</span> *) <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>((newlen + 1) * <span class="keyword">sizeof</span>(char));</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="keywordflow">if</span>(!newstr)</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="comment">/* Surround the string in quotes if necessary */</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  p2 = newstr;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordflow">if</span>(!escape_only) {</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    newstr[0] = <span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    newstr[newlen - 1] = <span class="charliteral">&#39;&quot;&#39;</span>;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    p2++;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  }</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="comment">/* Copy the string, escaping backslash and quote characters along the way */</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  p1 = <a class="code" href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="keywordflow">while</span>(*p1) {</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">if</span>(*p1 == <span class="charliteral">&#39;\\&#39;</span> || *p1 == <span class="charliteral">&#39;&quot;&#39;</span>) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      *p2 = <span class="charliteral">&#39;\\&#39;</span>;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      p2++;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    }</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;   *p2 = *p1;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    p1++;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    p2++;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  }</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">/* Terminate the string */</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  newstr[newlen] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">return</span> newstr;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;}</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment"> * imap_is_bchar()</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment"> * Portable test of whether the specified char is a &quot;bchar&quot; as defined in the</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment"> * grammar of RFC-5092.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> imap_is_bchar(<span class="keywordtype">char</span> ch)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;{</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="keywordflow">switch</span>(ch) {</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="comment">/* bchar */</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;/&#39;</span>:</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="comment">/* bchar -&gt; achar */</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;&amp;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;=&#39;</span>:</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="comment">/* bchar -&gt; achar -&gt; uchar -&gt; unreserved */</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>:</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>:</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;H&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;J&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;O&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;Q&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;j&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;_&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;~&#39;</span>:</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="comment">/* bchar -&gt; achar -&gt; uchar -&gt; sub-delims-sh */</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;$&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\&#39;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;(&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;)&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;*&#39;</span>:</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;,&#39;</span>:</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="comment">/* bchar -&gt; achar -&gt; uchar -&gt; pct-encoded */</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>: <span class="comment">/* HEXDIG chars are already included above */</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  }</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;}</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment"> * imap_parse_url_options()</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment"> * Parse the URL login options.</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_url_options(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;{</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <span class="keyword">struct </span><a class="code" href="structimap__conn.html">imap_conn</a> *imapc = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">proto</a>.<a class="code" href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">imapc</a>;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = conn-&gt;<a class="code" href="structconnectdata.html#a23dda8a6723d55183f77ce35788f5579">options</a>;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#a516c52d54469755ed8b9122e0285b446">resetprefs</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a> = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;=&#39;</span>)</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> + 1;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;;&#39;</span>)</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="stringliteral">&quot;AUTH=&quot;</span>, 5))</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl__sasl_8c.html#af3a36e703adbfc9eb39cd3ff314f8a3d">Curl_sasl_parse_url_auth_option</a>(&amp;imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>,</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                                               <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> - <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> == <span class="charliteral">&#39;;&#39;</span>)</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="keywordflow">switch</span>(imapc-&gt;<a class="code" href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">sasl</a>.<a class="code" href="struct_s_a_s_l.html#a996ab35cbdb005d788be0f75817b5112">prefmech</a>) {</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl__sasl_8h.html#a0d17b662c34d62263c4ac37d6409a231">SASL_AUTH_NONE</a>:</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> = <a class="code" href="imap_8h.html#a30b647e05d3dca30fa4034a9a14888a8">IMAP_TYPE_NONE</a>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl__sasl_8h.html#aec5d6836cac4e54d575a669afdf0dea3">SASL_AUTH_DEFAULT</a>:</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> = <a class="code" href="imap_8h.html#aab02bcecc6c88fc5f85e458604f63ed3">IMAP_TYPE_ANY</a>;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    imapc-&gt;<a class="code" href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">preftype</a> = <a class="code" href="imap_8h.html#ac149449ebe108fd43c875a8b3f9913bf">IMAP_TYPE_SASL</a>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment"> * imap_parse_url_path()</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment"> * Parse the URL path into separate path components.</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_url_path(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;{</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="comment">/* The imap struct is already initialised in imap_connect() */</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *begin = &amp;<a class="code" href="structdata.html">data</a>-&gt;state.up.path[1]; <span class="comment">/* skip leading slash */</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = begin;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="comment">/* See how much of the URL is a valid path and decode it */</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keywordflow">while</span>(imap_is_bchar(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != begin) {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="comment">/* Remove the trailing slash if present */</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *end = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="keywordflow">if</span>(end &gt; begin &amp;&amp; end[-1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      end--;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, begin, end - begin, &amp;imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a>, NULL,</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                            <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> = NULL;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <span class="comment">/* There can be any number of parameters in the form &quot;;NAME=VALUE&quot; */</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> == <span class="charliteral">&#39;;&#39;</span>) {</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordtype">size_t</span> valuelen;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="comment">/* Find the length of the name parameter */</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    begin = ++<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> != <span class="charliteral">&#39;=&#39;</span>)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordflow">if</span>(!*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="comment">/* Decode the name parameter */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, begin, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> - begin, &amp;<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="comment">/* Find the length of the value parameter */</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    begin = ++<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordflow">while</span>(imap_is_bchar(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    <span class="comment">/* Decode the value parameter */</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, begin, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> - begin, &amp;<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>, &amp;valuelen, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    }</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a>(<a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;IMAP URL parameter &#39;%s&#39; = &#39;%s&#39;\n&quot;</span>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>));</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="comment">/* Process the known hierarchical parameters (UIDVALIDITY, UID, SECTION and</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">       PARTIAL) stripping of the trailing slash character if it is present.</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">       Note: Unknown parameters trigger a URL_MALFORMAT error. */</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="stringliteral">&quot;UIDVALIDITY&quot;</span>) &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a>) {</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="keywordflow">if</span>(valuelen &gt; 0 &amp;&amp; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      imap-&gt;<a class="code" href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">uidvalidity</a> = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = NULL;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    }</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="stringliteral">&quot;UID&quot;</span>) &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a>) {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      <span class="keywordflow">if</span>(valuelen &gt; 0 &amp;&amp; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a> = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = NULL;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    }</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="stringliteral">&quot;MAILINDEX&quot;</span>) &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>) {</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keywordflow">if</span>(valuelen &gt; 0 &amp;&amp; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a> = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = NULL;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    }</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="stringliteral">&quot;SECTION&quot;</span>) &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a>) {</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <span class="keywordflow">if</span>(valuelen &gt; 0 &amp;&amp; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      imap-&gt;<a class="code" href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">section</a> = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = NULL;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <span class="stringliteral">&quot;PARTIAL&quot;</span>) &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a>) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keywordflow">if</span>(valuelen &gt; 0 &amp;&amp; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>[valuelen - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      imap-&gt;<a class="code" href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">partial</a> = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = NULL;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    }</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    }</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="comment">/* Does the URL contain a query parameter? Only valid when we have a mailbox</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">     and no UID as per RFC-5092 */</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keywordflow">if</span>(imap-&gt;<a class="code" href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">mailbox</a> &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">uid</a> &amp;&amp; !imap-&gt;<a class="code" href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">mindex</a>) {</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="comment">/* Get the query parameter, URL decoded */</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    (void)<a class="code" href="urlapi_8h.html#abfb2378e801e13033e70c3819d8afca1">curl_url_get</a>(<a class="code" href="structdata.html">data</a>-&gt;state.uh, <a class="code" href="urlapi_8h.html#aa61ba3e924e11f4a7f208aa051a5d2ebad44a6470deff9d6fc0b423aab47462e8">CURLUPART_QUERY</a>, &amp;imap-&gt;<a class="code" href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">query</a>,</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                       <a class="code" href="urlapi_8h.html#a454384246f1932a3493fa5eb9f671ffc">CURLU_URLDECODE</a>);</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  }</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="comment">/* Any extra stuff at the end of the URL is an error */</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordflow">if</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a>;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;}</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">/***********************************************************************</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment"> * imap_parse_custom_request()</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment"> * Parse the custom request.</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> imap_parse_custom_request(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;{</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_i_m_a_p.html">IMAP</a> *imap = <a class="code" href="structdata.html">data</a>-&gt;req.protop;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a> = <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a>];</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">/* URL decode the custom request */</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, 0, &amp;imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="comment">/* Extract the parameters if specified */</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *params = imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <span class="keywordflow">while</span>(*params &amp;&amp; *params != <span class="charliteral">&#39; &#39;</span>)</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        params++;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">if</span>(*params) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        imap-&gt;<a class="code" href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">custom_params</a> = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(params);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>[params - imap-&gt;<a class="code" href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">custom</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        <span class="keywordflow">if</span>(!imap-&gt;<a class="code" href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">custom_params</a>)</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    }</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  }</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;}</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_DISABLE_IMAP */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaaef4439450032e719930d3db4cb1b74ac"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaef4439450032e719930d3db4cb1b74ac">IMAP_SEARCH</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00047">imap.h:47</a></div></div>
<div class="ttc" id="structconnectdata_html_ab6f11cf5c5bc549e9f9af12fc65e2e23"><div class="ttname"><a href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">connectdata::ssl</a></div><div class="ttdeci">struct ssl_connect_data ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00885">urldata.h:885</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a15aced4a015c44ff454787debee23520"><div class="ttname"><a href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">Curl_easy::state</a></div><div class="ttdeci">struct UrlState state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01795">urldata.h:1795</a></div></div>
<div class="ttc" id="ftp_8c_html_a77812d4945cd21094debbd06962f0f01"><div class="ttname"><a href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a></div><div class="ttdeci">#define state(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00101">ftp.c:101</a></div></div>
<div class="ttc" id="sendf_8h_html_aae18389dfefc98a5057629f6a46fd78f"><div class="ttname"><a href="sendf_8h.html#aae18389dfefc98a5057629f6a46fd78f">CLIENTWRITE_BODY</a></div><div class="ttdeci">#define CLIENTWRITE_BODY</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00050">sendf.h:50</a></div></div>
<div class="ttc" id="struct_s_a_s_l_html_a85feab732c5c647f44a98be0879b4c07"><div class="ttname"><a href="struct_s_a_s_l.html#a85feab732c5c647f44a98be0879b4c07">SASL::authmechs</a></div><div class="ttdeci">unsigned int authmechs</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00104">curl_sasl.h:104</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="escape_8c_html_a11aa4921a19102059a1d94e2be15477a"><div class="ttname"><a href="escape_8c.html#a11aa4921a19102059a1d94e2be15477a">Curl_urldecode</a></div><div class="ttdeci">CURLcode Curl_urldecode(struct Curl_easy *data, const char *string, size_t length, char **ostring, size_t *olen, bool reject_ctrl)</div><div class="ttdef"><b>Definition:</b> <a href="escape_8c_source.html#l00147">escape.c:147</a></div></div>
<div class="ttc" id="curl_8h_html_adbc451757ed5aeebdff70d9517e9ff49"><div class="ttname"><a href="curl_8h.html#adbc451757ed5aeebdff70d9517e9ff49">curl_mime_headers</a></div><div class="ttdeci">CURL_EXTERN CURLcode curl_mime_headers(curl_mimepart *part, struct curl_slist *headers, int take_ownership)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01436">mime.c:1436</a></div></div>
<div class="ttc" id="structpingpong_html_a4f9a725e7d24dbfe7b0574ce14671048"><div class="ttname"><a href="structpingpong.html#a4f9a725e7d24dbfe7b0574ce14671048">pingpong::sendleft</a></div><div class="ttdeci">size_t sendleft</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00059">pingpong.h:59</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00536">curl.h:536</a></div></div>
<div class="ttc" id="structimap__conn_html_a409ee6664f95ae2631ba41d5e2e16a26"><div class="ttname"><a href="structimap__conn.html#a409ee6664f95ae2631ba41d5e2e16a26">imap_conn::login_disabled</a></div><div class="ttdeci">bool login_disabled</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00081">imap.h:81</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="pingpong_8h_html_aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961"><div class="ttname"><a href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652eada17477ba87a76ad5d9f9df52c717961">FTPTRANSFER_INFO</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00037">pingpong.h:37</a></div></div>
<div class="ttc" id="mime_8h_html_afdc5138da8e131f5e919d4f8e67ae172a52e324a18fd8b30fa3c3801991ecbded"><div class="ttname"><a href="mime_8h.html#afdc5138da8e131f5e919d4f8e67ae172a52e324a18fd8b30fa3c3801991ecbded">MIMESTRATEGY_MAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="mime_8h_source.html#l00063">mime.h:63</a></div></div>
<div class="ttc" id="struct_s_a_s_l_html_a996ab35cbdb005d788be0f75817b5112"><div class="ttname"><a href="struct_s_a_s_l.html#a996ab35cbdb005d788be0f75817b5112">SASL::prefmech</a></div><div class="ttdeci">unsigned int prefmech</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00105">curl_sasl.h:105</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="progress_8c_html_a9458c724bbe21e16b9abf8f696a3916a"><div class="ttname"><a href="progress_8c.html#a9458c724bbe21e16b9abf8f696a3916a">Curl_pgrsSetUploadCounter</a></div><div class="ttdeci">void Curl_pgrsSetUploadCounter(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00336">progress.c:336</a></div></div>
<div class="ttc" id="connect_8h_html_a0f98be540dd5a5f56c9ec98dc2489661"><div class="ttname"><a href="connect_8h.html#a0f98be540dd5a5f56c9ec98dc2489661">connclose</a></div><div class="ttdeci">#define connclose(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00145">connect.h:145</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_a6b1048327042c3ed90ad8c5e1cf5ef6ea031a2f7c13d80a40be33526d4577c843"><div class="ttname"><a href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea031a2f7c13d80a40be33526d4577c843">SASL_INPROGRESS</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00081">curl_sasl.h:81</a></div></div>
<div class="ttc" id="curl__sasl_8h_html"><div class="ttname"><a href="curl__sasl_8h.html">curl_sasl.h</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a6fbb8f80996d3921279d0314179a4958"><div class="ttname"><a href="struct_connect_bits.html#a6fbb8f80996d3921279d0314179a4958">ConnectBits::protoconnstart</a></div><div class="ttdeci">bool protoconnstart</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00400">urldata.h:400</a></div></div>
<div class="ttc" id="curl_8h_html_a30d3c27b363600b6748798f8b3a1ec75"><div class="ttname"><a href="curl_8h.html#a30d3c27b363600b6748798f8b3a1ec75">CURLPROTO_IMAP</a></div><div class="ttdeci">#define CURLPROTO_IMAP</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00877">curl.h:877</a></div></div>
<div class="ttc" id="warnless_8c_html_ad00eb8c7d08a3af99f84038736057606"><div class="ttname"><a href="warnless_8c.html#ad00eb8c7d08a3af99f84038736057606">curlx_sltosi</a></div><div class="ttdeci">int curlx_sltosi(long slnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00264">warnless.c:264</a></div></div>
<div class="ttc" id="structpingpong_html_afc0e964e626fa8bd851d96082f70eeb9"><div class="ttname"><a href="structpingpong.html#afc0e964e626fa8bd851d96082f70eeb9">pingpong::response_time</a></div><div class="ttdeci">long response_time</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00063">pingpong.h:63</a></div></div>
<div class="ttc" id="imap_8h_html_a30b647e05d3dca30fa4034a9a14888a8"><div class="ttname"><a href="imap_8h.html#a30b647e05d3dca30fa4034a9a14888a8">IMAP_TYPE_NONE</a></div><div class="ttdeci">#define IMAP_TYPE_NONE</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00095">imap.h:95</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="pingpong_8c_html_a6ba0ccd2a13cada0cffd6fa6c2ea98f6"><div class="ttname"><a href="pingpong_8c.html#a6ba0ccd2a13cada0cffd6fa6c2ea98f6">Curl_pp_disconnect</a></div><div class="ttdeci">CURLcode Curl_pp_disconnect(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00508">pingpong.c:508</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a623ca310726f3a1e75c0aa92322d7f2a"><div class="ttname"><a href="curl__sasl_8c.html#a623ca310726f3a1e75c0aa92322d7f2a">Curl_sasl_cleanup</a></div><div class="ttdeci">void Curl_sasl_cleanup(struct connectdata *conn, unsigned int authused)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00081">curl_sasl.c:81</a></div></div>
<div class="ttc" id="structimap__conn_html_afb7c402c854fcd5bb02fafc0ac0bed3a"><div class="ttname"><a href="structimap__conn.html#afb7c402c854fcd5bb02fafc0ac0bed3a">imap_conn::preauth</a></div><div class="ttdeci">bool preauth</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00075">imap.h:75</a></div></div>
<div class="ttc" id="imap_8c_html_adbaedd433cb50b17f37cf5772f9e3475"><div class="ttname"><a href="imap_8c.html#adbaedd433cb50b17f37cf5772f9e3475">IMAP_RESP_OK</a></div><div class="ttdeci">#define IMAP_RESP_OK</div><div class="ttdef"><b>Definition:</b> <a href="imap_8c_source.html#l00167">imap.c:167</a></div></div>
<div class="ttc" id="structimap__conn_html_a3460507a270b136ddbc58a0cb9c7ef6a"><div class="ttname"><a href="structimap__conn.html#a3460507a270b136ddbc58a0cb9c7ef6a">imap_conn::resptag</a></div><div class="ttdeci">char resptag[5]</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00079">imap.h:79</a></div></div>
<div class="ttc" id="mime_8h_html_a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b"><div class="ttname"><a href="mime_8h.html#a3f7ea952d37b502d03fb5d8f8b9d7101abe93c496b53ded1073ef46824c2e260b">MIMEKIND_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="mime_8h_source.html#l00039">mime.h:39</a></div></div>
<div class="ttc" id="struct_curl__handler_html"><div class="ttname"><a href="struct_curl__handler.html">Curl_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00628">urldata.h:628</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa9c6ca16e6c5af045bb8fcbc4ced2c796"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa9c6ca16e6c5af045bb8fcbc4ced2c796">IMAP_LOGIN</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00040">imap.h:40</a></div></div>
<div class="ttc" id="pingpong_8h_html_aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9"><div class="ttname"><a href="pingpong_8h.html#aa1cf969282409b2cbdfb2beade8b652ea7207fd3eff03eee6ed3b1d648523c3c9">FTPTRANSFER_BODY</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00036">pingpong.h:36</a></div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="urlapi_8h_html_abfb2378e801e13033e70c3819d8afca1"><div class="ttname"><a href="urlapi_8h.html#abfb2378e801e13033e70c3819d8afca1">curl_url_get</a></div><div class="ttdeci">CURL_EXTERN CURLUcode curl_url_get(CURLU *handle, CURLUPart what, char **part, unsigned int flags)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2urlapi_8c_source.html#l00920">urlapi.c:920</a></div></div>
<div class="ttc" id="structimap__conn_html_a67a2f8a87d834b5a00fc16b4f517ca30"><div class="ttname"><a href="structimap__conn.html#a67a2f8a87d834b5a00fc16b4f517ca30">imap_conn::cmdid</a></div><div class="ttdeci">int cmdid</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00078">imap.h:78</a></div></div>
<div class="ttc" id="structconnectdata_html_ae7924587f916593e1fb682086f298ce8"><div class="ttname"><a href="structconnectdata.html#ae7924587f916593e1fb682086f298ce8">connectdata::handler</a></div><div class="ttdeci">const struct Curl_handler * handler</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00905">urldata.h:905</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="pingpong_8c_html_a77b3262b262d7bb8d51c131078cd0f31"><div class="ttname"><a href="pingpong_8c.html#a77b3262b262d7bb8d51c131078cd0f31">Curl_pp_vsendf</a></div><div class="ttdeci">CURLcode Curl_pp_vsendf(struct pingpong *pp, const char *fmt, va_list args)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00160">pingpong.c:160</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9c2850d0cbdb8743ad056150ca51e191">CURLE_WEIRD_SERVER_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00467">curl.h:467</a></div></div>
<div class="ttc" id="pingpong_8c_html_a2f6c579918627b1add05e82015bad826"><div class="ttname"><a href="pingpong_8c.html#a2f6c579918627b1add05e82015bad826">Curl_pp_flushsend</a></div><div class="ttdeci">CURLcode Curl_pp_flushsend(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00484">pingpong.c:484</a></div></div>
<div class="ttc" id="mime_8h_html_ae6faa301cc4b37f4112e9acc984db066"><div class="ttname"><a href="mime_8h.html#ae6faa301cc4b37f4112e9acc984db066">MIME_BODY_ONLY</a></div><div class="ttdeci">#define MIME_BODY_ONLY</div><div class="ttdef"><b>Definition:</b> <a href="mime_8h_source.html#l00031">mime.h:31</a></div></div>
<div class="ttc" id="mime_8c_html_aa3774f4f669549973a0ff85d5372dc8f"><div class="ttname"><a href="mime_8c.html#aa3774f4f669549973a0ff85d5372dc8f">Curl_mime_prepare_headers</a></div><div class="ttdeci">CURLcode Curl_mime_prepare_headers(curl_mimepart *part, const char *contenttype, const char *disposition, enum mimestrategy strategy)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01678">mime.c:1678</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa6076e4cab6d67e43e7cedb0f409dba86">IMAP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00032">imap.h:32</a></div></div>
<div class="ttc" id="struct_user_defined_html_aff15b3af2d0a7aebbe20243098811fda"><div class="ttname"><a href="struct_user_defined.html#aff15b3af2d0a7aebbe20243098811fda">UserDefined::upload</a></div><div class="ttdeci">bool upload</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01640">urldata.h:1640</a></div></div>
<div class="ttc" id="structconnectdata_html_a67243eae05daae35cf8e0d3a49b9b8b9"><div class="ttname"><a href="structconnectdata.html#a67243eae05daae35cf8e0d3a49b9b8b9">connectdata::tls_upgraded</a></div><div class="ttdeci">bool tls_upgraded</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00892">urldata.h:892</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ab9b2b0dca8aa242d128640dbfde66fc6">CURLE_URL_MALFORMAT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00461">curl.h:461</a></div></div>
<div class="ttc" id="urldata_8h_html_a6e968b2dddd9a08d21f730c57b9ae0d6"><div class="ttname"><a href="urldata_8h.html#a6e968b2dddd9a08d21f730c57b9ae0d6">PORT_IMAPS</a></div><div class="ttdeci">#define PORT_IMAPS</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00040">urldata.h:40</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaad84f9beee436b2ca50801981333797b7"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaad84f9beee436b2ca50801981333797b7">IMAP_UPGRADETLS</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00037">imap.h:37</a></div></div>
<div class="ttc" id="curl_8h_html"><div class="ttname"><a href="curl_8h.html">curl.h</a></div></div>
<div class="ttc" id="vtls_8h_html_a5ee046324452a0fe07e54818257fe04c"><div class="ttname"><a href="vtls_8h.html#a5ee046324452a0fe07e54818257fe04c">Curl_ssl_connect_nonblocking</a></div><div class="ttdeci">#define Curl_ssl_connect_nonblocking(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00270">vtls.h:270</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a581b4391538871e4df80a243ec49d6a3"><div class="ttname"><a href="curl__sasl_8c.html#a581b4391538871e4df80a243ec49d6a3">Curl_sasl_init</a></div><div class="ttdeci">void Curl_sasl_init(struct SASL *sasl, const struct SASLproto *params)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00177">curl_sasl.c:177</a></div></div>
<div class="ttc" id="urldata_8h_html_a0ea7effcf0508ef4153127d686fabdcb"><div class="ttname"><a href="urldata_8h.html#a0ea7effcf0508ef4153127d686fabdcb">PORT_IMAP</a></div><div class="ttdeci">#define PORT_IMAP</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00039">urldata.h:39</a></div></div>
<div class="ttc" id="strcase_8h_html_a4b6a8324b9a93ddfa5413308a22bfa44"><div class="ttname"><a href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a></div><div class="ttdeci">#define strcasecompare(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00035">strcase.h:35</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a3cfa74a98ef25f2d28c419c13a9c8033"><div class="ttname"><a href="struct_i_m_a_p.html#a3cfa74a98ef25f2d28c419c13a9c8033">IMAP::mailbox</a></div><div class="ttdeci">char * mailbox</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00058">imap.h:58</a></div></div>
<div class="ttc" id="struct_user_defined_html_a5e855dcf947888f8f1730b0e9fc03c32"><div class="ttname"><a href="struct_user_defined.html#a5e855dcf947888f8f1730b0e9fc03c32">UserDefined::opt_no_body</a></div><div class="ttdeci">bool opt_no_body</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01639">urldata.h:1639</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_ae843604f745769d50ec667afe96d10c5"><div class="ttname"><a href="struct_i_m_a_p.html#ae843604f745769d50ec667afe96d10c5">IMAP::transfer</a></div><div class="ttdeci">curl_pp_transfer transfer</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00057">imap.h:57</a></div></div>
<div class="ttc" id="imap_8h_html_ac149449ebe108fd43c875a8b3f9913bf"><div class="ttname"><a href="imap_8h.html#ac149449ebe108fd43c875a8b3f9913bf">IMAP_TYPE_SASL</a></div><div class="ttdeci">#define IMAP_TYPE_SASL</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00092">imap.h:92</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a3dca40ce1e998420175eabe37246e05b"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a3dca40ce1e998420175eabe37246e05b">CURL_FORMAT_CURL_OFF_T</a></div><div class="ttdeci">#define CURL_FORMAT_CURL_OFF_T</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00395">system.h:395</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_aec5d6836cac4e54d575a669afdf0dea3"><div class="ttname"><a href="curl__sasl_8h.html#aec5d6836cac4e54d575a669afdf0dea3">SASL_AUTH_DEFAULT</a></div><div class="ttdeci">#define SASL_AUTH_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00044">curl_sasl.h:44</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaab873db8c58df0effed9d3fe4e0c5ae54"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaab873db8c58df0effed9d3fe4e0c5ae54">IMAP_APPEND_FINAL</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00046">imap.h:46</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaaca3968b75d65a456f48347d212d316a0"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaca3968b75d65a456f48347d212d316a0">IMAP_CAPABILITY</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00035">imap.h:35</a></div></div>
<div class="ttc" id="imap_8c_html_af0481802b10618d47e7c6ba936f300ea"><div class="ttname"><a href="imap_8c.html#af0481802b10618d47e7c6ba936f300ea">IMAP_RESP_NOT_OK</a></div><div class="ttdeci">#define IMAP_RESP_NOT_OK</div><div class="ttdef"><b>Definition:</b> <a href="imap_8c_source.html#l00168">imap.c:168</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a494e2b4279dc064f7ed1d0abd602b28d"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a494e2b4279dc064f7ed1d0abd602b28d">curl_off_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_OFF_T curl_off_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00442">system.h:442</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa380a71f52c42edbafe4a66ec2ba26619"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa380a71f52c42edbafe4a66ec2ba26619">IMAP_SELECT</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00042">imap.h:42</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a371e800af2726fd2bfffbe509fcc97ac"><div class="ttname"><a href="curl__sasl_8c.html#a371e800af2726fd2bfffbe509fcc97ac">Curl_sasl_start</a></div><div class="ttdeci">CURLcode Curl_sasl_start(struct SASL *sasl, struct connectdata *conn, bool force_ir, saslprogress *progress)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00253">curl_sasl.c:253</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_a0d17b662c34d62263c4ac37d6409a231"><div class="ttname"><a href="curl__sasl_8h.html#a0d17b662c34d62263c4ac37d6409a231">SASL_AUTH_NONE</a></div><div class="ttdeci">#define SASL_AUTH_NONE</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00042">curl_sasl.h:42</a></div></div>
<div class="ttc" id="curl_8h_html_aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986"><div class="ttname"><a href="curl_8h.html#aa5618da2459dcb16a18ed3552c17d33fa1b2e22a414d8dcc2d2c651bc59012986">CURLUSESSL_TRY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00783">curl.h:783</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="http_8h_html"><div class="ttname"><a href="http_8h.html">http.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a4bb3a85b09c8a63a0b526a24f9b1897a"><div class="ttname"><a href="structconnectdata.html#a4bb3a85b09c8a63a0b526a24f9b1897a">connectdata::passwd</a></div><div class="ttdeci">char * passwd</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00864">urldata.h:864</a></div></div>
<div class="ttc" id="urldata_8h_html_ad851f566879d5b859ec9181a21318b64"><div class="ttname"><a href="urldata_8h.html#ad851f566879d5b859ec9181a21318b64">PROTOPT_SSL</a></div><div class="ttdeci">#define PROTOPT_SSL</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00706">urldata.h:706</a></div></div>
<div class="ttc" id="structconnectdata_html_af3fd10c98c7a57afa3ae63e20ced23f5"><div class="ttname"><a href="structconnectdata.html#af3fd10c98c7a57afa3ae63e20ced23f5">connectdata::imapc</a></div><div class="ttdeci">struct imap_conn imapc</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01007">urldata.h:1007</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="imap_8h_html"><div class="ttname"><a href="imap_8h.html">imap.h</a></div></div>
<div class="ttc" id="structpingpong_html_a124ea1f6b5aa08b8938cdd3d8a5c4b9f"><div class="ttname"><a href="structpingpong.html#a124ea1f6b5aa08b8938cdd3d8a5c4b9f">pingpong::statemach_act</a></div><div class="ttdeci">CURLcode(* statemach_act)(struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00072">pingpong.h:72</a></div></div>
<div class="ttc" id="vtls_8h_html"><div class="ttname"><a href="vtls_8h.html">vtls.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00540">curl.h:540</a></div></div>
<div class="ttc" id="urlapi_8h_html_aa61ba3e924e11f4a7f208aa051a5d2ebad44a6470deff9d6fc0b423aab47462e8"><div class="ttname"><a href="urlapi_8h.html#aa61ba3e924e11f4a7f208aa051a5d2ebad44a6470deff9d6fc0b423aab47462e8">CURLUPART_QUERY</a></div><div class="ttdef"><b>Definition:</b> <a href="urlapi_8h_source.html#l00060">urlapi.h:60</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a556484f88f55ead798f328ca5e8d08bc"><div class="ttname"><a href="struct_i_m_a_p.html#a556484f88f55ead798f328ca5e8d08bc">IMAP::uid</a></div><div class="ttdeci">char * uid</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00060">imap.h:60</a></div></div>
<div class="ttc" id="mime_8c_html_a421afd16d330a7d51f13ec1aecca05be"><div class="ttname"><a href="mime_8c.html#a421afd16d330a7d51f13ec1aecca05be">Curl_mime_read</a></div><div class="ttdeci">size_t Curl_mime_read(char *buffer, size_t size, size_t nitems, void *instream)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01532">mime.c:1532</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curlx_8c_html_af6458f5d187f1d7c82fb9ea7ef634b44"><div class="ttname"><a href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a></div><div class="ttdeci">#define ZERO_NULL</div><div class="ttdef"><b>Definition:</b> <a href="curlx_8c_source.html#l00131">curlx.c:131</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa7a03ad57f81e95a60b8840401861ced2"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa7a03ad57f81e95a60b8840401861ced2">IMAP_LOGOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00048">imap.h:48</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a3e48e0195eb27ce292195e9133c70a18">CURLE_UPLOAD_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00491">curl.h:491</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a8a13221afd448ab0b91f021b4f5ec7c7"><div class="ttname"><a href="struct_curl__easy.html#a8a13221afd448ab0b91f021b4f5ec7c7">Curl_easy::req</a></div><div class="ttdeci">struct SingleRequest req</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01787">urldata.h:1787</a></div></div>
<div class="ttc" id="progress_8h_html"><div class="ttname"><a href="progress_8h.html">progress.h</a></div></div>
<div class="ttc" id="structssl__connect__data_html_ad63d8e461921062845bbf07dfc0007c5"><div class="ttname"><a href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">ssl_connect_data::use</a></div><div class="ttdeci">bool use</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00201">urldata.h:201</a></div></div>
<div class="ttc" id="output_8d_html_a7bcb6a773be04cbd4890bfe10fa42696"><div class="ttname"><a href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a></div><div class="ttdeci">Long you can use specifier.That variable will be replaced with the current string for the URL being fetched.Like if you specify two URLs on the same command line</div><div class="ttdef"><b>Definition:</b> <a href="output_8d_source.html#l00008">output.d:8</a></div></div>
<div class="ttc" id="transfer_8c_html_a8ccd1948f2a90c90b6fd1ac993e44a32"><div class="ttname"><a href="transfer_8c.html#a8ccd1948f2a90c90b6fd1ac993e44a32">Curl_setup_transfer</a></div><div class="ttdeci">void Curl_setup_transfer(struct connectdata *conn, int sockindex, curl_off_t size, bool getheader, curl_off_t *bytecountp, int writesockindex, curl_off_t *writecountp)</div><div class="ttdef"><b>Definition:</b> <a href="transfer_8c_source.html#l01743">transfer.c:1743</a></div></div>
<div class="ttc" id="unit1398_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="unit1398_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00033">unit1398.c:33</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a0091f833e532479d6510f72639f726ef"><div class="ttname"><a href="struct_connect_bits.html#a0091f833e532479d6510f72639f726ef">ConnectBits::tcpconnect</a></div><div class="ttdeci">bool tcpconnect[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00398">urldata.h:398</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaacbce467d1755f2653c268562a9c7a100"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaacbce467d1755f2653c268562a9c7a100">IMAP_LIST</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00041">imap.h:41</a></div></div>
<div class="ttc" id="mime_8c_html_a18951691569e3c259cba64edf1d3bd4b"><div class="ttname"><a href="mime_8c.html#a18951691569e3c259cba64edf1d3bd4b">Curl_mime_add_header</a></div><div class="ttdeci">CURLcode Curl_mime_add_header(struct curl_slist **slp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01610">mime.c:1610</a></div></div>
<div class="ttc" id="structpingpong_html_ad13b684e9f73f8d93d077003c97f5b43"><div class="ttname"><a href="structpingpong.html#ad13b684e9f73f8d93d077003c97f5b43">pingpong::endofresp</a></div><div class="ttdeci">bool(* endofresp)(struct connectdata *conn, char *ptr, size_t len, int *code)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00074">pingpong.h:74</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa4b7258cc80f22b67f224f2ac97e703eb"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa4b7258cc80f22b67f224f2ac97e703eb">IMAP_AUTHENTICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00039">imap.h:39</a></div></div>
<div class="ttc" id="mime_8h_html"><div class="ttname"><a href="mime_8h.html">mime.h</a></div></div>
<div class="ttc" id="pingpong_8c_html_ac23a9a0836693c1ec2eb24ac53123391"><div class="ttname"><a href="pingpong_8c.html#ac23a9a0836693c1ec2eb24ac53123391">Curl_pp_statemach</a></div><div class="ttdeci">CURLcode Curl_pp_statemach(struct pingpong *pp, bool block)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00080">pingpong.c:80</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaafe669e271a40f798003fd76c0eaf6e63"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaafe669e271a40f798003fd76c0eaf6e63">IMAP_FETCH_FINAL</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00044">imap.h:44</a></div></div>
<div class="ttc" id="imap_8c_html_a36b324474a9d2730691634beebff39f7"><div class="ttname"><a href="imap_8c.html#a36b324474a9d2730691634beebff39f7">imap_to_imaps</a></div><div class="ttdeci">#define imap_to_imaps(x)</div><div class="ttdef"><b>Definition:</b> <a href="imap_8c_source.html#l00193">imap.c:193</a></div></div>
<div class="ttc" id="mime_8c_html_a16da9e4dbf38be0096a6c63bd408c39c"><div class="ttname"><a href="mime_8c.html#a16da9e4dbf38be0096a6c63bd408c39c">Curl_mime_rewind</a></div><div class="ttdeci">CURLcode Curl_mime_rewind(curl_mimepart *part)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01541">mime.c:1541</a></div></div>
<div class="ttc" id="structimap__conn_html_ab491adc78fa239cdd04f5cfb9e018a39"><div class="ttname"><a href="structimap__conn.html#ab491adc78fa239cdd04f5cfb9e018a39">imap_conn::mailbox_uidvalidity</a></div><div class="ttdeci">char * mailbox_uidvalidity</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00084">imap.h:84</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a36086b5d94c661053ac2a51cb70b8fa7"><div class="ttname"><a href="struct_i_m_a_p.html#a36086b5d94c661053ac2a51cb70b8fa7">IMAP::custom</a></div><div class="ttdeci">char * custom</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00065">imap.h:65</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a0318109baab696da473aef3b184fe185"><div class="ttname"><a href="curl__sasl_8c.html#a0318109baab696da473aef3b184fe185">Curl_sasl_continue</a></div><div class="ttdeci">CURLcode Curl_sasl_continue(struct SASL *sasl, struct connectdata *conn, int code, saslprogress *progress)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00410">curl_sasl.c:410</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_a6b1048327042c3ed90ad8c5e1cf5ef6e"><div class="ttname"><a href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6e">saslprogress</a></div><div class="ttdeci">saslprogress</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00079">curl_sasl.h:79</a></div></div>
<div class="ttc" id="struct_s_a_s_lproto_html"><div class="ttname"><a href="struct_s_a_s_lproto.html">SASLproto</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00086">curl_sasl.h:86</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a8f38e38285b60bb2be1df3be02fa5ecd"><div class="ttname"><a href="struct_i_m_a_p.html#a8f38e38285b60bb2be1df3be02fa5ecd">IMAP::custom_params</a></div><div class="ttdeci">char * custom_params</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00066">imap.h:66</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a0b0d042ef268f40c3ff3568c4769c077"><div class="ttname"><a href="curl__sasl_8c.html#a0b0d042ef268f40c3ff3568c4769c077">Curl_sasl_can_authenticate</a></div><div class="ttdeci">bool Curl_sasl_can_authenticate(struct SASL *sasl, struct connectdata *conn)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00235">curl_sasl.c:235</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_ab5ca8ef10cc46798d01ef17b0babb957"><div class="ttname"><a href="curl__sasl_8c.html#ab5ca8ef10cc46798d01ef17b0babb957">Curl_sasl_decode_mech</a></div><div class="ttdeci">unsigned int Curl_sasl_decode_mech(const char *ptr, size_t maxlen, size_t *len)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00117">curl_sasl.c:117</a></div></div>
<div class="ttc" id="strtoofft_8c_html_a3c9f5c063165fc15454feac4def889d7"><div class="ttname"><a href="strtoofft_8c.html#a3c9f5c063165fc15454feac4def889d7">curlx_strtoofft</a></div><div class="ttdeci">CURLofft curlx_strtoofft(const char *str, char **endp, int base, curl_off_t *num)</div><div class="ttdef"><b>Definition:</b> <a href="strtoofft_8c_source.html#l00215">strtoofft.c:215</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa1bfe1b2026d0357ee6ba25ea009a7f66"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1bfe1b2026d0357ee6ba25ea009a7f66">IMAP_FETCH</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00043">imap.h:43</a></div></div>
<div class="ttc" id="strcase_8h_html_a48c605aaef9b3681c41d91096b6baad0"><div class="ttname"><a href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a></div><div class="ttdeci">#define strncasecompare(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00036">strcase.h:36</a></div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="remote-name_8d_html_aa335f8bb20424b03700f57b150bf0aa6"><div class="ttname"><a href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a></div><div class="ttdeci">Long the path is cut off.The file will be saved in the current working directory.If you want the file saved in a different make sure you change the current working directory before invoking curl with this option.The remote file name to use for saving is extracted from the given nothing and if it already exists it will be overwritten.If you want the server to be able to choose the file name refer to remote header name which can be used in addition to this option.If the server chooses a file name and that name already exists it will not be overwritten.There is no URL decoding done on the file name.If it has or other URL encoded parts of the name</div><div class="ttdef"><b>Definition:</b> <a href="remote-name_8d_source.html#l00006">remote-name.d:6</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a807aec0dfce25fe10b6d54c6843ceecb">CURLE_QUOTE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00487">curl.h:487</a></div></div>
<div class="ttc" id="curl_8h_html_a2431e24f2138b8074ffe85acace52384"><div class="ttname"><a href="curl_8h.html#a2431e24f2138b8074ffe85acace52384">CURLPROTO_IMAPS</a></div><div class="ttdeci">#define CURLPROTO_IMAPS</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00878">curl.h:878</a></div></div>
<div class="ttc" id="structconnectdata_html_a23709f8003b50c28fb59cd977ee23632"><div class="ttname"><a href="structconnectdata.html#a23709f8003b50c28fb59cd977ee23632">connectdata::connection_id</a></div><div class="ttdeci">long connection_id</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00806">urldata.h:806</a></div></div>
<div class="ttc" id="strerror_8h_html"><div class="ttname"><a href="strerror_8h.html">strerror.h</a></div></div>
<div class="ttc" id="imap_8c_html_ae276e4e81c4afa813d9324d62421bff8"><div class="ttname"><a href="imap_8c.html#ae276e4e81c4afa813d9324d62421bff8">Curl_handler_imap</a></div><div class="ttdeci">const struct Curl_handler Curl_handler_imap</div><div class="ttdef"><b>Definition:</b> <a href="imap_8c_source.html#l00117">imap.c:117</a></div></div>
<div class="ttc" id="structimap__conn_html_a9712a9bb41d0fc31ce92ceabbb543d58"><div class="ttname"><a href="structimap__conn.html#a9712a9bb41d0fc31ce92ceabbb543d58">imap_conn::pp</a></div><div class="ttdeci">struct pingpong pp</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00072">imap.h:72</a></div></div>
<div class="ttc" id="progress_8c_html_a82906bd19baedaf94d95274dd2371b22"><div class="ttname"><a href="progress_8c.html#a82906bd19baedaf94d95274dd2371b22">Curl_pgrsSetUploadSize</a></div><div class="ttdeci">void Curl_pgrsSetUploadSize(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00353">progress.c:353</a></div></div>
<div class="ttc" id="structimap__conn_html_af67d2b9f56c485d016107263531d9fc6"><div class="ttname"><a href="structimap__conn.html#af67d2b9f56c485d016107263531d9fc6">imap_conn::tls_supported</a></div><div class="ttdeci">bool tls_supported</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00080">imap.h:80</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_a263820a96504b97e1a6143aa4835a8b9"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#a263820a96504b97e1a6143aa4835a8b9">CURL_FORMAT_CURL_OFF_TU</a></div><div class="ttdeci">#define CURL_FORMAT_CURL_OFF_TU</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00396">system.h:396</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a4dabe5a34a618b55e0d3bc4e85c0a2f0">CURLE_REMOTE_FILE_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00557">curl.h:557</a></div></div>
<div class="ttc" id="struct_s_a_s_l_html_aa0c7b537da5cdc37aa0b99dd760a281b"><div class="ttname"><a href="struct_s_a_s_l.html#aa0c7b537da5cdc37aa0b99dd760a281b">SASL::authused</a></div><div class="ttdeci">unsigned int authused</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00106">curl_sasl.h:106</a></div></div>
<div class="ttc" id="progress_8c_html_a00f01952b08507f31def8af5b088e53f"><div class="ttname"><a href="progress_8c.html#a00f01952b08507f31def8af5b088e53f">Curl_pgrsSetDownloadSize</a></div><div class="ttdeci">void Curl_pgrsSetDownloadSize(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00341">progress.c:341</a></div></div>
<div class="ttc" id="strtoofft_8h_html"><div class="ttname"><a href="strtoofft_8h.html">strtoofft.h</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a2552e76060104849e037c5cfe3c091cb"><div class="ttname"><a href="struct_i_m_a_p.html#a2552e76060104849e037c5cfe3c091cb">IMAP::section</a></div><div class="ttdeci">char * section</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00062">imap.h:62</a></div></div>
<div class="ttc" id="curl_8h_html_a7516630ec17f247697dd3272be7ada74"><div class="ttname"><a href="curl_8h.html#a7516630ec17f247697dd3272be7ada74">curl_read_callback</a></div><div class="ttdeci">size_t(* curl_read_callback)(char *buffer, size_t size, size_t nitems, void *instream)</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00358">curl.h:358</a></div></div>
<div class="ttc" id="structimap__conn_html_a30046f4126be10473e114d3036027b85"><div class="ttname"><a href="structimap__conn.html#a30046f4126be10473e114d3036027b85">imap_conn::mailbox</a></div><div class="ttdeci">char * mailbox</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00083">imap.h:83</a></div></div>
<div class="ttc" id="structconnectdata_html_a23dda8a6723d55183f77ce35788f5579"><div class="ttname"><a href="structconnectdata.html#a23dda8a6723d55183f77ce35788f5579">connectdata::options</a></div><div class="ttdeci">char * options</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00865">urldata.h:865</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_a6b1048327042c3ed90ad8c5e1cf5ef6ea1de9500c71f5d22637fce8b383c8cf19"><div class="ttname"><a href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea1de9500c71f5d22637fce8b383c8cf19">SASL_DONE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00082">curl_sasl.h:82</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="multiif_8h_html"><div class="ttname"><a href="multiif_8h.html">multiif.h</a></div></div>
<div class="ttc" id="sendf_8c_html_ad59954133649b7538b387f940b86024f"><div class="ttname"><a href="sendf_8c.html#ad59954133649b7538b387f940b86024f">Curl_client_write</a></div><div class="ttdeci">CURLcode Curl_client_write(struct connectdata *conn, int type, char *ptr, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00651">sendf.c:651</a></div></div>
<div class="ttc" id="memdebug_8h_html_a795660f73c902cc80ac0fe6cda0dbd1c"><div class="ttname"><a href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a></div><div class="ttdeci">#define Curl_safefree(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="memdebug_8h_source.html#l00176">memdebug.h:176</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="structpingpong_html_a3114f4d2dc54a2816b07d3688e425a43"><div class="ttname"><a href="structpingpong.html#a3114f4d2dc54a2816b07d3688e425a43">pingpong::cache_size</a></div><div class="ttdeci">size_t cache_size</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00050">pingpong.h:50</a></div></div>
<div class="ttc" id="pingpong_8c_html_aafa087a3d539d9b5e1257c083a4e93d2"><div class="ttname"><a href="pingpong_8c.html#aafa087a3d539d9b5e1257c083a4e93d2">Curl_pp_getsock</a></div><div class="ttdeci">int Curl_pp_getsock(struct pingpong *pp, curl_socket_t *socks, int numsocks)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00464">pingpong.c:464</a></div></div>
<div class="ttc" id="pingpong_8c_html_a73961c0abe7e8733e6b7364af2e84cfa"><div class="ttname"><a href="pingpong_8c.html#a73961c0abe7e8733e6b7364af2e84cfa">Curl_pp_moredata</a></div><div class="ttdeci">bool Curl_pp_moredata(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00515">pingpong.c:515</a></div></div>
<div class="ttc" id="mime_8c_html_a5d447429cc681c949f0a2b9c60bebdae"><div class="ttname"><a href="mime_8c.html#a5d447429cc681c949f0a2b9c60bebdae">Curl_mime_size</a></div><div class="ttdeci">curl_off_t Curl_mime_size(curl_mimepart *part)</div><div class="ttdef"><b>Definition:</b> <a href="mime_8c_source.html#l01587">mime.c:1587</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3e3dfee99c81f563d18ef4626d8886e1"><div class="ttname"><a href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a></div><div class="ttdeci">#define aprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00046">curl_printf.h:46</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html"><div class="ttname"><a href="struct_i_m_a_p.html">IMAP</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00056">imap.h:56</a></div></div>
<div class="ttc" id="struct_single_request_html_a5803af0f75195ad74badb6ced9b24b16"><div class="ttname"><a href="struct_single_request.html#a5803af0f75195ad74badb6ced9b24b16">SingleRequest::protop</a></div><div class="ttdeci">void * protop</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00619">urldata.h:619</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fafe604c42ae587594510842a54ace673e">STRING_CUSTOMREQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01404">urldata.h:1404</a></div></div>
<div class="ttc" id="urldata_8h_html_a0320d3ae0f4915a179d877818b3e2a05"><div class="ttname"><a href="urldata_8h.html#a0320d3ae0f4915a179d877818b3e2a05">RESP_TIMEOUT</a></div><div class="ttdeci">#define RESP_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00080">urldata.h:80</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="struct_s_a_s_l_html_a516c52d54469755ed8b9122e0285b446"><div class="ttname"><a href="struct_s_a_s_l.html#a516c52d54469755ed8b9122e0285b446">SASL::resetprefs</a></div><div class="ttdeci">bool resetprefs</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00107">curl_sasl.h:107</a></div></div>
<div class="ttc" id="transfer_8c_html_a0649a25288fefe787c7bedddadb8a31d"><div class="ttname"><a href="transfer_8c.html#a0649a25288fefe787c7bedddadb8a31d">Curl_checkheaders</a></div><div class="ttdeci">char * Curl_checkheaders(const struct connectdata *conn, const char *thisheader)</div><div class="ttdef"><b>Definition:</b> <a href="transfer_8c_source.html#l00093">transfer.c:93</a></div></div>
<div class="ttc" id="structimap__conn_html"><div class="ttname"><a href="structimap__conn.html">imap_conn</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00071">imap.h:71</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_ae03dd8f9fee4884d27afc6c58c764e7b"><div class="ttname"><a href="struct_i_m_a_p.html#ae03dd8f9fee4884d27afc6c58c764e7b">IMAP::mindex</a></div><div class="ttdeci">char * mindex</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00061">imap.h:61</a></div></div>
<div class="ttc" id="structpingpong_html_ac6242b076d5ebd5ff7c2325aeebcea36"><div class="ttname"><a href="structpingpong.html#ac6242b076d5ebd5ff7c2325aeebcea36">pingpong::cache</a></div><div class="ttdeci">char * cache</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00049">pingpong.h:49</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="progress_8c_html_afd65889574fb7bde6ffcec48b0d8debb"><div class="ttname"><a href="progress_8c.html#afd65889574fb7bde6ffcec48b0d8debb">Curl_pgrsSetDownloadCounter</a></div><div class="ttdeci">void Curl_pgrsSetDownloadCounter(struct Curl_easy *data, curl_off_t size)</div><div class="ttdef"><b>Definition:</b> <a href="progress_8c_source.html#l00306">progress.c:306</a></div></div>
<div class="ttc" id="connect_8h_html_acdca2a91749c4f2ca1805e482bad0f90"><div class="ttname"><a href="connect_8h.html#acdca2a91749c4f2ca1805e482bad0f90">connkeep</a></div><div class="ttdeci">#define connkeep(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8h_source.html#l00146">connect.h:146</a></div></div>
<div class="ttc" id="urlapi_8h_html_a454384246f1932a3493fa5eb9f671ffc"><div class="ttname"><a href="urlapi_8h.html#a454384246f1932a3493fa5eb9f671ffc">CURLU_URLDECODE</a></div><div class="ttdeci">#define CURLU_URLDECODE</div><div class="ttdef"><b>Definition:</b> <a href="urlapi_8h_source.html#l00073">urlapi.h:73</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a5626b2fd54a23691539bf7babc9c2841"><div class="ttname"><a href="struct_i_m_a_p.html#a5626b2fd54a23691539bf7babc9c2841">IMAP::query</a></div><div class="ttdeci">char * query</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00064">imap.h:64</a></div></div>
<div class="ttc" id="pingpong_8c_html_afa377ab63385678cbf3059b1cd3f9aaa"><div class="ttname"><a href="pingpong_8c.html#afa377ab63385678cbf3059b1cd3f9aaa">Curl_pp_init</a></div><div class="ttdeci">void Curl_pp_init(struct pingpong *pp)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00139">pingpong.c:139</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="structimap__conn_html_a5c3f48d09eb40719de673df06e330519"><div class="ttname"><a href="structimap__conn.html#a5c3f48d09eb40719de673df06e330519">imap_conn::ssldone</a></div><div class="ttdeci">bool ssldone</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00074">imap.h:74</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_acc3e9b1176bd8c62c4fe0e017007e719"><div class="ttname"><a href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a></div><div class="ttdeci">#define ISDIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00065">curl_ctype.h:65</a></div></div>
<div class="ttc" id="struct_curl__handler_html_a2fc887b2697c63980406a19108b82a24"><div class="ttname"><a href="struct_curl__handler.html#a2fc887b2697c63980406a19108b82a24">Curl_handler::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00702">urldata.h:702</a></div></div>
<div class="ttc" id="transfer_8h_html"><div class="ttname"><a href="transfer_8h.html">transfer.h</a></div></div>
<div class="ttc" id="structpingpong_html_a522d890c9b0b6e9edbc977e9543ef362"><div class="ttname"><a href="structpingpong.html#a522d890c9b0b6e9edbc977e9543ef362">pingpong::conn</a></div><div class="ttdeci">struct connectdata * conn</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00066">pingpong.h:66</a></div></div>
<div class="ttc" id="structimap__conn_html_a98620c8dfd27fb2fd0be3a4de5bb4319"><div class="ttname"><a href="structimap__conn.html#a98620c8dfd27fb2fd0be3a4de5bb4319">imap_conn::sasl</a></div><div class="ttdeci">struct SASL sasl</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00076">imap.h:76</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_aeb46e69bf08a2603006fccd49e90dd46"><div class="ttname"><a href="struct_i_m_a_p.html#aeb46e69bf08a2603006fccd49e90dd46">IMAP::partial</a></div><div class="ttdeci">char * partial</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00063">imap.h:63</a></div></div>
<div class="ttc" id="escape_8h_html"><div class="ttname"><a href="escape_8h.html">escape.h</a></div></div>
<div class="ttc" id="struct_i_m_a_p_html_a416fce2e1931472400c6d56bb5270ae9"><div class="ttname"><a href="struct_i_m_a_p.html#a416fce2e1931472400c6d56bb5270ae9">IMAP::uidvalidity</a></div><div class="ttdeci">char * uidvalidity</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00059">imap.h:59</a></div></div>
<div class="ttc" id="pingpong_8c_html_a72d99a85630458817725215f758898b6"><div class="ttname"><a href="pingpong_8c.html#a72d99a85630458817725215f758898b6">Curl_pp_sendf</a></div><div class="ttdeci">CURLcode Curl_pp_sendf(struct pingpong *pp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00253">pingpong.c:253</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="structconnectdata_html_a347307932d5d64be48527b2f3ed666ca"><div class="ttname"><a href="structconnectdata.html#a347307932d5d64be48527b2f3ed666ca">connectdata::proto</a></div><div class="ttdeci">union connectdata::@45 proto</div></div>
<div class="ttc" id="urldata_8h_html_a7dc3bffda7491b001e405e434493b896"><div class="ttname"><a href="urldata_8h.html#a7dc3bffda7491b001e405e434493b896">PROTOPT_URLOPTIONS</a></div><div class="ttdeci">#define PROTOPT_URLOPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00723">urldata.h:723</a></div></div>
<div class="ttc" id="imap_8h_html_aab02bcecc6c88fc5f85e458604f63ed3"><div class="ttname"><a href="imap_8h.html#aab02bcecc6c88fc5f85e458604f63ed3">IMAP_TYPE_ANY</a></div><div class="ttdeci">#define IMAP_TYPE_ANY</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00096">imap.h:96</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_af3a36e703adbfc9eb39cd3ff314f8a3d"><div class="ttname"><a href="curl__sasl_8c.html#af3a36e703adbfc9eb39cd3ff314f8a3d">Curl_sasl_parse_url_auth_option</a></div><div class="ttdeci">CURLcode Curl_sasl_parse_url_auth_option(struct SASL *sasl, const char *value, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00145">curl_sasl.c:145</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1ea"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1ea">imapstate</a></div><div class="ttdeci">imapstate</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00031">imap.h:31</a></div></div>
<div class="ttc" id="struct_url_state_html_a049af7985a282087c2a21aa90cee0e1c"><div class="ttname"><a href="struct_url_state.html#a049af7985a282087c2a21aa90cee0e1c">UrlState::buffer</a></div><div class="ttdeci">char * buffer</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01258">urldata.h:1258</a></div></div>
<div class="ttc" id="pingpong_8c_html_a37bd477ec46526ae33926df9e61e7051"><div class="ttname"><a href="pingpong_8c.html#a37bd477ec46526ae33926df9e61e7051">Curl_pp_readresp</a></div><div class="ttdeci">CURLcode Curl_pp_readresp(curl_socket_t sockfd, struct pingpong *pp, int *code, size_t *size)</div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8c_source.html#l00272">pingpong.c:272</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="structimap__conn_html_ae476e7a8fa03da99f508812c1d8196d6"><div class="ttname"><a href="structimap__conn.html#ae476e7a8fa03da99f508812c1d8196d6">imap_conn::preftype</a></div><div class="ttdeci">unsigned int preftype</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00077">imap.h:77</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="structimap__conn_html_ac7e06fca7ab2f13f020fa5a5c15864a7"><div class="ttname"><a href="structimap__conn.html#ac7e06fca7ab2f13f020fa5a5c15864a7">imap_conn::ir_supported</a></div><div class="ttdeci">bool ir_supported</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00082">imap.h:82</a></div></div>
<div class="ttc" id="imap_8h_html_aba3ad26835d0af88926a323546998304"><div class="ttname"><a href="imap_8h.html#aba3ad26835d0af88926a323546998304">Curl_handler_imaps</a></div><div class="ttdeci">const struct Curl_handler Curl_handler_imaps</div></div>
<div class="ttc" id="hostip_8h_html"><div class="ttname"><a href="hostip_8h.html">hostip.h</a></div></div>
<div class="ttc" id="curl__sasl_8h_html_a6b1048327042c3ed90ad8c5e1cf5ef6ea17835c0cce72df2710536ee19b53ddb4"><div class="ttname"><a href="curl__sasl_8h.html#a6b1048327042c3ed90ad8c5e1cf5ef6ea17835c0cce72df2710536ee19b53ddb4">SASL_IDLE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8h_source.html#l00080">curl_sasl.h:80</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="imap_8c_html_a12c4bcee933e8e06bacbee077813de2c"><div class="ttname"><a href="imap_8c.html#a12c4bcee933e8e06bacbee077813de2c">IMAP_RESP_PREAUTH</a></div><div class="ttdeci">#define IMAP_RESP_PREAUTH</div><div class="ttdef"><b>Definition:</b> <a href="imap_8c_source.html#l00169">imap.c:169</a></div></div>
<div class="ttc" id="urldata_8h_html_ad1e824167a50a205dad75e1256dedfca"><div class="ttname"><a href="urldata_8h.html#ad1e824167a50a205dad75e1256dedfca">PROTOPT_CLOSEACTION</a></div><div class="ttdeci">#define PROTOPT_CLOSEACTION</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00708">urldata.h:708</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="socks_8h_html"><div class="ttname"><a href="socks_8h.html">socks.h</a></div></div>
<div class="ttc" id="url_8h_html"><div class="ttname"><a href="url_8h.html">url.h</a></div></div>
<div class="ttc" id="structpingpong_html"><div class="ttname"><a href="structpingpong.html">pingpong</a></div><div class="ttdef"><b>Definition:</b> <a href="pingpong_8h_source.html#l00048">pingpong.h:48</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="imap_8h_html_ae3f0ff2a0a47eab3b443d1ada554b70b"><div class="ttname"><a href="imap_8h.html#ae3f0ff2a0a47eab3b443d1ada554b70b">IMAP_TYPE_CLEARTEXT</a></div><div class="ttdeci">#define IMAP_TYPE_CLEARTEXT</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00091">imap.h:91</a></div></div>
<div class="ttc" id="structimap__conn_html_aaf8646375e2aa9e615c764874ca093bb"><div class="ttname"><a href="structimap__conn.html#aaf8646375e2aa9e615c764874ca093bb">imap_conn::state</a></div><div class="ttdeci">imapstate state</div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00073">imap.h:73</a></div></div>
<div class="ttc" id="unit1602_8c_html_a35af0be900467fedbb610bd6ea65ed78"><div class="ttname"><a href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a></div><div class="ttdeci">int key</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00056">unit1602.c:56</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaaf6d1e90b5fcecb4a9baf757df9815110"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaaf6d1e90b5fcecb4a9baf757df9815110">IMAP_SERVERGREET</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00033">imap.h:33</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a3bfd8a5d78dc98e435348b877e19f619"><div class="ttname"><a href="struct_connect_bits.html#a3bfd8a5d78dc98e435348b877e19f619">ConnectBits::user_passwd</a></div><div class="ttdeci">bool user_passwd</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00390">urldata.h:390</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa05191306d5de2126c93f02a62665a548"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa05191306d5de2126c93f02a62665a548">IMAP_STARTTLS</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00036">imap.h:36</a></div></div>
<div class="ttc" id="structconnectdata_html_a85cb9da7776d42c440612d2940a7fcb4"><div class="ttname"><a href="structconnectdata.html#a85cb9da7776d42c440612d2940a7fcb4">connectdata::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00863">urldata.h:863</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a805079d1643f348afa725659b45b6f87"><div class="ttname"><a href="curl__setup__once_8h.html#a805079d1643f348afa725659b45b6f87">DEBUGF</a></div><div class="ttdeci">#define DEBUGF(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00390">curl_setup_once.h:390</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
<div class="ttc" id="imap_8h_html_afd32b033e86ebc4fc96084546d9aa1eaa1d6b765d7df319a1b12e1ff92edc9f50"><div class="ttname"><a href="imap_8h.html#afd32b033e86ebc4fc96084546d9aa1eaa1d6b765d7df319a1b12e1ff92edc9f50">IMAP_APPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="imap_8h_source.html#l00045">imap.h:45</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="imap_8c.html">imap.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
