<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/BLEServer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_b_l_e_server_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLEServer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_b_l_e_server_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * BLEServer.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Apr 16, 2017</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#if defined(CONFIG_BT_ENABLED)</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;esp_bt.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;esp_bt_main.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_device_8h.html">BLEDevice.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_server_8h.html">BLEServer.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_service_8h.html">BLEService.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_utils_8h.html">BLEUtils.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;unordered_set&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#ifdef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;esp32-hal-log.h&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;BLEServer&quot;</span>;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;BLEServer::BLEServer() {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="class_b_l_e_server.html#a20dfb42bb8d7a1c2ba3d9efe8c5feb3f">m_appId</a>            = ESP_GATT_IF_NONE;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    m_gatts_if         = ESP_GATT_IF_NONE;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    m_connectedCount   = 0;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    m_connId           = ESP_GATT_IF_NONE;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    m_pServerCallbacks = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;} <span class="comment">// BLEServer</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keywordtype">void</span> BLEServer::createApp(uint16_t appId) {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="class_b_l_e_server.html#a20dfb42bb8d7a1c2ba3d9efe8c5feb3f">m_appId</a> = appId;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    registerApp(appId);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;} <span class="comment">// createApp</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#abd2ac6a301f7fef5dc133828599d3c37">   57</a></span>&#160;<a class="code" href="class_b_l_e_service.html">BLEService</a>* <a class="code" href="class_b_l_e_server.html#abd2ac6a301f7fef5dc133828599d3c37">BLEServer::createService</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* uuid) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_b_l_e_server.html#abd2ac6a301f7fef5dc133828599d3c37">createService</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a>(uuid));</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#ae9fb4b1571fc55263712ec7ffca6f9c5">   72</a></span>&#160;<a class="code" href="class_b_l_e_service.html">BLEService</a>* <a class="code" href="class_b_l_e_server.html#abd2ac6a301f7fef5dc133828599d3c37">BLEServer::createService</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> uuid, uint32_t numHandles, uint8_t inst_id) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; createService - %s&quot;</span>, uuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    m_semaphoreCreateEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">take</a>(<span class="stringliteral">&quot;createService&quot;</span>);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// Check that a service with the supplied UUID does not already exist.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span> (m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#aad2e2ecdb6f4d649e312df804ef82bbe">getByUUID</a>(uuid) != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        ESP_LOGW(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; Attempt to create a new service with uuid %s but a service with that UUID already exists.&quot;</span>,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            uuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="class_b_l_e_service.html">BLEService</a>* pService = <span class="keyword">new</span> <a class="code" href="class_b_l_e_server.html#ae0bbf0970642e11895d7561ca4493fa4">BLEService</a>(uuid, numHandles);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    pService-&gt;<a class="code" href="class_b_l_e_service.html#ae74660b6311964faa6885ec7f844d672">m_instId</a> = inst_id;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#a0c5c2eb0b6b8232a7576ff7de46e79a3">setByUUID</a>(uuid, pService); <span class="comment">// Save a reference to this service being on this server.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    pService-&gt;<a class="code" href="class_b_l_e_service.html#ace35b24d626f88b9e4dd9af2b7340d3f">executeCreate</a>(<span class="keyword">this</span>);          <span class="comment">// Perform the API calls to actually create the service.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    m_semaphoreCreateEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">wait</a>(<span class="stringliteral">&quot;createService&quot;</span>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; createService&quot;</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> pService;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;} <span class="comment">// createService</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a99b57db6fd85cc3d3103f95ca07c02c3">   99</a></span>&#160;<a class="code" href="class_b_l_e_service.html">BLEService</a>* <a class="code" href="class_b_l_e_server.html#a99b57db6fd85cc3d3103f95ca07c02c3">BLEServer::getServiceByUUID</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* uuid) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#aad2e2ecdb6f4d649e312df804ef82bbe">getByUUID</a>(uuid);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a3a1f821d90b773fbddcc2b1a8823dfbc">  108</a></span>&#160;<a class="code" href="class_b_l_e_service.html">BLEService</a>* <a class="code" href="class_b_l_e_server.html#a99b57db6fd85cc3d3103f95ca07c02c3">BLEServer::getServiceByUUID</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> uuid) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">return</span> m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#aad2e2ecdb6f4d649e312df804ef82bbe">getByUUID</a>(uuid);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#ad33d73fc09af764bcb44840decb53e8c">  117</a></span>&#160;<a class="code" href="class_b_l_e_advertising.html">BLEAdvertising</a>* <a class="code" href="class_b_l_e_server.html#ad33d73fc09af764bcb44840decb53e8c">BLEServer::getAdvertising</a>() {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">BLEDevice::getAdvertising</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#aea374714afde5e29b2bf09251ec77e2a">  121</a></span>&#160;uint16_t <a class="code" href="class_b_l_e_server.html#aea374714afde5e29b2bf09251ec77e2a">BLEServer::getConnId</a>() {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> m_connId;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a4e73a6a59133915aa7212d3e87f60084">  130</a></span>&#160;uint32_t <a class="code" href="class_b_l_e_server.html#a4e73a6a59133915aa7212d3e87f60084">BLEServer::getConnectedCount</a>() {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span> m_connectedCount;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;} <span class="comment">// getConnectedCount</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;uint16_t BLEServer::getGattsIf() {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> m_gatts_if;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordtype">void</span> BLEServer::handleGATTServerEvent(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t* param) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; handleGATTServerEvent: %s&quot;</span>,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="class_b_l_e_utils.html#acb35970d17947515e04bd77af6a5f0f9">BLEUtils::gattServerEventTypeToString</a>(event).c_str());</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">switch</span>(event) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// ESP_GATTS_ADD_CHAR_EVT - Indicate that a characteristic was added to the service.</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">// add_char:</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// - esp_gatt_status_t status</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// - uint16_t          attr_handle</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// - uint16_t          service_handle</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// - esp_bt_uuid_t     char_uuid</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_ADD_CHAR_EVT: {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        } <span class="comment">// ESP_GATTS_ADD_CHAR_EVT</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_MTU_EVT:</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <a class="code" href="class_b_l_e_server.html#a7dc75376bf4315baa9ff03f267079ad2">updatePeerMTU</a>(param-&gt;mtu.conn_id, param-&gt;mtu.mtu);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// ESP_GATTS_CONNECT_EVT</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// connect:</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// - uint16_t      conn_id</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">// - esp_bd_addr_t remote_bda</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_CONNECT_EVT: {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            m_connId = param-&gt;connect.conn_id;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <a class="code" href="class_b_l_e_server.html#a6c528688f1ac67a2b8a971e776221312">addPeerDevice</a>((<span class="keywordtype">void</span>*)<span class="keyword">this</span>, <span class="keyword">false</span>, m_connId);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">if</span> (m_pServerCallbacks != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                m_pServerCallbacks-&gt;<a class="code" href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">onConnect</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                m_pServerCallbacks-&gt;<a class="code" href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">onConnect</a>(<span class="keyword">this</span>, param);         </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            m_connectedCount++;   <span class="comment">// Increment the number of connected devices count.   </span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        } <span class="comment">// ESP_GATTS_CONNECT_EVT</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// ESP_GATTS_CREATE_EVT</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// Called when a new service is registered as having been created.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">// create:</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment">// * esp_gatt_status_t  status</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// * uint16_t           service_handle</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">// * esp_gatt_srvc_id_t service_id</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_CREATE_EVT: {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <a class="code" href="class_b_l_e_service.html">BLEService</a>* pService = m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#aad2e2ecdb6f4d649e312df804ef82bbe">getByUUID</a>(param-&gt;create.service_id.id.uuid, param-&gt;create.service_id.id.inst_id);  <span class="comment">// &lt;--- very big bug for multi services with the same uuid</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#a2f51583e6ef6c0d0fb3f0daaa74a03f0">setByHandle</a>(param-&gt;create.service_handle, pService);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            m_semaphoreCreateEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        } <span class="comment">// ESP_GATTS_CREATE_EVT</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// ESP_GATTS_DISCONNECT_EVT</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// disconnect</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// - uint16_t                       conn_id</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment">// - esp_bd_addr_t                  remote_bda</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">// - esp_gatt_conn_reason_t         reason</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">// If we receive a disconnect event then invoke the callback for disconnects (if one is present).</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// we also want to start advertising again.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_DISCONNECT_EVT: {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            m_connectedCount--;                          <span class="comment">// Decrement the number of connected devices count.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">if</span> (m_pServerCallbacks != <span class="keyword">nullptr</span>) {         <span class="comment">// If we have callbacks, call now.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                m_pServerCallbacks-&gt;<a class="code" href="class_b_l_e_server_callbacks.html#ada4c2b7544b9d8bf338bb6740f90c5d7">onDisconnect</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <a class="code" href="class_b_l_e_server.html#a03e5e5cc394e94cfe688c6fbf90bdf3b">startAdvertising</a>(); <span class="comment">//- do this with some delay from the loop()</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="class_b_l_e_server.html#ad0aa00937e0a8179dd0449ffa6a8cf9e">removePeerDevice</a>(param-&gt;disconnect.conn_id, <span class="keyword">false</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        } <span class="comment">// ESP_GATTS_DISCONNECT_EVT</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// ESP_GATTS_READ_EVT - A request to read the value of a characteristic has arrived.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// read:</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// - uint16_t      conn_id</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">// - uint32_t      trans_id</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">// - esp_bd_addr_t bda</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">// - uint16_t      handle</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">// - uint16_t      offset</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment">// - bool          is_long</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">// - bool          need_rsp</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_READ_EVT: {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        } <span class="comment">// ESP_GATTS_READ_EVT</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="comment">// ESP_GATTS_REG_EVT</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">// reg:</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">// - esp_gatt_status_t status</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// - uint16_t app_id</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_REG_EVT: {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            m_gatts_if = gatts_if;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            m_semaphoreRegisterAppEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>(); <span class="comment">// Unlock the mutex waiting for the registration of the app.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        } <span class="comment">// ESP_GATTS_REG_EVT</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// ESP_GATTS_WRITE_EVT - A request to write the value of a characteristic has arrived.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// write:</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">// - uint16_t      conn_id</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">// - uint16_t      trans_id</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">// - esp_bd_addr_t bda</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// - uint16_t      handle</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// - uint16_t      offset</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// - bool          need_rsp</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// - bool          is_prep</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// - uint16_t      len</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// - uint8_t*      value</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_WRITE_EVT: {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">case</span> ESP_GATTS_OPEN_EVT:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            m_semaphoreOpenEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">give</a>(param-&gt;open.status);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// Invoke the handler for every Service we have.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#aa87e34571db0f18cb7a4dc7f8c7488af">handleGATTServerEvent</a>(event, gatts_if, param);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; handleGATTServerEvent&quot;</span>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;} <span class="comment">// handleGATTServerEvent</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">void</span> BLEServer::registerApp(uint16_t m_appId) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; registerApp - %d&quot;</span>, <a class="code" href="class_b_l_e_server.html#a20dfb42bb8d7a1c2ba3d9efe8c5feb3f">m_appId</a>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    m_semaphoreRegisterAppEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">take</a>(<span class="stringliteral">&quot;registerApp&quot;</span>); <span class="comment">// Take the mutex, will be released by ESP_GATTS_REG_EVT event.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    ::esp_ble_gatts_app_register(<a class="code" href="class_b_l_e_server.html#a20dfb42bb8d7a1c2ba3d9efe8c5feb3f">m_appId</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    m_semaphoreRegisterAppEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">wait</a>(<span class="stringliteral">&quot;registerApp&quot;</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; registerApp&quot;</span>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;} <span class="comment">// registerApp</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#aeb9792bfc87be06326de09a3a1586e8f">  304</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#aeb9792bfc87be06326de09a3a1586e8f">BLEServer::setCallbacks</a>(<a class="code" href="class_b_l_e_server_callbacks.html">BLEServerCallbacks</a>* pCallbacks) {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    m_pServerCallbacks = pCallbacks;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;} <span class="comment">// setCallbacks</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment"> * Remove service</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a535dff64fff355afab59261354b3878b">  311</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#a535dff64fff355afab59261354b3878b">BLEServer::removeService</a>(<a class="code" href="class_b_l_e_service.html">BLEService</a>* service) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    service-&gt;<a class="code" href="class_b_l_e_service.html#aec3670fcb080192d663bf4f9a45f757b">stop</a>();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    service-&gt;<a class="code" href="class_b_l_e_service.html#a9611b7587763018aeb8065469fdca5ea">executeDelete</a>();   </div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    m_serviceMap.<a class="code" href="class_b_l_e_service_map.html#a388558ad13a9f33b18c6b7e110a82a0e">removeService</a>(service);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a03e5e5cc394e94cfe688c6fbf90bdf3b">  323</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#a03e5e5cc394e94cfe688c6fbf90bdf3b">BLEServer::startAdvertising</a>() {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; startAdvertising&quot;</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="class_b_l_e_device.html#a1f16045c3a431adaff5b51dff9c1c418">BLEDevice::startAdvertising</a>();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; startAdvertising&quot;</span>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;} <span class="comment">// startAdvertising</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a64059e91736510068f1a196fe5fc56be">  333</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_b_l_e_server.html#a64059e91736510068f1a196fe5fc56be">BLEServer::connect</a>(<a class="code" href="class_b_l_e_address.html">BLEAddress</a> address) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    esp_bd_addr_t addr;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;addr, address.<a class="code" href="class_b_l_e_address.html#a4c11bcce1d6ebf907e9a3c4f318bde2e">getNative</a>(), 6);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Perform the open connection request against the target BLE Server.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    m_semaphoreOpenEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">take</a>(<span class="stringliteral">&quot;connect&quot;</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    esp_err_t errRc = ::esp_ble_gatts_open(</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        getGattsIf(),</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        addr, <span class="comment">// address</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        1                              <span class="comment">// direct connection</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    );</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (errRc != ESP_OK) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gattc_open: rc=%d %s&quot;</span>, errRc, <a class="code" href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a>(errRc));</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    uint32_t <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = m_semaphoreOpenEvt.<a class="code" href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">wait</a>(<span class="stringliteral">&quot;connect&quot;</span>);   <span class="comment">// Wait for the connection to complete.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; connect(), rc=%d&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>==ESP_GATT_OK);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == ESP_GATT_OK;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;} <span class="comment">// connect</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">  355</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">BLEServerCallbacks::onConnect</a>(<a class="code" href="class_b_l_e_server.html">BLEServer</a>* pServer) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; onConnect(): Default&quot;</span>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;Device: %s&quot;</span>, <a class="code" href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a>().c_str());</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&lt;&lt; onConnect()&quot;</span>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;} <span class="comment">// onConnect</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="class_b_l_e_server_callbacks.html#aaa78b42be5c45f82a4120fd9eccd5521">  361</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">BLEServerCallbacks::onConnect</a>(<a class="code" href="class_b_l_e_server.html">BLEServer</a>* pServer, esp_ble_gatts_cb_param_t* param) {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; onConnect(): Default&quot;</span>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;Device: %s&quot;</span>, <a class="code" href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a>().c_str());</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&lt;&lt; onConnect()&quot;</span>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;} <span class="comment">// onConnect</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="class_b_l_e_server_callbacks.html#ada4c2b7544b9d8bf338bb6740f90c5d7">  368</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server_callbacks.html#ada4c2b7544b9d8bf338bb6740f90c5d7">BLEServerCallbacks::onDisconnect</a>(<a class="code" href="class_b_l_e_server.html">BLEServer</a>* pServer) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; onDisconnect(): Default&quot;</span>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;Device: %s&quot;</span>, <a class="code" href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a>().c_str());</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    ESP_LOGD(<span class="stringliteral">&quot;BLEServerCallbacks&quot;</span>, <span class="stringliteral">&quot;&lt;&lt; onDisconnect()&quot;</span>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;} <span class="comment">// onDisconnect</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/* multi connect support */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">/* TODO do some more tweaks */</span></div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a7dc75376bf4315baa9ff03f267079ad2">  376</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#a7dc75376bf4315baa9ff03f267079ad2">BLEServer::updatePeerMTU</a>(uint16_t conn_id, uint16_t mtu) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// set mtu in conn_status_t</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">const</span> std::map&lt;uint16_t, conn_status_t&gt;::iterator <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> = m_connectedServersMap.find(conn_id);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a> != m_connectedServersMap.end()) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>-&gt;second.mtu = mtu;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        std::swap(m_connectedServersMap[conn_id], <a class="code" href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a>-&gt;second);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#ab4685d292df030895b821ba45693ad2f">  385</a></span>&#160;std::map&lt;uint16_t, conn_status_t&gt; <a class="code" href="class_b_l_e_server.html#ab4685d292df030895b821ba45693ad2f">BLEServer::getPeerDevices</a>(<span class="keywordtype">bool</span> _client) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">return</span> m_connectedServersMap;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a898e73615b3056ed3af21eb2ecdcbfa2">  390</a></span>&#160;uint16_t <a class="code" href="class_b_l_e_server.html#a898e73615b3056ed3af21eb2ecdcbfa2">BLEServer::getPeerMTU</a>(uint16_t conn_id) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">return</span> m_connectedServersMap.find(conn_id)-&gt;second.mtu;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#a6c528688f1ac67a2b8a971e776221312">  394</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#a6c528688f1ac67a2b8a971e776221312">BLEServer::addPeerDevice</a>(<span class="keywordtype">void</span>* <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>, <span class="keywordtype">bool</span> _client, uint16_t conn_id) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="structconn__status__t.html">conn_status_t</a> status = {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        .<a class="code" href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">peer_device</a> = <a class="code" href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a>,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        .connected = <span class="keyword">true</span>,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        .mtu = 23</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    };</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    m_connectedServersMap.insert(std::pair&lt;uint16_t, conn_status_t&gt;(conn_id, status));  </div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#ad0aa00937e0a8179dd0449ffa6a8cf9e">  404</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#ad0aa00937e0a8179dd0449ffa6a8cf9e">BLEServer::removePeerDevice</a>(uint16_t conn_id, <span class="keywordtype">bool</span> _client) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    m_connectedServersMap.erase(conn_id);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;}</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/* multi connect support */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="class_b_l_e_server.html#aaacfdde14490230c22cdd8e3347b66be">  412</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_server.html#aaacfdde14490230c22cdd8e3347b66be">BLEServer::updateConnParams</a>(esp_bd_addr_t remote_bda, uint16_t minInterval, uint16_t maxInterval, uint16_t latency, uint16_t <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    esp_ble_conn_update_params_t conn_params;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(conn_params.bda, remote_bda, <span class="keyword">sizeof</span>(esp_bd_addr_t));</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    conn_params.latency = latency;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    conn_params.max_int = maxInterval;    <span class="comment">// max_int = 0x20*1.25ms = 40ms</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    conn_params.min_int = minInterval;    <span class="comment">// min_int = 0x10*1.25ms = 20ms</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    conn_params.timeout = <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>;    <span class="comment">// timeout = 400*10ms = 4000ms</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    esp_ble_gap_update_conn_params(&amp;conn_params); </div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="preprocessor">#endif // CONFIG_BT_ENABLED</span></div><div class="ttc" id="class_b_l_e_server_html_a20dfb42bb8d7a1c2ba3d9efe8c5feb3f"><div class="ttname"><a href="class_b_l_e_server.html#a20dfb42bb8d7a1c2ba3d9efe8c5feb3f">BLEServer::m_appId</a></div><div class="ttdeci">uint16_t m_appId</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00075">BLEServer.h:75</a></div></div>
<div class="ttc" id="class_b_l_e_u_u_i_d_html"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html">BLEUUID</a></div><div class="ttdoc">A model of a BLE UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8h_source.html#l00018">BLEUUID.h:18</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a03e5e5cc394e94cfe688c6fbf90bdf3b"><div class="ttname"><a href="class_b_l_e_server.html#a03e5e5cc394e94cfe688c6fbf90bdf3b">BLEServer::startAdvertising</a></div><div class="ttdeci">void startAdvertising()</div><div class="ttdoc">Start advertising. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00323">BLEServer.cpp:323</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_ad33d73fc09af764bcb44840decb53e8c"><div class="ttname"><a href="class_b_l_e_server.html#ad33d73fc09af764bcb44840decb53e8c">BLEServer::getAdvertising</a></div><div class="ttdeci">BLEAdvertising * getAdvertising()</div><div class="ttdoc">Retrieve the advertising object that can be used to advertise the existence of the server...</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00117">BLEServer.cpp:117</a></div></div>
<div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_service_map_html_aad2e2ecdb6f4d649e312df804ef82bbe"><div class="ttname"><a href="class_b_l_e_service_map.html#aad2e2ecdb6f4d649e312df804ef82bbe">BLEServiceMap::getByUUID</a></div><div class="ttdeci">BLEService * getByUUID(const char *uuid)</div><div class="ttdoc">Return the service by UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_map_8cpp_source.html#l00019">BLEServiceMap.cpp:19</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_aaacfdde14490230c22cdd8e3347b66be"><div class="ttname"><a href="class_b_l_e_server.html#aaacfdde14490230c22cdd8e3347b66be">BLEServer::updateConnParams</a></div><div class="ttdeci">void updateConnParams(esp_bd_addr_t remote_bda, uint16_t minInterval, uint16_t maxInterval, uint16_t latency, uint16_t timeout)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00412">BLEServer.cpp:412</a></div></div>
<div class="ttc" id="class_b_l_e_service_map_html_a0c5c2eb0b6b8232a7576ff7de46e79a3"><div class="ttname"><a href="class_b_l_e_service_map.html#a0c5c2eb0b6b8232a7576ff7de46e79a3">BLEServiceMap::setByUUID</a></div><div class="ttdeci">void setByUUID(const char *uuid, BLEService *service)</div></div>
<div class="ttc" id="class_b_l_e_address_html"><div class="ttname"><a href="class_b_l_e_address.html">BLEAddress</a></div><div class="ttdoc">A BLE device address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8h_source.html#l00021">BLEAddress.h:21</a></div></div>
<div class="ttc" id="_b_l_e_utils_8h_html"><div class="ttname"><a href="_b_l_e_utils_8h.html">BLEUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_service_map_html_a388558ad13a9f33b18c6b7e110a82a0e"><div class="ttname"><a href="class_b_l_e_service_map.html#a388558ad13a9f33b18c6b7e110a82a0e">BLEServiceMap::removeService</a></div><div class="ttdeci">void removeService(BLEService *service)</div><div class="ttdoc">Removes service from maps. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_map_8cpp_source.html#l00121">BLEServiceMap.cpp:121</a></div></div>
<div class="ttc" id="_b_l_e_device_8h_html"><div class="ttname"><a href="_b_l_e_device_8h.html">BLEDevice.h</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a4e73a6a59133915aa7212d3e87f60084"><div class="ttname"><a href="class_b_l_e_server.html#a4e73a6a59133915aa7212d3e87f60084">BLEServer::getConnectedCount</a></div><div class="ttdeci">uint32_t getConnectedCount()</div><div class="ttdoc">Return the number of connected clients. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00130">BLEServer.cpp:130</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="structconn__status__t_html_a094f343c247e14a74ad13a46ebe3acd0"><div class="ttname"><a href="structconn__status__t.html#a094f343c247e14a74ad13a46ebe3acd0">conn_status_t::peer_device</a></div><div class="ttdeci">void * peer_device</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00029">BLEServer.h:29</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_aea374714afde5e29b2bf09251ec77e2a"><div class="ttname"><a href="class_b_l_e_server.html#aea374714afde5e29b2bf09251ec77e2a">BLEServer::getConnId</a></div><div class="ttdeci">uint16_t getConnId()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00121">BLEServer.cpp:121</a></div></div>
<div class="ttc" id="class_b_l_e_service_html"><div class="ttname"><a href="class_b_l_e_service.html">BLEService</a></div><div class="ttdoc">The model of a BLE service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_8h_source.html#l00049">BLEService.h:49</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_ad1aa158e37d15363b4441482fae82dd8"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#ad1aa158e37d15363b4441482fae82dd8">FreeRTOS::Semaphore::give</a></div><div class="ttdeci">void give()</div><div class="ttdoc">Give a semaphore. The Semaphore is given. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00114">FreeRTOS.cpp:114</a></div></div>
<div class="ttc" id="class_b_l_e_advertising_html"><div class="ttname"><a href="class_b_l_e_advertising.html">BLEAdvertising</a></div><div class="ttdoc">Perform and manage BLE advertising. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_advertising_8h_source.html#l00047">BLEAdvertising.h:47</a></div></div>
<div class="ttc" id="class_b_l_e_server_callbacks_html_ada4c2b7544b9d8bf338bb6740f90c5d7"><div class="ttname"><a href="class_b_l_e_server_callbacks.html#ada4c2b7544b9d8bf338bb6740f90c5d7">BLEServerCallbacks::onDisconnect</a></div><div class="ttdeci">virtual void onDisconnect(BLEServer *pServer)</div><div class="ttdoc">Handle an existing client disconnection. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00368">BLEServer.cpp:368</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_acb35970d17947515e04bd77af6a5f0f9"><div class="ttname"><a href="class_b_l_e_utils.html#acb35970d17947515e04bd77af6a5f0f9">BLEUtils::gattServerEventTypeToString</a></div><div class="ttdeci">static std::string gattServerEventTypeToString(esp_gatts_cb_event_t eventType)</div><div class="ttdoc">Return a string representation of a GATT server event code. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l00961">BLEUtils.cpp:961</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a1f16045c3a431adaff5b51dff9c1c418"><div class="ttname"><a href="class_b_l_e_device.html#a1f16045c3a431adaff5b51dff9c1c418">BLEDevice::startAdvertising</a></div><div class="ttdeci">static void startAdvertising()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00561">BLEDevice.cpp:561</a></div></div>
<div class="ttc" id="structconn__status__t_html"><div class="ttname"><a href="structconn__status__t.html">conn_status_t</a></div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00028">BLEServer.h:28</a></div></div>
<div class="ttc" id="_b_l_e_server_8h_html"><div class="ttname"><a href="_b_l_e_server_8h.html">BLEServer.h</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="class_b_l_e_device_html_af3e0271d566f8ddce17db9b71be843b2"><div class="ttname"><a href="class_b_l_e_device.html#af3e0271d566f8ddce17db9b71be843b2">BLEDevice::toString</a></div><div class="ttdeci">static std::string toString()</div><div class="ttdoc">Return a string representation of the nature of this device. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00475">BLEDevice.cpp:475</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a64059e91736510068f1a196fe5fc56be"><div class="ttname"><a href="class_b_l_e_server.html#a64059e91736510068f1a196fe5fc56be">BLEServer::connect</a></div><div class="ttdeci">bool connect(BLEAddress address)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00333">BLEServer.cpp:333</a></div></div>
<div class="ttc" id="cacert_8d_html_a2dc1940063b86f9c406c65ac7928ac63"><div class="ttname"><a href="cacert_8d.html#a2dc1940063b86f9c406c65ac7928ac63">peer</a></div><div class="ttdeci">Long so this option is typically used to alter that default file.curl recognizes the environment variable named CURL_CA_BUNDLE if it is and uses the given path as a path to a CA cert bundle.This option overrides that variable.The windows version of curl will automatically look for a CA certs file named curl ca bundle.either in the same directory as curl.or in the Current Working or in any folder along your PATH.If curl is built against the NSS SSL the NSS PEM then this option is supported for backward compatibility with other SSL but it should not be set.If the option is not then curl will use the certificates in the system and user Keychain to verify the peer</div><div class="ttdef"><b>Definition:</b> <a href="cacert_8d_source.html#l00023">cacert.d:23</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a898e73615b3056ed3af21eb2ecdcbfa2"><div class="ttname"><a href="class_b_l_e_server.html#a898e73615b3056ed3af21eb2ecdcbfa2">BLEServer::getPeerMTU</a></div><div class="ttdeci">uint16_t getPeerMTU(uint16_t conn_id)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00390">BLEServer.cpp:390</a></div></div>
<div class="ttc" id="class_b_l_e_server_callbacks_html_a1e14399f4b08acdcb481014d5c336112"><div class="ttname"><a href="class_b_l_e_server_callbacks.html#a1e14399f4b08acdcb481014d5c336112">BLEServerCallbacks::onConnect</a></div><div class="ttdeci">virtual void onConnect(BLEServer *pServer)</div><div class="ttdoc">Handle a new client connection. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00355">BLEServer.cpp:355</a></div></div>
<div class="ttc" id="class_general_utils_html_a25e466e54ff002f54bfb7e1f43bd401b"><div class="ttname"><a href="class_general_utils.html#a25e466e54ff002f54bfb7e1f43bd401b">GeneralUtils::errorToString</a></div><div class="ttdeci">static const char * errorToString(esp_err_t errCode)</div><div class="ttdoc">Convert an ESP error code to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_general_utils_8cpp_source.html#l00366">GeneralUtils.cpp:366</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a535dff64fff355afab59261354b3878b"><div class="ttname"><a href="class_b_l_e_server.html#a535dff64fff355afab59261354b3878b">BLEServer::removeService</a></div><div class="ttdeci">void removeService(BLEService *service)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00311">BLEServer.cpp:311</a></div></div>
<div class="ttc" id="class_b_l_e_server_html"><div class="ttname"><a href="class_b_l_e_server.html">BLEServer</a></div><div class="ttdoc">The model of a BLE server. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00063">BLEServer.h:63</a></div></div>
<div class="ttc" id="class_b_l_e_service_map_html_a2f51583e6ef6c0d0fb3f0daaa74a03f0"><div class="ttname"><a href="class_b_l_e_service_map.html#a2f51583e6ef6c0d0fb3f0daaa74a03f0">BLEServiceMap::setByHandle</a></div><div class="ttdeci">void setByHandle(uint16_t handle, BLEService *service)</div><div class="ttdoc">Set the service by handle. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_map_8cpp_source.html#l00066">BLEServiceMap.cpp:66</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_a023cb404ff897bb39064b454732ccf21"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#a023cb404ff897bb39064b454732ccf21">FreeRTOS::Semaphore::wait</a></div><div class="ttdeci">uint32_t wait(std::string owner=&quot;&lt;Unknown&gt;&quot;)</div><div class="ttdoc">Wait for a semaphore to be released by trying to take it and then releasing it again. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00064">FreeRTOS.cpp:64</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_ad0aa00937e0a8179dd0449ffa6a8cf9e"><div class="ttname"><a href="class_b_l_e_server.html#ad0aa00937e0a8179dd0449ffa6a8cf9e">BLEServer::removePeerDevice</a></div><div class="ttdeci">void removePeerDevice(uint16_t conn_id, bool client)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00404">BLEServer.cpp:404</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a7dc75376bf4315baa9ff03f267079ad2"><div class="ttname"><a href="class_b_l_e_server.html#a7dc75376bf4315baa9ff03f267079ad2">BLEServer::updatePeerMTU</a></div><div class="ttdeci">void updatePeerMTU(uint16_t connId, uint16_t mtu)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00376">BLEServer.cpp:376</a></div></div>
<div class="ttc" id="class_b_l_e_service_html_aec3670fcb080192d663bf4f9a45f757b"><div class="ttname"><a href="class_b_l_e_service.html#aec3670fcb080192d663bf4f9a45f757b">BLEService::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Stop the service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_8cpp_source.html#l00171">BLEService.cpp:171</a></div></div>
<div class="ttc" id="class_b_l_e_address_html_a4c11bcce1d6ebf907e9a3c4f318bde2e"><div class="ttname"><a href="class_b_l_e_address.html#a4c11bcce1d6ebf907e9a3c4f318bde2e">BLEAddress::getNative</a></div><div class="ttdeci">esp_bd_addr_t * getNative()</div><div class="ttdoc">Return the native representation of the address. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_address_8cpp_source.html#l00069">BLEAddress.cpp:69</a></div></div>
<div class="ttc" id="class_b_l_e_service_html_a9611b7587763018aeb8065469fdca5ea"><div class="ttname"><a href="class_b_l_e_service.html#a9611b7587763018aeb8065469fdca5ea">BLEService::executeDelete</a></div><div class="ttdeci">void executeDelete()</div><div class="ttdoc">Delete the service. Delete the service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_8cpp_source.html#l00091">BLEService.cpp:91</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a6c528688f1ac67a2b8a971e776221312"><div class="ttname"><a href="class_b_l_e_server.html#a6c528688f1ac67a2b8a971e776221312">BLEServer::addPeerDevice</a></div><div class="ttdeci">void addPeerDevice(void *peer, bool is_client, uint16_t conn_id)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00394">BLEServer.cpp:394</a></div></div>
<div class="ttc" id="_b_l_e_service_8h_html"><div class="ttname"><a href="_b_l_e_service_8h.html">BLEService.h</a></div></div>
<div class="ttc" id="class_b_l_e_server_callbacks_html"><div class="ttname"><a href="class_b_l_e_server_callbacks.html">BLEServerCallbacks</a></div><div class="ttdoc">Callbacks associated with the operation of a BLE server. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00116">BLEServer.h:116</a></div></div>
<div class="ttc" id="class_b_l_e_service_map_html_aa87e34571db0f18cb7a4dc7f8c7488af"><div class="ttname"><a href="class_b_l_e_service_map.html#aa87e34571db0f18cb7a4dc7f8c7488af">BLEServiceMap::handleGATTServerEvent</a></div><div class="ttdeci">void handleGATTServerEvent(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t *param)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_map_8cpp_source.html#l00084">BLEServiceMap.cpp:84</a></div></div>
<div class="ttc" id="class_b_l_e_service_html_ace35b24d626f88b9e4dd9af2b7340d3f"><div class="ttname"><a href="class_b_l_e_service.html#ace35b24d626f88b9e4dd9af2b7340d3f">BLEService::executeCreate</a></div><div class="ttdeci">void executeCreate(BLEServer *pServer)</div><div class="ttdoc">Create the service. Create the service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_8cpp_source.html#l00064">BLEService.cpp:64</a></div></div>
<div class="ttc" id="ftp-ssl-ccc-mode_8d_html_ac4f4031531425afe8fbe576a1e1d1642"><div class="ttname"><a href="ftp-ssl-ccc-mode_8d.html#ac4f4031531425afe8fbe576a1e1d1642">it</a></div><div class="ttdeci">Long but instead wait for the server to do it</div><div class="ttdef"><b>Definition:</b> <a href="ftp-ssl-ccc-mode_8d_source.html#l00008">ftp-ssl-ccc-mode.d:8</a></div></div>
<div class="ttc" id="class_b_l_e_device_html_a604dc61d03239c3350631babc313bb2e"><div class="ttname"><a href="class_b_l_e_device.html#a604dc61d03239c3350631babc313bb2e">BLEDevice::getAdvertising</a></div><div class="ttdeci">static BLEAdvertising * getAdvertising()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_device_8cpp_source.html#l00552">BLEDevice.cpp:552</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_ae0bbf0970642e11895d7561ca4493fa4"><div class="ttname"><a href="class_b_l_e_server.html#ae0bbf0970642e11895d7561ca4493fa4">BLEServer::BLEService</a></div><div class="ttdeci">friend class BLEService</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8h_source.html#l00090">BLEServer.h:90</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_a99b57db6fd85cc3d3103f95ca07c02c3"><div class="ttname"><a href="class_b_l_e_server.html#a99b57db6fd85cc3d3103f95ca07c02c3">BLEServer::getServiceByUUID</a></div><div class="ttdeci">BLEService * getServiceByUUID(const char *uuid)</div><div class="ttdoc">Get a BLE Service by its UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00099">BLEServer.cpp:99</a></div></div>
<div class="ttc" id="class_b_l_e_u_u_i_d_html_a52e30a254e1ff10a429c2e0a36a6131d"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">BLEUUID::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Get a string representation of the UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8cpp_source.html#l00355">BLEUUID.cpp:355</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_aeb9792bfc87be06326de09a3a1586e8f"><div class="ttname"><a href="class_b_l_e_server.html#aeb9792bfc87be06326de09a3a1586e8f">BLEServer::setCallbacks</a></div><div class="ttdeci">void setCallbacks(BLEServerCallbacks *pCallbacks)</div><div class="ttdoc">Set the server callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00304">BLEServer.cpp:304</a></div></div>
<div class="ttc" id="class_b_l_e_service_html_ae74660b6311964faa6885ec7f844d672"><div class="ttname"><a href="class_b_l_e_service.html#ae74660b6311964faa6885ec7f844d672">BLEService::m_instId</a></div><div class="ttdeci">uint8_t m_instId</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_service_8h_source.html#l00065">BLEService.h:65</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_1_1_semaphore_html_a67fa9bf777be48332a30154e006827fd"><div class="ttname"><a href="class_free_r_t_o_s_1_1_semaphore.html#a67fa9bf777be48332a30154e006827fd">FreeRTOS::Semaphore::take</a></div><div class="ttdeci">bool take(std::string owner=&quot;&lt;Unknown&gt;&quot;)</div><div class="ttdoc">Take a semaphore. Take a semaphore and wait indefinitely. </div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00159">FreeRTOS.cpp:159</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_abd2ac6a301f7fef5dc133828599d3c37"><div class="ttname"><a href="class_b_l_e_server.html#abd2ac6a301f7fef5dc133828599d3c37">BLEServer::createService</a></div><div class="ttdeci">BLEService * createService(const char *uuid)</div><div class="ttdoc">Create a BLE Service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00057">BLEServer.cpp:57</a></div></div>
<div class="ttc" id="class_b_l_e_server_html_ab4685d292df030895b821ba45693ad2f"><div class="ttname"><a href="class_b_l_e_server.html#ab4685d292df030895b821ba45693ad2f">BLEServer::getPeerDevices</a></div><div class="ttdeci">std::map&lt; uint16_t, conn_status_t &gt; getPeerDevices(bool client)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_server_8cpp_source.html#l00385">BLEServer.cpp:385</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_b_l_e_server_8cpp.html">BLEServer.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
