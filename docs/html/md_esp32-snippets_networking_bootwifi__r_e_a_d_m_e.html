<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: Bootwifi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_esp32-snippets_networking_bootwifi__r_e_a_d_m_e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bootwifi </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is common to want to start an ESP32 and have it connect to a <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> environment but how does one bootstrap it? To connect to a <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> environment, we typically need to know the SSID and password of the network to which we wish to connect. But without network connection to the ESP32, how do we set it? This component provides a potential solution.</p>
<p>The module exposes a function called <code>bootwifi</code> which, when called, will own the connection of the device to the local <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> environment. To do this, it looks in its flash storage to see if it has previously been given an SSID/password pair. If it has, it attempts to connect to that access point and join the network.</p>
<p>However, let us assume that it has never been given that information. In this case it will become an access point in its own right. What this means is that the ESP32 will become a <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> network to which other <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> devices can connect. Now you can connect to the ESP32 using your phone or other <a class="el" href="class_wi_fi.html" title="WiFi driver. ">WiFi</a> device as it will appear as an access point against which we can connect. Once connected, we can open a browser to it. In the browser page, we will be prompted for the SSID and password we wish to subsequently use. This will be saved and used from then on. Now the device will connect to that network.</p>
<p>What if we take our ESP32 to a new environment where the previously saved access point is no longer accessible or we simply just fail to connect? Again, we will fall back into being an access point and the user will be able to supply new information.</p>
<p>What if we want to change the access point to which the ESP32 connects even if that access point has been previously saved and is still connectable? Simple, the ESP32 can check a GPIO pin at startup and, if that pin is high (default low) then that can be used as a manual indication that we should become an access point without even attempting to connect to the network.</p>
<p>This code is supplied in the form of an ESP-IDF module. In addition, <a class="el" href="class_boot_wi_fi.html">BootWiFi</a> has a pre-requisite of the <code>cpp_utils</code> component also distributed as part of this repoistory.</p>
<p>The logic uses C++ exception handling and hence C++ exception handling must be enabled in <code>make menuconfig</code>.</p>
<h2>Example</h2>
<p>Below is a sample of a minimal main.cpp. <br />
* If you run it on an esp32, it should create a new open wifi network with SSID: "ESP32". <br />
* Connect to that network.</p><ul>
<li>Then open a browser and go to <a href="http://192.168.4.1">http://192.168.4.1</a>. <div class="fragment"><div class="line">{C++}</div><div class="line">#include &quot;BootWiFi.h&quot;</div><div class="line">#include &quot;sdkconfig.h&quot;</div><div class="line"></div><div class="line">extern &quot;C&quot; {</div><div class="line">    void app_main(void);</div><div class="line">}</div><div class="line"></div><div class="line">BootWiFi *boot;</div><div class="line"></div><div class="line">void app_main(void) {</div><div class="line">    boot = new BootWiFi();</div><div class="line">    boot-&gt;boot();</div><div class="line">}</div></div><!-- fragment --></li>
</ul>
<h2>GPIO boot override</h2>
<p>To enable the ability to specify a GPIO pin to override known station information, compile the code with <code>-DBOOTWIFI_OVERRIDE_GPIO=&lt;num&gt;</code> when <code>&lt;num&gt;</code> is a GPIO pin number. If the pin is high at startup, then it will override. The pin is configured as pull-down low so it need not be artificially held low. The default is no override pin.</p>
<h2>Future enhancements</h2>
<p>There is always room for enhancements:</p>
<ul>
<li>Improve the web page shown to the user - Right now it is pretty basic and ideally could be dramatically improved. Features to be added include<ul>
<li>listing of available access points for selection</li>
</ul>
</li>
<li>Integrate SSL security.</li>
<li>NeoPixel support for visualization of connection status:<ul>
<li>Green - connected</li>
<li>Blue - being an access point</li>
<li>Red - Connecting</li>
<li>Flashing red - failed</li>
</ul>
</li>
<li>Ability to specify an IP address for static IP address connection to the access point.</li>
<li>mDNS support when available.</li>
<li>Component configuration options including:<ul>
<li><a class="el" href="struct_network.html">Network</a> SSID to use when being an access point.</li>
<li><a class="el" href="struct_network.html">Network</a> password to use when being an access point (if any).</li>
</ul>
</li>
</ul>
<h2>Design and implementation notes</h2>
<p>The parameters for Bootwifi are stored in Non-Volatile Storage (<a class="el" href="class_n_v_s.html" title="Provide Non Volatile Storage access. ">NVS</a>). The name space in <a class="el" href="class_n_v_s.html" title="Provide Non Volatile Storage access. ">NVS</a> is <code>bootwifi</code>. The keys are:</p>
<ul>
<li><code>version</code> - The version of the protocol.</li>
<li><code>connectionInfo</code> - The details for connection.</li>
</ul>
<p>The form shown to the end user sends back a response as an <a class="el" href="struct_h_t_t_p.html">HTTP</a> POST to <code>/ssidSelected</code>. which contains the following form fields:</p>
<ul>
<li>ssid</li>
<li>password</li>
<li>ip</li>
<li>gw</li>
<li>netmask </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
