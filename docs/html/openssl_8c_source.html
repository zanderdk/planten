<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/vtls/openssl.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('openssl_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">openssl.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="openssl_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * Source file for all OpenSSL-specific code for the TLS/SSL layer. No code</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * but vtls.c should ever call or use these functions.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * The original SSLeay-using code for curl was written by Linas Vepstas and</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * Sampo Kellomaki 1998.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="formdata_8h.html">formdata.h</a>&quot;</span> <span class="comment">/* for the boundary function */</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="url_8h.html">url.h</a>&quot;</span> <span class="comment">/* for the ssl config check function */</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__pton_8h.html">inet_pton.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="openssl_8h.html">openssl.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="slist_8h.html">slist.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vtls_8h.html">vtls.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hostcheck_8h.html">hostcheck.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;openssl/ssl.h&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;openssl/rand.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;openssl/x509v3.h&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_DSA</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;openssl/dsa.h&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;openssl/dh.h&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;openssl/err.h&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;openssl/md5.h&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;openssl/conf.h&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;openssl/bn.h&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &lt;openssl/rsa.h&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;openssl/bio.h&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;openssl/buffer.h&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &lt;openssl/pkcs12.h&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090808fL) &amp;&amp; !defined(OPENSSL_NO_OCSP)</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;openssl/ocsp.h&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090700fL) &amp;&amp; </span><span class="comment">/* 0.9.7 or later */</span><span class="preprocessor">     \</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">  !defined(OPENSSL_NO_ENGINE)</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#define USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &lt;openssl/engine.h&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="non-ascii_8h.html">non-ascii.h</a>&quot;</span> <span class="comment">/* for Curl_convert_from_utf8 prototype */</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">/* The last #include files should be: */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">/* Uncomment the ALLOW_RENEG line to a real #define if you want to allow TLS</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">   renegotiations when built with BoringSSL. Renegotiating is non-compliant</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">   with HTTP/2 and &quot;an extremely dangerous protocol feature&quot;. Beware.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">#define ALLOW_RENEG 1</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#ifndef OPENSSL_VERSION_NUMBER</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#error &quot;OPENSSL_VERSION_NUMBER not defined&quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &lt;openssl/ui.h&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x00909000L</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#define SSL_METHOD_QUAL const</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#define SSL_METHOD_QUAL</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10000000L)</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#define HAVE_ERR_REMOVE_THREAD_STATE 1</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#if !defined(HAVE_SSLV2_CLIENT_METHOD) || \</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">  OPENSSL_VERSION_NUMBER &gt;= 0x10100000L </span><span class="comment">/* 1.1.0+ has no SSLv2 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#undef OPENSSL_NO_SSL2 </span><span class="comment">/* undef first to avoid compiler warnings */</span><span class="preprocessor"></span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#define OPENSSL_NO_SSL2</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10100000L) &amp;&amp; </span><span class="comment">/* OpenSSL 1.1.0+ */</span><span class="preprocessor"> \</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">    !(defined(LIBRESSL_VERSION_NUMBER) &amp;&amp; \</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">      LIBRESSL_VERSION_NUMBER &lt; 0x20700000L)</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#define SSLEAY_VERSION_NUMBER OPENSSL_VERSION_NUMBER</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#define HAVE_X509_GET0_EXTENSIONS 1 </span><span class="comment">/* added in 1.1.0 -pre1 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#define HAVE_OPAQUE_EVP_PKEY 1 </span><span class="comment">/* since 1.1.0 -pre3 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#define HAVE_OPAQUE_RSA_DSA_DH 1 </span><span class="comment">/* since 1.1.0 -pre5 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#define CONST_EXTS const</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#define HAVE_ERR_REMOVE_THREAD_STATE_DEPRECATED 1</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/* funny typecast define due to difference in API */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#ifdef LIBRESSL_VERSION_NUMBER</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#define ARG2_X509_signature_print (X509_ALGOR *)</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#define ARG2_X509_signature_print</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/* For OpenSSL before 1.1.0 */</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#define ASN1_STRING_get0_data(x) ASN1_STRING_data(x)</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#define X509_get0_notBefore(x) X509_get_notBefore(x)</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#define X509_get0_notAfter(x) X509_get_notAfter(x)</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#define CONST_EXTS </span><span class="comment">/* nope */</span><span class="preprocessor"></span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#ifndef LIBRESSL_VERSION_NUMBER</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#define OpenSSL_version_num() SSLeay()</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#ifdef LIBRESSL_VERSION_NUMBER</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#define OpenSSL_version_num() LIBRESSL_VERSION_NUMBER</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x1000200fL) &amp;&amp; </span><span class="comment">/* 1.0.2 or later */</span><span class="preprocessor"> \</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">    !(defined(LIBRESSL_VERSION_NUMBER) &amp;&amp; \</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">      LIBRESSL_VERSION_NUMBER &lt; 0x20700000L)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#define HAVE_X509_GET0_SIGNATURE 1</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x10002003L &amp;&amp; \</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">  OPENSSL_VERSION_NUMBER &lt;= 0x10002FFFL &amp;&amp; \</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">  !defined(OPENSSL_NO_COMP)</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#define HAVE_SSL_COMP_FREE_COMPRESSION_METHODS 1</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &lt; 0x0090808fL)</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/* not present in older OpenSSL */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#define OPENSSL_load_builtin_modules(x)</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"> * Whether SSL_CTX_set_keylog_callback is available.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> * OpenSSL: supported since 1.1.1 https://github.com/openssl/openssl/pull/2287</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> * BoringSSL: supported since d28f59c27bac (committed 2015-11-19)</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> * LibreSSL: unsupported in at least 2.7.2 (explicitly check for it since it</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"> *           lies and pretends to be OpenSSL 2.0.0).</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10101000L &amp;&amp; \</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">     !defined(LIBRESSL_VERSION_NUMBER)) || \</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">    defined(OPENSSL_IS_BORINGSSL)</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#define HAVE_KEYLOG_CALLBACK</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">/* Whether SSL_CTX_set_ciphersuites is available.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"> * OpenSSL: supported since 1.1.1 (commit a53b5be6a05)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"> * BoringSSL: no</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"> * LibreSSL: no</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#if ((OPENSSL_VERSION_NUMBER &gt;= 0x10101000L) &amp;&amp; \</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">     !defined(LIBRESSL_VERSION_NUMBER) &amp;&amp;       \</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">     !defined(OPENSSL_IS_BORINGSSL))</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#define HAVE_SSL_CTX_SET_CIPHERSUITES</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#define HAVE_SSL_CTX_SET_POST_HANDSHAKE_AUTH</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#if defined(LIBRESSL_VERSION_NUMBER)</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">#define OSSL_PACKAGE &quot;LibreSSL&quot;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#elif defined(OPENSSL_IS_BORINGSSL)</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#define OSSL_PACKAGE &quot;BoringSSL&quot;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#define OSSL_PACKAGE &quot;OpenSSL&quot;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10100000L)</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/* up2date versions of OpenSSL maintain the default reasonably secure without</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> * breaking compatibility, so it is better not to override the default by curl</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#define DEFAULT_CIPHER_SELECTION NULL</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">/* ... but it is not the case with old versions of OpenSSL */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#define DEFAULT_CIPHER_SELECTION \</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">  &quot;ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#define ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>ssl_tap_state {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">int</span> master_key_length;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> master_key[SSL_MAX_MASTER_KEY_LENGTH];</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> client_random[SSL3_RANDOM_SIZE];</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;} ssl_tap_state_t;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_SSLKEYLOGFILE */</span><span class="preprocessor"></span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keyword">struct </span>ssl_backend_data {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">/* these ones requires specific SSL-types */</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  SSL_CTX* ctx;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a>*     handle;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  X509*    server_cert;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">/* tap_state holds the last seen master key if we&#39;re logging them */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  ssl_tap_state_t tap_state;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;};</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#define BACKEND connssl-&gt;backend</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> * Number of bytes to read from the random number seed file. This must be</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> * a finite value (because some entropy &quot;files&quot; like /dev/urandom have</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> * an infinite length), but must be large enough to provide enough</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"> * entropy to properly seed OpenSSL&#39;s PRNG.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#define RAND_LOAD_LENGTH 1024</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/* The fp for the open SSLKEYLOGFILE, or NULL if not open */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keyword">static</span> <a class="code" href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">FILE</a> *keylog_file_fp;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#ifdef HAVE_KEYLOG_CALLBACK</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ossl_keylog_callback(<span class="keyword">const</span> <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *ssl, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  (void)ssl;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">/* Using fputs here instead of fprintf since libcurl&#39;s fprintf replacement</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">     may not be thread-safe. */</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">if</span>(keylog_file_fp &amp;&amp; <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> &amp;&amp; *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">char</span> stackbuf[256];</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">size_t</span> linelen = strlen(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span>(linelen &lt;= <span class="keyword">sizeof</span>(stackbuf) - 2)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = stackbuf;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(linelen + 2);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, linelen);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[linelen] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[linelen + 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    fputs(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, keylog_file_fp);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a> != stackbuf)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">#define KEYLOG_PREFIX      &quot;CLIENT_RANDOM &quot;</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="preprocessor">#define KEYLOG_PREFIX_LEN  (sizeof(KEYLOG_PREFIX) - 1)</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> * tap_ssl_key is called by libcurl to make the CLIENT_RANDOMs if the OpenSSL</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> * being used doesn&#39;t have native support for doing that.</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> tap_ssl_key(<span class="keyword">const</span> <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *ssl, ssl_tap_state_t *<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *hex = <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordtype">int</span> pos, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[KEYLOG_PREFIX_LEN + 2 * SSL3_RANDOM_SIZE + 1 +</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            2 * SSL_MAX_MASTER_KEY_LENGTH + 1 + 1];</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keyword">const</span> SSL_SESSION *session = <a class="code" href="setup-vms_8h.html#a58b03f9f0b36400484e017811cb7fe97">SSL_get_session</a>(ssl);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> client_random[SSL3_RANDOM_SIZE];</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> master_key[SSL_MAX_MASTER_KEY_LENGTH];</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">int</span> master_key_length = 0;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span>(!session || !keylog_file_fp)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x10100000L &amp;&amp; \</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">    !(defined(LIBRESSL_VERSION_NUMBER) &amp;&amp; \</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">      LIBRESSL_VERSION_NUMBER &lt; 0x20700000L)</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">/* ssl-&gt;s3 is not checked in openssl 1.1.0-pre6, but let&#39;s assume that</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">   * we have a valid SSL context if we have a non-NULL session. */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  SSL_get_client_random(ssl, client_random, SSL3_RANDOM_SIZE);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  master_key_length = (int)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    SSL_SESSION_get_master_key(session, master_key, SSL_MAX_MASTER_KEY_LENGTH);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">if</span>(ssl-&gt;s3 &amp;&amp; session-&gt;master_key_length &gt; 0) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    master_key_length = session-&gt;master_key_length;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(master_key, session-&gt;master_key, session-&gt;master_key_length);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(client_random, ssl-&gt;s3-&gt;client_random, SSL3_RANDOM_SIZE);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span>(master_key_length &lt;= 0)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">/* Skip writing keys if there is no key or it did not change. */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;master_key_length == master_key_length &amp;&amp;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;     !memcmp(<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;master_key, master_key, master_key_length) &amp;&amp;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;     !memcmp(<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;client_random, client_random, SSL3_RANDOM_SIZE)) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;master_key_length = master_key_length;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;master_key, master_key, master_key_length);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>-&gt;client_random, client_random, SSL3_RANDOM_SIZE);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, KEYLOG_PREFIX, KEYLOG_PREFIX_LEN);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  pos = KEYLOG_PREFIX_LEN;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">/* Client Random for SSLv3/TLS */</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; SSL3_RANDOM_SIZE; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = hex[client_random[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt;&gt; 4];</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = hex[client_random[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp; 0xF];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">/* Master Secret (size is at most SSL_MAX_MASTER_KEY_LENGTH) */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; master_key_length; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = hex[master_key[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt;&gt; 4];</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = hex[master_key[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp; 0xF];</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos++] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[pos] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">/* Using fputs here instead of fprintf since libcurl&#39;s fprintf replacement</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">     may not be thread-safe. */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  fputs(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, keylog_file_fp);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !HAVE_KEYLOG_CALLBACK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_SSLKEYLOGFILE */</span><span class="preprocessor"></span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *SSL_ERROR_to_str(<span class="keywordtype">int</span> err)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;{</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_NONE:</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_NONE&quot;</span>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_SSL:</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_SSL&quot;</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_READ&quot;</span>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_WRITE&quot;</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_X509_LOOKUP:</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_X509_LOOKUP&quot;</span>;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_SYSCALL&quot;</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN:</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_ZERO_RETURN&quot;</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_CONNECT:</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_CONNECT&quot;</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_ACCEPT:</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_ACCEPT&quot;</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">#if defined(SSL_ERROR_WANT_ASYNC)</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_ASYNC:</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_ASYNC&quot;</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#if defined(SSL_ERROR_WANT_ASYNC_JOB)</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_ASYNC_JOB:</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_ASYNC_JOB&quot;</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="preprocessor">#if defined(SSL_ERROR_WANT_EARLY)</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">case</span> SSL_ERROR_WANT_EARLY:</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR_WANT_EARLY&quot;</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_ERROR unknown&quot;</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;}</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/* Return error string for last OpenSSL error</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *ossl_strerror(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> error, <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;{</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <a class="code" href="setup-vms_8h.html#af40b39c5e68f2f343ff9bcba436edafe">ERR_error_string_n</a>(error, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">/* Return an extra data index for the connection data.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"> * This index can be used with SSL_get_ex_data() and SSL_set_ex_data().</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ossl_get_ssl_conn_index(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;{</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> ssl_ex_data_conn_index = -1;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">if</span>(ssl_ex_data_conn_index &lt; 0) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    ssl_ex_data_conn_index = SSL_get_ex_new_index(0, NULL, NULL, NULL, NULL);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">return</span> ssl_ex_data_conn_index;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">/* Return an extra data index for the sockindex.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"> * This index can be used with SSL_get_ex_data() and SSL_set_ex_data().</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ossl_get_ssl_sockindex_index(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;{</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> ssl_ex_data_sockindex_index = -1;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">if</span>(ssl_ex_data_sockindex_index &lt; 0) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    ssl_ex_data_sockindex_index = SSL_get_ex_new_index(0, NULL, NULL, NULL,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        NULL);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">return</span> ssl_ex_data_sockindex_index;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> passwd_callback(<span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> encrypting,</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                           <span class="keywordtype">void</span> *global_passwd)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;{</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0 == encrypting);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span>(!encrypting) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="unit1602_8c.html#a70d958290b8b8ebaff45365d4e5b9e54">klen</a> = <a class="code" href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a>(strlen((<span class="keywordtype">char</span> *)global_passwd));</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span>(num &gt; <a class="code" href="unit1602_8c.html#a70d958290b8b8ebaff45365d4e5b9e54">klen</a>) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, global_passwd, <a class="code" href="unit1602_8c.html#a70d958290b8b8ebaff45365d4e5b9e54">klen</a> + 1);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1602_8c.html#a70d958290b8b8ebaff45365d4e5b9e54">klen</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> * rand_enough() returns TRUE if we have seeded the random engine properly.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> rand_enough(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;{</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">return</span> (0 != <a class="code" href="setup-vms_8h.html#a35d18fa01c2a73e674e3fe2f9f43b618">RAND_status</a>()) ? <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_seed(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;{</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="comment">/* we have the &quot;SSL is seeded&quot; boolean static to prevent multiple</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">     time-consuming seedings in vain */</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> ssl_seeded = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">char</span> fname[256];</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span>(ssl_seeded)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span>(rand_enough()) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">/* OpenSSL 1.1.0+ will return here */</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    ssl_seeded = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#ifndef RANDOM_FILE</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">/* if RANDOM_FILE isn&#39;t defined, we only perform this if an option tells</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">     us to! */</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fabf50bfe61fa3dc11954f35f0b84217d4">STRING_SSL_RANDOM_FILE</a>])</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#define RANDOM_FILE &quot;&quot; </span><span class="comment">/* doesn&#39;t matter won&#39;t be used */</span><span class="preprocessor"></span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">/* let the option override the define */</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <a class="code" href="setup-vms_8h.html#ae4d853c0bba4917e70a486afd1b2eafa">RAND_load_file</a>((<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fabf50bfe61fa3dc11954f35f0b84217d4">STRING_SSL_RANDOM_FILE</a>]?</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fabf50bfe61fa3dc11954f35f0b84217d4">STRING_SSL_RANDOM_FILE</a>]:</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    <a class="code" href="config-vxworks_8h.html#ab4f3d89a4ce924109f1d4d9dd78128bf">RANDOM_FILE</a>),</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                   RAND_LOAD_LENGTH);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span>(rand_enough())</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">#if defined(HAVE_RAND_EGD)</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">/* only available in OpenSSL 0.9.5 and later */</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">/* EGD_SOCKET is set at configure time or not at all */</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor">#ifndef EGD_SOCKET</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">/* If we don&#39;t have the define set, we only do this if the egd-option</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">     is set */</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa88d3e306ecb6c0404e204831e8df7128">STRING_SSL_EGDSOCKET</a>])</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor">#define EGD_SOCKET &quot;&quot; </span><span class="comment">/* doesn&#39;t matter won&#39;t be used */</span><span class="preprocessor"></span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">/* If there&#39;s an option and a define, the option overrides the</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">       define */</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="setup-vms_8h.html#af7c70d7048f69d75d7a1f47c070f4732">RAND_egd</a>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa88d3e306ecb6c0404e204831e8df7128">STRING_SSL_EGDSOCKET</a>]?</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                       <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa88d3e306ecb6c0404e204831e8df7128">STRING_SSL_EGDSOCKET</a>]:EGD_SOCKET);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span>(-1 != ret) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">if</span>(rand_enough())</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">/* fallback to a custom seeding of the PRNG using a hash based on a current</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">     time */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> randb[64];</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = <span class="keyword">sizeof</span>(randb);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, i_max;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0, i_max = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcurltime.html">curltime</a>); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; i_max; ++<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keyword">struct </span><a class="code" href="structcurltime.html">curltime</a> tv = <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>();</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <a class="code" href="select_8c.html#a5e5b75391965e920e725abf29b0bdcef">Curl_wait_ms</a>(1);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      tv.<a class="code" href="structcurltime.html#aa037ee31cbd9bc40e07ebade62e7ad5d">tv_sec</a> *= <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      tv.<a class="code" href="structcurltime.html#a2bb2442cdc8b9e4d2287805ce8febb17">tv_usec</a> *= (<span class="keywordtype">unsigned</span> int)<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 2;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      tv.<a class="code" href="structcurltime.html#aa037ee31cbd9bc40e07ebade62e7ad5d">tv_sec</a> ^= ((<a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>().<a class="code" href="structcurltime.html#aa037ee31cbd9bc40e07ebade62e7ad5d">tv_sec</a> + <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>().<a class="code" href="structcurltime.html#a2bb2442cdc8b9e4d2287805ce8febb17">tv_usec</a>) *</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 3)) &lt;&lt; 8;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      tv.<a class="code" href="structcurltime.html#a2bb2442cdc8b9e4d2287805ce8febb17">tv_usec</a> ^= (<span class="keywordtype">unsigned</span> int) ((<a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>().<a class="code" href="structcurltime.html#aa037ee31cbd9bc40e07ebade62e7ad5d">tv_sec</a> +</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                                     <a class="code" href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a>().<a class="code" href="structcurltime.html#a2bb2442cdc8b9e4d2287805ce8febb17">tv_usec</a>) *</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                                    (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 4)) &lt;&lt; 16;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;randb[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcurltime.html">curltime</a>)], &amp;tv,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;             <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcurltime.html">curltime</a>));</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="setup-vms_8h.html#a78b44abc77b6c9dc2b85e938bfb399c1">RAND_add</a>(randb, (<span class="keywordtype">int</span>)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, (<span class="keywordtype">double</span>)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>/2);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  } <span class="keywordflow">while</span>(!rand_enough());</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">/* generates a default path for the random seed file */</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  fname[0] = 0; <span class="comment">/* blank it first */</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="setup-vms_8h.html#af6aec876f8a115fd32e475992c422beb">RAND_file_name</a>(fname, <span class="keyword">sizeof</span>(fname));</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span>(fname[0]) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">/* we got a file name to try */</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="setup-vms_8h.html#ae4d853c0bba4917e70a486afd1b2eafa">RAND_load_file</a>(fname, RAND_LOAD_LENGTH);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span>(rand_enough())</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;libcurl is now using a weak random seed!\n&quot;</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">return</span> (rand_enough() ? <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a> :</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a> <span class="comment">/* confusing error code */</span>);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;}</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="preprocessor">#ifndef SSL_FILETYPE_ENGINE</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#define SSL_FILETYPE_ENGINE 42</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#ifndef SSL_FILETYPE_PKCS12</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#define SSL_FILETYPE_PKCS12 43</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_file_type(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a> || !<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>[0])</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">return</span> SSL_FILETYPE_PEM;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, <span class="stringliteral">&quot;PEM&quot;</span>))</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">return</span> SSL_FILETYPE_PEM;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, <span class="stringliteral">&quot;DER&quot;</span>))</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">return</span> SSL_FILETYPE_ASN1;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, <span class="stringliteral">&quot;ENG&quot;</span>))</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">return</span> SSL_FILETYPE_ENGINE;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, <span class="stringliteral">&quot;P12&quot;</span>))</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">return</span> SSL_FILETYPE_PKCS12;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"> * Supply default password to the engine user interface conversation.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"> * The password is passed by OpenSSL engine from ENGINE_load_private_key()</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"> * last argument to the ui and can be obtained by UI_get0_user_data(ui) here.</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ssl_ui_reader(UI *ui, UI_STRING *uis)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;{</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *password;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="setup-vms_8h.html#a52caeb5c80ab333eed112e7223109005">UI_get_string_type</a>(uis)) {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">case</span> UIT_PROMPT:</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordflow">case</span> UIT_VERIFY:</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    password = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="setup-vms_8h.html#a6897a03e447918c3806f3d265f6b215b">UI_get0_user_data</a>(ui);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span>(password &amp;&amp; (<a class="code" href="setup-vms_8h.html#a2af3e2b30a5128e2d1e75819558f50c0">UI_get_input_flags</a>(uis) &amp; UI_INPUT_FLAG_DEFAULT_PWD)) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <a class="code" href="setup-vms_8h.html#ac18c60575612d7cc3aa9dd7825622704">UI_set_result</a>(ui, uis, password);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="setup-vms_8h.html#a1e4221f2e2f29468d8e87f6ced65dbb9">UI_method_get_reader</a>(<a class="code" href="setup-vms_8h.html#a329890f98ddcebf882f2424436952ba8">UI_OpenSSL</a>()))(ui, uis);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment"> * Suppress interactive request for a default password if available.</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ssl_ui_writer(UI *ui, UI_STRING *uis)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;{</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="setup-vms_8h.html#a52caeb5c80ab333eed112e7223109005">UI_get_string_type</a>(uis)) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">case</span> UIT_PROMPT:</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">case</span> UIT_VERIFY:</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a6897a03e447918c3806f3d265f6b215b">UI_get0_user_data</a>(ui) &amp;&amp;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;       (<a class="code" href="setup-vms_8h.html#a2af3e2b30a5128e2d1e75819558f50c0">UI_get_input_flags</a>(uis) &amp; UI_INPUT_FLAG_DEFAULT_PWD)) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="setup-vms_8h.html#a5b2ab27f36f5c0fc344578890743dc00">UI_method_get_writer</a>(<a class="code" href="setup-vms_8h.html#a329890f98ddcebf882f2424436952ba8">UI_OpenSSL</a>()))(ui, uis);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"> * Check if a given string is a PKCS#11 URI</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> is_pkcs11_uri(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;{</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">string</span> &amp;&amp; <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="keywordtype">string</span>, <span class="stringliteral">&quot;pkcs11:&quot;</span>, 7));</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;}</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_set_engine(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *engine);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="keyword">static</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keywordtype">int</span> cert_stuff(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;               SSL_CTX* ctx,</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;               <span class="keywordtype">char</span> *cert_file,</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">char</span> *cert_type,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;               <span class="keywordtype">char</span> *key_file,</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">char</span> *key_type,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;               <span class="keywordtype">char</span> *key_passwd)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;{</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordtype">char</span> error_buffer[256];</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordtype">bool</span> check_privkey = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordtype">int</span> file_type = do_file_type(cert_type);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordflow">if</span>(cert_file || (file_type == SSL_FILETYPE_ENGINE)) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *ssl;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    X509 *x509;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">int</span> cert_done = 0;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span>(key_passwd) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="comment">/* set the password in the callback userdata */</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      SSL_CTX_set_default_passwd_cb_userdata(ctx, key_passwd);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="comment">/* Set passwd callback: */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <a class="code" href="setup-vms_8h.html#a406ac1bed18a820aa841fef93a8fa9af">SSL_CTX_set_default_passwd_cb</a>(ctx, passwd_callback);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">switch</span>(file_type) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_PEM:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">/* SSL_CTX_use_certificate_chain_file() only works on PEM files */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">if</span>(SSL_CTX_use_certificate_chain_file(ctx,</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                            cert_file) != 1) {</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;              <span class="stringliteral">&quot;could not load PEM client certificate, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;              <span class="stringliteral">&quot; error %s, &quot;</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;              <span class="stringliteral">&quot;(no key found, wrong pass phrase, or wrong file format?)&quot;</span>,</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_ASN1:</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="comment">/* SSL_CTX_use_certificate_file() works with either PEM or ASN1, but</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">         we use the case above for PEM so this can only be performed with</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">         ASN1 files. */</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a00e5f84f5e9e3192ecbe1e4d458f5606">SSL_CTX_use_certificate_file</a>(ctx,</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                      cert_file,</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                      file_type) != 1) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;              <span class="stringliteral">&quot;could not load ASN1 client certificate, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;              <span class="stringliteral">&quot; error %s, &quot;</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;              <span class="stringliteral">&quot;(no key found, wrong pass phrase, or wrong file format?)&quot;</span>,</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_ENGINE:</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="preprocessor">#if defined(USE_OPENSSL_ENGINE) &amp;&amp; defined(ENGINE_CTRL_GET_CMD_FROM_NAME)</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">/* Implicitly use pkcs11 engine if none was provided and the</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">         * cert_file is a PKCS#11 URI */</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          <span class="keywordflow">if</span>(is_pkcs11_uri(cert_file)) {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">if</span>(Curl_ossl_set_engine(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;pkcs11&quot;</span>) != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;              <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd_name = <span class="stringliteral">&quot;LOAD_CERT_CTRL&quot;</span>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          <span class="keyword">struct </span>{</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *cert_id;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            X509 *cert;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          } params;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          params.cert_id = cert_file;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          params.cert = NULL;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <span class="comment">/* Does the engine supports LOAD_CERT_CTRL ? */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a1d23a9a2785cb38e8ec54e5ff8848b85">ENGINE_ctrl</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine, ENGINE_CTRL_GET_CMD_FROM_NAME,</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                          0, (<span class="keywordtype">void</span> *)cmd_name, NULL)) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ssl engine does not support loading certificates&quot;</span>);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          <span class="comment">/* Load the certificate from the engine */</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a36c338edca3188a9c5ab9234e65c53f1">ENGINE_ctrl_cmd</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine, cmd_name,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                              0, &amp;params, NULL, 1)) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ssl engine cannot load client cert with id&quot;</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                  <span class="stringliteral">&quot; &#39;%s&#39; [%s]&quot;</span>, cert_file,</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                  ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                <span class="keyword">sizeof</span>(error_buffer)));</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">if</span>(!params.cert) {</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ssl engine didn&#39;t initialized the certificate &quot;</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                  <span class="stringliteral">&quot;properly.&quot;</span>);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;          }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#ac78686b148fb4b4ec55b126c404bd89e">SSL_CTX_use_certificate</a>(ctx, params.cert) != 1) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable to set client certificate&quot;</span>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(params.cert);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(params.cert); <span class="comment">/* we don&#39;t need the handle any more... */</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;crypto engine not set, can&#39;t load certificate&quot;</span>);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;file type ENG for certificate not implemented&quot;</span>);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_PKCS12:</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      BIO *fp = NULL;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      PKCS12 *p12 = NULL;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      EVP_PKEY *pri;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      STACK_OF(X509) *ca = NULL;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      fp = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(BIO_s_file());</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">if</span>(fp == NULL) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;              <span class="stringliteral">&quot;BIO_new return NULL, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;              <span class="stringliteral">&quot; error %s&quot;</span>,</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">if</span>(BIO_read_filename(fp, cert_file) &lt;= 0) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;could not open PKCS12 file &#39;%s&#39;&quot;</span>, cert_file);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      p12 = d2i_PKCS12_bio(fp, NULL);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">if</span>(!p12) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;error reading PKCS12 file &#39;%s&#39;&quot;</span>, cert_file);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <a class="code" href="setup-vms_8h.html#ab6f7f30c1eade5bcd93023f8f6948bb3">PKCS12_PBE_add</a>();</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a87a05918f3772aac3d94e2028f7ef2a9">PKCS12_parse</a>(p12, key_passwd, &amp;pri, &amp;x509,</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                       &amp;ca)) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;              <span class="stringliteral">&quot;could not parse PKCS12 file, check password, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;              <span class="stringliteral">&quot; error %s&quot;</span>,</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="setup-vms_8h.html#acb43861076a3c8d414e6a07db1426f7c">PKCS12_free</a>(p12);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <a class="code" href="setup-vms_8h.html#acb43861076a3c8d414e6a07db1426f7c">PKCS12_free</a>(p12);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#ac78686b148fb4b4ec55b126c404bd89e">SSL_CTX_use_certificate</a>(ctx, x509) != 1) {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;              <span class="stringliteral">&quot;could not load PKCS12 client certificate, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;              <span class="stringliteral">&quot; error %s&quot;</span>,</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a44ca1aff4da82f55bd20b3c7a7f2e383">SSL_CTX_use_PrivateKey</a>(ctx, pri) != 1) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable to use private key from PKCS12 file &#39;%s&#39;&quot;</span>,</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;              cert_file);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a06dc4c3f54ecece03a956a8f99296ff5">SSL_CTX_check_private_key</a> (ctx)) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;private key from PKCS12 file &#39;%s&#39; &quot;</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;              <span class="stringliteral">&quot;does not match certificate in same file&quot;</span>, cert_file);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="comment">/* Set Certificate Verification chain */</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span>(ca) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">while</span>(sk_X509_num(ca)) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          <span class="comment">/*</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">           * Note that sk_X509_pop() is used below to make sure the cert is</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">           * removed from the stack properly before getting passed to</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">           * SSL_CTX_add_extra_chain_cert(), which takes ownership. Previously</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">           * we used sk_X509_value() instead, but then we&#39;d clean it in the</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">           * subsequent sk_X509_pop_free() call.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">           */</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          X509 *<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a> = sk_X509_pop(ca);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a071ec51a8ccde74c39a480a1252bebf2">SSL_CTX_add_client_CA</a>(ctx, <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>)) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;cannot add certificate to client CA list&quot;</span>);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          <span class="keywordflow">if</span>(!SSL_CTX_add_extra_chain_cert(ctx, <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>)) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;cannot add certificate to certificate chain&quot;</span>);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      cert_done = 1;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>:</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <a class="code" href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a>(pri);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(x509);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      sk_X509_pop_free(ca, <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">if</span>(!cert_done)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">return</span> 0; <span class="comment">/* failure! */</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;not supported file type &#39;%s&#39; for certificate&quot;</span>, cert_type);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    file_type = do_file_type(key_type);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">switch</span>(file_type) {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_PEM:</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordflow">if</span>(cert_done)</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordflow">if</span>(!key_file)</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="comment">/* cert &amp; key can only be in PEM case in the same file */</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        key_file = cert_file;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_ASN1:</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a740f86ab81898650517cedc4e997c200">SSL_CTX_use_PrivateKey_file</a>(ctx, key_file, file_type) != 1) {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable to set private key file: &#39;%s&#39; type %s&quot;</span>,</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;              key_file, key_type?key_type:<span class="stringliteral">&quot;PEM&quot;</span>);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      }</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_ENGINE:</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      {                         <span class="comment">/* XXXX still needs some work */</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        EVP_PKEY *priv_key = NULL;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment">/* Implicitly use pkcs11 engine if none was provided and the</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">         * key_file is a PKCS#11 URI */</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;          <span class="keywordflow">if</span>(is_pkcs11_uri(key_file)) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="keywordflow">if</span>(Curl_ossl_set_engine(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;pkcs11&quot;</span>) != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;              <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          UI_METHOD *ui_method =</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <a class="code" href="setup-vms_8h.html#a458ee91fc97fec42499863353fc0ed1a">UI_create_method</a>((<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;curl user interface&quot;</span>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          <span class="keywordflow">if</span>(!ui_method) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable do create &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                  <span class="stringliteral">&quot; user-interface method&quot;</span>);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          <a class="code" href="setup-vms_8h.html#a49169ee8e53a3c836d2814c424b043e3">UI_method_set_opener</a>(ui_method, <a class="code" href="setup-vms_8h.html#a86ecfb04d381e5c007dbd56643be77c2">UI_method_get_opener</a>(<a class="code" href="setup-vms_8h.html#a329890f98ddcebf882f2424436952ba8">UI_OpenSSL</a>()));</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          <a class="code" href="setup-vms_8h.html#a0608770b2a8065a7f8491ca019ebc10b">UI_method_set_closer</a>(ui_method, <a class="code" href="setup-vms_8h.html#a05075fd2898e376d6ac0b3c00c4f6404">UI_method_get_closer</a>(<a class="code" href="setup-vms_8h.html#a329890f98ddcebf882f2424436952ba8">UI_OpenSSL</a>()));</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <a class="code" href="setup-vms_8h.html#a0093ee9027cc3bca1814103f77b95c26">UI_method_set_reader</a>(ui_method, ssl_ui_reader);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <a class="code" href="setup-vms_8h.html#afd3703179f9d1c463c329e6823ad21ed">UI_method_set_writer</a>(ui_method, ssl_ui_writer);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <span class="comment">/* the typecast below was added to please mingw32 */</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;          priv_key = (EVP_PKEY *)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <a class="code" href="setup-vms_8h.html#a09cd5396359dce8f8c614863248ed057">ENGINE_load_private_key</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine, key_file,</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                    ui_method,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                    key_passwd);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          <a class="code" href="setup-vms_8h.html#ad0b04ac080f2d189a852e8b479d7734b">UI_destroy_method</a>(ui_method);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;          <span class="keywordflow">if</span>(!priv_key) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to load private key from crypto engine&quot;</span>);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a44ca1aff4da82f55bd20b3c7a7f2e383">SSL_CTX_use_PrivateKey</a>(ctx, priv_key) != 1) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable to set private key&quot;</span>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <a class="code" href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a>(priv_key);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;          }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          <a class="code" href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a>(priv_key);  <span class="comment">/* we don&#39;t need the handle any more... */</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;crypto engine not set, can&#39;t load private key&quot;</span>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;file type ENG for private key not supported&quot;</span>);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">case</span> SSL_FILETYPE_PKCS12:</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span>(!cert_done) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;file type P12 for private key not supported&quot;</span>);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;not supported file type for private key&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    ssl = <a class="code" href="setup-vms_8h.html#a02e6c397c6763f0c0be42921bdb1a3c9">SSL_new</a>(ctx);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">if</span>(!ssl) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unable to create an SSL structure&quot;</span>);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    x509 = <a class="code" href="setup-vms_8h.html#a93ae7336fe5201923da0b5be5db508f9">SSL_get_certificate</a>(ssl);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">/* This version was provided by Evan Jordan and is supposed to not</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">       leak memory as the previous version: */</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span>(x509) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      EVP_PKEY *pktmp = <a class="code" href="setup-vms_8h.html#a2505312fdce26ff8bc2d3686cc6b9a6f">X509_get_pubkey</a>(x509);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="setup-vms_8h.html#a54131e400e9a600d4597134398de41ba">EVP_PKEY_copy_parameters</a>(pktmp, <a class="code" href="setup-vms_8h.html#a75f751890ae1efc310dd1b018878d84d">SSL_get_privatekey</a>(ssl));</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <a class="code" href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a>(pktmp);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_IS_BORINGSSL)</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="comment">/* If RSA is used, don&#39;t check the private key if its flags indicate</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">       * it doesn&#39;t support it. */</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      EVP_PKEY *priv_key = <a class="code" href="setup-vms_8h.html#a75f751890ae1efc310dd1b018878d84d">SSL_get_privatekey</a>(ssl);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordtype">int</span> pktype;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_EVP_PKEY</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      pktype = EVP_PKEY_id(priv_key);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      pktype = priv_key-&gt;type;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">if</span>(pktype == EVP_PKEY_RSA) {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        RSA *rsa = EVP_PKEY_get1_RSA(priv_key);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordflow">if</span>(RSA_flags(rsa) &amp; RSA_METHOD_FLAG_NO_CHECK)</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;          check_privkey = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        RSA_free(rsa); <span class="comment">/* Decrement reference count */</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="setup-vms_8h.html#a706c82bfae7ce618d3f0e39a0d72a988">SSL_free</a>(ssl);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">/* If we are using DSA, we can copy the parameters from</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">     * the private key */</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">if</span>(check_privkey == <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="comment">/* Now we know that a key and cert have been set against</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">       * the SSL context */</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a06dc4c3f54ecece03a956a8f99296ff5">SSL_CTX_check_private_key</a>(ctx)) {</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Private key does not match the certificate public key&quot;</span>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">/* returns non-zero on failure */</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_name_oneline(X509_NAME *<a class="code" href="structa.html">a</a>, <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;{</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordflow">return</span> X509_NAME_oneline(<a class="code" href="structa.html">a</a>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  BIO *bio_out = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(<a class="code" href="setup-vms_8h.html#a89bfb3b0711e9bd660ac564e1cac91f8">BIO_s_mem</a>());</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  BUF_MEM *biomem;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordflow">if</span>(!bio_out)</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* alloc failed! */</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-vms_8h.html#a9c484827ba0013b393e32968e412c856">X509_NAME_print_ex</a>(bio_out, <a class="code" href="structa.html">a</a>, 0, XN_FLAG_SEP_SPLUS_SPC);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  BIO_get_mem_ptr(bio_out, &amp;biomem);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span>((<span class="keywordtype">size_t</span>)biomem-&gt;length &lt; <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = biomem-&gt;length;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>--; <span class="comment">/* don&#39;t overwrite the buffer end */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, biomem-&gt;data, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>] = 0;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(bio_out);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordflow">return</span> !<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Curl_ossl_init(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;{</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordtype">char</span> *keylog_file_name;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="setup-vms_8h.html#abee800186c80a76ed83b0c2dc227e238">OPENSSL_load_builtin_modules</a>();</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <a class="code" href="setup-vms_8h.html#abc1bb4410eebd8b9c1be26cc86029354">ENGINE_load_builtin_engines</a>();</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="comment">/* OPENSSL_config(NULL); is &quot;strongly recommended&quot; to use but unfortunately</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">     that function makes an exit() call on wrongly formatted config files</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">     which makes it hard to use in some situations. OPENSSL_config() itself</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">     calls CONF_modules_load_file() and we use that instead and we ignore</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">     its return code! */</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">/* CONF_MFLAGS_DEFAULT_SECTION introduced some time between 0.9.8b and</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">     0.9.8e */</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="preprocessor">#ifndef CONF_MFLAGS_DEFAULT_SECTION</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="preprocessor">#define CONF_MFLAGS_DEFAULT_SECTION 0x0</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_OPENSSL_AUTO_LOAD_CONFIG</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <a class="code" href="setup-vms_8h.html#a8e83b9ac94b508d151adc74c69a72a27">CONF_modules_load_file</a>(NULL, NULL,</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                         CONF_MFLAGS_DEFAULT_SECTION|</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                         CONF_MFLAGS_IGNORE_MISSING_FILE);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10100000L) &amp;&amp; \</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="preprocessor">    !defined(LIBRESSL_VERSION_NUMBER)</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">/* OpenSSL 1.1.0+ takes care of initialization itself */</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="comment">/* Lets get nice error messages */</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <a class="code" href="setup-vms_8h.html#a18498436deaef8bd0ca75406c504ea54">SSL_load_error_strings</a>();</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">/* Init the global ciphers and digests */</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">if</span>(!SSLeay_add_ssl_algorithms())</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  OpenSSL_add_all_algorithms();</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordflow">if</span>(!keylog_file_fp) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    keylog_file_name = <a class="code" href="curl_8h.html#a613d9e6457f36b84548cbf2006a34e14">curl_getenv</a>(<span class="stringliteral">&quot;SSLKEYLOGFILE&quot;</span>);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">if</span>(keylog_file_name) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      keylog_file_fp = fopen(keylog_file_name, <a class="code" href="curl__setup_8h.html#a83627b88ed8d3c99516bb8708bde66cc">FOPEN_APPENDTEXT</a>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="keywordflow">if</span>(keylog_file_fp) {</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">if</span>(setvbuf(keylog_file_fp, NULL, _IONBF, 0))</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordflow">if</span>(setvbuf(keylog_file_fp, NULL, _IOLBF, 4096))</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          fclose(keylog_file_fp);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          keylog_file_fp = NULL;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(keylog_file_name);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="comment">/* Initialize the extra data indexes */</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="keywordflow">if</span>(ossl_get_ssl_conn_index() &lt; 0 || ossl_get_ssl_sockindex_index() &lt; 0)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;}</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">/* Global cleanup */</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_ossl_cleanup(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;{</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10100000L) &amp;&amp; \</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="preprocessor">    !defined(LIBRESSL_VERSION_NUMBER)</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="comment">/* OpenSSL 1.1 deprecates all these cleanup functions and</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">     turns them into no-ops in OpenSSL 1.0 compatibility mode */</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="comment">/* Free ciphers and digests lists */</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <a class="code" href="setup-vms_8h.html#a563034aa65354c4b56f552668e17b557">EVP_cleanup</a>();</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">/* Free engine list */</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  ENGINE_cleanup();</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="comment">/* Free OpenSSL error strings */</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <a class="code" href="setup-vms_8h.html#a7152baf27577993557a9c7fcafdfd288">ERR_free_strings</a>();</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">/* Free thread local error state, destroying hash upon zero refcount */</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="preprocessor">#ifdef HAVE_ERR_REMOVE_THREAD_STATE</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  ERR_remove_thread_state(NULL);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <a class="code" href="setup-vms_8h.html#a2e9e338108c9f1445d8da6a8dc8a129c">ERR_remove_state</a>(0);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="comment">/* Free all memory allocated by all configuration modules */</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  CONF_modules_free();</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_COMP_FREE_COMPRESSION_METHODS</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  SSL_COMP_free_compression_methods();</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor">#ifdef ENABLE_SSLKEYLOGFILE</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="keywordflow">if</span>(keylog_file_fp) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    fclose(keylog_file_fp);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    keylog_file_fp = NULL;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;}</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment"> * This function is used to determine connection status.</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment"> * Return codes:</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"> *     1 means the connection is still in place</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment"> *     0 means the connection has been closed</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment"> *    -1 means the connection status is unknown</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Curl_ossl_check_cxn(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;{</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="comment">/* SSL_peek takes data out of the raw recv buffer without peeking so we use</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">     recv MSG_PEEK instead. Bug #795 */</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="preprocessor">#ifdef MSG_PEEK</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  nread = recv((<a class="code" href="config-dos_8h.html#a6b79be6b722e2ba9009495691c233d77">RECV_TYPE_ARG1</a>)conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>], (<a class="code" href="config-dos_8h.html#a873c61ebe62de63e8a199bc819424301">RECV_TYPE_ARG2</a>)&amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;               (<a class="code" href="config-dos_8h.html#abb2068740d788b2a25b7d378bb803d5c">RECV_TYPE_ARG3</a>)1, (<a class="code" href="config-dos_8h.html#aa257e0c95ce1b33306381a8d7b9d5962">RECV_TYPE_ARG4</a>)MSG_PEEK);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordflow">if</span>(nread == 0)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">return</span> 0; <span class="comment">/* connection has been closed */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordflow">if</span>(nread == 1)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* connection still in place */</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nread == -1) {</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordtype">int</span> err = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">if</span>(err == EINPROGRESS ||</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;#<span class="keywordflow">if</span> defined(<a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>) &amp;&amp; (<a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a> != EWOULDBLOCK)</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;         err == <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a> ||</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;#endif</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;         err == EWOULDBLOCK)</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keywordflow">return</span> 1; <span class="comment">/* connection still in place */</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordflow">if</span>(err == ECONNRESET ||</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;#ifdef ECONNABORTED</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;         err == ECONNABORTED ||</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;#endif</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;#ifdef ENETDOWN</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;         err == ENETDOWN ||</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;#endif</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;#ifdef ENETRESET</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;         err == ENETRESET ||</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;#endif</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;#ifdef ESHUTDOWN</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;         err == ESHUTDOWN ||</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;#endif</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;#ifdef ETIMEDOUT</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;         err == ETIMEDOUT ||</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;#endif</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;         err == ENOTCONN)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="keywordflow">return</span> 0; <span class="comment">/* connection has been closed */</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keywordflow">return</span> -1; <span class="comment">/* connection status unknown */</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;}</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">/* Selects an OpenSSL crypto engine</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_set_engine(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *engine)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;{</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  ENGINE *e;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x00909000L</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  e = ENGINE_by_id(engine);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">/* avoid memory leak */</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordflow">for</span>(e = <a class="code" href="setup-vms_8h.html#a91672027ad0aa37c6f5ba9a1aefa2d4c">ENGINE_get_first</a>(); e; e = <a class="code" href="setup-vms_8h.html#a56f44a82e25148deb9ef182f1ae157ac">ENGINE_get_next</a>(e)) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *e_id = <a class="code" href="setup-vms_8h.html#a99ae6c0f531e926e6839b9ece58b17e7">ENGINE_get_id</a>(e);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span>(!strcmp(engine, e_id))</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  }</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordflow">if</span>(!e) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL Engine &#39;%s&#39; not found&quot;</span>, engine);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a52cb532d2a08f913d6273f0b4341e135">CURLE_SSL_ENGINE_NOTFOUND</a>;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <a class="code" href="setup-vms_8h.html#a4dbcbfb09083d9bcaac672463d68a909">ENGINE_finish</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine);</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="setup-vms_8h.html#a7d07acd5584159f20f836962c4abdc1a">ENGINE_free</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.engine = NULL;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  }</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a55b93f90eb95b7e6789437c392e0e788">ENGINE_init</a>(e)) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[256];</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <a class="code" href="setup-vms_8h.html#a7d07acd5584159f20f836962c4abdc1a">ENGINE_free</a>(e);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed to initialise SSL Engine &#39;%s&#39;:\n%s&quot;</span>,</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          engine, ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)));</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aa13f40e5aac785732191143407c0c612">CURLE_SSL_ENGINE_INITFAILED</a>;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  }</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <a class="code" href="structdata.html">data</a>-&gt;state.engine = e;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  (void)engine;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL Engine not supported&quot;</span>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a52cb532d2a08f913d6273f0b4341e135">CURLE_SSL_ENGINE_NOTFOUND</a>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;}</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">/* Sets engine as default for all SSL operations</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_set_engine_default(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a5f8018d9c44060e2e90cd6fabe1d6692">ENGINE_set_default</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine, ENGINE_METHOD_ALL) &gt; 0) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;set default crypto engine &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            <a class="code" href="setup-vms_8h.html#a99ae6c0f531e926e6839b9ece58b17e7">ENGINE_get_id</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine));</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;set default crypto engine &#39;%s&#39; failed&quot;</span>,</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            <a class="code" href="setup-vms_8h.html#a99ae6c0f531e926e6839b9ece58b17e7">ENGINE_get_id</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine));</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a91b56d8b059414b941e73150cd5fb3a2">CURLE_SSL_ENGINE_SETFAILED</a>;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    }</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  (void) <a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;}</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">/* Return list of OpenSSL crypto engine names.</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *Curl_ossl_engines_list(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;{</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *list = NULL;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="keyword">struct </span><a class="code" href="structcurl__slist.html">curl_slist</a> *beg;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  ENGINE *e;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordflow">for</span>(e = <a class="code" href="setup-vms_8h.html#a91672027ad0aa37c6f5ba9a1aefa2d4c">ENGINE_get_first</a>(); e; e = <a class="code" href="setup-vms_8h.html#a56f44a82e25148deb9ef182f1ae157ac">ENGINE_get_next</a>(e)) {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    beg = <a class="code" href="curl_8h.html#a7ea20d9a213c806f82446bed893f423f">curl_slist_append</a>(list, <a class="code" href="setup-vms_8h.html#a99ae6c0f531e926e6839b9ece58b17e7">ENGINE_get_id</a>(e));</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span>(!beg) {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <a class="code" href="curl_8h.html#a3a28c84e40db0ef30859b680281c9d36">curl_slist_free_all</a>(list);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    list = beg;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  (void) <a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordflow">return</span> list;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ossl_close(<span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;{</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;handle) {</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    (void)<a class="code" href="setup-vms_8h.html#a15e99abfd6e6241f1424fd71331a12ec">SSL_shutdown</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="setup-vms_8h.html#ab2741d20acc86b4564591f5fbcd3c1f1">SSL_set_connect_state</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="setup-vms_8h.html#a706c82bfae7ce618d3f0e39a0d72a988">SSL_free</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    BACKEND-&gt;handle = NULL;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  }</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ctx) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="setup-vms_8h.html#a94cf6f18d4f14d23153cdeb90fa5923d">SSL_CTX_free</a>(BACKEND-&gt;ctx);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    BACKEND-&gt;ctx = NULL;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment"> * This function is called when an SSL connection is closed.</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_ossl_close(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;{</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  ossl_close(&amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex]);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  ossl_close(&amp;conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[sockindex]);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;}</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment"> * This function is called to shut down the SSL layer but keep the</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment"> * socket open (CCC - Clear Command Channel)</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Curl_ossl_shutdown(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;{</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="keywordtype">int</span> retval = 0;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[256]; <span class="comment">/* We will use this for the OpenSSL error buffer, so it has</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">                    to be at least 256 bytes long. */</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sslerror;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="keywordtype">int</span> buffsize;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="keywordtype">int</span> err;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keywordtype">bool</span> done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="comment">/* This has only been tested on the proftpd server, and the mod_tls code</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">     sends a close notify alert without waiting for a close notify alert in</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">     response. Thus we wait for a close notify alert from the server, but</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">     we do not send one. Let&#39;s hope other servers do the same... */</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_ccc == <a class="code" href="curl_8h.html#a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a">CURLFTPSSL_CCC_ACTIVE</a>)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      (void)<a class="code" href="setup-vms_8h.html#a15e99abfd6e6241f1424fd71331a12ec">SSL_shutdown</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;handle) {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    buffsize = (int)<span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">while</span>(!done) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="keywordtype">int</span> what = <a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex],</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                                 SSL_SHUTDOWN_TIMEOUT);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="keywordflow">if</span>(what &gt; 0) {</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <a class="code" href="setup-vms_8h.html#a690ca365fec9f672101a774fb82fe3e7">ERR_clear_error</a>();</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="comment">/* Something to read, let&#39;s do it and hope that it is the close</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">           notify alert from the server */</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        nread = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)<a class="code" href="setup-vms_8h.html#aae68723650f0ed53b36894d426afdbc9">SSL_read</a>(BACKEND-&gt;handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, buffsize);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        err = <a class="code" href="setup-vms_8h.html#afb6a3c48e555d21b01f588b08c8d6d74">SSL_get_error</a>(BACKEND-&gt;handle, (<span class="keywordtype">int</span>)nread);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="keywordflow">case</span> SSL_ERROR_NONE: <span class="comment">/* this is not an error */</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN: <span class="comment">/* no more data */</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          <span class="comment">/* This is the expected response. There was no data but only</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">             the close notify alert */</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          <span class="comment">/* there&#39;s data pending, re-invoke SSL_read() */</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL_ERROR_WANT_READ\n&quot;</span>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          <span class="comment">/* SSL wants a write. Really odd. Let&#39;s bail out. */</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL_ERROR_WANT_WRITE\n&quot;</span>);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;          done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          <span class="comment">/* openssl/ssl.h says &quot;look at error stack/return value/errno&quot; */</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;          sslerror = <a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>();</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; SSL_read on shutdown: %s, errno %d&quot;</span>,</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                (sslerror ?</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                 ossl_strerror(sslerror, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)) :</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                 SSL_ERROR_to_str(err)),</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;          done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        }</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0 == what) {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="comment">/* timeout */</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL shutdown timeout&quot;</span>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="comment">/* anything that gets here is fatally bad */</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;select/poll on SSL socket, errno: %d&quot;</span>, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        retval = -1;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    } <span class="comment">/* while()-loop for the select() */</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.verbose) {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_GET_SHUTDOWN</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <span class="keywordflow">switch</span>(<a class="code" href="setup-vms_8h.html#a951c99e8afb0b981911ea5da6631f9ee">SSL_get_shutdown</a>(BACKEND-&gt;handle)) {</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <span class="keywordflow">case</span> SSL_SENT_SHUTDOWN:</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL_get_shutdown() returned SSL_SENT_SHUTDOWN\n&quot;</span>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      <span class="keywordflow">case</span> SSL_RECEIVED_SHUTDOWN:</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL_get_shutdown() returned SSL_RECEIVED_SHUTDOWN\n&quot;</span>);</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <span class="keywordflow">case</span> SSL_SENT_SHUTDOWN|SSL_RECEIVED_SHUTDOWN:</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL_get_shutdown() returned SSL_SENT_SHUTDOWN|&quot;</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;              <span class="stringliteral">&quot;SSL_RECEIVED__SHUTDOWN\n&quot;</span>);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      }</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <a class="code" href="setup-vms_8h.html#a706c82bfae7ce618d3f0e39a0d72a988">SSL_free</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    BACKEND-&gt;handle = NULL;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordflow">return</span> retval;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;}</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_ossl_session_free(<span class="keywordtype">void</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;{</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="comment">/* free the ID */</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <a class="code" href="setup-vms_8h.html#a748e88c59d5a8fb7690774ac69748610">SSL_SESSION_free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;}</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> * This function is called when the &#39;data&#39; struct is going away. Close</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"> * down everything and free all resources!</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_ossl_close_all(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;{</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL_ENGINE</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;state.engine) {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="setup-vms_8h.html#a4dbcbfb09083d9bcaac672463d68a909">ENGINE_finish</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <a class="code" href="setup-vms_8h.html#a7d07acd5584159f20f836962c4abdc1a">ENGINE_free</a>(<a class="code" href="structdata.html">data</a>-&gt;state.engine);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <a class="code" href="structdata.html">data</a>-&gt;state.engine = NULL;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  (void)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="preprocessor">#if !defined(HAVE_ERR_REMOVE_THREAD_STATE_DEPRECATED) &amp;&amp; \</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="preprocessor">  defined(HAVE_ERR_REMOVE_THREAD_STATE)</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="comment">/* OpenSSL 1.0.1 and 1.0.2 build an error queue that is stored per-thread</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">     so we need to clean it here in case the thread will be killed. All OpenSSL</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">     code should extract the error in association with the error so clearing</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">     this queue here should be harmless at worst. */</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  ERR_remove_thread_state(NULL);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;}</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">/* ====================================================== */</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment"> * Match subjectAltName against the host name. This requires a conversion</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment"> * in CURL_DOES_CONVERSIONS builds.</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> subj_alt_hostcheck(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span> *match_pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">char</span> *dispname)</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#ifdef CURL_DOES_CONVERSIONS</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;{</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordtype">bool</span> res = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="comment">/* Curl_cert_hostcheck uses host encoding, but we get ASCII from</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">     OpenSSl.</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">char</span> *match_pattern2 = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(match_pattern);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="keywordflow">if</span>(match_pattern2) {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="non-ascii_8h.html#a7f86eb6237ad590baa14e82fae9d6d83">Curl_convert_from_network</a>(<a class="code" href="structdata.html">data</a>, match_pattern2,</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                                strlen(match_pattern2)) == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="hostcheck_8h.html#a27f0cb03fe4f1f02de4846ca58e29a8a">Curl_cert_hostcheck</a>(match_pattern2, <a class="code" href="structhostname.html">hostname</a>)) {</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        res = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                <span class="stringliteral">&quot; subjectAltName: host \&quot;%s\&quot; matched cert&#39;s \&quot;%s\&quot;\n&quot;</span>,</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                dispname, match_pattern2);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      }</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    }</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(match_pattern2);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="stringliteral">&quot;SSL: out of memory when allocating temporary for subjectAltName&quot;</span>);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  }</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;}</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;{</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="preprocessor">#ifdef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  (void)dispname;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  (void)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="hostcheck_8h.html#a27f0cb03fe4f1f02de4846ca58e29a8a">Curl_cert_hostcheck</a>(match_pattern, <a class="code" href="structhostname.html">hostname</a>)) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; subjectAltName: host \&quot;%s\&quot; matched cert&#39;s \&quot;%s\&quot;\n&quot;</span>,</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                  dispname, match_pattern);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  }</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;}</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">/* Quote from RFC2818 section 3.1 &quot;Server Identity&quot;</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">   If a subjectAltName extension of type dNSName is present, that MUST</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">   be used as the identity. Otherwise, the (most specific) Common Name</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">   field in the Subject field of the certificate MUST be used. Although</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">   the use of the Common Name is existing practice, it is deprecated and</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">   Certification Authorities are encouraged to use the dNSName instead.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment">   Matching is performed using the matching rules specified by</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment">   [RFC2459].  If more than one identity of a given type is present in</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">   the certificate (e.g., more than one dNSName name, a match in any one</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">   of the set is considered acceptable.) Names may contain the wildcard</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">   character * which is considered to match any single domain name</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">   component or component fragment. E.g., *.a.com matches foo.a.com but</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">   not bar.foo.a.com. f*.com matches foo.com but not bar.com.</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">   In some cases, the URI is specified as an IP address rather than a</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">   hostname. In this case, the iPAddress subjectAltName must be present</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">   in the certificate and must exactly match the IP in the URI.</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> verifyhost(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, X509 *server_cert)</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;{</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keywordtype">bool</span> matched = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="keywordtype">int</span> target = GEN_DNS; <span class="comment">/* target type, GEN_DNS or GEN_IPADD */</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordtype">size_t</span> addrlen = 0;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  STACK_OF(GENERAL_NAME) *altnames;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="keyword">struct </span>in6_addr addr;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="keyword">struct </span>in_addr addr;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="keywordtype">bool</span> dNSName = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* if a dNSName field exists in the cert */</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="keywordtype">bool</span> iPAddress = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* if a iPAddress field exists in the cert */</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="structhostname.html">hostname</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> :</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> dispname = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ?</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#aee7d0ff8210c25b87d6fdeacf8ea7939">dispname</a> : conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#aee7d0ff8210c25b87d6fdeacf8ea7939">dispname</a>;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#afbb3ed3c6e41a5e79efc77b3bf00376d">ipv6_ip</a> &amp;&amp;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;     <a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, <a class="code" href="structhostname.html">hostname</a>, &amp;addr)) {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    target = GEN_IPADD;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    addrlen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>in6_addr);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  }</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET, <a class="code" href="structhostname.html">hostname</a>, &amp;addr)) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      target = GEN_IPADD;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      addrlen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>in_addr);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="comment">/* get a &quot;list&quot; of alternative names */</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  altnames = <a class="code" href="setup-vms_8h.html#a5d2928a33b697892fa7dcc0f1fb0d129">X509_get_ext_d2i</a>(server_cert, NID_subject_alt_name, NULL, NULL);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="keywordflow">if</span>(altnames) {</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keywordtype">int</span> numalts;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordtype">bool</span> dnsmatched = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordtype">bool</span> ipmatched = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="comment">/* get amount of alternatives, RFC2459 claims there MUST be at least</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">       one, but we don&#39;t depend on it... */</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    numalts = sk_GENERAL_NAME_num(altnames);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="comment">/* loop through all alternatives - until a dnsmatch */</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; numalts) &amp;&amp; !dnsmatched; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      <span class="comment">/* get a handle to alternative name number i */</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="keyword">const</span> GENERAL_NAME *check = sk_GENERAL_NAME_value(altnames, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      <span class="keywordflow">if</span>(check-&gt;type == GEN_DNS)</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        dNSName = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(check-&gt;type == GEN_IPADD)</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        iPAddress = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      <span class="comment">/* only check alternatives of the same type the target is */</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <span class="keywordflow">if</span>(check-&gt;type == target) {</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        <span class="comment">/* get data and length */</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *altptr = (<span class="keywordtype">char</span> *)ASN1_STRING_get0_data(check-&gt;d.ia5);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordtype">size_t</span> altlen = (size_t) <a class="code" href="setup-vms_8h.html#a3082baf484326774c04577668a0a1784">ASN1_STRING_length</a>(check-&gt;d.ia5);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">switch</span>(target) {</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="keywordflow">case</span> GEN_DNS: <span class="comment">/* name/pattern comparison */</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;          <span class="comment">/* The OpenSSL man page explicitly says: &quot;In general it cannot be</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">             assumed that the data returned by ASN1_STRING_data() is null</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">             terminated or does not contain embedded nulls.&quot; But also that</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">             &quot;The actual format of the data will depend on the actual string</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">             type itself: for example for and IA5String the data will be ASCII&quot;</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment">             Gisle researched the OpenSSL sources:</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">             &quot;I checked the 0.9.6 and 0.9.8 sources before my patch and</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment">             it always 0-terminates an IA5String.&quot;</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;          <span class="keywordflow">if</span>((altlen == strlen(altptr)) &amp;&amp;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;             <span class="comment">/* if this isn&#39;t true, there was an embedded zero in the name</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">                string and we cannot match it. */</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;             subj_alt_hostcheck(<a class="code" href="structdata.html">data</a>, altptr, <a class="code" href="structhostname.html">hostname</a>, dispname)) {</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            dnsmatched = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;          }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <span class="keywordflow">case</span> GEN_IPADD: <span class="comment">/* IP address comparison */</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;          <span class="comment">/* compare alternative IP address if the data chunk is the same size</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">             our server IP address is */</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;          <span class="keywordflow">if</span>((altlen == addrlen) &amp;&amp; !memcmp(altptr, &amp;addr, altlen)) {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            ipmatched = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                  <span class="stringliteral">&quot; subjectAltName: host \&quot;%s\&quot; matched cert&#39;s IP address!\n&quot;</span>,</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                  dispname);</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      }</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    }</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <a class="code" href="setup-vms_8h.html#a7ef49d7dd301195bbd65dfeef7918a5e">GENERAL_NAMES_free</a>(altnames);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordflow">if</span>(dnsmatched || ipmatched)</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      matched = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  }</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">if</span>(matched)</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="comment">/* an alternative name matched */</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    ;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dNSName || iPAddress) {</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; subjectAltName does not match %s\n&quot;</span>, dispname);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: no alternative certificate subject name matches &quot;</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;          <span class="stringliteral">&quot;target host name &#39;%s&#39;&quot;</span>, dispname);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  }</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="comment">/* we have to look to the last occurrence of a commonName in the</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">       distinguished one to get the most significant one. */</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = -1;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="comment">/* The following is done because of a bug in 0.9.6b */</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *nulstr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *peer_CN = nulstr;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    X509_NAME *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a> = <a class="code" href="setup-vms_8h.html#a410e7961cad2b4f22017252ded2f38f4">X509_get_subject_name</a>(server_cert);</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>)</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      <span class="keywordflow">while</span>((<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="setup-vms_8h.html#a9cc1d30e397bd178233d70a73ac50107">X509_NAME_get_index_by_NID</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, NID_commonName, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>)) &gt;= 0)</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="comment">/* we have the name entry and we will now convert this to a string</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">       that we can use for comparison. Doing this we support BMPstring,</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">       UTF8 etc. */</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt;= 0) {</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      ASN1_STRING *tmp =</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <a class="code" href="setup-vms_8h.html#adaf74bc2b761c1da097286183a63ff4b">X509_NAME_ENTRY_get_data</a>(<a class="code" href="setup-vms_8h.html#af97700553bd78a9f1797c2525a152887">X509_NAME_get_entry</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="comment">/* In OpenSSL 0.9.7d and earlier, ASN1_STRING_to_UTF8 fails if the input</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">         is already UTF-8 encoded. We check for this case and copy the raw</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">         string manually to avoid the problem. This code can be made</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">         conditional in the future when OpenSSL has been fixed. Work-around</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">         brought by Alexis S. L. Carvalho. */</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keywordflow">if</span>(tmp) {</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#afdf7a6c69be63cbd9a8fc09b83ea330f">ASN1_STRING_type</a>(tmp) == V_ASN1_UTF8STRING) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;          <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="setup-vms_8h.html#a3082baf484326774c04577668a0a1784">ASN1_STRING_length</a>(tmp);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> &gt;= 0) {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            peer_CN = OPENSSL_malloc(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> + 1);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            <span class="keywordflow">if</span>(peer_CN) {</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;              <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(peer_CN, ASN1_STRING_get0_data(tmp), <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;              peer_CN[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            }</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;          }</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="keywordflow">else</span> <span class="comment">/* not a UTF8 name */</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;          <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = <a class="code" href="setup-vms_8h.html#a74d3d3725cba6c1054cec14ce1693383">ASN1_STRING_to_UTF8</a>(&amp;peer_CN, tmp);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <span class="keywordflow">if</span>(peer_CN &amp;&amp; (<a class="code" href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a>(strlen((<span class="keywordtype">char</span> *)peer_CN)) != <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>)) {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;          <span class="comment">/* there was a terminating zero before the end of string, this</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">             cannot match and we return failure! */</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: illegal cert name field&quot;</span>);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="keywordflow">if</span>(peer_CN == nulstr)</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;       peer_CN = NULL;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="comment">/* convert peer_CN from UTF8 */</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="non-ascii_8h.html#aa89c200049135ad5e08a5d3092be3b78">Curl_convert_from_utf8</a>(<a class="code" href="structdata.html">data</a>, (<span class="keywordtype">char</span> *)peer_CN,</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                                           strlen((<span class="keywordtype">char</span> *)peer_CN));</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <span class="comment">/* Curl_convert_from_utf8 calls failf if unsuccessful */</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        OPENSSL_free(peer_CN);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      }</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    }</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="comment">/* error already detected, pass through */</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      ;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!peer_CN) {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            <span class="stringliteral">&quot;SSL: unable to obtain common name from peer certificate&quot;</span>);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="hostcheck_8h.html#a27f0cb03fe4f1f02de4846ca58e29a8a">Curl_cert_hostcheck</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)peer_CN, <a class="code" href="structhostname.html">hostname</a>)) {</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: certificate subject name &#39;%s&#39; does not match &quot;</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            <span class="stringliteral">&quot;target host name &#39;%s&#39;&quot;</span>, peer_CN, dispname);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    }</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; common name: %s (matched)\n&quot;</span>, peer_CN);</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    }</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordflow">if</span>(peer_CN)</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      OPENSSL_free(peer_CN);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  }</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;}</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090808fL) &amp;&amp; !defined(OPENSSL_NO_TLSEXT) &amp;&amp; \</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="preprocessor">    !defined(OPENSSL_NO_OCSP)</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> verifystatus(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                             <span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl)</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;{</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, ocsp_status;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  OCSP_RESPONSE *rsp = NULL;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  OCSP_BASICRESP *br = NULL;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  X509_STORE     *st = NULL;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  STACK_OF(X509) *ch = NULL;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="keywordtype">long</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = SSL_get_tlsext_status_ocsp_resp(BACKEND-&gt;handle, &amp;<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>) {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;No OCSP response received&quot;</span>);</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  rsp = d2i_OCSP_RESPONSE(NULL, &amp;<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keywordflow">if</span>(!rsp) {</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Invalid OCSP response&quot;</span>);</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  }</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  ocsp_status = OCSP_response_status(rsp);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordflow">if</span>(ocsp_status != OCSP_RESPONSE_STATUS_SUCCESSFUL) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Invalid OCSP response status: %s (%d)&quot;</span>,</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;          OCSP_response_status_str(ocsp_status), ocsp_status);</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  }</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  br = OCSP_response_get1_basic(rsp);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="keywordflow">if</span>(!br) {</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Invalid OCSP response&quot;</span>);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  }</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  ch = <a class="code" href="setup-vms_8h.html#ae7a3a3c97dd01e898235d37445053c59">SSL_get_peer_cert_chain</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  st = <a class="code" href="setup-vms_8h.html#af55e4ccbb54ad626fde32c2a43a8e06e">SSL_CTX_get_cert_store</a>(BACKEND-&gt;ctx);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="preprocessor">#if ((OPENSSL_VERSION_NUMBER &lt;= 0x1000201fL) </span><span class="comment">/* Fixed after 1.0.2a */</span><span class="preprocessor"> || \</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="preprocessor">     (defined(LIBRESSL_VERSION_NUMBER) &amp;&amp;                               \</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="preprocessor">      LIBRESSL_VERSION_NUMBER &lt;= 0x2040200fL))</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="comment">/* The authorized responder cert in the OCSP response MUST be signed by the</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">     peer cert&#39;s issuer (see RFC6960 section 4.2.2.2). If that&#39;s a root cert,</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">     no problem, but if it&#39;s an intermediate cert OpenSSL has a bug where it</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">     expects this issuer to be present in the chain embedded in the OCSP</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">     response. So we add it if necessary. */</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="comment">/* First make sure the peer cert chain includes both a peer and an issuer,</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">     and the OCSP response contains a responder cert. */</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordflow">if</span>(sk_X509_num(ch) &gt;= 2 &amp;&amp; sk_X509_num(br-&gt;certs) &gt;= 1) {</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    X509 *responder = sk_X509_value(br-&gt;certs, sk_X509_num(br-&gt;certs) - 1);</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">/* Find issuer of responder cert and add it to the OCSP response chain */</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; sk_X509_num(ch); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      X509 *issuer = sk_X509_value(ch, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a4e60f57d61a6a6acab36969bbe0a334a">X509_check_issued</a>(issuer, responder) == X509_V_OK) {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="keywordflow">if</span>(!OCSP_basic_add1_cert(br, issuer)) {</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Could not add issuer cert to OCSP response&quot;</span>);</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;          <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;          <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        }</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      }</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">if</span>(OCSP_basic_verify(br, ch, st, 0) &lt;= 0) {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;OCSP response verification failed&quot;</span>);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; OCSP_resp_count(br); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordtype">int</span> cert_status, crl_reason;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    OCSP_SINGLERESP *single = NULL;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    ASN1_GENERALIZEDTIME *rev, *thisupd, *nextupd;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    single = OCSP_resp_get0(br, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">if</span>(!single)</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    cert_status = OCSP_single_get0_status(single, &amp;crl_reason, &amp;rev,</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                                          &amp;thisupd, &amp;nextupd);</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">if</span>(!OCSP_check_validity(thisupd, nextupd, 300L, -1L)) {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;OCSP response has expired&quot;</span>);</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    }</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate status: %s (%d)\n&quot;</span>,</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;          OCSP_cert_status_str(cert_status), cert_status);</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">switch</span>(cert_status) {</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="keywordflow">case</span> V_OCSP_CERTSTATUS_GOOD:</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      <span class="keywordflow">case</span> V_OCSP_CERTSTATUS_REVOKED:</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate revocation reason: %s (%d)&quot;</span>,</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;              OCSP_crl_reason_str(crl_reason), crl_reason);</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keywordflow">case</span> V_OCSP_CERTSTATUS_UNKNOWN:</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a>;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">goto</span> end;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    }</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  }</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;end:</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordflow">if</span>(br) OCSP_BASICRESP_free(br);</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  OCSP_RESPONSE_free(rsp);</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;}</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_OPENSSL */</span><span class="preprocessor"></span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">/* The SSL_CTRL_SET_MSG_CALLBACK doesn&#39;t exist in ancient OpenSSL versions</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">   and thus this cannot be done there. */</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="preprocessor">#ifdef SSL_CTRL_SET_MSG_CALLBACK</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ssl_msg_type(<span class="keywordtype">int</span> ssl_ver, <span class="keywordtype">int</span> <a class="code" href="struct_curl__easy.html#a58a5db9f498161b06cd8f245d718b155">msg</a>)</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;{</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="preprocessor">#ifdef SSL2_VERSION_MAJOR</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="keywordflow">if</span>(ssl_ver == SSL2_VERSION_MAJOR) {</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="struct_curl__easy.html#a58a5db9f498161b06cd8f245d718b155">msg</a>) {</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_ERROR:</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error&quot;</span>;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_CLIENT_HELLO:</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client hello&quot;</span>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_CLIENT_MASTER_KEY:</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client key&quot;</span>;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_CLIENT_FINISHED:</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client finished&quot;</span>;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_SERVER_HELLO:</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server hello&quot;</span>;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_SERVER_VERIFY:</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server verify&quot;</span>;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_SERVER_FINISHED:</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server finished&quot;</span>;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_REQUEST_CERTIFICATE:</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request CERT&quot;</span>;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <span class="keywordflow">case</span> SSL2_MT_CLIENT_CERTIFICATE:</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client CERT&quot;</span>;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    }</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordflow">if</span>(ssl_ver == SSL3_VERSION_MAJOR) {</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="struct_curl__easy.html#a58a5db9f498161b06cd8f245d718b155">msg</a>) {</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_HELLO_REQUEST:</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hello request&quot;</span>;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CLIENT_HELLO:</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client hello&quot;</span>;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_SERVER_HELLO:</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server hello&quot;</span>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_NEWSESSION_TICKET</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_NEWSESSION_TICKET:</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Newsession Ticket&quot;</span>;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CERTIFICATE:</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Certificate&quot;</span>;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_SERVER_KEY_EXCHANGE:</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server key exchange&quot;</span>;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CLIENT_KEY_EXCHANGE:</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Client key exchange&quot;</span>;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CERTIFICATE_REQUEST:</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Request CERT&quot;</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_SERVER_DONE:</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server finished&quot;</span>;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CERTIFICATE_VERIFY:</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;CERT verify&quot;</span>;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_FINISHED:</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Finished&quot;</span>;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_CERTIFICATE_STATUS</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_CERTIFICATE_STATUS:</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Certificate Status&quot;</span>;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_ENCRYPTED_EXTENSIONS</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_ENCRYPTED_EXTENSIONS:</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Encrypted Extensions&quot;</span>;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_END_OF_EARLY_DATA</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_END_OF_EARLY_DATA:</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;End of early data&quot;</span>;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_KEY_UPDATE</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_KEY_UPDATE:</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Key update&quot;</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_NEXT_PROTO</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_NEXT_PROTO:</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Next protocol&quot;</span>;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="preprocessor">#ifdef SSL3_MT_MESSAGE_HASH</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">case</span> SSL3_MT_MESSAGE_HASH:</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Message hash&quot;</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    }</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  }</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;}</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *tls_rt_type(<span class="keywordtype">int</span> <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>)</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;{</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>) {</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="preprocessor">#ifdef SSL3_RT_HEADER</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="keywordflow">case</span> SSL3_RT_HEADER:</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS header&quot;</span>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <span class="keywordflow">case</span> SSL3_RT_CHANGE_CIPHER_SPEC:</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS change cipher&quot;</span>;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="keywordflow">case</span> SSL3_RT_ALERT:</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS alert&quot;</span>;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keywordflow">case</span> SSL3_RT_HANDSHAKE:</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS handshake&quot;</span>;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keywordflow">case</span> SSL3_RT_APPLICATION_DATA:</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS app data&quot;</span>;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS Unknown&quot;</span>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;}</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment"> * Our callback from the SSL/TLS layers.</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> ssl_tls_trace(<span class="keywordtype">int</span> direction, <span class="keywordtype">int</span> ssl_ver, <span class="keywordtype">int</span> content_type,</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *ssl,</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                          <span class="keywordtype">void</span> *userp)</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;{</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordtype">char</span> unknown[32];</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *verstr = NULL;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = userp;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <span class="keywordflow">if</span>(!conn || !conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> || !conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#aab42d022c7e38fee30d1bd51e7d747f3">fdebug</a> ||</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;     (direction != 0 &amp;&amp; direction != 1))</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keywordflow">switch</span>(ssl_ver) {</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="preprocessor">#ifdef SSL2_VERSION </span><span class="comment">/* removed in recent versions */</span><span class="preprocessor"></span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keywordflow">case</span> SSL2_VERSION:</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    verstr = <span class="stringliteral">&quot;SSLv2&quot;</span>;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="preprocessor">#ifdef SSL3_VERSION</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">case</span> SSL3_VERSION:</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    verstr = <span class="stringliteral">&quot;SSLv3&quot;</span>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <span class="keywordflow">case</span> TLS1_VERSION:</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    verstr = <span class="stringliteral">&quot;TLSv1.0&quot;</span>;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="preprocessor">#ifdef TLS1_1_VERSION</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="keywordflow">case</span> TLS1_1_VERSION:</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    verstr = <span class="stringliteral">&quot;TLSv1.1&quot;</span>;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="preprocessor">#ifdef TLS1_2_VERSION</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="keywordflow">case</span> TLS1_2_VERSION:</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    verstr = <span class="stringliteral">&quot;TLSv1.2&quot;</span>;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordflow">case</span> TLS1_3_VERSION:</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    verstr = <span class="stringliteral">&quot;TLSv1.3&quot;</span>;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(unknown, <span class="keyword">sizeof</span>(unknown), <span class="stringliteral">&quot;(%x)&quot;</span>, ssl_ver);</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    verstr = unknown;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  }</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="comment">/* Log progress for interesting records only (like Handshake or Alert), skip</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">   * all raw record headers (content_type == SSL3_RT_HEADER or ssl_ver == 0).</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">   * For TLS 1.3, skip notification of the decrypted inner Content Type.</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">if</span>(ssl_ver</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;#ifdef SSL3_RT_INNER_CONTENT_TYPE</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;     &amp;&amp; content_type != SSL3_RT_INNER_CONTENT_TYPE</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;#endif</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    ) {</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *msg_name, *tls_rt_name;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordtype">char</span> ssl_buf[1024];</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordtype">int</span> msg_type, txt_len;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="comment">/* the info given when the version is zero is not that useful for us */</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    ssl_ver &gt;&gt;= 8; <span class="comment">/* check the upper 8 bits only below */</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="comment">/* SSLv2 doesn&#39;t seem to have TLS record-type headers, so OpenSSL</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">     * always pass-up content-type as 0. But the interesting message-type</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">     * is at &#39;buf[0]&#39;.</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <span class="keywordflow">if</span>(ssl_ver == SSL3_VERSION_MAJOR &amp;&amp; content_type)</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      tls_rt_name = tls_rt_type(content_type);</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      tls_rt_name = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    <span class="keywordflow">if</span>(content_type == SSL3_RT_CHANGE_CIPHER_SPEC) {</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      msg_type = *(<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      msg_name = <span class="stringliteral">&quot;Change cipher spec&quot;</span>;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    }</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(content_type == SSL3_RT_ALERT) {</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      msg_type = (((<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)[0] &lt;&lt; 8) + ((<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)[1];</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      msg_name = SSL_alert_desc_string_long(msg_type);</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    }</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      msg_type = *(<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      msg_name = ssl_msg_type(ssl_ver, msg_type);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    }</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    txt_len = <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(ssl_buf, <span class="keyword">sizeof</span>(ssl_buf), <span class="stringliteral">&quot;%s (%s), %s, %s (%d):\n&quot;</span>,</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                        verstr, direction?<span class="stringliteral">&quot;OUT&quot;</span>:<span class="stringliteral">&quot;IN&quot;</span>,</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                        tls_rt_name, msg_name, msg_type);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">if</span>(0 &lt;= txt_len &amp;&amp; (<span class="keywordtype">unsigned</span>)txt_len &lt; <span class="keyword">sizeof</span>(ssl_buf)) {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      <a class="code" href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a>(<a class="code" href="structdata.html">data</a>, <a class="code" href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a527a249892b8a9d34406e66c18611767">CURLINFO_TEXT</a>, ssl_buf, (<span class="keywordtype">size_t</span>)txt_len);</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    }</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  }</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <a class="code" href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a>(<a class="code" href="structdata.html">data</a>, (direction == 1) ? <a class="code" href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a24d8abe6d4ec1df2e2e707b07bca57dd">CURLINFO_SSL_DATA_OUT</a> :</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;             <a class="code" href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14af788d7ad3eeacfcbd2170c64166c241c">CURLINFO_SSL_DATA_IN</a>, (<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  (void) <a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;}</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="preprocessor">#ifdef USE_OPENSSL</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">/* ====================================================== */</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="preprocessor">#ifdef SSL_CTRL_SET_TLSEXT_HOSTNAME</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="preprocessor">#  define use_sni(x)  sni = (x)</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="preprocessor">#  define use_sni(x)  Curl_nop_stmt</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">/* Check for OpenSSL 1.0.2 which has ALPN support. */</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="preprocessor">#undef HAS_ALPN</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x10002000L \</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="preprocessor">    &amp;&amp; !defined(OPENSSL_NO_TLSEXT)</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="preprocessor">#  define HAS_ALPN 1</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">/* Check for OpenSSL 1.0.1 which has NPN support. */</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="preprocessor">#undef HAS_NPN</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x10001000L \</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="preprocessor">    &amp;&amp; !defined(OPENSSL_NO_TLSEXT) \</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="preprocessor">    &amp;&amp; !defined(OPENSSL_NO_NEXTPROTONEG)</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="preprocessor">#  define HAS_NPN 1</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="preprocessor">#ifdef HAS_NPN</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment"> * in is a list of length prefixed strings. this function has to select</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment"> * the protocol we want to use from the list and write its string into out.</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;select_next_protocol(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **out, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outlen,</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> inlen,</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keylen)</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;{</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + keylen &lt;= inlen; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> += <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] + 1) {</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordflow">if</span>(memcmp(&amp;<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1], <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, keylen) == 0) {</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      *out = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) &amp;<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1];</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      *outlen = <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    }</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  }</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;}</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;select_next_proto_cb(<a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>,</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **out, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outlen,</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> inlen,</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                     <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;{</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a>*) arg;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  (void)<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a297b95c9d8a6b73ab0d15f752e23ba8b">httpversion</a> &gt;= <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a> &amp;&amp;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;     !select_next_protocol(out, outlen, <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, inlen, NGHTTP2_PROTO_VERSION_ID,</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                           NGHTTP2_PROTO_VERSION_ID_LEN)) {</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;NPN, negotiated HTTP2 (%s)\n&quot;</span>,</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;          NGHTTP2_PROTO_VERSION_ID);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a>;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keywordflow">return</span> SSL_TLSEXT_ERR_OK;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  }</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="keywordflow">if</span>(!select_next_protocol(out, outlen, <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, inlen, <a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>,</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                           <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>)) {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;NPN, negotiated HTTP1.1\n&quot;</span>);</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a>;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    <span class="keywordflow">return</span> SSL_TLSEXT_ERR_OK;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;NPN, no overlap, use HTTP1.1\n&quot;</span>);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  *out = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  *outlen = <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a>;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="keywordflow">return</span> SSL_TLSEXT_ERR_OK;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;}</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAS_NPN */</span><span class="preprocessor"></span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;get_ssl_version_txt(<a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>)</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;{</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>)</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  <span class="keywordflow">switch</span>(<a class="code" href="setup-vms_8h.html#a15d8c1c61f7dcd1af34de7afe3c8b323">SSL_version</a>(<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>)) {</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  <span class="keywordflow">case</span> TLS1_3_VERSION:</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLSv1.3&quot;</span>;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  <span class="keywordflow">case</span> TLS1_2_VERSION:</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLSv1.2&quot;</span>;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keywordflow">case</span> TLS1_1_VERSION:</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLSv1.1&quot;</span>;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordflow">case</span> TLS1_VERSION:</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLSv1.0&quot;</span>;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="keywordflow">case</span> SSL3_VERSION:</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSLv3&quot;</span>;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="keywordflow">case</span> SSL2_VERSION:</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSLv2&quot;</span>;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;}</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;set_ssl_version_min_max(<span class="keywordtype">long</span> *ctx_options, <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                        <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;{</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &lt; 0x1000100FL) || !defined(TLS1_3_VERSION)</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="comment">/* convoluted #if condition just to avoid compiler warnings on unused</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">     variable */</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="keywordtype">long</span> ssl_version = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a>);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="keywordtype">long</span> ssl_version_max = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(version_max);</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="keywordflow">switch</span>(ssl_version) {</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    {</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      SSL_CTX_set_max_proto_version(BACKEND-&gt;ctx, TLS1_3_VERSION);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1_2;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    }</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      (void)sockindex;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      (void)ctx_options;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without TLS 1.3 support&quot;</span>);</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1_1;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without TLS 1.2 support&quot;</span>);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without TLS 1.1 support&quot;</span>);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  }</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordflow">switch</span>(ssl_version_max) {</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da74aee28bba157392e07b797d710900e1">CURL_SSLVERSION_MAX_TLSv1_0</a>:</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1_1;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4daa94fe5edaa7282176fa95c61bcbc91e3">CURL_SSLVERSION_MAX_TLSv1_1</a>:</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1_2;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="comment">/* FALLTHROUGH */</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5">CURL_SSLVERSION_MAX_TLSv1_2</a>:</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      *ctx_options |= SSL_OP_NO_TLSv1_3;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468">CURL_SSLVERSION_MAX_TLSv1_3</a>:</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without TLS 1.3 support&quot;</span>);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  }</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;}</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="comment">/* The &quot;new session&quot; callback must return zero if the session can be removed</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="comment"> * or non-zero if the session has been put into the session cache.</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ossl_new_session_cb(<a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *ssl, SSL_SESSION *ssl_sessionid)</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;{</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;  <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  <span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a> *conn;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="keywordtype">int</span> sockindex;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *sockindex_ptr;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordtype">int</span> connectdata_idx = ossl_get_ssl_conn_index();</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <span class="keywordtype">int</span> sockindex_idx = ossl_get_ssl_sockindex_index();</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  <span class="keywordflow">if</span>(connectdata_idx &lt; 0 || sockindex_idx &lt; 0)</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  conn = (<span class="keyword">struct </span><a class="code" href="structconnectdata.html">connectdata</a>*) SSL_get_ex_data(<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>, connectdata_idx);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="keywordflow">if</span>(!conn)</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="comment">/* The sockindex has been stored as a pointer to an array element */</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  sockindex_ptr = (<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a>*) SSL_get_ex_data(<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>, sockindex_idx);</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  sockindex = (int)(sockindex_ptr - conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>);</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(primary.sessionid)) {</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordtype">bool</span> incache;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="keywordtype">void</span> *old_ssl_sessionid = NULL;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    Curl_ssl_sessionid_lock(conn);</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    incache = !(Curl_ssl_getsessionid(conn, &amp;old_ssl_sessionid, NULL,</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                      sockindex));</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="keywordflow">if</span>(incache) {</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="keywordflow">if</span>(old_ssl_sessionid != ssl_sessionid) {</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;old SSL session ID is stale, removing\n&quot;</span>);</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        Curl_ssl_delsessionid(conn, old_ssl_sessionid);</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        incache = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    }</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    <span class="keywordflow">if</span>(!incache) {</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      <span class="keywordflow">if</span>(!Curl_ssl_addsessionid(conn, ssl_sessionid,</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                      0 <span class="comment">/* unknown size */</span>, sockindex)) {</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <span class="comment">/* the session has been put into the session cache */</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        res = 1;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      }</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to store ssl session&quot;</span>);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    }</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  }</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;}</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ossl_connect_step1(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;{</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  <span class="keywordtype">char</span> *ciphers;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  SSL_METHOD_QUAL SSL_METHOD *req_method = NULL;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  X509_LOOKUP *lookup = NULL;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <span class="keywordtype">long</span> ctx_options = 0;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="preprocessor">#ifdef SSL_CTRL_SET_TLSEXT_HOSTNAME</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="keywordtype">bool</span> sni;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="structhostname.html">hostname</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> :</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="keyword">struct </span>in6_addr addr;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="keyword">struct </span>in_addr addr;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="keywordtype">long</span> * <span class="keyword">const</span> certverifyresult = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ?</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    &amp;<a class="code" href="structdata.html">data</a>-&gt;set.proxy_ssl.certverifyresult : &amp;<a class="code" href="structdata.html">data</a>-&gt;set.ssl.certverifyresult;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ssl_version = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a>);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="preprocessor">#ifdef USE_TLS_SRP</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480">CURL_TLSAUTH</a> ssl_authtype = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(authtype);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;  <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_cert = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert);</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_cert_type = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert_type);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_cafile = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(CAfile);</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_capath = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(CApath);</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> verifypeer = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifypeer);</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_crlfile = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(CRLfile);</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;  <span class="keywordtype">char</span> error_buffer[256];</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>);</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;  <span class="comment">/* Make funny stuff to get random input */</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_ossl_seed(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  *certverifyresult = !X509_V_OK;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="comment">/* check to see if we&#39;ve been told to use an explicit SSL/TLS version */</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  <span class="keywordflow">switch</span>(ssl_version) {</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="comment">/* it will be handled later with the context options */</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x10100000L)</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    req_method = TLS_client_method();</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    req_method = <a class="code" href="setup-vms_8h.html#a4d0579ef3ac599f56ba3fa39076a8928">SSLv23_client_method</a>();</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    use_sni(<a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a>:</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="preprocessor">#ifdef OPENSSL_NO_SSL2</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without SSLv2 support&quot;</span>);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="preprocessor">#ifdef USE_TLS_SRP</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordflow">if</span>(ssl_authtype == <a class="code" href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480a4c0ae8216421b905a5ba0fff6b685abe">CURL_TLSAUTH_SRP</a>)</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    req_method = SSLv2_client_method();</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    use_sni(<a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a>:</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="preprocessor">#ifdef OPENSSL_NO_SSL3_METHOD</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; was built without SSLv3 support&quot;</span>);</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a>;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="preprocessor">#ifdef USE_TLS_SRP</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">if</span>(ssl_authtype == <a class="code" href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480a4c0ae8216421b905a5ba0fff6b685abe">CURL_TLSAUTH_SRP</a>)</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    req_method = <a class="code" href="setup-vms_8h.html#aa5c639c644584d66688d5b192189150c">SSLv3_client_method</a>();</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    use_sni(<a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unrecognized parameter passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  }</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ctx)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <a class="code" href="setup-vms_8h.html#a94cf6f18d4f14d23153cdeb90fa5923d">SSL_CTX_free</a>(BACKEND-&gt;ctx);</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  BACKEND-&gt;ctx = <a class="code" href="setup-vms_8h.html#a6d72286382ff2d3d13954e512d23165f">SSL_CTX_new</a>(req_method);</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keywordflow">if</span>(!BACKEND-&gt;ctx) {</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t create a context: %s&quot;</span>,</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;          ossl_strerror(<a class="code" href="setup-vms_8h.html#af86a876be57d5b055050d87b0feda7ae">ERR_peek_error</a>(), error_buffer, <span class="keyword">sizeof</span>(error_buffer)));</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  }</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="preprocessor">#ifdef SSL_MODE_RELEASE_BUFFERS</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  SSL_CTX_set_mode(BACKEND-&gt;ctx, SSL_MODE_RELEASE_BUFFERS);</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="preprocessor">#ifdef SSL_CTRL_SET_MSG_CALLBACK</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.fdebug &amp;&amp; <a class="code" href="structdata.html">data</a>-&gt;set.verbose) {</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="comment">/* the SSL trace callback is only used for verbose logging */</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <a class="code" href="setup-vms_8h.html#a0ede1baca5700d1c8e30f7de2a8dd46c">SSL_CTX_set_msg_callback</a>(BACKEND-&gt;ctx, ssl_tls_trace);</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    SSL_CTX_set_msg_callback_arg(BACKEND-&gt;ctx, conn);</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  }</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="comment">/* OpenSSL contains code to work-around lots of bugs and flaws in various</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">     SSL-implementations. SSL_CTX_set_options() is used to enabled those</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">     work-arounds. The man page for this option states that SSL_OP_ALL enables</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">     all the work-arounds and that &quot;It is usually safe to use SSL_OP_ALL to</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">     enable the bug workaround options if compatibility with somewhat broken</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment">     implementations is desired.&quot;</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="comment">     The &quot;-no_ticket&quot; option was introduced in Openssl0.9.8j. It&#39;s a flag to</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="comment">     disable &quot;rfc4507bis session ticket support&quot;.  rfc4507bis was later turned</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">     into the proper RFC5077 it seems: https://tools.ietf.org/html/rfc5077</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment">     The enabled extension concerns the session management. I wonder how often</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment">     libcurl stops a connection and then resumes a TLS session. also, sending</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment">     the session data is some overhead. .I suggest that you just use your</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment">     proposed patch (which explicitly disables TICKET).</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">     If someone writes an application with libcurl and openssl who wants to</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">     enable the feature, one can do this in the SSL callback.</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">     SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG option enabling allowed proper</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment">     interoperability with web server Netscape Enterprise Server 2.0.1 which</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="comment">     was released back in 1996.</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">     Due to CVE-2010-4180, option SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG has</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">     become ineffective as of OpenSSL 0.9.8q and 1.0.0c. In order to mitigate</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">     CVE-2010-4180 when using previous OpenSSL versions we no longer enable</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">     this option regardless of OpenSSL version and SSL_OP_ALL definition.</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">     OpenSSL added a work-around for a SSL 3.0/TLS 1.0 CBC vulnerability</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">     (https://www.openssl.org/~bodo/tls-cbc.txt). In 0.9.6e they added a bit to</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment">     SSL_OP_ALL that _disables_ that work-around despite the fact that</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="comment">     SSL_OP_ALL is documented to do &quot;rather harmless&quot; workarounds. In order to</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="comment">     keep the secure work-around, the SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS bit</span></div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="comment">     must not be set.</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;  ctx_options = SSL_OP_ALL;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_TICKET</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  ctx_options |= SSL_OP_NO_TICKET;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_COMPRESSION</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  ctx_options |= SSL_OP_NO_COMPRESSION;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  <span class="comment">/* mitigate CVE-2010-4180 */</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  ctx_options &amp;= ~SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="preprocessor">#ifdef SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <span class="comment">/* unless the user explicitly ask to allow the protocol vulnerability we</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment">     use the work-around */</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(enable_beast))</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    ctx_options &amp;= ~SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">switch</span>(ssl_version) {</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a>:</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    ctx_options |= SSL_OP_NO_SSLv2;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_1;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_2;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_3;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="comment">/* asking for any TLS version as the minimum, means no SSL versions</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="comment">       allowed */</span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    ctx_options |= SSL_OP_NO_SSLv2;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    ctx_options |= SSL_OP_NO_SSLv3;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = set_ssl_version_min_max(&amp;ctx_options, conn, sockindex);</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>)</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;       <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a>:</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    ctx_options |= SSL_OP_NO_SSLv3;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="preprocessor">#if OPENSSL_VERSION_NUMBER &gt;= 0x1000100FL</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_1;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_2;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="preprocessor">#ifdef TLS1_3_VERSION</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    ctx_options |= SSL_OP_NO_TLSv1_3;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unrecognized parameter passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  }</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  SSL_CTX_set_options(BACKEND-&gt;ctx, ctx_options);</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="preprocessor">#ifdef HAS_NPN</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a0a00cd02ce442392e3836545ce356b6a">tls_enable_npn</a>)</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    SSL_CTX_set_next_proto_select_cb(BACKEND-&gt;ctx, select_next_proto_cb, conn);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="preprocessor">#ifdef HAS_ALPN</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">tls_enable_alpn</a>) {</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="keywordtype">int</span> cur = 0;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>[128];</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.httpversion &gt;= <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a> &amp;&amp;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;       (!<a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() || !conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">tunnel_proxy</a>)) {</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>[cur++] = NGHTTP2_PROTO_VERSION_ID_LEN;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>[cur], NGHTTP2_PROTO_VERSION_ID,</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;          NGHTTP2_PROTO_VERSION_ID_LEN);</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      cur += NGHTTP2_PROTO_VERSION_ID_LEN;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, offering %s\n&quot;</span>, NGHTTP2_PROTO_VERSION_ID);</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    }</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>[cur++] = <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;<a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>[cur], <a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>, <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>);</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    cur += <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, offering %s\n&quot;</span>, <a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="comment">/* expects length prefixed preference ordered list of protocols in wire</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">     * format</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    SSL_CTX_set_alpn_protos(BACKEND-&gt;ctx, <a class="code" href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a>, cur);</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  <span class="keywordflow">if</span>(ssl_cert || ssl_cert_type) {</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    <span class="keywordflow">if</span>(!cert_stuff(conn, BACKEND-&gt;ctx, ssl_cert, ssl_cert_type,</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                   <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>), <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(key_type),</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                   <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(key_passwd))) {</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      <span class="comment">/* failf() is already done in cert_stuff() */</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a>;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    }</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  }</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  ciphers = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(cipher_list);</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <span class="keywordflow">if</span>(!ciphers)</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    ciphers = (<span class="keywordtype">char</span> *)DEFAULT_CIPHER_SELECTION;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="keywordflow">if</span>(ciphers) {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#aa7611069fbad9e8c84bbafc77b58f369">SSL_CTX_set_cipher_list</a>(BACKEND-&gt;ctx, ciphers)) {</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed setting cipher list: %s&quot;</span>, ciphers);</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Cipher selection: %s\n&quot;</span>, ciphers);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_CTX_SET_CIPHERSUITES</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  {</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="keywordtype">char</span> *ciphers13 = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(cipher_list13);</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordflow">if</span>(ciphers13) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <span class="keywordflow">if</span>(!SSL_CTX_set_ciphersuites(BACKEND-&gt;ctx, ciphers13)) {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed setting TLS 1.3 cipher suite: %s&quot;</span>, ciphers13);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      }</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;TLS 1.3 cipher selection: %s\n&quot;</span>, ciphers13);</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    }</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_CTX_SET_POST_HANDSHAKE_AUTH</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <span class="comment">/* OpenSSL 1.1.1 requires clients to opt-in for PHA */</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  SSL_CTX_set_post_handshake_auth(BACKEND-&gt;ctx, 1);</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="preprocessor">#ifdef USE_TLS_SRP</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  <span class="keywordflow">if</span>(ssl_authtype == <a class="code" href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480a4c0ae8216421b905a5ba0fff6b685abe">CURL_TLSAUTH_SRP</a>) {</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_username = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(username);</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Using TLS-SRP username: %s\n&quot;</span>, ssl_username);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    <span class="keywordflow">if</span>(!SSL_CTX_set_srp_username(BACKEND-&gt;ctx, ssl_username)) {</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unable to set SRP user name&quot;</span>);</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a>;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    }</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="keywordflow">if</span>(!SSL_CTX_set_srp_password(BACKEND-&gt;ctx, <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(password))) {</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed setting SRP password&quot;</span>);</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a>;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    }</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(cipher_list)) {</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Setting cipher list SRP\n&quot;</span>);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#aa7611069fbad9e8c84bbafc77b58f369">SSL_CTX_set_cipher_list</a>(BACKEND-&gt;ctx, <span class="stringliteral">&quot;SRP&quot;</span>)) {</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed setting SRP cipher list&quot;</span>);</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      }</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    }</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  }</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="keywordflow">if</span>(ssl_cafile || ssl_capath) {</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="comment">/* tell SSL where to find CA certificates that are used to verify</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="comment">       the servers certificate. */</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a61d3b7d7309c202af466281171c05ed6">SSL_CTX_load_verify_locations</a>(BACKEND-&gt;ctx, ssl_cafile, ssl_capath)) {</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      <span class="keywordflow">if</span>(verifypeer) {</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <span class="comment">/* Fail if we insist on successfully verifying the server. */</span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;error setting certificate verify locations:\n&quot;</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;              <span class="stringliteral">&quot;  CAfile: %s\n  CApath: %s&quot;</span>,</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;              ssl_cafile ? ssl_cafile : <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;              ssl_capath ? ssl_capath : <span class="stringliteral">&quot;none&quot;</span>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      }</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <span class="comment">/* Just continue with a warning if no strict  certificate verification</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment">         is required. */</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;error setting certificate verify locations,&quot;</span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;            <span class="stringliteral">&quot; continuing anyway:\n&quot;</span>);</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    }</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="comment">/* Everything is fine. */</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;successfully set certificate verify locations:\n&quot;</span>);</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    }</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;          <span class="stringliteral">&quot;  CAfile: %s\n&quot;</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;          <span class="stringliteral">&quot;  CApath: %s\n&quot;</span>,</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;          ssl_cafile ? ssl_cafile : <span class="stringliteral">&quot;none&quot;</span>,</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;          ssl_capath ? ssl_capath : <span class="stringliteral">&quot;none&quot;</span>);</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  }</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="preprocessor">#ifdef CURL_CA_FALLBACK</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(verifypeer) {</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;    <span class="comment">/* verifying the peer without any CA certificates won&#39;t</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="comment">       work so use openssl&#39;s built in default as fallback */</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    SSL_CTX_set_default_verify_paths(BACKEND-&gt;ctx);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  }</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordflow">if</span>(ssl_crlfile) {</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="comment">/* tell SSL where to find CRL file that is used to check certificate</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="comment">     * revocation */</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    lookup = <a class="code" href="setup-vms_8h.html#ac0e57f9a4ec9d5ff1418a48cde263ab5">X509_STORE_add_lookup</a>(<a class="code" href="setup-vms_8h.html#af55e4ccbb54ad626fde32c2a43a8e06e">SSL_CTX_get_cert_store</a>(BACKEND-&gt;ctx),</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                                 <a class="code" href="setup-vms_8h.html#a221080751e77ffa1b64c7150aacc262f">X509_LOOKUP_file</a>());</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <span class="keywordflow">if</span>(!lookup ||</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;       (!<a class="code" href="setup-vms_8h.html#a99fe37fc3d3adef7634c44bb1f3ed59a">X509_load_crl_file</a>(lookup, ssl_crlfile, X509_FILETYPE_PEM)) ) {</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;error loading CRL file: %s&quot;</span>, ssl_crlfile);</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a241c54474fe64668004fc8d15496085c">CURLE_SSL_CRL_BADFILE</a>;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    }</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="comment">/* Everything is fine. */</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;successfully load CRL file:\n&quot;</span>);</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <a class="code" href="setup-vms_8h.html#afefcb42f55dc7e6f9d519be6d852dba8">X509_STORE_set_flags</a>(<a class="code" href="setup-vms_8h.html#af55e4ccbb54ad626fde32c2a43a8e06e">SSL_CTX_get_cert_store</a>(BACKEND-&gt;ctx),</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                         X509_V_FLAG_CRL_CHECK|X509_V_FLAG_CRL_CHECK_ALL);</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;  CRLfile: %s\n&quot;</span>, ssl_crlfile);</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  }</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="comment">/* Try building a chain using issuers in the trusted store first to avoid</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment">  problems with server-sent legacy intermediates.</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment">  Newer versions of OpenSSL do alternate chain checking by default which</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="comment">  gives us the same fix without as much of a performance hit (slight), so we</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="comment">  prefer that if available.</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;<span class="comment">  https://rt.openssl.org/Ticket/Display.html?id=3621&amp;user=guest&amp;pass=guest</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="preprocessor">#if defined(X509_V_FLAG_TRUSTED_FIRST) &amp;&amp; !defined(X509_V_FLAG_NO_ALT_CHAINS)</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="keywordflow">if</span>(verifypeer) {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <a class="code" href="setup-vms_8h.html#afefcb42f55dc7e6f9d519be6d852dba8">X509_STORE_set_flags</a>(<a class="code" href="setup-vms_8h.html#af55e4ccbb54ad626fde32c2a43a8e06e">SSL_CTX_get_cert_store</a>(BACKEND-&gt;ctx),</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                         X509_V_FLAG_TRUSTED_FIRST);</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  }</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  <span class="comment">/* SSL always tries to verify the peer, this only says whether it should</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="comment">   * fail to connect if the verification fails, or if it should continue</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="comment">   * anyway. In the latter case the result of the verification is checked with</span></div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;<span class="comment">   * SSL_get_verify_result() below. */</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;  <a class="code" href="setup-vms_8h.html#ad16fc197ca0af13411844895262ac9b6">SSL_CTX_set_verify</a>(BACKEND-&gt;ctx,</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                     verifypeer ? SSL_VERIFY_PEER : SSL_VERIFY_NONE, NULL);</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;  <span class="comment">/* Enable logging of secrets to the file specified in env SSLKEYLOGFILE. */</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="preprocessor">#if defined(ENABLE_SSLKEYLOGFILE) &amp;&amp; defined(HAVE_KEYLOG_CALLBACK)</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;  <span class="keywordflow">if</span>(keylog_file_fp) {</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    SSL_CTX_set_keylog_callback(BACKEND-&gt;ctx, ossl_keylog_callback);</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;  }</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  <span class="comment">/* Enable the session cache because it&#39;s a prerequisite for the &quot;new session&quot;</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="comment">   * callback. Use the &quot;external storage&quot; mode to avoid that OpenSSL creates</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="comment">   * an internal session cache.</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  SSL_CTX_set_session_cache_mode(BACKEND-&gt;ctx,</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      SSL_SESS_CACHE_CLIENT | SSL_SESS_CACHE_NO_INTERNAL);</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  SSL_CTX_sess_set_new_cb(BACKEND-&gt;ctx, ossl_new_session_cb);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="comment">/* give application a chance to interfere with SSL set up. */</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ssl.fsslctx) {</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = (*<a class="code" href="structdata.html">data</a>-&gt;set.ssl.fsslctx)(<a class="code" href="structdata.html">data</a>, BACKEND-&gt;ctx,</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                                      <a class="code" href="structdata.html">data</a>-&gt;set.ssl.fsslctxp);</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;error signaled by ssl ctx callback&quot;</span>);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    }</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  }</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  <span class="comment">/* Lets make an SSL structure */</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;handle)</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <a class="code" href="setup-vms_8h.html#a706c82bfae7ce618d3f0e39a0d72a988">SSL_free</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  BACKEND-&gt;handle = <a class="code" href="setup-vms_8h.html#a02e6c397c6763f0c0be42921bdb1a3c9">SSL_new</a>(BACKEND-&gt;ctx);</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;  <span class="keywordflow">if</span>(!BACKEND-&gt;handle) {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t create a context (handle)!&quot;</span>);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  }</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090808fL) &amp;&amp; !defined(OPENSSL_NO_TLSEXT) &amp;&amp; \</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="preprocessor">    !defined(OPENSSL_NO_OCSP)</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifystatus))</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    SSL_set_tlsext_status_type(BACKEND-&gt;handle, TLSEXT_STATUSTYPE_ocsp);</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="preprocessor">#if defined(OPENSSL_IS_BORINGSSL) &amp;&amp; defined(ALLOW_RENEG)</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  SSL_set_renegotiate_mode(BACKEND-&gt;handle, ssl_renegotiate_freely);</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  <a class="code" href="setup-vms_8h.html#ab2741d20acc86b4564591f5fbcd3c1f1">SSL_set_connect_state</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  BACKEND-&gt;server_cert = 0x0;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="preprocessor">#ifdef SSL_CTRL_SET_TLSEXT_HOSTNAME</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="keywordflow">if</span>((0 == <a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET, <a class="code" href="structhostname.html">hostname</a>, &amp;addr)) &amp;&amp;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;#ifdef <a class="code" href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;     (0 == <a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, <a class="code" href="structhostname.html">hostname</a>, &amp;addr)) &amp;&amp;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;#endif</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;     sni &amp;&amp;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;     !SSL_set_tlsext_host_name(BACKEND-&gt;handle, <a class="code" href="structhostname.html">hostname</a>))</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: failed to configure server name indication (SNI) &quot;</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;          <span class="stringliteral">&quot;TLS extension\n&quot;</span>);</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  <span class="comment">/* Check if there&#39;s a cached ID we can/should use here! */</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(primary.sessionid)) {</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="keywordtype">void</span> *ssl_sessionid = NULL;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    <span class="keywordtype">int</span> connectdata_idx = ossl_get_ssl_conn_index();</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="keywordtype">int</span> sockindex_idx = ossl_get_ssl_sockindex_index();</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <span class="keywordflow">if</span>(connectdata_idx &gt;= 0 &amp;&amp; sockindex_idx &gt;= 0) {</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <span class="comment">/* Store the data needed for the &quot;new session&quot; callback.</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment">       * The sockindex is stored as a pointer to an array element. */</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;      SSL_set_ex_data(BACKEND-&gt;handle, connectdata_idx, conn);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      SSL_set_ex_data(BACKEND-&gt;handle, sockindex_idx, conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a> + sockindex);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    }</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    Curl_ssl_sessionid_lock(conn);</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    <span class="keywordflow">if</span>(!Curl_ssl_getsessionid(conn, &amp;ssl_sessionid, NULL, sockindex)) {</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      <span class="comment">/* we got a session id, use it! */</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a14f32226c92f6f56dfb6b810cdaed446">SSL_set_session</a>(BACKEND-&gt;handle, ssl_sessionid)) {</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSL_set_session failed: %s&quot;</span>,</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)));</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      }</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <span class="comment">/* Informational message */</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL re-using session ID\n&quot;</span>);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    }</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  }</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[sockindex].<a class="code" href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">use</a>) {</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    BIO *<span class="keyword">const</span> bio = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(BIO_f_ssl());</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <a class="code" href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a> *handle = conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[sockindex].backend-&gt;handle;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a> == conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[sockindex].<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a>);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(handle != NULL);</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(bio != NULL);</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    BIO_set_ssl(bio, handle, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    SSL_set_bio(BACKEND-&gt;handle, bio, bio);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  }</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#a9623d65824dcc16b639b1d5cf0bf8107">SSL_set_fd</a>(BACKEND-&gt;handle, (<span class="keywordtype">int</span>)sockfd)) {</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <span class="comment">/* pass the raw socket into the SSL layers */</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSL_set_fd failed: %s&quot;</span>,</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;          ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer, <span class="keyword">sizeof</span>(error_buffer)));</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  }</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a>;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;}</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ossl_connect_step2(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;{</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keywordtype">int</span> err;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="keywordtype">long</span> * <span class="keyword">const</span> certverifyresult = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ?</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    &amp;<a class="code" href="structdata.html">data</a>-&gt;set.proxy_ssl.certverifyresult : &amp;<a class="code" href="structdata.html">data</a>-&gt;set.ssl.certverifyresult;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;              || <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;              || <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>);</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <a class="code" href="setup-vms_8h.html#a690ca365fec9f672101a774fb82fe3e7">ERR_clear_error</a>();</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  err = <a class="code" href="setup-vms_8h.html#aff3b619d1881322570e9689338c26baa">SSL_connect</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="comment">/* If keylogging is enabled but the keylog callback is not supported then log</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="comment">     secrets here, immediately after SSL_connect by using tap_ssl_key. */</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="preprocessor">#if defined(ENABLE_SSLKEYLOGFILE) &amp;&amp; !defined(HAVE_KEYLOG_CALLBACK)</span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;  tap_ssl_key(BACKEND-&gt;handle, &amp;BACKEND-&gt;tap_state);</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;  <span class="comment">/* 1  is fine</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment">     0  is &quot;not successful but was shut down controlled&quot;</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment">     &lt;0 is &quot;handshake was not successful, because a fatal error occurred&quot; */</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;  <span class="keywordflow">if</span>(1 != err) {</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="keywordtype">int</span> detail = <a class="code" href="setup-vms_8h.html#afb6a3c48e555d21b01f588b08c8d6d74">SSL_get_error</a>(BACKEND-&gt;handle, err);</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="keywordflow">if</span>(SSL_ERROR_WANT_READ == detail) {</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a>;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    }</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordflow">if</span>(SSL_ERROR_WANT_WRITE == detail) {</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a>;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    }</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <span class="comment">/* untreated error */</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> errdetail;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <span class="keywordtype">char</span> error_buffer[256]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;      <span class="keywordtype">long</span> lerr;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <span class="keywordtype">int</span> lib;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      <span class="keywordtype">int</span> reason;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      <span class="comment">/* the connection failed, we&#39;re not waiting for anything else. */</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a>;</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      <span class="comment">/* Get the earliest error code from the thread&#39;s error queue and removes</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="comment">         the entry. */</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      errdetail = <a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>();</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;      <span class="comment">/* Extract which lib and reason */</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;      lib = ERR_GET_LIB(errdetail);</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;      reason = ERR_GET_REASON(errdetail);</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      <span class="keywordflow">if</span>((lib == ERR_LIB_SSL) &amp;&amp;</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;         (reason == SSL_R_CERTIFICATE_VERIFY_FAILED)) {</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        lerr = <a class="code" href="setup-vms_8h.html#a2dd08cb14ef6733c358be4f442ff410a">SSL_get_verify_result</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;        <span class="keywordflow">if</span>(lerr != X509_V_OK) {</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;          *certverifyresult = lerr;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;          <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(error_buffer, <span class="keyword">sizeof</span>(error_buffer),</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                    <span class="stringliteral">&quot;SSL certificate problem: %s&quot;</span>,</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                    <a class="code" href="setup-vms_8h.html#a23aa09f44032fb7175abe25a8ef7b024">X509_verify_cert_error_string</a>(lerr));</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        }</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;          <span class="comment">/* strcpy() is fine here as long as the string fits within</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment">             error_buffer */</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;          strcpy(error_buffer, <span class="stringliteral">&quot;SSL certificate verification failed&quot;</span>);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;      }</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        ossl_strerror(errdetail, error_buffer, <span class="keyword">sizeof</span>(error_buffer));</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      }</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <span class="comment">/* detail is already set to the SSL error above */</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      <span class="comment">/* If we e.g. use SSLv2 request-method and the server doesn&#39;t like us</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment">       * (RST connection etc.), OpenSSL gives no explanation whatsoever and</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="comment">       * the SO_ERROR is also lost.</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a> == <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; errdetail == 0) {</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="structhostname.html">hostname</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ?</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> : conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> port = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">port</a> : conn-&gt;<a class="code" href="structconnectdata.html#a82d9732a096255f5d8741c4a0ea990eb">remote_port</a>;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; SSL_connect: %s in connection to %s:%ld &quot;</span>,</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;              SSL_ERROR_to_str(detail), <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      }</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      <span class="comment">/* Could be a CERT problem */</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;%s&quot;</span>, error_buffer);</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    }</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  }</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="comment">/* we have been connected fine, we&#39;re not waiting for anything else. */</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a>;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="comment">/* Informational message */</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection using %s / %s\n&quot;</span>,</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;          get_ssl_version_txt(BACKEND-&gt;handle),</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          SSL_get_cipher(BACKEND-&gt;handle));</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="preprocessor">#ifdef HAS_ALPN</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="comment">/* Sets data and len to negotiated protocol, len is 0 if no protocol was</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment">     * negotiated</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">tls_enable_alpn</a>) {</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *neg_protocol;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      SSL_get0_alpn_selected(BACKEND-&gt;handle, &amp;neg_protocol, &amp;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> != 0) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, server accepted to use %.*s\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, neg_protocol);</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> == NGHTTP2_PROTO_VERSION_ID_LEN &amp;&amp;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;           !memcmp(NGHTTP2_PROTO_VERSION_ID, neg_protocol, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)) {</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;          conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a>;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        }</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> == <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a> &amp;&amp;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;           !memcmp(<a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>, neg_protocol, <a class="code" href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a>)) {</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;          conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a>;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      }</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, server did not agree to a protocol\n&quot;</span>);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    }</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;  }</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;}</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> asn1_object_dump(ASN1_OBJECT *<a class="code" href="structa.html">a</a>, <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;{</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, ilen;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;  ilen = (int)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;  <span class="keywordflow">if</span>(ilen &lt; 0)</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* buffer too big */</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="setup-vms_8h.html#ab0948ba5c5c5d3f7e66b71d46e7a7ff5">i2t_ASN1_OBJECT</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, ilen, <a class="code" href="structa.html">a</a>);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt;= ilen)</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* buffer too small */</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;}</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;<span class="preprocessor">#define push_certinfo(_label, _num) \</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="preprocessor">do {                              \</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="preprocessor">  long info_len = BIO_get_mem_data(mem, &amp;ptr); \</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;<span class="preprocessor">  Curl_ssl_push_certinfo_len(data, _num, _label, ptr, info_len); \</span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="preprocessor">  if(1 != BIO_reset(mem))                                        \</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;<span class="preprocessor">    break;                                                       \</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;<span class="preprocessor">} WHILE_FALSE</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pubkey_show(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                        BIO *mem,</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                        <span class="keywordtype">int</span> num,</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>,</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>,</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;#ifdef HAVE_OPAQUE_RSA_DSA_DH</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                        <span class="keyword">const</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;#endif</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                        BIGNUM *bn)</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;{</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  <span class="keywordtype">char</span> namebuf[32];</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;  <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(namebuf, <span class="keyword">sizeof</span>(namebuf), <span class="stringliteral">&quot;%s(%s)&quot;</span>, <a class="code" href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>, <a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <span class="keywordflow">if</span>(bn)</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    BN_print(mem, bn);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  push_certinfo(namebuf, num);</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;}</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_RSA_DSA_DH</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="preprocessor">#define print_pubkey_BN(_type, _name, _num)              \</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="preprocessor">  pubkey_show(data, mem, _num, #_type, #_name, _name)</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="preprocessor">#define print_pubkey_BN(_type, _name, _num)    \</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="preprocessor">do {                              \</span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="preprocessor">  if(_type-&gt;_name) { \</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="preprocessor">    pubkey_show(data, mem, _num, #_type, #_name, _type-&gt;_name); \</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="preprocessor">  } \</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="preprocessor">} WHILE_FALSE</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> X509V3_ext(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                      <span class="keywordtype">int</span> certnum,</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                      CONST_EXTS STACK_OF(X509_EXTENSION) *exts)</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;{</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)sk_X509_EXTENSION_num(exts) &lt;= 0)</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    <span class="comment">/* no extensions, bail out */</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; (int)sk_X509_EXTENSION_num(exts); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    ASN1_OBJECT *obj;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    X509_EXTENSION *ext = sk_X509_EXTENSION_value(exts, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    BUF_MEM *biomem;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[512];</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="keywordtype">char</span> namebuf[128];</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    BIO *bio_out = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(<a class="code" href="setup-vms_8h.html#a89bfb3b0711e9bd660ac564e1cac91f8">BIO_s_mem</a>());</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="keywordflow">if</span>(!bio_out)</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    obj = <a class="code" href="setup-vms_8h.html#a4ead4d93b3d52c189754db122087752e">X509_EXTENSION_get_object</a>(ext);</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    asn1_object_dump(obj, namebuf, <span class="keyword">sizeof</span>(namebuf));</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="setup-vms_8h.html#aab7dc0cfbac448e2e86e9ee8c6aaacb4">X509V3_EXT_print</a>(bio_out, ext, 0, 0))</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <a class="code" href="setup-vms_8h.html#a0b0a5da9dd1869f358e76c32d391dac9">ASN1_STRING_print</a>(bio_out, (ASN1_STRING *)<a class="code" href="setup-vms_8h.html#aa49ec2376b0abc6f0029b4988ab62c79">X509_EXTENSION_get_data</a>(ext));</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    BIO_get_mem_ptr(bio_out, &amp;biomem);</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; (size_t)biomem-&gt;length; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *sep = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      <span class="keywordflow">if</span>(biomem-&gt;data[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>] == <span class="charliteral">&#39;\n&#39;</span>) {</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        sep = <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++; <span class="comment">/* skip the newline */</span></div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;      };</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">while</span>((<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;(<span class="keywordtype">size_t</span>)biomem-&gt;length) &amp;&amp; (biomem-&gt;data[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>] == <span class="charliteral">&#39; &#39;</span>))</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>&lt;(<span class="keywordtype">size_t</span>)biomem-&gt;length)</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> += <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)-(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>-<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>), <span class="stringliteral">&quot;%s%c&quot;</span>, sep,</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                         biomem-&gt;data[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    }</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    Curl_ssl_push_certinfo(<a class="code" href="structdata.html">data</a>, certnum, namebuf, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(bio_out);</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;  }</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;  <span class="keywordflow">return</span> 0; <span class="comment">/* all is fine */</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;}</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> get_cert_chain(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                               <span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl)</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;{</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  STACK_OF(X509) *sk;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;  <span class="keywordtype">int</span> numcerts;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;  BIO *mem;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  sk = <a class="code" href="setup-vms_8h.html#ae7a3a3c97dd01e898235d37445053c59">SSL_get_peer_cert_chain</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="keywordflow">if</span>(!sk) {</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  }</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  numcerts = sk_X509_num(sk);</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_ssl_init_certinfo(<a class="code" href="structdata.html">data</a>, numcerts);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  }</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;  mem = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(<a class="code" href="setup-vms_8h.html#a89bfb3b0711e9bd660ac564e1cac91f8">BIO_s_mem</a>());</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; numcerts; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    ASN1_INTEGER *num;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    X509 *<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a> = sk_X509_value(sk, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    EVP_PKEY *pubkey = NULL;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <span class="keyword">const</span> ASN1_BIT_STRING *psig = NULL;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <a class="code" href="setup-vms_8h.html#a9c484827ba0013b393e32968e412c856">X509_NAME_print_ex</a>(mem, <a class="code" href="setup-vms_8h.html#a410e7961cad2b4f22017252ded2f38f4">X509_get_subject_name</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>), 0, XN_FLAG_ONELINE);</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Subject&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <a class="code" href="setup-vms_8h.html#a9c484827ba0013b393e32968e412c856">X509_NAME_print_ex</a>(mem, <a class="code" href="setup-vms_8h.html#ad9d91a5f187f92caec96549f7f99ce08">X509_get_issuer_name</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>), 0, XN_FLAG_ONELINE);</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Issuer&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    BIO_printf(mem, <span class="stringliteral">&quot;%lx&quot;</span>, X509_get_version(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>));</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Version&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    num = <a class="code" href="setup-vms_8h.html#a97f3e3bdc74924efa81ef32d47227233">X509_get_serialNumber</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    <span class="keywordflow">if</span>(num-&gt;type == V_ASN1_NEG_INTEGER)</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      BIO_puts(mem, <span class="stringliteral">&quot;-&quot;</span>);</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; num-&gt;length; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;      BIO_printf(mem, <span class="stringliteral">&quot;%02x&quot;</span>, num-&gt;data[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Serial Number&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="preprocessor">#if defined(HAVE_X509_GET0_SIGNATURE) &amp;&amp; defined(HAVE_X509_GET0_EXTENSIONS)</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;      <span class="keyword">const</span> X509_ALGOR *palg = NULL;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;      ASN1_STRING *<a class="code" href="structa.html">a</a> = ASN1_STRING_new();</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structa.html">a</a>) {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        X509_get0_signature(&amp;psig, &amp;palg, <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        X509_signature_print(mem, ARG2_X509_signature_print palg, <a class="code" href="structa.html">a</a>);</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        ASN1_STRING_free(<a class="code" href="structa.html">a</a>);</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="keywordflow">if</span>(palg) {</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;          i2a_ASN1_OBJECT(mem, palg-&gt;algorithm);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;          push_certinfo(<span class="stringliteral">&quot;Public Key Algorithm&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        }</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      }</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      X509V3_ext(<a class="code" href="structdata.html">data</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, X509_get0_extensions(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>));</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    }</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    {</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      <span class="comment">/* before OpenSSL 1.0.2 */</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;      X509_CINF *cinf = <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>-&gt;cert_info;</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      i2a_ASN1_OBJECT(mem, cinf-&gt;signature-&gt;algorithm);</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      push_certinfo(<span class="stringliteral">&quot;Signature Algorithm&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      i2a_ASN1_OBJECT(mem, cinf-&gt;key-&gt;algor-&gt;algorithm);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      push_certinfo(<span class="stringliteral">&quot;Public Key Algorithm&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      X509V3_ext(<a class="code" href="structdata.html">data</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, cinf-&gt;extensions);</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      psig = <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>-&gt;signature;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    }</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    ASN1_TIME_print(mem, X509_get0_notBefore(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>));</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Start date&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    ASN1_TIME_print(mem, X509_get0_notAfter(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>));</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Expire date&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    pubkey = <a class="code" href="setup-vms_8h.html#a2505312fdce26ff8bc2d3686cc6b9a6f">X509_get_pubkey</a>(<a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <span class="keywordflow">if</span>(!pubkey)</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;   Unable to load public key\n&quot;</span>);</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordtype">int</span> pktype;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_EVP_PKEY</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;      pktype = EVP_PKEY_id(pubkey);</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      pktype = pubkey-&gt;type;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      <span class="keywordflow">switch</span>(pktype) {</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      <span class="keywordflow">case</span> EVP_PKEY_RSA:</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      {</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        RSA *rsa;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_EVP_PKEY</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        rsa = EVP_PKEY_get0_RSA(pubkey);</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        rsa = pubkey-&gt;pkey.rsa;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_RSA_DSA_DH</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        {</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;          <span class="keyword">const</span> BIGNUM *<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;          <span class="keyword">const</span> BIGNUM *e;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;          RSA_get0_key(rsa, &amp;<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, &amp;e, NULL);</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;          BN_print(mem, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>);</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;          push_certinfo(<span class="stringliteral">&quot;RSA Public Key&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;          print_pubkey_BN(rsa, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;          print_pubkey_BN(rsa, e, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        }</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        BIO_printf(mem, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="setup-vms_8h.html#a01e08f80ad19159daa59390042c4b612">BN_num_bits</a>(rsa-&gt;n));</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        push_certinfo(<span class="stringliteral">&quot;RSA Public Key&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        print_pubkey_BN(rsa, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        print_pubkey_BN(rsa, e, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      }</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;      <span class="keywordflow">case</span> EVP_PKEY_DSA:</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;      {</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="preprocessor">#ifndef OPENSSL_NO_DSA</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        DSA *dsa;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_EVP_PKEY</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        dsa = EVP_PKEY_get0_DSA(pubkey);</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        dsa = pubkey-&gt;pkey.dsa;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_RSA_DSA_DH</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        {</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;          <span class="keyword">const</span> BIGNUM *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;          <span class="keyword">const</span> BIGNUM *q;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;          <span class="keyword">const</span> BIGNUM *g;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;          <span class="keyword">const</span> BIGNUM *pub_key;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;          DSA_get0_pqg(dsa, &amp;<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, &amp;q, &amp;g);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;          DSA_get0_key(dsa, &amp;pub_key, NULL);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;          print_pubkey_BN(dsa, <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;          print_pubkey_BN(dsa, q, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;          print_pubkey_BN(dsa, g, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;          print_pubkey_BN(dsa, pub_key, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        }</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        print_pubkey_BN(dsa, <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        print_pubkey_BN(dsa, q, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        print_pubkey_BN(dsa, g, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        print_pubkey_BN(dsa, pub_key, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !OPENSSL_NO_DSA */</span><span class="preprocessor"></span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      }</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;      <span class="keywordflow">case</span> EVP_PKEY_DH:</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      {</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        DH *dh;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_EVP_PKEY</span></div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        dh = EVP_PKEY_get0_DH(pubkey);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        dh = pubkey-&gt;pkey.dh;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="preprocessor">#ifdef HAVE_OPAQUE_RSA_DSA_DH</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        {</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;          <span class="keyword">const</span> BIGNUM *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;          <span class="keyword">const</span> BIGNUM *q;</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;          <span class="keyword">const</span> BIGNUM *g;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;          <span class="keyword">const</span> BIGNUM *pub_key;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;          DH_get0_pqg(dh, &amp;<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, &amp;q, &amp;g);</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;          DH_get0_key(dh, &amp;pub_key, NULL);</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;          print_pubkey_BN(dh, <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;          print_pubkey_BN(dh, q, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;          print_pubkey_BN(dh, g, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;          print_pubkey_BN(dh, pub_key, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;       }</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        print_pubkey_BN(dh, <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        print_pubkey_BN(dh, g, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        print_pubkey_BN(dh, pub_key, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      }</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="keywordflow">case</span> EVP_PKEY_EC: <span class="comment">/* symbol not present in OpenSSL 0.9.6 */</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        <span class="comment">/* left TODO */</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      }</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      <a class="code" href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a>(pubkey);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    }</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    <span class="keywordflow">if</span>(psig) {</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; psig-&gt;length; <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        BIO_printf(mem, <span class="stringliteral">&quot;%02x:&quot;</span>, psig-&gt;data[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      push_certinfo(<span class="stringliteral">&quot;Signature&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    }</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    <a class="code" href="setup-vms_8h.html#abf3e7113358b6d2bb48abf801fdf9116">PEM_write_bio_X509</a>(mem, <a class="code" href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a>);</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    push_certinfo(<span class="stringliteral">&quot;Cert&quot;</span>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  }</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(mem);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;}</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="comment"> * Heavily modified from:</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;<span class="comment"> * https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning#OpenSSL</span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> pkp_pin_peer_pubkey(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>, X509* cert,</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *pinnedpubkey)</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;{</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;  <span class="comment">/* Scratch */</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;  <span class="keywordtype">int</span> len1 = 0, len2 = 0;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buff1 = NULL, *<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a> = NULL;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;  <span class="comment">/* Result is returned to caller */</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f">CURLE_SSL_PINNEDPUBKEYNOTMATCH</a>;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;  <span class="comment">/* if a path wasn&#39;t specified, don&#39;t pin */</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;  <span class="keywordflow">if</span>(!pinnedpubkey)</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  <span class="keywordflow">if</span>(!cert)</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <span class="comment">/* Begin Gyrations to get the subjectPublicKeyInfo     */</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <span class="comment">/* Thanks to Viktor Dukhovni on the OpenSSL mailing list */</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="comment">/* https://groups.google.com/group/mailing.openssl.users/browse_thread</span></div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;<span class="comment">     /thread/d61858dae102c6c7 */</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    len1 = <a class="code" href="setup-vms_8h.html#a97ce2c6906885aa8d887d135945c2165">i2d_X509_PUBKEY</a>(X509_get_X509_PUBKEY(cert), NULL);</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <span class="keywordflow">if</span>(len1 &lt; 1)</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <span class="keywordflow">break</span>; <span class="comment">/* failed */</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    <span class="comment">/* https://www.openssl.org/docs/crypto/buffer.html */</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    buff1 = <a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a> = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(len1);</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="keywordflow">if</span>(!buff1)</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keywordflow">break</span>; <span class="comment">/* failed */</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    <span class="comment">/* https://www.openssl.org/docs/crypto/d2i_X509.html */</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    len2 = <a class="code" href="setup-vms_8h.html#a97ce2c6906885aa8d887d135945c2165">i2d_X509_PUBKEY</a>(X509_get_X509_PUBKEY(cert), &amp;<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a>);</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;<span class="comment">     * These checks are verifying we got back the same values as when we</span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="comment">     * sized the buffer. It&#39;s pretty weak since they should always be the</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="comment">     * same. But it gives us something to test.</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="keywordflow">if</span>((len1 != len2) || !<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a> || ((<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a> - buff1) != len1))</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      <span class="keywordflow">break</span>; <span class="comment">/* failed */</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="comment">/* End Gyrations */</span></div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <span class="comment">/* The one good exit point */</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_pin_peer_pubkey(<a class="code" href="structdata.html">data</a>, pinnedpubkey, buff1, len1);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  } <span class="keywordflow">while</span>(0);</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;  <span class="comment">/* https://www.openssl.org/docs/crypto/buffer.html */</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  <span class="keywordflow">if</span>(buff1)</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(buff1);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;}</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="comment"> * Get the server cert, verify it and show it etc, only call failf() if the</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;<span class="comment"> * &#39;strict&#39; argument is TRUE as otherwise all this is for informational</span></div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="comment"> * purposes only!</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment"> * We check certificates to authenticate the server; otherwise we risk</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment"> * man-in-the-middle attack.</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> servercert(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                           <span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl,</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                           <span class="keywordtype">bool</span> strict)</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;{</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;  <span class="keywordtype">long</span> lerr;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;  X509 *issuer;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;  BIO *fp = NULL;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  <span class="keywordtype">char</span> error_buffer[256]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2048];</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;  <span class="keywordtype">long</span> * <span class="keyword">const</span> certverifyresult = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ?</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    &amp;<a class="code" href="structdata.html">data</a>-&gt;set.proxy_ssl.certverifyresult : &amp;<a class="code" href="structdata.html">data</a>-&gt;set.ssl.certverifyresult;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  BIO *mem = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(<a class="code" href="setup-vms_8h.html#a89bfb3b0711e9bd660ac564e1cac91f8">BIO_s_mem</a>());</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ssl.certinfo)</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    <span class="comment">/* we&#39;ve been asked to gather certificate info! */</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    (void)get_cert_chain(conn, connssl);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  BACKEND-&gt;server_cert = <a class="code" href="setup-vms_8h.html#a1dc692f9cc757a915064dedb56896974">SSL_get_peer_certificate</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;  <span class="keywordflow">if</span>(!BACKEND-&gt;server_cert) {</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(mem);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    <span class="keywordflow">if</span>(!strict)</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t get peer certificate!&quot;</span>);</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;  }</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;%s certificate:\n&quot;</span>, <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? <span class="stringliteral">&quot;Proxy&quot;</span> : <span class="stringliteral">&quot;Server&quot;</span>);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = x509_name_oneline(<a class="code" href="setup-vms_8h.html#a410e7961cad2b4f22017252ded2f38f4">X509_get_subject_name</a>(BACKEND-&gt;server_cert),</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;                         <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>));</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; subject: %s\n&quot;</span>, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>?<span class="stringliteral">&quot;[NONE]&quot;</span>:<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;  {</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    <span class="keywordtype">long</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    ASN1_TIME_print(mem, X509_get0_notBefore(BACKEND-&gt;server_cert));</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = BIO_get_mem_data(mem, (<span class="keywordtype">char</span> **) &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; start date: %.*s\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;    (void)BIO_reset(mem);</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;    ASN1_TIME_print(mem, X509_get0_notAfter(BACKEND-&gt;server_cert));</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = BIO_get_mem_data(mem, (<span class="keywordtype">char</span> **) &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; expire date: %.*s\n&quot;</span>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    (void)BIO_reset(mem);</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;  }</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;  <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(mem);</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifyhost)) {</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = verifyhost(conn, BACKEND-&gt;server_cert);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;      BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    }</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;  }</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = x509_name_oneline(<a class="code" href="setup-vms_8h.html#ad9d91a5f187f92caec96549f7f99ce08">X509_get_issuer_name</a>(BACKEND-&gt;server_cert),</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                         <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>));</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    <span class="keywordflow">if</span>(strict)</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t get X509-issuer name!&quot;</span>);</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  }</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; issuer: %s\n&quot;</span>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;    <span class="comment">/* We could do all sorts of certificate verification stuff here before</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="comment">       deallocating the certificate. */</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;    <span class="comment">/* e.g. match issuer name with provided issuer certificate */</span></div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert)) {</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      fp = <a class="code" href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a>(BIO_s_file());</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      <span class="keywordflow">if</span>(fp == NULL) {</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;              <span class="stringliteral">&quot;BIO_new return NULL, &quot;</span> OSSL_PACKAGE</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;              <span class="stringliteral">&quot; error %s&quot;</span>,</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;              ossl_strerror(<a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>(), error_buffer,</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                            <span class="keyword">sizeof</span>(error_buffer)) );</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;        BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      }</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      <span class="keywordflow">if</span>(BIO_read_filename(fp, <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert)) &lt;= 0) {</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;        <span class="keywordflow">if</span>(strict)</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Unable to open issuer cert (%s)&quot;</span>,</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert));</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;        <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a567c864875b56a6fed90ca22bc89a5a2">CURLE_SSL_ISSUER_ERROR</a>;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      }</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;      issuer = PEM_read_bio_X509(fp, NULL, <a class="code" href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a>, NULL);</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <span class="keywordflow">if</span>(!issuer) {</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;        <span class="keywordflow">if</span>(strict)</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Unable to read issuer cert (%s)&quot;</span>,</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;                <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert));</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(issuer);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a567c864875b56a6fed90ca22bc89a5a2">CURLE_SSL_ISSUER_ERROR</a>;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;      }</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="setup-vms_8h.html#a4e60f57d61a6a6acab36969bbe0a334a">X509_check_issued</a>(issuer, BACKEND-&gt;server_cert) != X509_V_OK) {</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        <span class="keywordflow">if</span>(strict)</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Certificate issuer check failed (%s)&quot;</span>,</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;                <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert));</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(issuer);</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;        BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a567c864875b56a6fed90ca22bc89a5a2">CURLE_SSL_ISSUER_ERROR</a>;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;      }</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; SSL certificate issuer check ok (%s)\n&quot;</span>,</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;            <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(issuercert));</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;      <a class="code" href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a>(fp);</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(issuer);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    }</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    lerr = *certverifyresult = <a class="code" href="setup-vms_8h.html#a2dd08cb14ef6733c358be4f442ff410a">SSL_get_verify_result</a>(BACKEND-&gt;handle);</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;    <span class="keywordflow">if</span>(*certverifyresult != X509_V_OK) {</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifypeer)) {</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;        <span class="comment">/* We probably never reach this, because SSL_connect() will fail</span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="comment">           and we return earlier if verifypeer is set? */</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;        <span class="keywordflow">if</span>(strict)</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate verify result: %s (%ld)&quot;</span>,</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;                <a class="code" href="setup-vms_8h.html#a23aa09f44032fb7175abe25a8ef7b024">X509_verify_cert_error_string</a>(lerr), lerr);</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; SSL certificate verify result: %s (%ld),&quot;</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;              <span class="stringliteral">&quot; continuing anyway.\n&quot;</span>,</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;              <a class="code" href="setup-vms_8h.html#a23aa09f44032fb7175abe25a8ef7b024">X509_verify_cert_error_string</a>(lerr), lerr);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    }</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot; SSL certificate verify ok.\n&quot;</span>);</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  }</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090808fL) &amp;&amp; !defined(OPENSSL_NO_TLSEXT) &amp;&amp; \</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="preprocessor">    !defined(OPENSSL_NO_OCSP)</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifystatus)) {</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = verifystatus(conn, connssl);</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;      <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;      BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    }</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;  }</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;  <span class="keywordflow">if</span>(!strict)</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;    <span class="comment">/* when not strict, we don&#39;t bother about the verify cert problems */</span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;  <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa85af043a41434c1b4f439fb89d5c9047">STRING_SSL_PINNEDPUBLICKEY_PROXY</a>] :</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                         <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f">STRING_SSL_PINNEDPUBLICKEY_ORIG</a>];</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> &amp;&amp; <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = pkp_pin_peer_pubkey(<a class="code" href="structdata.html">data</a>, BACKEND-&gt;server_cert, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: public key does not match pinned public key!&quot;</span>);</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;  }</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;  <a class="code" href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a>(BACKEND-&gt;server_cert);</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;  BACKEND-&gt;server_cert = NULL;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a>;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;}</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ossl_connect_step3(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;{</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>);</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;<span class="comment">   * We check certificates to authenticate the server; otherwise we risk</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;<span class="comment">   * man-in-the-middle attack; NEVERTHELESS, if we&#39;re told explicitly not to</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;<span class="comment">   * verify the peer ignore faults and failures from the server cert</span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;<span class="comment">   * operations.</span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = servercert(conn, connssl, (<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifypeer) ||</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;                                      <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifyhost)));</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a>;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;}</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="keyword">static</span> <a class="code" href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a> ossl_recv;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;<span class="keyword">static</span> <a class="code" href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a> ossl_send;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> ossl_connect_common(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                                    <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                                    <span class="keywordtype">bool</span> nonblocking,</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                                    <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;{</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;  time_t timeout_ms;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;  <span class="keywordtype">int</span> what;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  <span class="comment">/* check if the connection has already been established */</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a>) {</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    *done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;  }</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    <span class="comment">/* Find out how much more time we&#39;re allowed */</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    timeout_ms = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      <span class="comment">/* no need to continue if time already is up */</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    }</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ossl_connect_step1(conn, sockindex);</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;  }</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;        <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    <span class="comment">/* check allowed time left */</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    timeout_ms = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      <span class="comment">/* no need to continue if time already is up */</span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    }</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    <span class="comment">/* if ssl is expecting something, check if it&#39;s available. */</span></div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    <span class="keywordflow">if</span>(connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> == <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> ||</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;       connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> == <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a>) {</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> writefd = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> ==</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;        connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>?sockfd:<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> readfd = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> ==</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>?sockfd:<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;      what = <a class="code" href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a>(readfd, <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>, writefd,</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;                               nonblocking?0:timeout_ms);</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;      <span class="keywordflow">if</span>(what &lt; 0) {</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;        <span class="comment">/* fatal error */</span></div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;select/poll on SSL socket, errno: %d&quot;</span>, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;      }</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      <span class="keywordflow">if</span>(0 == what) {</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        <span class="keywordflow">if</span>(nonblocking) {</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;          *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;        <span class="comment">/* timeout */</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;      }</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;      <span class="comment">/* socket is readable or writable */</span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    }</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    <span class="comment">/* Run transaction, and return to the caller if it failed or if this</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment">     * connection is done nonblocking and this loop would execute again. This</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">     * permits the owner of a multi handle to abort a connection attempt</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;<span class="comment">     * before step2 has completed while ensuring that a client using select()</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;<span class="comment">     * or epoll() will always have a valid fdset to wait on.</span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ossl_connect_step2(conn, sockindex);</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (nonblocking &amp;&amp;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;                  (<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                   <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                   <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>)))</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;  } <span class="comment">/* repeat step2 until all transactions are done. */</span></div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ossl_connect_step3(conn, sockindex);</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;  }</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;    connssl-&gt;<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a> = <a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a>;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[sockindex] = ossl_recv;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[sockindex] = ossl_send;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    *done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  }</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;  <span class="comment">/* Reset our connect state machine */</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a>;</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;}</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_connect_nonblocking(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;                                              <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                                              <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;{</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;  <span class="keywordflow">return</span> ossl_connect_common(conn, sockindex, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, done);</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;}</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;{</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;  <span class="keywordtype">bool</span> done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = ossl_connect_common(conn, sockindex, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, &amp;done);</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(done);</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;}</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Curl_ossl_data_pending(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                                   <span class="keywordtype">int</span> connindex)</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;{</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[connindex];</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *proxyssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[connindex];</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;  <span class="keywordflow">if</span>(connssl-&gt;backend-&gt;handle &amp;&amp; <a class="code" href="setup-vms_8h.html#afe0d45b9905f519fa032e134eaccb01c">SSL_pending</a>(connssl-&gt;backend-&gt;handle))</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;  <span class="keywordflow">if</span>(proxyssl-&gt;backend-&gt;handle &amp;&amp; <a class="code" href="setup-vms_8h.html#afe0d45b9905f519fa032e134eaccb01c">SSL_pending</a>(proxyssl-&gt;backend-&gt;handle))</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;}</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> Curl_ossl_version(<span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> ossl_send(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                         <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">void</span> *mem,</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                         <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                         <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *curlcode)</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;{</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  <span class="comment">/* SSL_write() is said to return &#39;int&#39; while write() and send() returns</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;<span class="comment">     &#39;size_t&#39; */</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;  <span class="keywordtype">int</span> err;</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;  <span class="keywordtype">char</span> error_buffer[256];</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sslerror;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;  <span class="keywordtype">int</span> memlen;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  <a class="code" href="setup-vms_8h.html#a690ca365fec9f672101a774fb82fe3e7">ERR_clear_error</a>();</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;  memlen = (<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; (size_t)INT_MAX) ? INT_MAX : (int)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-vms_8h.html#a7ca4a51d411e5c43e3b6e57b8ea19f2c">SSL_write</a>(BACKEND-&gt;handle, mem, memlen);</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;    err = <a class="code" href="setup-vms_8h.html#afb6a3c48e555d21b01f588b08c8d6d74">SSL_get_error</a>(BACKEND-&gt;handle, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;    <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;      <span class="comment">/* The operation did not complete; the same TLS/SSL I/O function</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;<span class="comment">         should be called again later. This is basically an EWOULDBLOCK</span></div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;<span class="comment">         equivalent. */</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;      *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SSL_write() returned SYSCALL, errno = %d&quot;</span>,</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;            <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;      *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_SSL:</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      <span class="comment">/*  A failure in the SSL library occurred, usually a protocol error.</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">          The OpenSSL error queue contains more information on the error. */</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;      sslerror = <a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>();</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;      <span class="keywordflow">if</span>(ERR_GET_LIB(sslerror) == ERR_LIB_SSL &amp;&amp;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;         ERR_GET_REASON(sslerror) == SSL_R_BIO_NOT_SET &amp;&amp;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;         conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex].<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a> == <a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a> &amp;&amp;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;         conn-&gt;<a class="code" href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">proxy_ssl</a>[sockindex].<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a> == <a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a>) {</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;        <span class="keywordtype">char</span> ver[120];</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;        Curl_ossl_version(ver, 120);</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Error: %s does not support double SSL tunneling.&quot;</span>,</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;              ver);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      }</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SSL_write() error: %s&quot;</span>,</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;              ossl_strerror(sslerror, error_buffer, <span class="keyword">sizeof</span>(error_buffer)));</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;    }</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    <span class="comment">/* a true error */</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; SSL_write: %s, errno %d&quot;</span>,</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;          SSL_ERROR_to_str(err), <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;    *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;  }</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;  *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>; <span class="comment">/* number of bytes */</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;}</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> ossl_recv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="comment">/* connection data */</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                         <span class="keywordtype">int</span> num,                  <span class="comment">/* socketindex */</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;                         <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,                <span class="comment">/* store read data here */</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                         <span class="keywordtype">size_t</span> buffersize,        <span class="comment">/* max amount to read */</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                         <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *curlcode)</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;{</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;  <span class="keywordtype">char</span> error_buffer[256];</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sslerror;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;  <span class="keywordtype">int</span> buffsize;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[num];</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;  <a class="code" href="setup-vms_8h.html#a690ca365fec9f672101a774fb82fe3e7">ERR_clear_error</a>();</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;  buffsize = (buffersize &gt; (size_t)INT_MAX) ? INT_MAX : (int)buffersize;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;  nread = (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)<a class="code" href="setup-vms_8h.html#aae68723650f0ed53b36894d426afdbc9">SSL_read</a>(BACKEND-&gt;handle, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, buffsize);</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;  <span class="keywordflow">if</span>(nread &lt;= 0) {</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    <span class="comment">/* failed SSL_read */</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="keywordtype">int</span> err = <a class="code" href="setup-vms_8h.html#afb6a3c48e555d21b01f588b08c8d6d74">SSL_get_error</a>(BACKEND-&gt;handle, (<span class="keywordtype">int</span>)nread);</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_NONE: <span class="comment">/* this is not an error */</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN: <span class="comment">/* no more data */</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      <span class="comment">/* there&#39;s data pending, re-invoke SSL_read() */</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      <span class="comment">/* openssl/ssl.h for SSL_ERROR_SYSCALL says &quot;look at error stack/return</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="comment">         value/errno&quot; */</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      <span class="comment">/* https://www.openssl.org/docs/crypto/ERR_get_error.html */</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;      sslerror = <a class="code" href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a>();</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;      <span class="keywordflow">if</span>((nread &lt; 0) || sslerror) {</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;        <span class="comment">/* If the return code was negative or there actually is an error in the</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;<span class="comment">           queue */</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, OSSL_PACKAGE <span class="stringliteral">&quot; SSL_read: %s, errno %d&quot;</span>,</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;              (sslerror ?</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;               ossl_strerror(sslerror, error_buffer, <span class="keyword">sizeof</span>(error_buffer)) :</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;               SSL_ERROR_to_str(err)),</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;              <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      }</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;    }</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;  }</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  <span class="keywordflow">return</span> nread;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;}</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> Curl_ossl_version(<span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;{</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="preprocessor">#ifdef OPENSSL_IS_BORINGSSL</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, OSSL_PACKAGE);</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* OPENSSL_IS_BORINGSSL */</span><span class="preprocessor"></span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  <span class="keywordtype">char</span> sub[3];</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ssleay_value;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;  sub[2]=<span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;  sub[1]=<span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;  ssleay_value = OpenSSL_version_num();</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;  <span class="keywordflow">if</span>(ssleay_value &lt; 0x906000) {</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    ssleay_value = SSLEAY_VERSION_NUMBER;</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    sub[0]=<span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;  }</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    <span class="keywordflow">if</span>(ssleay_value&amp;0xff0) {</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;      <span class="keywordtype">int</span> minor_ver = (ssleay_value &gt;&gt; 4) &amp; 0xff;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      <span class="keywordflow">if</span>(minor_ver &gt; 26) {</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="comment">/* handle extended version introduced for 0.9.8za */</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        sub[1] = (char) ((minor_ver - 1) % 26 + <span class="charliteral">&#39;a&#39;</span> + 1);</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;        sub[0] = <span class="charliteral">&#39;z&#39;</span>;</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      }</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        sub[0] = (char) (minor_ver + <span class="charliteral">&#39;a&#39;</span> - 1);</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      }</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    }</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      sub[0]=<span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;  }</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, <span class="stringliteral">&quot;%s/%lx.%lx.%lx%s&quot;</span>,</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;                   OSSL_PACKAGE,</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                   (ssleay_value&gt;&gt;28)&amp;0xf,</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                   (ssleay_value&gt;&gt;20)&amp;0xff,</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;                   (ssleay_value&gt;&gt;12)&amp;0xff,</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                   sub);</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_IS_BORINGSSL */</span><span class="preprocessor"></span></div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;}</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;<span class="comment">/* can be called with data == NULL */</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_random(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *entropy, <span class="keywordtype">size_t</span> length)</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;{</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;    <span class="keywordflow">if</span>(Curl_ossl_seed(<a class="code" href="structdata.html">data</a>)) <span class="comment">/* Initiate the seed if not already done */</span></div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a>; <span class="comment">/* couldn&#39;t seed for some reason */</span></div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  }</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">if</span>(!rand_enough())</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a>;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;  }</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  <span class="comment">/* RAND_bytes() returns 1 on success, 0 otherwise.  */</span></div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-vms_8h.html#aa683720bff9343cedea7c81dda04f8c0">RAND_bytes</a>(entropy, <a class="code" href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a>(length));</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 1 ? <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a> : <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a>);</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;}</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_md5sum(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp, <span class="comment">/* input */</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;                                 <span class="keywordtype">size_t</span> tmplen,</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *md5sum <span class="comment">/* output */</span>,</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;                                 <span class="keywordtype">size_t</span> unused)</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;{</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;  EVP_MD_CTX *mdctx;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;  (void) unused;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;  mdctx = EVP_MD_CTX_create();</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;  EVP_DigestInit_ex(mdctx, EVP_md5(), NULL);</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  EVP_DigestUpdate(mdctx, tmp, tmplen);</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;  EVP_DigestFinal_ex(mdctx, md5sum, &amp;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;  EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;}</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090800fL) &amp;&amp; !defined(OPENSSL_NO_SHA256)</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_ossl_sha256sum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp, <span class="comment">/* input */</span></div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;                                <span class="keywordtype">size_t</span> tmplen,</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *sha256sum <span class="comment">/* output */</span>,</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;                                <span class="keywordtype">size_t</span> unused)</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;{</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  EVP_MD_CTX *mdctx;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0;</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  (void) unused;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  mdctx =  EVP_MD_CTX_create();</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;  EVP_DigestInit_ex(mdctx, EVP_sha256(), NULL);</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;  EVP_DigestUpdate(mdctx, tmp, tmplen);</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;  EVP_DigestFinal_ex(mdctx, sha256sum, &amp;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;}</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Curl_ossl_cert_status_request(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;{</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="preprocessor">#if (OPENSSL_VERSION_NUMBER &gt;= 0x0090808fL) &amp;&amp; !defined(OPENSSL_NO_TLSEXT) &amp;&amp; \</span></div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="preprocessor">    !defined(OPENSSL_NO_OCSP)</span></div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;}</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *Curl_ossl_get_internals(<span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl,</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;                                     <a class="code" href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7b">CURLINFO</a> info)</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;{</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;  <span class="comment">/* Legacy: CURLINFO_TLS_SESSION must return an SSL_CTX pointer. */</span></div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;  <span class="keywordflow">return</span> info == <a class="code" href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7baec99d0c4534207509d00a0f2feee97fb">CURLINFO_TLS_SESSION</a> ?</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;         (<span class="keywordtype">void</span> *)BACKEND-&gt;ctx : (<span class="keywordtype">void</span> *)BACKEND-&gt;handle;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;}</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__ssl.html">Curl_ssl</a> Curl_ssl_openssl = {</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  { <a class="code" href="curl_8h.html#a908c5b707ac681212b8f8688cf76689dac51b430af8fa4c044fb05a38e39a17c9">CURLSSLBACKEND_OPENSSL</a>, <span class="stringliteral">&quot;openssl&quot;</span> }, <span class="comment">/* info */</span></div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;  <a class="code" href="vtls_8h.html#a25c48ad233afd4831acb0b0b699ed109">SSLSUPP_CA_PATH</a> |</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;  <a class="code" href="vtls_8h.html#af964d3e85b565ae20b4f85444b9b1619">SSLSUPP_CERTINFO</a> |</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;  <a class="code" href="vtls_8h.html#a932726d4856765a766c86e3a3ed29a8f">SSLSUPP_PINNEDPUBKEY</a> |</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;  <a class="code" href="vtls_8h.html#a4ff8480c5307cec2506c039114624e1d">SSLSUPP_SSL_CTX</a> |</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_CTX_SET_CIPHERSUITES</span></div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;  <a class="code" href="vtls_8h.html#a486d7ada0cb21188917be26be3d81483">SSLSUPP_TLS13_CIPHERSUITES</a> |</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;  <a class="code" href="vtls_8h.html#aa47defd1c2f78f3225dfc06c638c8689">SSLSUPP_HTTPS_PROXY</a>,</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;  <span class="keyword">sizeof</span>(<span class="keyword">struct </span>ssl_backend_data),</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;  Curl_ossl_init,                <span class="comment">/* init */</span></div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;  Curl_ossl_cleanup,             <span class="comment">/* cleanup */</span></div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  Curl_ossl_version,             <span class="comment">/* version */</span></div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;  Curl_ossl_check_cxn,           <span class="comment">/* check_cxn */</span></div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;  Curl_ossl_shutdown,            <span class="comment">/* shutdown */</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;  Curl_ossl_data_pending,        <span class="comment">/* data_pending */</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  Curl_ossl_random,              <span class="comment">/* random */</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  Curl_ossl_cert_status_request, <span class="comment">/* cert_status_request */</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;  Curl_ossl_connect,             <span class="comment">/* connect */</span></div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;  Curl_ossl_connect_nonblocking, <span class="comment">/* connect_nonblocking */</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;  Curl_ossl_get_internals,       <span class="comment">/* get_internals */</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  Curl_ossl_close,               <span class="comment">/* close_one */</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;  Curl_ossl_close_all,           <span class="comment">/* close_all */</span></div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  Curl_ossl_session_free,        <span class="comment">/* session_free */</span></div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;  Curl_ossl_set_engine,          <span class="comment">/* set_engine */</span></div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;  Curl_ossl_set_engine_default,  <span class="comment">/* set_engine_default */</span></div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;  Curl_ossl_engines_list,        <span class="comment">/* engines_list */</span></div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;  <a class="code" href="vtls_8h.html#a0a1d6e1d64672ae38b75216a44d08641">Curl_none_false_start</a>,         <span class="comment">/* false_start */</span></div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;  Curl_ossl_md5sum,              <span class="comment">/* md5sum */</span></div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;#<a class="code" href="unit1305_8c.html#a19c83966ddb434275d52d14653b32204">if</a> (OPENSSL_VERSION_NUMBER &gt;= 0x0090800fL) &amp;&amp; !defined(OPENSSL_NO_SHA256)</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;  Curl_ossl_sha256sum            <span class="comment">/* sha256sum */</span></div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;  NULL                           <span class="comment">/* sha256sum */</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;};</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_OPENSSL */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00498">curl.h:498</a></div></div>
<div class="ttc" id="setup-vms_8h_html_abf3e7113358b6d2bb48abf801fdf9116"><div class="ttname"><a href="setup-vms_8h.html#abf3e7113358b6d2bb48abf801fdf9116">PEM_write_bio_X509</a></div><div class="ttdeci">#define PEM_write_bio_X509</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00257">setup-vms.h:257</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a22f4e1c5287dbe7e2dc71c6fc1047418"><div class="ttname"><a href="setup-vms_8h.html#a22f4e1c5287dbe7e2dc71c6fc1047418">EVP_PKEY_free</a></div><div class="ttdeci">#define EVP_PKEY_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00242">setup-vms.h:242</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a8b1240ed32c840ebe18b5f57d13959b1"><div class="ttname"><a href="setup-vms_8h.html#a8b1240ed32c840ebe18b5f57d13959b1">X509_free</a></div><div class="ttdeci">#define X509_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00345">setup-vms.h:345</a></div></div>
<div class="ttc" id="structconnectdata_html_ab6f11cf5c5bc549e9f9af12fc65e2e23"><div class="ttname"><a href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">connectdata::ssl</a></div><div class="ttdeci">struct ssl_connect_data ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00885">urldata.h:885</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a44ca1aff4da82f55bd20b3c7a7f2e383"><div class="ttname"><a href="setup-vms_8h.html#a44ca1aff4da82f55bd20b3c7a7f2e383">SSL_CTX_use_PrivateKey</a></div><div class="ttdeci">#define SSL_CTX_use_PrivateKey</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00281">setup-vms.h:281</a></div></div>
<div class="ttc" id="ftp_8c_html_a77812d4945cd21094debbd06962f0f01"><div class="ttname"><a href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a></div><div class="ttdeci">#define state(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00101">ftp.c:101</a></div></div>
<div class="ttc" id="setup-vms_8h_html_adaf74bc2b761c1da097286183a63ff4b"><div class="ttname"><a href="setup-vms_8h.html#adaf74bc2b761c1da097286183a63ff4b">X509_NAME_ENTRY_get_data</a></div><div class="ttdeci">#define X509_NAME_ENTRY_get_data</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00337">setup-vms.h:337</a></div></div>
<div class="ttc" id="setup-vms_8h_html_af7c70d7048f69d75d7a1f47c070f4732"><div class="ttname"><a href="setup-vms_8h.html#af7c70d7048f69d75d7a1f47c070f4732">RAND_egd</a></div><div class="ttdeci">#define RAND_egd</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00263">setup-vms.h:263</a></div></div>
<div class="ttc" id="formdata_8h_html"><div class="ttname"><a href="formdata_8h.html">formdata.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a52caeb5c80ab333eed112e7223109005"><div class="ttname"><a href="setup-vms_8h.html#a52caeb5c80ab333eed112e7223109005">UI_get_string_type</a></div><div class="ttdeci">#define UI_get_string_type</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00319">setup-vms.h:319</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00527">curl.h:527</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a78b44abc77b6c9dc2b85e938bfb399c1"><div class="ttname"><a href="setup-vms_8h.html#a78b44abc77b6c9dc2b85e938bfb399c1">RAND_add</a></div><div class="ttdeci">#define RAND_add</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00261">setup-vms.h:261</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00530">curl.h:530</a></div></div>
<div class="ttc" id="proto_8d_html_a454d355bda85162423424da4a79fd517"><div class="ttname"><a href="proto_8d.html#a454d355bda85162423424da4a79fd517">protocols</a></div><div class="ttdeci">Long are comma and are each a protocol name or optionally prefixed by zero or more modifiers.Available modifiers removing it from the list of protocols already permitted..TP.though subject to later modification by subsequent entries in the comma separated list..RE.IP For but disables ftps.TP.B proto http only enables http and https.TP.B https also only enables http and https.RE Unknown protocols produce a warning.This allows scripts to safely rely on being able to disable potentially dangerous protocols</div><div class="ttdef"><b>Definition:</b> <a href="proto_8d_source.html#l00034">proto.d:34</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a0093ee9027cc3bca1814103f77b95c26"><div class="ttname"><a href="setup-vms_8h.html#a0093ee9027cc3bca1814103f77b95c26">UI_method_set_reader</a></div><div class="ttdeci">#define UI_method_set_reader</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00328">setup-vms.h:328</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a58b03f9f0b36400484e017811cb7fe97"><div class="ttname"><a href="setup-vms_8h.html#a58b03f9f0b36400484e017811cb7fe97">SSL_get_session</a></div><div class="ttdeci">#define SSL_get_session</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00296">setup-vms.h:296</a></div></div>
<div class="ttc" id="ignore-content-length_8d_html_a06bf02a476389246deac1e3c53ee7e18"><div class="ttname"><a href="ignore-content-length_8d.html#a06bf02a476389246deac1e3c53ee7e18">x</a></div><div class="ttdeci">Long Ignore the Content Length header.This is particularly useful for servers running Apache. x</div><div class="ttdef"><b>Definition:</b> <a href="ignore-content-length_8d_source.html#l00005">ignore-content-length.d:5</a></div></div>
<div class="ttc" id="config-dos_8h_html_a873c61ebe62de63e8a199bc819424301"><div class="ttname"><a href="config-dos_8h.html#a873c61ebe62de63e8a199bc819424301">RECV_TYPE_ARG2</a></div><div class="ttdeci">#define RECV_TYPE_ARG2</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00107">config-dos.h:107</a></div></div>
<div class="ttc" id="setup-vms_8h_html_abc1bb4410eebd8b9c1be26cc86029354"><div class="ttname"><a href="setup-vms_8h.html#abc1bb4410eebd8b9c1be26cc86029354">ENGINE_load_builtin_engines</a></div><div class="ttdeci">#define ENGINE_load_builtin_engines</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00231">setup-vms.h:231</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="structconnectdata_html_aec2de2220c36ec447f6101e85bf0a52b"><div class="ttname"><a href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">connectdata::recv</a></div><div class="ttdeci">Curl_recv * recv[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00879">urldata.h:879</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a071ec51a8ccde74c39a480a1252bebf2"><div class="ttname"><a href="setup-vms_8h.html#a071ec51a8ccde74c39a480a1252bebf2">SSL_CTX_add_client_CA</a></div><div class="ttdeci">#define SSL_CTX_add_client_CA</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00268">setup-vms.h:268</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a0e5145164e8e2a9d6eb43eef1c71f1af">CURLE_BAD_FUNCTION_ARGUMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00513">curl.h:513</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a58a5db9f498161b06cd8f245d718b155"><div class="ttname"><a href="struct_curl__easy.html#a58a5db9f498161b06cd8f245d718b155">Curl_easy::msg</a></div><div class="ttdeci">struct Curl_message msg</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01767">urldata.h:1767</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aae68723650f0ed53b36894d426afdbc9"><div class="ttname"><a href="setup-vms_8h.html#aae68723650f0ed53b36894d426afdbc9">SSL_read</a></div><div class="ttdeci">#define SSL_read</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00304">setup-vms.h:304</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aa49ec2376b0abc6f0029b4988ab62c79"><div class="ttname"><a href="setup-vms_8h.html#aa49ec2376b0abc6f0029b4988ab62c79">X509_EXTENSION_get_data</a></div><div class="ttdeci">#define X509_EXTENSION_get_data</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00334">setup-vms.h:334</a></div></div>
<div class="ttc" id="vtls_8h_html_a594e132ba0c0e860b62140083ead1c0d"><div class="ttname"><a href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a></div><div class="ttdeci">#define SSL_CONN_CONFIG(var)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00138">vtls.h:138</a></div></div>
<div class="ttc" id="structcurl__slist_html"><div class="ttname"><a href="structcurl__slist.html">curl_slist</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02394">curl.h:2394</a></div></div>
<div class="ttc" id="struct_curl__ssl_html"><div class="ttname"><a href="struct_curl__ssl.html">Curl_ssl</a></div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00036">vtls.h:36</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ab76b179b23145cfc0547f1704c9215cb"><div class="ttname"><a href="setup-vms_8h.html#ab76b179b23145cfc0547f1704c9215cb">BIO_new</a></div><div class="ttdeci">#define BIO_new</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00200">setup-vms.h:200</a></div></div>
<div class="ttc" id="structconnectdata_html_a0c1824e51ef689efcfddaa09a72c788b"><div class="ttname"><a href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">connectdata::negnpn</a></div><div class="ttdeci">int negnpn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01032">urldata.h:1032</a></div></div>
<div class="ttc" id="vtls_8h_html_a25c48ad233afd4831acb0b0b699ed109"><div class="ttname"><a href="vtls_8h.html#a25c48ad233afd4831acb0b0b699ed109">SSLSUPP_CA_PATH</a></div><div class="ttdeci">#define SSLSUPP_CA_PATH</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00029">vtls.h:29</a></div></div>
<div class="ttc" id="structproxy__info_html_ae2cc9c2eb5c4ea0c4b92bf067e391bdc"><div class="ttname"><a href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">proxy_info::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00752">urldata.h:752</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="structcurltime_html_aa037ee31cbd9bc40e07ebade62e7ad5d"><div class="ttname"><a href="structcurltime.html#aa037ee31cbd9bc40e07ebade62e7ad5d">curltime::tv_sec</a></div><div class="ttdeci">time_t tv_sec</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00034">timeval.h:34</a></div></div>
<div class="ttc" id="vtls_8h_html_af8e5805a5e7df10119ca90c13a2b1a79"><div class="ttname"><a href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a></div><div class="ttdeci">#define ALPN_HTTP_1_1</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00128">vtls.h:128</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fabf50bfe61fa3dc11954f35f0b84217d4"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fabf50bfe61fa3dc11954f35f0b84217d4">STRING_SSL_RANDOM_FILE</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01436">urldata.h:1436</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a6d72286382ff2d3d13954e512d23165f"><div class="ttname"><a href="setup-vms_8h.html#a6d72286382ff2d3d13954e512d23165f">SSL_CTX_new</a></div><div class="ttdeci">#define SSL_CTX_new</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00275">setup-vms.h:275</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="vtls_8h_html_a6d4d2d806ff1ab1428629b690f02e964"><div class="ttname"><a href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a></div><div class="ttdeci">#define SSL_SET_OPTION(var)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00136">vtls.h:136</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01978">curl.h:1978</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a2dd08cb14ef6733c358be4f442ff410a"><div class="ttname"><a href="setup-vms_8h.html#a2dd08cb14ef6733c358be4f442ff410a">SSL_get_verify_result</a></div><div class="ttdeci">#define SSL_get_verify_result</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00298">setup-vms.h:298</a></div></div>
<div class="ttc" id="structssl__connect__data_html_a2de0f5a8b43b4e4550e22b1b8f3870e1"><div class="ttname"><a href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">ssl_connect_data::connecting_state</a></div><div class="ttdeci">ssl_connect_state connecting_state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00203">urldata.h:203</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a7d07acd5584159f20f836962c4abdc1a"><div class="ttname"><a href="setup-vms_8h.html#a7d07acd5584159f20f836962c4abdc1a">ENGINE_free</a></div><div class="ttdeci">#define ENGINE_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00226">setup-vms.h:226</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a36c338edca3188a9c5ab9234e65c53f1"><div class="ttname"><a href="setup-vms_8h.html#a36c338edca3188a9c5ab9234e65c53f1">ENGINE_ctrl_cmd</a></div><div class="ttdeci">#define ENGINE_ctrl_cmd</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00224">setup-vms.h:224</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01974">curl.h:1974</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f">STRING_SSL_PINNEDPUBLICKEY_ORIG</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01429">urldata.h:1429</a></div></div>
<div class="ttc" id="curl_8h_html_a9704d2633927f77efaa3e3c6f1c23a14af788d7ad3eeacfcbd2170c64166c241c"><div class="ttname"><a href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14af788d7ad3eeacfcbd2170c64166c241c">CURLINFO_SSL_DATA_IN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00438">curl.h:438</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa88d3e306ecb6c0404e204831e8df7128"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa88d3e306ecb6c0404e204831e8df7128">STRING_SSL_EGDSOCKET</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01435">urldata.h:1435</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a5b2ab27f36f5c0fc344578890743dc00"><div class="ttname"><a href="setup-vms_8h.html#a5b2ab27f36f5c0fc344578890743dc00">UI_method_get_writer</a></div><div class="ttdeci">#define UI_method_get_writer</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00325">setup-vms.h:325</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a7152baf27577993557a9c7fcafdfd288"><div class="ttname"><a href="setup-vms_8h.html#a7152baf27577993557a9c7fcafdfd288">ERR_free_strings</a></div><div class="ttdeci">#define ERR_free_strings</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00237">setup-vms.h:237</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aff3b619d1881322570e9689338c26baa"><div class="ttname"><a href="setup-vms_8h.html#aff3b619d1881322570e9689338c26baa">SSL_connect</a></div><div class="ttdeci">#define SSL_connect</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00287">setup-vms.h:287</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a329890f98ddcebf882f2424436952ba8"><div class="ttname"><a href="setup-vms_8h.html#a329890f98ddcebf882f2424436952ba8">UI_OpenSSL</a></div><div class="ttdeci">#define UI_OpenSSL</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00330">setup-vms.h:330</a></div></div>
<div class="ttc" id="curl_8h_html_aabc03ec968a2fdccde5c6709f712dd7b"><div class="ttname"><a href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7b">CURLINFO</a></div><div class="ttdeci">CURLINFO</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02498">curl.h:2498</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00526">curl.h:526</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a89bfb3b0711e9bd660ac564e1cac91f8"><div class="ttname"><a href="setup-vms_8h.html#a89bfb3b0711e9bd660ac564e1cac91f8">BIO_s_mem</a></div><div class="ttdeci">#define BIO_s_mem</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00201">setup-vms.h:201</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a7ef49d7dd301195bbd65dfeef7918a5e"><div class="ttname"><a href="setup-vms_8h.html#a7ef49d7dd301195bbd65dfeef7918a5e">GENERAL_NAMES_free</a></div><div class="ttdeci">#define GENERAL_NAMES_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00244">setup-vms.h:244</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f">CURLE_SSL_PINNEDPUBKEYNOTMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00578">curl.h:578</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00564">curl.h:564</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a9cc1d30e397bd178233d70a73ac50107"><div class="ttname"><a href="setup-vms_8h.html#a9cc1d30e397bd178233d70a73ac50107">X509_NAME_get_index_by_NID</a></div><div class="ttdeci">#define X509_NAME_get_index_by_NID</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00339">setup-vms.h:339</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ab6f7f30c1eade5bcd93023f8f6948bb3"><div class="ttname"><a href="setup-vms_8h.html#ab6f7f30c1eade5bcd93023f8f6948bb3">PKCS12_PBE_add</a></div><div class="ttdeci">#define PKCS12_PBE_add</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00258">setup-vms.h:258</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468">CURL_SSLVERSION_MAX_TLSv1_3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01990">curl.h:1990</a></div></div>
<div class="ttc" id="vtls_8h_html_af964d3e85b565ae20b4f85444b9b1619"><div class="ttname"><a href="vtls_8h.html#af964d3e85b565ae20b4f85444b9b1619">SSLSUPP_CERTINFO</a></div><div class="ttdeci">#define SSLSUPP_CERTINFO</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00030">vtls.h:30</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a5ad340930f379f8dfc17b8006eda254c">CURLE_SSL_INVALIDCERTSTATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00580">curl.h:580</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a410e7961cad2b4f22017252ded2f38f4"><div class="ttname"><a href="setup-vms_8h.html#a410e7961cad2b4f22017252ded2f38f4">X509_get_subject_name</a></div><div class="ttdeci">#define X509_get_subject_name</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00350">setup-vms.h:350</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ac92786e19b828c0c4a8fa5f7d6b1e01e">CURLE_NOT_BUILT_IN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00462">curl.h:462</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ae7a3a3c97dd01e898235d37445053c59"><div class="ttname"><a href="setup-vms_8h.html#ae7a3a3c97dd01e898235d37445053c59">SSL_get_peer_cert_chain</a></div><div class="ttdeci">#define SSL_get_peer_cert_chain</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00293">setup-vms.h:293</a></div></div>
<div class="ttc" id="config-os400_8h_html_a7a1524cf833450776ffc81c38a78c370"><div class="ttname"><a href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="ttdeci">#define ENABLE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00071">config-os400.h:71</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a7ca4a51d411e5c43e3b6e57b8ea19f2c"><div class="ttname"><a href="setup-vms_8h.html#a7ca4a51d411e5c43e3b6e57b8ea19f2c">SSL_write</a></div><div class="ttdeci">#define SSL_write</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00310">setup-vms.h:310</a></div></div>
<div class="ttc" id="structconnectdata_html_a91d94af5dfef86510940d658476b61cf"><div class="ttname"><a href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">connectdata::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00830">urldata.h:830</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a15d98c2eae880b790963d2b0d15a85dc"><div class="ttname"><a href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">ConnectBits::tls_enable_alpn</a></div><div class="ttdeci">bool tls_enable_alpn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00440">urldata.h:440</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a740f86ab81898650517cedc4e997c200"><div class="ttname"><a href="setup-vms_8h.html#a740f86ab81898650517cedc4e997c200">SSL_CTX_use_PrivateKey_file</a></div><div class="ttdeci">#define SSL_CTX_use_PrivateKey_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00282">setup-vms.h:282</a></div></div>
<div class="ttc" id="urldata_8h_html_a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c"><div class="ttname"><a href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00190">urldata.h:190</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aa7611069fbad9e8c84bbafc77b58f369"><div class="ttname"><a href="setup-vms_8h.html#aa7611069fbad9e8c84bbafc77b58f369">SSL_CTX_set_cipher_list</a></div><div class="ttdeci">#define SSL_CTX_set_cipher_list</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00276">setup-vms.h:276</a></div></div>
<div class="ttc" id="vtls_8h_html_aa47defd1c2f78f3225dfc06c638c8689"><div class="ttname"><a href="vtls_8h.html#aa47defd1c2f78f3225dfc06c638c8689">SSLSUPP_HTTPS_PROXY</a></div><div class="ttdeci">#define SSLSUPP_HTTPS_PROXY</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00033">vtls.h:33</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a1dc692f9cc757a915064dedb56896974"><div class="ttname"><a href="setup-vms_8h.html#a1dc692f9cc757a915064dedb56896974">SSL_get_peer_certificate</a></div><div class="ttdeci">#define SSL_get_peer_certificate</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00294">setup-vms.h:294</a></div></div>
<div class="ttc" id="setup-vms_8h_html_afb6a3c48e555d21b01f588b08c8d6d74"><div class="ttname"><a href="setup-vms_8h.html#afb6a3c48e555d21b01f588b08c8d6d74">SSL_get_error</a></div><div class="ttdeci">#define SSL_get_error</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00292">setup-vms.h:292</a></div></div>
<div class="ttc" id="strcase_8h_html_a4b6a8324b9a93ddfa5413308a22bfa44"><div class="ttname"><a href="strcase_8h.html#a4b6a8324b9a93ddfa5413308a22bfa44">strcasecompare</a></div><div class="ttdeci">#define strcasecompare(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00035">strcase.h:35</a></div></div>
<div class="ttc" id="warnless_8c_html_a02468fae1f563370c5e18045d5bc2ecb"><div class="ttname"><a href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a></div><div class="ttdeci">int curlx_uztosi(size_t uznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00203">warnless.c:203</a></div></div>
<div class="ttc" id="curl_8h_html_a613d9e6457f36b84548cbf2006a34e14"><div class="ttname"><a href="curl_8h.html#a613d9e6457f36b84548cbf2006a34e14">curl_getenv</a></div><div class="ttdeci">CURL_EXTERN char * curl_getenv(const char *variable)</div><div class="ttdef"><b>Definition:</b> <a href="getenv_8c_source.html#l00051">getenv.c:51</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a99ae6c0f531e926e6839b9ece58b17e7"><div class="ttname"><a href="setup-vms_8h.html#a99ae6c0f531e926e6839b9ece58b17e7">ENGINE_get_id</a></div><div class="ttdeci">#define ENGINE_get_id</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00228">setup-vms.h:228</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a54131e400e9a600d4597134398de41ba"><div class="ttname"><a href="setup-vms_8h.html#a54131e400e9a600d4597134398de41ba">EVP_PKEY_copy_parameters</a></div><div class="ttdeci">#define EVP_PKEY_copy_parameters</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00241">setup-vms.h:241</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a1e4221f2e2f29468d8e87f6ced65dbb9"><div class="ttname"><a href="setup-vms_8h.html#a1e4221f2e2f29468d8e87f6ced65dbb9">UI_method_get_reader</a></div><div class="ttdeci">#define UI_method_get_reader</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00324">setup-vms.h:324</a></div></div>
<div class="ttc" id="structhostname_html"><div class="ttname"><a href="structhostname.html">hostname</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00446">urldata.h:446</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a61d3b7d7309c202af466281171c05ed6"><div class="ttname"><a href="setup-vms_8h.html#a61d3b7d7309c202af466281171c05ed6">SSL_CTX_load_verify_locations</a></div><div class="ttdeci">#define SSL_CTX_load_verify_locations</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00274">setup-vms.h:274</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a221080751e77ffa1b64c7150aacc262f"><div class="ttname"><a href="setup-vms_8h.html#a221080751e77ffa1b64c7150aacc262f">X509_LOOKUP_file</a></div><div class="ttdeci">#define X509_LOOKUP_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00336">setup-vms.h:336</a></div></div>
<div class="ttc" id="setup-vms_8h_html_af86a876be57d5b055050d87b0feda7ae"><div class="ttname"><a href="setup-vms_8h.html#af86a876be57d5b055050d87b0feda7ae">ERR_peek_error</a></div><div class="ttdeci">#define ERR_peek_error</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00239">setup-vms.h:239</a></div></div>
<div class="ttc" id="structhostname_html_a9c9ce90bfcab1734f9376c6539d92cdd"><div class="ttname"><a href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">hostname::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00449">urldata.h:449</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00183">urldata.h:183</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="unit1394_8c_html_a0fb9c3165f64b5b79f3928b404818be9"><div class="ttname"><a href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a></div><div class="ttdeci">const char ** p</div><div class="ttdef"><b>Definition:</b> <a href="unit1394_8c_source.html#l00079">unit1394.c:79</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5">CURL_SSLVERSION_MAX_TLSv1_2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01989">curl.h:1989</a></div></div>
<div class="ttc" id="smooth-gtk-thread_8c_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="smooth-gtk-thread_8c_source.html#l00047">smooth-gtk-thread.c:47</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="setup-vms_8h_html_acb43861076a3c8d414e6a07db1426f7c"><div class="ttname"><a href="setup-vms_8h.html#acb43861076a3c8d414e6a07db1426f7c">PKCS12_free</a></div><div class="ttdeci">#define PKCS12_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00259">setup-vms.h:259</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a35d18fa01c2a73e674e3fe2f9f43b618"><div class="ttname"><a href="setup-vms_8h.html#a35d18fa01c2a73e674e3fe2f9f43b618">RAND_status</a></div><div class="ttdeci">#define RAND_status</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00266">setup-vms.h:266</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="config-dos_8h_html_abb2068740d788b2a25b7d378bb803d5c"><div class="ttname"><a href="config-dos_8h.html#abb2068740d788b2a25b7d378bb803d5c">RECV_TYPE_ARG3</a></div><div class="ttdeci">#define RECV_TYPE_ARG3</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00108">config-dos.h:108</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a15d8c1c61f7dcd1af34de7afe3c8b323"><div class="ttname"><a href="setup-vms_8h.html#a15d8c1c61f7dcd1af34de7afe3c8b323">SSL_version</a></div><div class="ttdeci">#define SSL_version</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00309">setup-vms.h:309</a></div></div>
<div class="ttc" id="connect-to_8d_html_ab7d8489f93efdce6052db1831d07463a"><div class="ttname"><a href="connect-to_8d.html#ab7d8489f93efdce6052db1831d07463a">SSL</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS SSL(e.g. SNI, certificate verification) or for the application protocols. &quot;HOST1&quot; and &quot;PORT1&quot; may be the empty string</div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01975">curl.h:1975</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a09cd5396359dce8f8c614863248ed057"><div class="ttname"><a href="setup-vms_8h.html#a09cd5396359dce8f8c614863248ed057">ENGINE_load_private_key</a></div><div class="ttdeci">#define ENGINE_load_private_key</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00232">setup-vms.h:232</a></div></div>
<div class="ttc" id="curl_8h_html_abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74"><div class="ttname"><a href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01926">curl.h:1926</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="structconnectdata_html_a4df63a4042ad767671bb3bfd74aa68fc"><div class="ttname"><a href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">connectdata::http_proxy</a></div><div class="ttdeci">struct proxy_info http_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00837">urldata.h:837</a></div></div>
<div class="ttc" id="timeval_8c_html_ae736e803680e1b7fa2b2868317b4b91f"><div class="ttname"><a href="timeval_8c.html#ae736e803680e1b7fa2b2868317b4b91f">Curl_now</a></div><div class="ttdeci">struct curltime Curl_now(void)</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8c_source.html#l00154">timeval.c:154</a></div></div>
<div class="ttc" id="struct_connect_bits_html_af764c68e6af921d2073c498f80741ea4"><div class="ttname"><a href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">ConnectBits::tunnel_proxy</a></div><div class="ttdeci">bool tunnel_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00405">urldata.h:405</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="structssl__connect__data_html_a46d3839ea70923be1efa7f85aba7f6a8"><div class="ttname"><a href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">ssl_connect_data::state</a></div><div class="ttdeci">ssl_connection_state state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00202">urldata.h:202</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01973">curl.h:1973</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a97f3e3bdc74924efa81ef32d47227233"><div class="ttname"><a href="setup-vms_8h.html#a97f3e3bdc74924efa81ef32d47227233">X509_get_serialNumber</a></div><div class="ttdeci">#define X509_get_serialNumber</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00349">setup-vms.h:349</a></div></div>
<div class="ttc" id="unit1602_8c_html_a70d958290b8b8ebaff45365d4e5b9e54"><div class="ttname"><a href="unit1602_8c.html#a70d958290b8b8ebaff45365d4e5b9e54">klen</a></div><div class="ttdeci">size_t klen</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00054">unit1602.c:54</a></div></div>
<div class="ttc" id="inet__pton_8h_html"><div class="ttname"><a href="inet__pton_8h.html">inet_pton.h</a></div></div>
<div class="ttc" id="struct_connect_bits_html_afbb3ed3c6e41a5e79efc77b3bf00376d"><div class="ttname"><a href="struct_connect_bits.html#afbb3ed3c6e41a5e79efc77b3bf00376d">ConnectBits::ipv6_ip</a></div><div class="ttdeci">bool ipv6_ip</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00392">urldata.h:392</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00555">curl.h:555</a></div></div>
<div class="ttc" id="vtls_8h_html"><div class="ttname"><a href="vtls_8h.html">vtls.h</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="setup-vms_8h_html_af40b39c5e68f2f343ff9bcba436edafe"><div class="ttname"><a href="setup-vms_8h.html#af40b39c5e68f2f343ff9bcba436edafe">ERR_error_string_n</a></div><div class="ttdeci">#define ERR_error_string_n</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00236">setup-vms.h:236</a></div></div>
<div class="ttc" id="setup-vms_8h_html_af97700553bd78a9f1797c2525a152887"><div class="ttname"><a href="setup-vms_8h.html#af97700553bd78a9f1797c2525a152887">X509_NAME_get_entry</a></div><div class="ttdeci">#define X509_NAME_get_entry</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00338">setup-vms.h:338</a></div></div>
<div class="ttc" id="form_8d_html_a7aead736a07eaf25623ad7bfa1f0ee2d"><div class="ttname"><a href="form_8d.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00048">form.d:48</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00529">curl.h:529</a></div></div>
<div class="ttc" id="curlx_8c_html_af6458f5d187f1d7c82fb9ea7ef634b44"><div class="ttname"><a href="curlx_8c.html#af6458f5d187f1d7c82fb9ea7ef634b44">ZERO_NULL</a></div><div class="ttdeci">#define ZERO_NULL</div><div class="ttdef"><b>Definition:</b> <a href="curlx_8c_source.html#l00131">curlx.c:131</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a00e5f84f5e9e3192ecbe1e4d458f5606"><div class="ttname"><a href="setup-vms_8h.html#a00e5f84f5e9e3192ecbe1e4d458f5606">SSL_CTX_use_certificate_file</a></div><div class="ttdeci">#define SSL_CTX_use_certificate_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00285">setup-vms.h:285</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a4ead4d93b3d52c189754db122087752e"><div class="ttname"><a href="setup-vms_8h.html#a4ead4d93b3d52c189754db122087752e">X509_EXTENSION_get_object</a></div><div class="ttdeci">#define X509_EXTENSION_get_object</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00335">setup-vms.h:335</a></div></div>
<div class="ttc" id="select_8c_html_a5e5b75391965e920e725abf29b0bdcef"><div class="ttname"><a href="select_8c.html#a5e5b75391965e920e725abf29b0bdcef">Curl_wait_ms</a></div><div class="ttdeci">int Curl_wait_ms(int timeout_ms)</div><div class="ttdef"><b>Definition:</b> <a href="select_8c_source.html#l00075">select.c:75</a></div></div>
<div class="ttc" id="vtls_8h_html_a9043fcf68904db7a0844fb55857bd482"><div class="ttname"><a href="vtls_8h.html#a9043fcf68904db7a0844fb55857bd482">ALPN_HTTP_1_1_LENGTH</a></div><div class="ttdeci">#define ALPN_HTTP_1_1_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00127">vtls.h:127</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1smb3_html_ae260bcf9c1467602a2139dd3a1a0cbab"><div class="ttname"><a href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">impacket.smb3.FILE</a></div><div class="ttdeci">dictionary FILE</div><div class="ttdef"><b>Definition:</b> <a href="smb3_8py_source.html#l00061">smb3.py:61</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a0b0a5da9dd1869f358e76c32d391dac9"><div class="ttname"><a href="setup-vms_8h.html#a0b0a5da9dd1869f358e76c32d391dac9">ASN1_STRING_print</a></div><div class="ttdeci">#define ASN1_STRING_print</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00195">setup-vms.h:195</a></div></div>
<div class="ttc" id="structssl__connect__data_html_ad63d8e461921062845bbf07dfc0007c5"><div class="ttname"><a href="structssl__connect__data.html#ad63d8e461921062845bbf07dfc0007c5">ssl_connect_data::use</a></div><div class="ttdeci">bool use</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00201">urldata.h:201</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a2e9e338108c9f1445d8da6a8dc8a129c"><div class="ttname"><a href="setup-vms_8h.html#a2e9e338108c9f1445d8da6a8dc8a129c">ERR_remove_state</a></div><div class="ttdeci">#define ERR_remove_state</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00240">setup-vms.h:240</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a9623d65824dcc16b639b1d5cf0bf8107"><div class="ttname"><a href="setup-vms_8h.html#a9623d65824dcc16b639b1d5cf0bf8107">SSL_set_fd</a></div><div class="ttdeci">#define SSL_set_fd</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00306">setup-vms.h:306</a></div></div>
<div class="ttc" id="output_8d_html_a7bcb6a773be04cbd4890bfe10fa42696"><div class="ttname"><a href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a></div><div class="ttdeci">Long you can use specifier.That variable will be replaced with the current string for the URL being fetched.Like if you specify two URLs on the same command line</div><div class="ttdef"><b>Definition:</b> <a href="output_8d_source.html#l00008">output.d:8</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a91b56d8b059414b941e73150cd5fb3a2"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a91b56d8b059414b941e73150cd5fb3a2">CURLE_SSL_ENGINE_SETFAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00524">curl.h:524</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a86ecfb04d381e5c007dbd56643be77c2"><div class="ttname"><a href="setup-vms_8h.html#a86ecfb04d381e5c007dbd56643be77c2">UI_method_get_opener</a></div><div class="ttdeci">#define UI_method_get_opener</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00323">setup-vms.h:323</a></div></div>
<div class="ttc" id="config-dos_8h_html_aa257e0c95ce1b33306381a8d7b9d5962"><div class="ttname"><a href="config-dos_8h.html#aa257e0c95ce1b33306381a8d7b9d5962">RECV_TYPE_ARG4</a></div><div class="ttdeci">#define RECV_TYPE_ARG4</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00109">config-dos.h:109</a></div></div>
<div class="ttc" id="openssl_8h_html"><div class="ttname"><a href="openssl_8h.html">openssl.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aa683720bff9343cedea7c81dda04f8c0"><div class="ttname"><a href="setup-vms_8h.html#aa683720bff9343cedea7c81dda04f8c0">RAND_bytes</a></div><div class="ttdeci">#define RAND_bytes</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00262">setup-vms.h:262</a></div></div>
<div class="ttc" id="vtls_8h_html_a0a1d6e1d64672ae38b75216a44d08641"><div class="ttname"><a href="vtls_8h.html#a0a1d6e1d64672ae38b75216a44d08641">Curl_none_false_start</a></div><div class="ttdeci">bool Curl_none_false_start(void)</div></div>
<div class="ttc" id="curl_8h_html_a9704d2633927f77efaa3e3c6f1c23a14a24d8abe6d4ec1df2e2e707b07bca57dd"><div class="ttname"><a href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a24d8abe6d4ec1df2e2e707b07bca57dd">CURLINFO_SSL_DATA_OUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00439">curl.h:439</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="vtls_8h_html_a932726d4856765a766c86e3a3ed29a8f"><div class="ttname"><a href="vtls_8h.html#a932726d4856765a766c86e3a3ed29a8f">SSLSUPP_PINNEDPUBKEY</a></div><div class="ttdeci">#define SSLSUPP_PINNEDPUBKEY</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00031">vtls.h:31</a></div></div>
<div class="ttc" id="connect_8c_html_aed32c0fb99c80a40c097c98a3eb03c74"><div class="ttname"><a href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a></div><div class="ttdeci">timediff_t Curl_timeleft(struct Curl_easy *data, struct curltime *nowp, bool duringconnect)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l00184">connect.c:184</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a951c99e8afb0b981911ea5da6631f9ee"><div class="ttname"><a href="setup-vms_8h.html#a951c99e8afb0b981911ea5da6631f9ee">SSL_get_shutdown</a></div><div class="ttdeci">#define SSL_get_shutdown</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00297">setup-vms.h:297</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a93ae7336fe5201923da0b5be5db508f9"><div class="ttname"><a href="setup-vms_8h.html#a93ae7336fe5201923da0b5be5db508f9">SSL_get_certificate</a></div><div class="ttdeci">#define SSL_get_certificate</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00290">setup-vms.h:290</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_af0fac1cea1165b4debec7f686edf3313"><div class="ttname"><a href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a></div><div class="ttdeci">#define EAGAIN</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00444">config-win32ce.h:444</a></div></div>
<div class="ttc" id="curl_8h_html_a7ea20d9a213c806f82446bed893f423f"><div class="ttname"><a href="curl_8h.html#a7ea20d9a213c806f82446bed893f423f">curl_slist_append</a></div><div class="ttdeci">CURL_EXTERN struct curl_slist * curl_slist_append(struct curl_slist *, const char *)</div><div class="ttdef"><b>Definition:</b> <a href="slist_8c_source.html#l00089">slist.c:89</a></div></div>
<div class="ttc" id="select_8h_html_a7e89e8a851eb27402914a0d5beb58d99"><div class="ttname"><a href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a></div><div class="ttdeci">#define SOCKET_READABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00079">select.h:79</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a8e83b9ac94b508d151adc74c69a72a27"><div class="ttname"><a href="setup-vms_8h.html#a8e83b9ac94b508d151adc74c69a72a27">CONF_modules_load_file</a></div><div class="ttdeci">#define CONF_modules_load_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00207">setup-vms.h:207</a></div></div>
<div class="ttc" id="structa_html"><div class="ttname"><a href="structa.html">a</a></div><div class="ttdef"><b>Definition:</b> <a href="unit1323_8c_source.html#l00036">unit1323.c:36</a></div></div>
<div class="ttc" id="struct_user_defined_html_a297b95c9d8a6b73ab0d15f752e23ba8b"><div class="ttname"><a href="struct_user_defined.html#a297b95c9d8a6b73ab0d15f752e23ba8b">UserDefined::httpversion</a></div><div class="ttdeci">long httpversion</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01591">urldata.h:1591</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a01e08f80ad19159daa59390042c4b612"><div class="ttname"><a href="setup-vms_8h.html#a01e08f80ad19159daa59390042c4b612">BN_num_bits</a></div><div class="ttdeci">#define BN_num_bits</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00203">setup-vms.h:203</a></div></div>
<div class="ttc" id="strcase_8h_html_a48c605aaef9b3681c41d91096b6baad0"><div class="ttname"><a href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a></div><div class="ttdeci">#define strncasecompare(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00036">strcase.h:36</a></div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ac18c60575612d7cc3aa9dd7825622704"><div class="ttname"><a href="setup-vms_8h.html#ac18c60575612d7cc3aa9dd7825622704">UI_set_result</a></div><div class="ttdeci">#define UI_set_result</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00331">setup-vms.h:331</a></div></div>
<div class="ttc" id="vtls_8h_html_a486d7ada0cb21188917be26be3d81483"><div class="ttname"><a href="vtls_8h.html#a486d7ada0cb21188917be26be3d81483">SSLSUPP_TLS13_CIPHERSUITES</a></div><div class="ttdeci">#define SSLSUPP_TLS13_CIPHERSUITES</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00034">vtls.h:34</a></div></div>
<div class="ttc" id="remote-name_8d_html_aa335f8bb20424b03700f57b150bf0aa6"><div class="ttname"><a href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a></div><div class="ttdeci">Long the path is cut off.The file will be saved in the current working directory.If you want the file saved in a different make sure you change the current working directory before invoking curl with this option.The remote file name to use for saving is extracted from the given nothing and if it already exists it will be overwritten.If you want the server to be able to choose the file name refer to remote header name which can be used in addition to this option.If the server chooses a file name and that name already exists it will not be overwritten.There is no URL decoding done on the file name.If it has or other URL encoded parts of the name</div><div class="ttdef"><b>Definition:</b> <a href="remote-name_8d_source.html#l00006">remote-name.d:6</a></div></div>
<div class="ttc" id="structssl__connect__data_html"><div class="ttname"><a href="structssl__connect__data.html">ssl_connect_data</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00197">urldata.h:197</a></div></div>
<div class="ttc" id="non-ascii_8h_html_a7f86eb6237ad590baa14e82fae9d6d83"><div class="ttname"><a href="non-ascii_8h.html#a7f86eb6237ad590baa14e82fae9d6d83">Curl_convert_from_network</a></div><div class="ttdeci">#define Curl_convert_from_network(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="non-ascii_8h_source.html#l00057">non-ascii.h:57</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00182">urldata.h:182</a></div></div>
<div class="ttc" id="curl_8h_html_a9704d2633927f77efaa3e3c6f1c23a14a527a249892b8a9d34406e66c18611767"><div class="ttname"><a href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a527a249892b8a9d34406e66c18611767">CURLINFO_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00433">curl.h:433</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a1d23a9a2785cb38e8ec54e5ff8848b85"><div class="ttname"><a href="setup-vms_8h.html#a1d23a9a2785cb38e8ec54e5ff8848b85">ENGINE_ctrl</a></div><div class="ttdeci">#define ENGINE_ctrl</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00223">setup-vms.h:223</a></div></div>
<div class="ttc" id="setup-vms_8h_html_af55e4ccbb54ad626fde32c2a43a8e06e"><div class="ttname"><a href="setup-vms_8h.html#af55e4ccbb54ad626fde32c2a43a8e06e">SSL_CTX_get_cert_store</a></div><div class="ttdeci">#define SSL_CTX_get_cert_store</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00273">setup-vms.h:273</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a55b93f90eb95b7e6789437c392e0e788"><div class="ttname"><a href="setup-vms_8h.html#a55b93f90eb95b7e6789437c392e0e788">ENGINE_init</a></div><div class="ttdeci">#define ENGINE_init</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00230">setup-vms.h:230</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ad0b04ac080f2d189a852e8b479d7734b"><div class="ttname"><a href="setup-vms_8h.html#ad0b04ac080f2d189a852e8b479d7734b">UI_destroy_method</a></div><div class="ttdeci">#define UI_destroy_method</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00321">setup-vms.h:321</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a706c82bfae7ce618d3f0e39a0d72a988"><div class="ttname"><a href="setup-vms_8h.html#a706c82bfae7ce618d3f0e39a0d72a988">SSL_free</a></div><div class="ttdeci">#define SSL_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00288">setup-vms.h:288</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01972">curl.h:1972</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a748e88c59d5a8fb7690774ac69748610"><div class="ttname"><a href="setup-vms_8h.html#a748e88c59d5a8fb7690774ac69748610">SSL_SESSION_free</a></div><div class="ttdeci">#define SSL_SESSION_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00286">setup-vms.h:286</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aa13f40e5aac785732191143407c0c612"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aa13f40e5aac785732191143407c0c612">CURLE_SSL_ENGINE_INITFAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00539">curl.h:539</a></div></div>
<div class="ttc" id="sendf_8c_html_a8b0f0a06869b888abb80a069182d0d5a"><div class="ttname"><a href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a></div><div class="ttdeci">int Curl_debug(struct Curl_easy *data, curl_infotype type, char *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00776">sendf.c:776</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ad16fc197ca0af13411844895262ac9b6"><div class="ttname"><a href="setup-vms_8h.html#ad16fc197ca0af13411844895262ac9b6">SSL_CTX_set_verify</a></div><div class="ttdeci">#define SSL_CTX_set_verify</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00280">setup-vms.h:280</a></div></div>
<div class="ttc" id="struct_user_defined_html_aab42d022c7e38fee30d1bd51e7d747f3"><div class="ttname"><a href="struct_user_defined.html#aab42d022c7e38fee30d1bd51e7d747f3">UserDefined::fdebug</a></div><div class="ttdeci">curl_debug_callback fdebug</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01531">urldata.h:1531</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00505">curl.h:505</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a15e99abfd6e6241f1424fd71331a12ec"><div class="ttname"><a href="setup-vms_8h.html#a15e99abfd6e6241f1424fd71331a12ec">SSL_shutdown</a></div><div class="ttdeci">#define SSL_shutdown</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00308">setup-vms.h:308</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a2505312fdce26ff8bc2d3686cc6b9a6f"><div class="ttname"><a href="setup-vms_8h.html#a2505312fdce26ff8bc2d3686cc6b9a6f">X509_get_pubkey</a></div><div class="ttdeci">#define X509_get_pubkey</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00348">setup-vms.h:348</a></div></div>
<div class="ttc" id="structconnectdata_html_ada83cbd7d295b87033b7ea635c0a5dd5"><div class="ttname"><a href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">connectdata::send</a></div><div class="ttdeci">Curl_send * send[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00880">urldata.h:880</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a690ca365fec9f672101a774fb82fe3e7"><div class="ttname"><a href="setup-vms_8h.html#a690ca365fec9f672101a774fb82fe3e7">ERR_clear_error</a></div><div class="ttdeci">#define ERR_clear_error</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00234">setup-vms.h:234</a></div></div>
<div class="ttc" id="fail-early_8d_html_a2b978ebca1e6cb7fcbcb9a6b51701ce3"><div class="ttname"><a href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply fail</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="structcurltime_html"><div class="ttname"><a href="structcurltime.html">curltime</a></div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00033">timeval.h:33</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00181">urldata.h:181</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ac78686b148fb4b4ec55b126c404bd89e"><div class="ttname"><a href="setup-vms_8h.html#ac78686b148fb4b4ec55b126c404bd89e">SSL_CTX_use_certificate</a></div><div class="ttdeci">#define SSL_CTX_use_certificate</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00284">setup-vms.h:284</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a82c2c4a514da95fce469765dacd90a52"><div class="ttname"><a href="setup-vms_8h.html#a82c2c4a514da95fce469765dacd90a52">BIO_free</a></div><div class="ttdeci">#define BIO_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00199">setup-vms.h:199</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a5f8018d9c44060e2e90cd6fabe1d6692"><div class="ttname"><a href="setup-vms_8h.html#a5f8018d9c44060e2e90cd6fabe1d6692">ENGINE_set_default</a></div><div class="ttdeci">#define ENGINE_set_default</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00233">setup-vms.h:233</a></div></div>
<div class="ttc" id="inet__pton_8c_html_a8d1e996e3cc6d70e844c787b1a8614cc"><div class="ttname"><a href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a></div><div class="ttdeci">int Curl_inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="inet__pton_8c_source.html#l00066">inet_pton.c:66</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a5d2928a33b697892fa7dcc0f1fb0d129"><div class="ttname"><a href="setup-vms_8h.html#a5d2928a33b697892fa7dcc0f1fb0d129">X509_get_ext_d2i</a></div><div class="ttdeci">#define X509_get_ext_d2i</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00346">setup-vms.h:346</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4da74aee28bba157392e07b797d710900e1"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da74aee28bba157392e07b797d710900e1">CURL_SSLVERSION_MAX_TLSv1_0</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01987">curl.h:1987</a></div></div>
<div class="ttc" id="unit1305_8c_html_a19c83966ddb434275d52d14653b32204"><div class="ttname"><a href="unit1305_8c.html#a19c83966ddb434275d52d14653b32204">if</a></div><div class="ttdeci">if(strcmp(arg, &quot;1305&quot;) !=0)</div><div class="ttdef"><b>Definition:</b> <a href="unit1305_8c_source.html#l00127">unit1305.c:127</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a91672027ad0aa37c6f5ba9a1aefa2d4c"><div class="ttname"><a href="setup-vms_8h.html#a91672027ad0aa37c6f5ba9a1aefa2d4c">ENGINE_get_first</a></div><div class="ttdeci">#define ENGINE_get_first</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00227">setup-vms.h:227</a></div></div>
<div class="ttc" id="memdebug_8h_html_a795660f73c902cc80ac0fe6cda0dbd1c"><div class="ttname"><a href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a></div><div class="ttdeci">#define Curl_safefree(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="memdebug_8h_source.html#l00176">memdebug.h:176</a></div></div>
<div class="ttc" id="setup-vms_8h_html_afd3703179f9d1c463c329e6823ad21ed"><div class="ttname"><a href="setup-vms_8h.html#afd3703179f9d1c463c329e6823ad21ed">UI_method_set_writer</a></div><div class="ttdeci">#define UI_method_set_writer</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00329">setup-vms.h:329</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="non-ascii_8h_html_aa89c200049135ad5e08a5d3092be3b78"><div class="ttname"><a href="non-ascii_8h.html#aa89c200049135ad5e08a5d3092be3b78">Curl_convert_from_utf8</a></div><div class="ttdeci">#define Curl_convert_from_utf8(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="non-ascii_8h_source.html#l00058">non-ascii.h:58</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a563034aa65354c4b56f552668e17b557"><div class="ttname"><a href="setup-vms_8h.html#a563034aa65354c4b56f552668e17b557">EVP_cleanup</a></div><div class="ttdeci">#define EVP_cleanup</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00243">setup-vms.h:243</a></div></div>
<div class="ttc" id="select_8c_html_a5c7e56fd4476c27a049314f502981f29"><div class="ttname"><a href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a></div><div class="ttdeci">int Curl_socket_check(curl_socket_t readfd0, curl_socket_t readfd1, curl_socket_t writefd, time_t timeout_ms)</div><div class="ttdef"><b>Definition:</b> <a href="select_8c_source.html#l00145">select.c:145</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a4dbcbfb09083d9bcaac672463d68a909"><div class="ttname"><a href="setup-vms_8h.html#a4dbcbfb09083d9bcaac672463d68a909">ENGINE_finish</a></div><div class="ttdeci">#define ENGINE_finish</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00225">setup-vms.h:225</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a74d3d3725cba6c1054cec14ce1693383"><div class="ttname"><a href="setup-vms_8h.html#a74d3d3725cba6c1054cec14ce1693383">ASN1_STRING_to_UTF8</a></div><div class="ttdeci">#define ASN1_STRING_to_UTF8</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00196">setup-vms.h:196</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ae4d853c0bba4917e70a486afd1b2eafa"><div class="ttname"><a href="setup-vms_8h.html#ae4d853c0bba4917e70a486afd1b2eafa">RAND_load_file</a></div><div class="ttdeci">#define RAND_load_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00265">setup-vms.h:265</a></div></div>
<div class="ttc" id="non-ascii_8h_html"><div class="ttname"><a href="non-ascii_8h.html">non-ascii.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a94cf6f18d4f14d23153cdeb90fa5923d"><div class="ttname"><a href="setup-vms_8h.html#a94cf6f18d4f14d23153cdeb90fa5923d">SSL_CTX_free</a></div><div class="ttdeci">#define SSL_CTX_free</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00272">setup-vms.h:272</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="config-vxworks_8h_html_ab4f3d89a4ce924109f1d4d9dd78128bf"><div class="ttname"><a href="config-vxworks_8h.html#ab4f3d89a4ce924109f1d4d9dd78128bf">RANDOM_FILE</a></div><div class="ttdeci">#define RANDOM_FILE</div><div class="ttdef"><b>Definition:</b> <a href="config-vxworks_8h_source.html#l00749">config-vxworks.h:749</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a97ce2c6906885aa8d887d135945c2165"><div class="ttname"><a href="setup-vms_8h.html#a97ce2c6906885aa8d887d135945c2165">i2d_X509_PUBKEY</a></div><div class="ttdeci">#define i2d_X509_PUBKEY</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00245">setup-vms.h:245</a></div></div>
<div class="ttc" id="hostcheck_8h_html_a27f0cb03fe4f1f02de4846ca58e29a8a"><div class="ttname"><a href="hostcheck_8h.html#a27f0cb03fe4f1f02de4846ca58e29a8a">Curl_cert_hostcheck</a></div><div class="ttdeci">int Curl_cert_hostcheck(const char *match_pattern, const char *hostname)</div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a18498436deaef8bd0ca75406c504ea54"><div class="ttname"><a href="setup-vms_8h.html#a18498436deaef8bd0ca75406c504ea54">SSL_load_error_strings</a></div><div class="ttdeci">#define SSL_load_error_strings</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00300">setup-vms.h:300</a></div></div>
<div class="ttc" id="structcurltime_html_a2bb2442cdc8b9e4d2287805ce8febb17"><div class="ttname"><a href="structcurltime.html#a2bb2442cdc8b9e4d2287805ce8febb17">curltime::tv_usec</a></div><div class="ttdeci">int tv_usec</div><div class="ttdef"><b>Definition:</b> <a href="timeval_8h_source.html#l00035">timeval.h:35</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00460">curl.h:460</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="hostcheck_8h_html"><div class="ttname"><a href="hostcheck_8h.html">hostcheck.h</a></div></div>
<div class="ttc" id="curl_8h_html_a24fffb09f0eaa14dd67cde59e7b09480"><div class="ttname"><a href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480">CURL_TLSAUTH</a></div><div class="ttdeci">CURL_TLSAUTH</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01996">curl.h:1996</a></div></div>
<div class="ttc" id="setup-vms_8h_html_afdf7a6c69be63cbd9a8fc09b83ea330f"><div class="ttname"><a href="setup-vms_8h.html#afdf7a6c69be63cbd9a8fc09b83ea330f">ASN1_STRING_type</a></div><div class="ttdeci">#define ASN1_STRING_type</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00197">setup-vms.h:197</a></div></div>
<div class="ttc" id="_b_l_e_eddystone_t_l_m_8h_html_ab22abc2906422da61885ac6c8e6a1a59"><div class="ttname"><a href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a></div><div class="ttdeci">uint8_t version</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_eddystone_t_l_m_8h_source.html#l00041">BLEEddystoneTLM.h:41</a></div></div>
<div class="ttc" id="urldata_8h_html_ad073adb2b5b8a2f9ab8eb0dcae415efc"><div class="ttname"><a href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a></div><div class="ttdeci">ssize_t() Curl_recv(struct connectdata *conn, int sockindex, char *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00110">urldata.h:110</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01976">curl.h:1976</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a4e60f57d61a6a6acab36969bbe0a334a"><div class="ttname"><a href="setup-vms_8h.html#a4e60f57d61a6a6acab36969bbe0a334a">X509_check_issued</a></div><div class="ttdeci">#define X509_check_issued</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00344">setup-vms.h:344</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a494c2e58e6a266a2e9fd0fa09a200894"><div class="ttname"><a href="setup-vms_8h.html#a494c2e58e6a266a2e9fd0fa09a200894">ERR_get_error</a></div><div class="ttdeci">#define ERR_get_error</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00238">setup-vms.h:238</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a6897a03e447918c3806f3d265f6b215b"><div class="ttname"><a href="setup-vms_8h.html#a6897a03e447918c3806f3d265f6b215b">UI_get0_user_data</a></div><div class="ttdeci">#define UI_get0_user_data</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00317">setup-vms.h:317</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a56f44a82e25148deb9ef182f1ae157ac"><div class="ttname"><a href="setup-vms_8h.html#a56f44a82e25148deb9ef182f1ae157ac">ENGINE_get_next</a></div><div class="ttdeci">#define ENGINE_get_next</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00229">setup-vms.h:229</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00531">curl.h:531</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a06dc4c3f54ecece03a956a8f99296ff5"><div class="ttname"><a href="setup-vms_8h.html#a06dc4c3f54ecece03a956a8f99296ff5">SSL_CTX_check_private_key</a></div><div class="ttdeci">#define SSL_CTX_check_private_key</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00270">setup-vms.h:270</a></div></div>
<div class="ttc" id="urldata_8h_html_a9f02ef6c16f171ef6fd36b7903e91b41"><div class="ttname"><a href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a></div><div class="ttdeci">ssize_t() Curl_send(struct connectdata *conn, int sockindex, const void *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00103">urldata.h:103</a></div></div>
<div class="ttc" id="slist_8h_html"><div class="ttname"><a href="slist_8h.html">slist.h</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="curl_8h_html_aabc03ec968a2fdccde5c6709f712dd7baec99d0c4534207509d00a0f2feee97fb"><div class="ttname"><a href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7baec99d0c4534207509d00a0f2feee97fb">CURLINFO_TLS_SESSION</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02549">curl.h:2549</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a241c54474fe64668004fc8d15496085c"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a241c54474fe64668004fc8d15496085c">CURLE_SSL_CRL_BADFILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00567">curl.h:567</a></div></div>
<div class="ttc" id="header_8d_html_af039c1a4bf9f7d5ffdd981d66cd3fb2d"><div class="ttname"><a href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a></div><div class="ttdeci">Long your externally set header will be used instead of the one.This allows you to make even trickier stuff than curl would normally do.You should not replace internally set headers without knowing perfectly well what you re doing.Remove an header by giving a replacement without content on the right side of the as in</div><div class="ttdef"><b>Definition:</b> <a href="header_8d_source.html#l00009">header.d:9</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a75f751890ae1efc310dd1b018878d84d"><div class="ttname"><a href="setup-vms_8h.html#a75f751890ae1efc310dd1b018878d84d">SSL_get_privatekey</a></div><div class="ttdeci">#define SSL_get_privatekey</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00295">setup-vms.h:295</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa85af043a41434c1b4f439fb89d5c9047"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa85af043a41434c1b4f439fb89d5c9047">STRING_SSL_PINNEDPUBLICKEY_PROXY</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01430">urldata.h:1430</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00180">urldata.h:180</a></div></div>
<div class="ttc" id="curl_8h_html_a24fffb09f0eaa14dd67cde59e7b09480a4c0ae8216421b905a5ba0fff6b685abe"><div class="ttname"><a href="curl_8h.html#a24fffb09f0eaa14dd67cde59e7b09480a4c0ae8216421b905a5ba0fff6b685abe">CURL_TLSAUTH_SRP</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01998">curl.h:1998</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a05075fd2898e376d6ac0b3c00c4f6404"><div class="ttname"><a href="setup-vms_8h.html#a05075fd2898e376d6ac0b3c00c4f6404">UI_method_get_closer</a></div><div class="ttdeci">#define UI_method_get_closer</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00322">setup-vms.h:322</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01977">curl.h:1977</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ac0e57f9a4ec9d5ff1418a48cde263ab5"><div class="ttname"><a href="setup-vms_8h.html#ac0e57f9a4ec9d5ff1418a48cde263ab5">X509_STORE_add_lookup</a></div><div class="ttdeci">#define X509_STORE_add_lookup</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00342">setup-vms.h:342</a></div></div>
<div class="ttc" id="structconnectdata_html_a57fed5d378439f0b8cbad7cc9e916604"><div class="ttname"><a href="structconnectdata.html#a57fed5d378439f0b8cbad7cc9e916604">connectdata::proxy_ssl</a></div><div class="ttdeci">struct ssl_connect_data proxy_ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00886">urldata.h:886</a></div></div>
<div class="ttc" id="curl_8h_html_a49d83160803f433b12209ed52aafc05f"><div class="ttname"><a href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a></div><div class="ttdeci">#define CURL_HTTP_VERSION_2</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01938">curl.h:1938</a></div></div>
<div class="ttc" id="structconnectdata_html_ac9d24fcd15a4c660fa7b6fbf55f6451d"><div class="ttname"><a href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">connectdata::port</a></div><div class="ttdeci">long port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00839">urldata.h:839</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a14f32226c92f6f56dfb6b810cdaed446"><div class="ttname"><a href="setup-vms_8h.html#a14f32226c92f6f56dfb6b810cdaed446">SSL_set_session</a></div><div class="ttdeci">#define SSL_set_session</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00307">setup-vms.h:307</a></div></div>
<div class="ttc" id="curl_8h_html_a908c5b707ac681212b8f8688cf76689dac51b430af8fa4c044fb05a38e39a17c9"><div class="ttname"><a href="curl_8h.html#a908c5b707ac681212b8f8688cf76689dac51b430af8fa4c044fb05a38e39a17c9">CURLSSLBACKEND_OPENSSL</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00139">curl.h:139</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a406ac1bed18a820aa841fef93a8fa9af"><div class="ttname"><a href="setup-vms_8h.html#a406ac1bed18a820aa841fef93a8fa9af">SSL_CTX_set_default_passwd_cb</a></div><div class="ttdeci">#define SSL_CTX_set_default_passwd_cb</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00278">setup-vms.h:278</a></div></div>
<div class="ttc" id="setup-vms_8h_html_abee800186c80a76ed83b0c2dc227e238"><div class="ttname"><a href="setup-vms_8h.html#abee800186c80a76ed83b0c2dc227e238">OPENSSL_load_builtin_modules</a></div><div class="ttdeci">#define OPENSSL_load_builtin_modules</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00254">setup-vms.h:254</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00184">urldata.h:184</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a49169ee8e53a3c836d2814c424b043e3"><div class="ttname"><a href="setup-vms_8h.html#a49169ee8e53a3c836d2814c424b043e3">UI_method_set_opener</a></div><div class="ttdeci">#define UI_method_set_opener</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00327">setup-vms.h:327</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a99fe37fc3d3adef7634c44bb1f3ed59a"><div class="ttname"><a href="setup-vms_8h.html#a99fe37fc3d3adef7634c44bb1f3ed59a">X509_load_crl_file</a></div><div class="ttdeci">#define X509_load_crl_file</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00351">setup-vms.h:351</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01979">curl.h:1979</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ab0948ba5c5c5d3f7e66b71d46e7a7ff5"><div class="ttname"><a href="setup-vms_8h.html#ab0948ba5c5c5d3f7e66b71d46e7a7ff5">i2t_ASN1_OBJECT</a></div><div class="ttdeci">#define i2t_ASN1_OBJECT</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00354">setup-vms.h:354</a></div></div>
<div class="ttc" id="_b_l_e_eddystone_t_l_m_8h_html_a36142ddde297ed1d5577c81230997301"><div class="ttname"><a href="_b_l_e_eddystone_t_l_m_8h.html#a36142ddde297ed1d5577c81230997301">temp</a></div><div class="ttdeci">uint16_t temp</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_eddystone_t_l_m_8h_source.html#l00043">BLEEddystoneTLM.h:43</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a458ee91fc97fec42499863353fc0ed1a"><div class="ttname"><a href="setup-vms_8h.html#a458ee91fc97fec42499863353fc0ed1a">UI_create_method</a></div><div class="ttdeci">#define UI_create_method</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00320">setup-vms.h:320</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a52cb532d2a08f913d6273f0b4341e135"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a52cb532d2a08f913d6273f0b4341e135">CURLE_SSL_ENGINE_NOTFOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00523">curl.h:523</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4daa94fe5edaa7282176fa95c61bcbc91e3"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4daa94fe5edaa7282176fa95c61bcbc91e3">CURL_SSLVERSION_MAX_TLSv1_1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01988">curl.h:1988</a></div></div>
<div class="ttc" id="vtls_8h_html_a4ff8480c5307cec2506c039114624e1d"><div class="ttname"><a href="vtls_8h.html#a4ff8480c5307cec2506c039114624e1d">SSLSUPP_SSL_CTX</a></div><div class="ttdeci">#define SSLSUPP_SSL_CTX</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00032">vtls.h:32</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a23aa09f44032fb7175abe25a8ef7b024"><div class="ttname"><a href="setup-vms_8h.html#a23aa09f44032fb7175abe25a8ef7b024">X509_verify_cert_error_string</a></div><div class="ttdeci">#define X509_verify_cert_error_string</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00352">setup-vms.h:352</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a4d0579ef3ac599f56ba3fa39076a8928"><div class="ttname"><a href="setup-vms_8h.html#a4d0579ef3ac599f56ba3fa39076a8928">SSLv23_client_method</a></div><div class="ttdeci">#define SSLv23_client_method</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00312">setup-vms.h:312</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a0ede1baca5700d1c8e30f7de2a8dd46c"><div class="ttname"><a href="setup-vms_8h.html#a0ede1baca5700d1c8e30f7de2a8dd46c">SSL_CTX_set_msg_callback</a></div><div class="ttdeci">#define SSL_CTX_set_msg_callback</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00279">setup-vms.h:279</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a9c484827ba0013b393e32968e412c856"><div class="ttname"><a href="setup-vms_8h.html#a9c484827ba0013b393e32968e412c856">X509_NAME_print_ex</a></div><div class="ttdeci">#define X509_NAME_print_ex</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00340">setup-vms.h:340</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="config-dos_8h_html_a6b79be6b722e2ba9009495691c233d77"><div class="ttname"><a href="config-dos_8h.html#a6b79be6b722e2ba9009495691c233d77">RECV_TYPE_ARG1</a></div><div class="ttdeci">#define RECV_TYPE_ARG1</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00106">config-dos.h:106</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a02e6c397c6763f0c0be42921bdb1a3c9"><div class="ttname"><a href="setup-vms_8h.html#a02e6c397c6763f0c0be42921bdb1a3c9">SSL_new</a></div><div class="ttdeci">#define SSL_new</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00301">setup-vms.h:301</a></div></div>
<div class="ttc" id="setup-vms_8h_html_af6aec876f8a115fd32e475992c422beb"><div class="ttname"><a href="setup-vms_8h.html#af6aec876f8a115fd32e475992c422beb">RAND_file_name</a></div><div class="ttdeci">#define RAND_file_name</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00264">setup-vms.h:264</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a567c864875b56a6fed90ca22bc89a5a2"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a567c864875b56a6fed90ca22bc89a5a2">CURLE_SSL_ISSUER_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00569">curl.h:569</a></div></div>
<div class="ttc" id="curl_8h_html_a3a28c84e40db0ef30859b680281c9d36"><div class="ttname"><a href="curl_8h.html#a3a28c84e40db0ef30859b680281c9d36">curl_slist_free_all</a></div><div class="ttdeci">CURL_EXTERN void curl_slist_free_all(struct curl_slist *)</div><div class="ttdef"><b>Definition:</b> <a href="slist_8c_source.html#l00129">slist.c:129</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a2af3e2b30a5128e2d1e75819558f50c0"><div class="ttname"><a href="setup-vms_8h.html#a2af3e2b30a5128e2d1e75819558f50c0">UI_get_input_flags</a></div><div class="ttdeci">#define UI_get_input_flags</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00318">setup-vms.h:318</a></div></div>
<div class="ttc" id="url_8h_html"><div class="ttname"><a href="url_8h.html">url.h</a></div></div>
<div class="ttc" id="curl__setup_8h_html_a83627b88ed8d3c99516bb8708bde66cc"><div class="ttname"><a href="curl__setup_8h.html#a83627b88ed8d3c99516bb8708bde66cc">FOPEN_APPENDTEXT</a></div><div class="ttdeci">#define FOPEN_APPENDTEXT</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00773">curl_setup.h:773</a></div></div>
<div class="ttc" id="get_8d_html_a38b0ef81b65f2aee282c8c217a123176"><div class="ttname"><a href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a></div><div class="ttdeci">Long this option will make all data specified with data</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="structhostname_html_aee7d0ff8210c25b87d6fdeacf8ea7939"><div class="ttname"><a href="structhostname.html#aee7d0ff8210c25b87d6fdeacf8ea7939">hostname::dispname</a></div><div class="ttdeci">const char * dispname</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00450">urldata.h:450</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00179">urldata.h:179</a></div></div>
<div class="ttc" id="unit1602_8c_html_a35af0be900467fedbb610bd6ea65ed78"><div class="ttname"><a href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a></div><div class="ttdeci">int key</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00056">unit1602.c:56</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aab7dc0cfbac448e2e86e9ee8c6aaacb4"><div class="ttname"><a href="setup-vms_8h.html#aab7dc0cfbac448e2e86e9ee8c6aaacb4">X509V3_EXT_print</a></div><div class="ttdeci">#define X509V3_EXT_print</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00332">setup-vms.h:332</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a0a00cd02ce442392e3836545ce356b6a"><div class="ttname"><a href="struct_connect_bits.html#a0a00cd02ce442392e3836545ce356b6a">ConnectBits::tls_enable_npn</a></div><div class="ttdeci">bool tls_enable_npn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00439">urldata.h:439</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a87a05918f3772aac3d94e2028f7ef2a9"><div class="ttname"><a href="setup-vms_8h.html#a87a05918f3772aac3d94e2028f7ef2a9">PKCS12_parse</a></div><div class="ttdeci">#define PKCS12_parse</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00260">setup-vms.h:260</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a3082baf484326774c04577668a0a1784"><div class="ttname"><a href="setup-vms_8h.html#a3082baf484326774c04577668a0a1784">ASN1_STRING_length</a></div><div class="ttdeci">#define ASN1_STRING_length</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00194">setup-vms.h:194</a></div></div>
<div class="ttc" id="structconnectdata_html_a82d9732a096255f5d8741c4a0ea990eb"><div class="ttname"><a href="structconnectdata.html#a82d9732a096255f5d8741c4a0ea990eb">connectdata::remote_port</a></div><div class="ttdeci">int remote_port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00840">urldata.h:840</a></div></div>
<div class="ttc" id="setup-vms_8h_html_afe0d45b9905f519fa032e134eaccb01c"><div class="ttname"><a href="setup-vms_8h.html#afe0d45b9905f519fa032e134eaccb01c">SSL_pending</a></div><div class="ttdeci">#define SSL_pending</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00303">setup-vms.h:303</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ad9d91a5f187f92caec96549f7f99ce08"><div class="ttname"><a href="setup-vms_8h.html#ad9d91a5f187f92caec96549f7f99ce08">X509_get_issuer_name</a></div><div class="ttdeci">#define X509_get_issuer_name</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00347">setup-vms.h:347</a></div></div>
<div class="ttc" id="setup-vms_8h_html_a0608770b2a8065a7f8491ca019ebc10b"><div class="ttname"><a href="setup-vms_8h.html#a0608770b2a8065a7f8491ca019ebc10b">UI_method_set_closer</a></div><div class="ttdeci">#define UI_method_set_closer</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00326">setup-vms.h:326</a></div></div>
<div class="ttc" id="curl_8h_html_a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a"><div class="ttname"><a href="curl_8h.html#a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a">CURLFTPSSL_CCC_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00828">curl.h:828</a></div></div>
<div class="ttc" id="setup-vms_8h_html_aa5c639c644584d66688d5b192189150c"><div class="ttname"><a href="setup-vms_8h.html#aa5c639c644584d66688d5b192189150c">SSLv3_client_method</a></div><div class="ttdeci">#define SSLv3_client_method</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00313">setup-vms.h:313</a></div></div>
<div class="ttc" id="vtls_8h_html_ad333981ba88648c413730d21d5418405"><div class="ttname"><a href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a></div><div class="ttdeci">#define SSL_IS_PROXY()</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00133">vtls.h:133</a></div></div>
<div class="ttc" id="setup-vms_8h_html_afefcb42f55dc7e6f9d519be6d852dba8"><div class="ttname"><a href="setup-vms_8h.html#afefcb42f55dc7e6f9d519be6d852dba8">X509_STORE_set_flags</a></div><div class="ttdeci">#define X509_STORE_set_flags</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00343">setup-vms.h:343</a></div></div>
<div class="ttc" id="setup-vms_8h_html_ab2741d20acc86b4564591f5fbcd3c1f1"><div class="ttname"><a href="setup-vms_8h.html#ab2741d20acc86b4564591f5fbcd3c1f1">SSL_set_connect_state</a></div><div class="ttdeci">#define SSL_set_connect_state</div><div class="ttdef"><b>Definition:</b> <a href="setup-vms_8h_source.html#l00305">setup-vms.h:305</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="dir_c8d0f45061db60a99b5caea59b58f693.html">vtls</a></li><li class="navelem"><a class="el" href="openssl_8c.html">openssl.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
