<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/networking/bootwifi/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('esp32-snippets_2networking_2bootwifi_2_r_e_a_d_m_e_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">esp32-snippets/networking/bootwifi/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="esp32-snippets_2networking_2bootwifi_2_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Bootwifi</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;It is common to want to start an ESP32 and have it connect to a WiFi environment but how does one bootstrap it?  To connect to a WiFi environment, we typically need to know the SSID and password of the network to which we wish to connect.  But without network connection to the ESP32, how do we set it?  This component provides a potential solution.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The module exposes a function called `bootwifi` which, when called, will own the connection of the device to the local WiFi environment.  To do this, it looks in its flash storage to see if it has previously been given an SSID/password pair.  If it has, it attempts to connect to that access point and join the network.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;However, let us assume that it has never been given that information.  In this case it will become an access point in its own right.  What this means is that the ESP32 will become a WiFi network to which other WiFi devices can connect.  Now you can connect to the ESP32 using your phone or other WiFi device as it will appear as an access point against which we can connect.  Once connected, we can open a browser to it.  In the browser page, we will be prompted for the SSID and password we wish to subsequently use.  This will be saved and used from then on.  Now the device will connect to that network.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;What if we take our ESP32 to a new environment where the previously saved access point is no longer accessible or we simply just fail to connect?  Again, we will fall back into being an access point and the user will be able to supply new information.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;What if we want to change the access point to which the ESP32 connects even if that access point has been previously saved and is still connectable?  Simple, the ESP32 can check a GPIO pin at startup and, if that pin is high (default low) then that can be used as a manual indication that we should become an access point without even attempting to connect to the network.</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;This code is supplied in the form of an ESP-IDF module.  In addition, BootWiFi has a pre-requisite of the `cpp_utils` component also distributed as part of this repoistory.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The logic uses C++ exception handling and hence C++ exception handling must be enabled in `make menuconfig`.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;## Example</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Below is a sample of a minimal main.cpp.  </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;* If you run it on an esp32, it should create a new open wifi network with SSID: &quot;ESP32&quot;.  </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;* Connect to that network. </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;* Then open a browser and go to http://192.168.4.1.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;```C++</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#include &quot;BootWiFi.h&quot;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;#include &quot;sdkconfig.h&quot;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;extern &quot;C&quot; {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   void app_main(void);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;BootWiFi *boot;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;void app_main(void) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;   boot = new BootWiFi();</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   boot-&gt;boot();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;```</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;## GPIO boot override</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;To enable the ability to specify a GPIO pin to override known station information, compile the code with `-DBOOTWIFI_OVERRIDE_GPIO=&lt;num&gt;` when `&lt;num&gt;` is a GPIO pin number.  If the pin is high at startup, then it will override.  The pin is configured as pull-down low so it need not be artificially held low.  The default is no override pin.</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;## Future enhancements</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;There is always room for enhancements:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;* Improve the web page shown to the user - Right now it is pretty basic and ideally could be dramatically improved.  Features to be added include</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  - listing of available access points for selection</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;* Integrate SSL security.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;* NeoPixel support for visualization of connection status:</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  - Green - connected</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  - Blue - being an access point</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  - Red - Connecting</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  - Flashing red - failed</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;* Ability to specify an IP address for static IP address connection to the access point.</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;* mDNS support when available.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;* Component configuration options including:</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  - Network SSID to use when being an access point.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  - Network password to use when being an access point (if any). </div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;## Design and implementation notes</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;The parameters for Bootwifi are stored in Non-Volatile Storage (NVS).  The name space in NVS</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;is `bootwifi`.  The keys are:</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;* `version` - The version of the protocol.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;* `connectionInfo` - The details for connection.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;The form shown to the end user sends back a response as an HTTP POST to `/ssidSelected`. which contains the following form fields:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;* ssid</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;* password</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;* ip</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;* gw</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;* netmask</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="esp32-snippets_2networking_2bootwifi_2_r_e_a_d_m_e_8md.html">README.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
