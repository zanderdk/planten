<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/BLERemoteService.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_b_l_e_remote_service_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLERemoteService.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_b_l_e_remote_service_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * BLERemoteService.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Jul 8, 2017</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: kolban</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#if defined(CONFIG_BT_ENABLED)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_remote_service_8h.html">BLERemoteService.h</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_b_l_e_utils_8h.html">BLEUtils.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_general_utils_8h.html">GeneralUtils.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;esp_err.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#ifdef ARDUINO_ARCH_ESP32</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;esp32-hal-log.h&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* LOG_TAG = <span class="stringliteral">&quot;BLERemoteService&quot;</span>;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;BLERemoteService::BLERemoteService(</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        esp_gatt_id_t srvcId,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <a class="code" href="class_b_l_e_client.html">BLEClient</a>*    pClient,</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        uint16_t      startHandle,</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        uint16_t      endHandle</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    ) {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; BLERemoteService()&quot;</span>);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    m_srvcId  = srvcId;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    m_pClient = pClient;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    m_uuid    = <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a>(m_srvcId);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    m_haveCharacteristics = <span class="keyword">false</span>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    m_startHandle = startHandle;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    m_endHandle = endHandle;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; BLERemoteService()&quot;</span>);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#abc3db77c0ad684a64e3ca5c850242bac">   41</a></span>&#160;<a class="code" href="class_b_l_e_remote_service.html#abc3db77c0ad684a64e3ca5c850242bac">BLERemoteService::~BLERemoteService</a>() {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    removeCharacteristics();</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">static bool compareSrvcId(esp_gatt_srvc_id_t id1, esp_gatt_srvc_id_t id2) {</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">    if (id1.id.inst_id != id2.id.inst_id) {</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">        return false;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">    if (!BLEUUID(id1.id.uuid).equals(BLEUUID(id2.id.uuid))) {</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">        return false;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">    return true;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">} // compareSrvcId</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">void</span> BLERemoteService::gattClientEventHandler(</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    esp_gattc_cb_event_t      event,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    esp_gatt_if_t             gattc_if,</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    esp_ble_gattc_cb_param_t* evtParam) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="comment">// ESP_GATTC_GET_CHAR_EVT</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// get_char:</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">// - esp_gatt_status_t    status</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment">// - uin1t6_t             conn_id</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">// - esp_gatt_srvc_id_t   srvc_id</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">// - esp_gatt_id_t        char_id</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment">// - esp_gatt_char_prop_t char_prop</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">        case ESP_GATTC_GET_CHAR_EVT: {</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">            // Is this event for this service?  If yes, then the local srvc_id and the event srvc_id will be</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">            // the same.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">            if (compareSrvcId(m_srvcId, evtParam-&gt;get_char.srvc_id) == false) {</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">                break;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">            }</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">            // If the status is NOT OK then we have a problem and continue.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">            if (evtParam-&gt;get_char.status != ESP_GATT_OK) {</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">                m_semaphoreGetCharEvt.give();</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">                break;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">            }</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">            // This is an indication that we now have the characteristic details for a characteristic owned</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">            // by this service so remember it.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">            m_characteristicMap.insert(std::pair&lt;std::string, BLERemoteCharacteristic*&gt;(</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">                    BLEUUID(evtParam-&gt;get_char.char_id.uuid).toString(),</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">                    new BLERemoteCharacteristic(evtParam-&gt;get_char.char_id, evtParam-&gt;get_char.char_prop, this) ));</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">            // Now that we have received a characteristic, lets ask for the next one.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">            esp_err_t errRc = ::esp_ble_gattc_get_characteristic(</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">                    m_pClient-&gt;getGattcIf(),</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">                    m_pClient-&gt;getConnId(),</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">                    &amp;m_srvcId,</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">                    &amp;evtParam-&gt;get_char.char_id);</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">            if (errRc != ESP_OK) {</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">                ESP_LOGE(LOG_TAG, &quot;esp_ble_gattc_get_characteristic: rc=%d %s&quot;, errRc, GeneralUtils::errorToString(errRc));</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">                break;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">            }</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">            //m_semaphoreGetCharEvt.give();</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">            break;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">        } // ESP_GATTC_GET_CHAR_EVT</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    } <span class="comment">// switch</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// Send the event to each of the characteristics owned by this service.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;myPair : m_characteristicMapByHandle) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;       myPair.second-&gt;gattClientEventHandler(event, gattc_if, evtParam);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;} <span class="comment">// gattClientEventHandler</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">  128</a></span>&#160;<a class="code" href="class_b_l_e_remote_characteristic.html">BLERemoteCharacteristic</a>* <a class="code" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">BLERemoteService::getCharacteristic</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* uuid) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">getCharacteristic</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a>(uuid));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} <span class="comment">// getCharacteristic</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    </div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#ad916bd78ab14767238b145d16dfa2634">  138</a></span>&#160;<a class="code" href="class_b_l_e_remote_characteristic.html">BLERemoteCharacteristic</a>* <a class="code" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">BLERemoteService::getCharacteristic</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> uuid) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">// Design</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">// ------</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">// We wish to retrieve the characteristic given its UUID.  It is possible that we have not yet asked the</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">// device what characteristics it has in which case we have nothing to match against.  If we have not</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">// asked the device about its characteristics, then we do that now.  Once we get the results we can then</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">// examine the characteristics map to see if it has the characteristic we are looking for.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (!m_haveCharacteristics) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        retrieveCharacteristics();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> v = uuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;myPair : m_characteristicMap) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (myPair.first == v) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">return</span> myPair.second;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// throw new BLEUuidNotFoundException();  // &lt;-- we dont want exception here, which will cause app crash, we want to search if any characteristic can be found one after another</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;} <span class="comment">// getCharacteristic</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordtype">void</span> BLERemoteService::retrieveCharacteristics() {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; getCharacteristics() for service: %s&quot;</span>, <a class="code" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">getUUID</a>().<a class="code" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">toString</a>().c_str());</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    removeCharacteristics(); <span class="comment">// Forget any previous characteristics.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    uint16_t offset = 0;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    esp_gattc_char_elem_t <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        uint16_t count = 10;  <span class="comment">// this value is used as in parameter that allows to search max 10 chars with the same uuid</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        esp_gatt_status_t status = ::esp_ble_gattc_get_all_char(</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <a class="code" href="class_b_l_e_remote_service.html#a4a05b11fa74971db7966639a4423a365">getClient</a>()-&gt;getGattcIf(),</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <a class="code" href="class_b_l_e_remote_service.html#a4a05b11fa74971db7966639a4423a365">getClient</a>()-&gt;getConnId(),</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            m_startHandle,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            m_endHandle,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            &amp;<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            &amp;count,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            offset</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        );</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (status == ESP_GATT_INVALID_OFFSET) {   <span class="comment">// We have reached the end of the entries.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span> (status != ESP_GATT_OK) {   <span class="comment">// If we got an error, end.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            ESP_LOGE(LOG_TAG, <span class="stringliteral">&quot;esp_ble_gattc_get_all_char: %s&quot;</span>, <a class="code" href="class_b_l_e_utils.html#a2c8470728e8005da46dc32786be63018">BLEUtils::gattStatusToString</a>(status).c_str());</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> (count == 0) {   <span class="comment">// If we failed to get any new records, end.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Found a characteristic: Handle: %d, UUID: %s&quot;</span>, <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.char_handle, <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.uuid).<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// We now have a new characteristic ... let us add that to our set of known characteristics</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <a class="code" href="class_b_l_e_remote_characteristic.html">BLERemoteCharacteristic</a> *pNewRemoteCharacteristic = <span class="keyword">new</span> <a class="code" href="class_b_l_e_remote_service.html#a8bf188268394efde920eaa32e556bdca">BLERemoteCharacteristic</a>(</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.char_handle,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.uuid),</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.properties,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keyword">this</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        );</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        m_characteristicMap.insert(std::pair&lt;std::string, BLERemoteCharacteristic*&gt;(pNewRemoteCharacteristic-&gt;getUUID().toString(), pNewRemoteCharacteristic));</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        m_characteristicMapByHandle.insert(std::pair&lt;uint16_t, BLERemoteCharacteristic*&gt;(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>.char_handle, pNewRemoteCharacteristic));</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        offset++;   <span class="comment">// Increment our count of number of descriptors found.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    } <span class="comment">// Loop forever (until we break inside the loop).</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    m_haveCharacteristics = <span class="keyword">true</span>; <span class="comment">// Remember that we have received the characteristics.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; getCharacteristics()&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;} <span class="comment">// getCharacteristics</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a82bc96c1167c717a8a886488175de047">  220</a></span>&#160;std::map&lt;std::string, BLERemoteCharacteristic*&gt;* <a class="code" href="class_b_l_e_remote_service.html#a82bc96c1167c717a8a886488175de047">BLERemoteService::getCharacteristics</a>() {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; getCharacteristics() for service: %s&quot;</span>, <a class="code" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">getUUID</a>().<a class="code" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">toString</a>().c_str());</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// If is possible that we have not read the characteristics associated with the service so do that</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// now.  The request to retrieve the characteristics by calling &quot;retrieveCharacteristics&quot; is a blocking</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// call and does not return until all the characteristics are available.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (!m_haveCharacteristics) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        retrieveCharacteristics();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; getCharacteristics() for service: %s&quot;</span>, <a class="code" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">getUUID</a>().<a class="code" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">toString</a>().c_str());</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">return</span> &amp;m_characteristicMap;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;} <span class="comment">// getCharacteristics</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a882d12060c056cb23ba80a19e9645f8c">  235</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_remote_service.html#a82bc96c1167c717a8a886488175de047">BLERemoteService::getCharacteristics</a>(std::map&lt;uint16_t, BLERemoteCharacteristic*&gt;* pCharacteristicMap) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wunused-but-set-parameter&quot;</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    pCharacteristicMap = &amp;m_characteristicMapByHandle;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}  <span class="comment">// Get the characteristics map.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a4a05b11fa74971db7966639a4423a365">  244</a></span>&#160;<a class="code" href="class_b_l_e_client.html">BLEClient</a>* <a class="code" href="class_b_l_e_remote_service.html#a4a05b11fa74971db7966639a4423a365">BLERemoteService::getClient</a>() {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> m_pClient;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;} <span class="comment">// getClient</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;uint16_t BLERemoteService::getEndHandle() {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> m_endHandle;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;} <span class="comment">// getEndHandle</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;esp_gatt_id_t* BLERemoteService::getSrvcId() {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">return</span> &amp;m_srvcId;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;} <span class="comment">// getSrvcId</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;uint16_t BLERemoteService::getStartHandle() {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span> m_startHandle;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;} <span class="comment">// getStartHandle</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a1886999790343b99709b33230e7c4d90">  264</a></span>&#160;uint16_t <a class="code" href="class_b_l_e_remote_service.html#a1886999790343b99709b33230e7c4d90">BLERemoteService::getHandle</a>() {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; getHandle: service: %s&quot;</span>, <a class="code" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">getUUID</a>().<a class="code" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">toString</a>().c_str());</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; getHandle: %d 0x%.2x&quot;</span>, getStartHandle(), getStartHandle());</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">return</span> getStartHandle();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;} <span class="comment">// getHandle</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">  271</a></span>&#160;<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> <a class="code" href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">BLERemoteService::getUUID</a>() {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> m_uuid;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#add878c364789adf89d6c1d6a3104df2a">  278</a></span>&#160;<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_b_l_e_remote_service.html#add878c364789adf89d6c1d6a3104df2a">BLERemoteService::getValue</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> characteristicUuid) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; readValue: uuid: %s&quot;</span>, characteristicUuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> ret =  <a class="code" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">getCharacteristic</a>(characteristicUuid)-&gt;<a class="code" href="class_b_l_e_remote_characteristic.html#a67b0993e84a032ef1f4dd0601e6a4628">readValue</a>();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; readValue&quot;</span>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;} <span class="comment">// readValue</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordtype">void</span> BLERemoteService::removeCharacteristics() {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;myPair : m_characteristicMap) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;       <span class="keyword">delete</span> myPair.second;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;       <span class="comment">//m_characteristicMap.erase(myPair.first);  // Should be no need to delete as it will be deleted by the clear</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    m_characteristicMap.clear();   <span class="comment">// Clear the map</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;myPair : m_characteristicMapByHandle) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;       <span class="keyword">delete</span> myPair.second;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    m_characteristicMapByHandle.clear();   <span class="comment">// Clear the map</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;} <span class="comment">// removeCharacteristics</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a2fab2636663276e5ff45653c02cdb90f">  313</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_b_l_e_remote_service.html#a2fab2636663276e5ff45653c02cdb90f">BLERemoteService::setValue</a>(<a class="code" href="class_b_l_e_u_u_i_d.html">BLEUUID</a> characteristicUuid, <a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&gt;&gt; setValue: uuid: %s&quot;</span>, characteristicUuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>().c_str());</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">getCharacteristic</a>(characteristicUuid)-&gt;<a class="code" href="class_b_l_e_remote_characteristic.html#aecd512f950b6a0151941d139d78b19aa">writeValue</a>(<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;&lt;&lt; setValue&quot;</span>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;} <span class="comment">// setValue</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">  324</a></span>&#160;<a class="code" href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">std::string</a> <a class="code" href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">BLERemoteService::toString</a>() {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    std::ostringstream ss;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;Service: uuid: &quot;</span> + m_uuid.<a class="code" href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">toString</a>();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;, start_handle: &quot;</span> &lt;&lt; std::dec &lt;&lt; m_startHandle &lt;&lt; <span class="stringliteral">&quot; 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; m_startHandle &lt;&lt;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="stringliteral">&quot;, end_handle: &quot;</span> &lt;&lt; std::dec &lt;&lt; m_endHandle &lt;&lt; <span class="stringliteral">&quot; 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; m_endHandle;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;myPair : m_characteristicMap) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        ss &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; myPair.second-&gt;toString();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;       <span class="comment">// myPair.second is the value</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">return</span> ss.str();</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;} <span class="comment">// toString</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CONFIG_BT_ENABLED */</span><span class="preprocessor"></span></div><div class="ttc" id="class_b_l_e_u_u_i_d_html"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html">BLEUUID</a></div><div class="ttdoc">A model of a BLE UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8h_source.html#l00018">BLEUUID.h:18</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a9c4613d0577c830c245797528dca992d"><div class="ttname"><a href="class_b_l_e_remote_service.html#a9c4613d0577c830c245797528dca992d">BLERemoteService::getUUID</a></div><div class="ttdeci">BLEUUID getUUID(void)</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00271">BLERemoteService.cpp:271</a></div></div>
<div class="ttc" id="_general_utils_8h_html"><div class="ttname"><a href="_general_utils_8h.html">GeneralUtils.h</a></div></div>
<div class="ttc" id="_b_l_e_utils_8h_html"><div class="ttname"><a href="_b_l_e_utils_8h.html">BLEUtils.h</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a6bb7997d3490efa1ef669fc900a9b536"><div class="ttname"><a href="class_b_l_e_remote_service.html#a6bb7997d3490efa1ef669fc900a9b536">BLERemoteService::toString</a></div><div class="ttdeci">std::string toString(void)</div><div class="ttdoc">Create a string representation of this remote service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00324">BLERemoteService.cpp:324</a></div></div>
<div class="ttc" id="connect-to_8d_html_a450c41f520f7661f0a48b8fd2597a74c"><div class="ttname"><a href="connect-to_8d.html#a450c41f520f7661f0a48b8fd2597a74c">string</a></div><div class="ttdeci">Long connect to e.g.at a specific cluster node in a cluster of servers.This option is only used to establish the network connection.It does NOT affect the hostname port that is used for TLS meaning any host port.HOST2 and PORT2 may also be the empty string</div><div class="ttdef"><b>Definition:</b> <a href="connect-to_8d_source.html#l00014">connect-to.d:14</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a1886999790343b99709b33230e7c4d90"><div class="ttname"><a href="class_b_l_e_remote_service.html#a1886999790343b99709b33230e7c4d90">BLERemoteService::getHandle</a></div><div class="ttdeci">uint16_t getHandle()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00264">BLERemoteService.cpp:264</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a82bc96c1167c717a8a886488175de047"><div class="ttname"><a href="class_b_l_e_remote_service.html#a82bc96c1167c717a8a886488175de047">BLERemoteService::getCharacteristics</a></div><div class="ttdeci">std::map&lt; std::string, BLERemoteCharacteristic * &gt; * getCharacteristics()</div><div class="ttdoc">Retrieve a map of all the characteristics of this service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00220">BLERemoteService.cpp:220</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_afa7ce75f76f9c905eef0593449854ce1"><div class="ttname"><a href="class_b_l_e_remote_service.html#afa7ce75f76f9c905eef0593449854ce1">BLERemoteService::getCharacteristic</a></div><div class="ttdeci">BLERemoteCharacteristic * getCharacteristic(const char *uuid)</div><div class="ttdoc">Get the remote characteristic object for the characteristic UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00128">BLERemoteService.cpp:128</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a4a05b11fa74971db7966639a4423a365"><div class="ttname"><a href="class_b_l_e_remote_service.html#a4a05b11fa74971db7966639a4423a365">BLERemoteService::getClient</a></div><div class="ttdeci">BLEClient * getClient(void)</div><div class="ttdoc">Get the client associated with this service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00244">BLERemoteService.cpp:244</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_abc3db77c0ad684a64e3ca5c850242bac"><div class="ttname"><a href="class_b_l_e_remote_service.html#abc3db77c0ad684a64e3ca5c850242bac">BLERemoteService::~BLERemoteService</a></div><div class="ttdeci">virtual ~BLERemoteService()</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00041">BLERemoteService.cpp:41</a></div></div>
<div class="ttc" id="class_b_l_e_remote_characteristic_html_aecd512f950b6a0151941d139d78b19aa"><div class="ttname"><a href="class_b_l_e_remote_characteristic.html#aecd512f950b6a0151941d139d78b19aa">BLERemoteCharacteristic::writeValue</a></div><div class="ttdeci">void writeValue(uint8_t *data, size_t length, bool response=false)</div><div class="ttdoc">Write the new value for the characteristic from a data buffer. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_characteristic_8cpp_source.html#l00546">BLERemoteCharacteristic.cpp:546</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a8bf188268394efde920eaa32e556bdca"><div class="ttname"><a href="class_b_l_e_remote_service.html#a8bf188268394efde920eaa32e556bdca">BLERemoteService::BLERemoteCharacteristic</a></div><div class="ttdeci">friend class BLERemoteCharacteristic</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8h_source.html#l00052">BLERemoteService.h:52</a></div></div>
<div class="ttc" id="class_b_l_e_utils_html_a2c8470728e8005da46dc32786be63018"><div class="ttname"><a href="class_b_l_e_utils.html#a2c8470728e8005da46dc32786be63018">BLEUtils::gattStatusToString</a></div><div class="ttdeci">static std::string gattStatusToString(esp_gatt_status_t status)</div><div class="ttdoc">Convert a GATT status to a string. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_utils_8cpp_source.html#l01893">BLEUtils.cpp:1893</a></div></div>
<div class="ttc" id="class_b_l_e_client_html"><div class="ttname"><a href="class_b_l_e_client.html">BLEClient</a></div><div class="ttdoc">A model of a BLE client. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_client_8h_source.html#l00031">BLEClient.h:31</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_a2fab2636663276e5ff45653c02cdb90f"><div class="ttname"><a href="class_b_l_e_remote_service.html#a2fab2636663276e5ff45653c02cdb90f">BLERemoteService::setValue</a></div><div class="ttdeci">void setValue(BLEUUID characteristicUuid, std::string value)</div><div class="ttdoc">Set the value of a characteristic. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00313">BLERemoteService.cpp:313</a></div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="class_b_l_e_remote_service_html_add878c364789adf89d6c1d6a3104df2a"><div class="ttname"><a href="class_b_l_e_remote_service.html#add878c364789adf89d6c1d6a3104df2a">BLERemoteService::getValue</a></div><div class="ttdeci">std::string getValue(BLEUUID characteristicUuid)</div><div class="ttdoc">Read the value of a characteristic associated with this service. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_service_8cpp_source.html#l00278">BLERemoteService.cpp:278</a></div></div>
<div class="ttc" id="_b_l_e_remote_service_8h_html"><div class="ttname"><a href="_b_l_e_remote_service_8h.html">BLERemoteService.h</a></div></div>
<div class="ttc" id="class_b_l_e_u_u_i_d_html_a52e30a254e1ff10a429c2e0a36a6131d"><div class="ttname"><a href="class_b_l_e_u_u_i_d.html#a52e30a254e1ff10a429c2e0a36a6131d">BLEUUID::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdoc">Get a string representation of the UUID. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_u_u_i_d_8cpp_source.html#l00355">BLEUUID.cpp:355</a></div></div>
<div class="ttc" id="class_b_l_e_remote_characteristic_html"><div class="ttname"><a href="class_b_l_e_remote_characteristic.html">BLERemoteCharacteristic</a></div><div class="ttdoc">A model of a remote BLE characteristic. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_characteristic_8h_source.html#l00029">BLERemoteCharacteristic.h:29</a></div></div>
<div class="ttc" id="class_b_l_e_remote_characteristic_html_a67b0993e84a032ef1f4dd0601e6a4628"><div class="ttname"><a href="class_b_l_e_remote_characteristic.html#a67b0993e84a032ef1f4dd0601e6a4628">BLERemoteCharacteristic::readValue</a></div><div class="ttdeci">std::string readValue()</div><div class="ttdoc">Read the value of the remote characteristic. </div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_remote_characteristic_8cpp_source.html#l00401">BLERemoteCharacteristic.cpp:401</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_b_l_e_remote_service_8cpp.html">BLERemoteService.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
