<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/tests/server/sws.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sws_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sws.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sws_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__setup_8h.html">server_setup.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/* sws.c: simple (silly?) web server</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">   This code was originally graciously donated to the project by Juergen</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   Wilke. Thanks a bunch!</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#ifdef HAVE_SIGNAL_H</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN_H</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_IN6_H</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;netinet/in6.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#ifdef HAVE_ARPA_INET_H</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#ifdef HAVE_NETINET_TCP_H</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;netinet/tcp.h&gt;</span> <span class="comment">/* for TCP_NODELAY */</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="sws_8c.html#a4858ee8b549f158fb5eb37dc7dad537e">   50</a></span>&#160;<span class="preprocessor">#define ENABLE_CURLX_PRINTF</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/* make the curlx header define all printf() functions to use the curlx_*</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">   versions instead */</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curlx_8h.html">curlx.h</a>&quot;</span> <span class="comment">/* from the private lib dir */</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="getpart_8h.html">getpart.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__pton_8h.html">inet_pton.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__sockaddr_8h.html">server_sockaddr.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/* include memdebug.h last */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#ifdef USE_WINSOCK</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#undef  EINTR</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#define EINTR    4 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#undef  EAGAIN</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#define EAGAIN  11 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#undef  ERANGE</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#define ERANGE  34 </span><span class="comment">/* errno.h value */</span><span class="preprocessor"></span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> {</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="sws_8c.html#ac9420823bfeba78fce625fc105e3b01da4d055a12ec2d2e6282ae3c6008dd970b">   72</a></span>&#160;  <a class="code" href="sws_8c.html#ac9420823bfeba78fce625fc105e3b01da4d055a12ec2d2e6282ae3c6008dd970b">socket_domain_inet</a> = AF_INET</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  , socket_domain_inet6 = AF_INET6</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  , socket_domain_unix = AF_UNIX</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;} socket_domain = AF_INET;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> use_gopher = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> serverlogslocked = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> is_proxy = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">   84</a></span>&#160;<span class="preprocessor">#define REQBUFSIZ 150000</span></div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="sws_8c.html#af9aef77e09101f1d35766c1adc962e98">   85</a></span>&#160;<span class="preprocessor">#define REQBUFSIZ_TXT &quot;149999&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">static</span> <span class="keywordtype">long</span> prevtestno = -1;    <span class="comment">/* previous test number we served */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">static</span> <span class="keywordtype">long</span> prevpartno = -1;    <span class="comment">/* previous part number we served */</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> prevbounce = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* instructs the server to increase the part</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">                                   number for a test in case the identical</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">                                   testno+partno request shows up again */</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="sws_8c.html#a865bb81bb1dff4a12dae46642759138b">   93</a></span>&#160;<span class="preprocessor">#define RCMD_NORMALREQ 0 </span><span class="comment">/* default request, use the tests file normally */</span><span class="preprocessor"></span></div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="sws_8c.html#a2aa5f996860068a5651be03dfc12c98e">   94</a></span>&#160;<span class="preprocessor">#define RCMD_IDLE      1 </span><span class="comment">/* told to sit idle */</span><span class="preprocessor"></span></div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="sws_8c.html#a9fedc81bea3ea0591b4be172e4a18382">   95</a></span>&#160;<span class="preprocessor">#define RCMD_STREAM    2 </span><span class="comment">/* told to stream */</span><span class="preprocessor"></span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">struct </span><a class="code" href="structhttprequest.html">httprequest</a> {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>[<a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>]; <span class="comment">/* buffer area for the incoming request */</span></div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">   99</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a>; <span class="comment">/* if a CONNECT */</span></div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">  100</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a>; <span class="comment">/* the port number CONNECT used */</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a>; <span class="comment">/* where to start checking of the request */</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>;     <span class="comment">/* size of the incoming request */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">long</span> <a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>;       <span class="comment">/* test number found in the request */</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">long</span> <a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>;       <span class="comment">/* part number found in the request */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a>;      <span class="comment">/* keep connection open info, as found in the request */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">auth_req</a>;  <span class="comment">/* authentication required, don&#39;t wait for body unless</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">                     there&#39;s an Authorization header */</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">auth</a>;      <span class="comment">/* Authorization header present in the incoming request */</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a>;      <span class="comment">/* Content-Length of the incoming request */</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a68cb27c4ca497c45f27138a1e737800d">digest</a>;    <span class="comment">/* Authorization digest header found */</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a>;      <span class="comment">/* Authorization ntlm header found */</span></div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">  112</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a>; <span class="comment">/* if non-zero, delay this number of seconds between</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">                     writes in the response */</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>;       <span class="comment">/* if non-zero, expect this many requests to do a &quot;piped&quot;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">                     request/response */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a>;       <span class="comment">/* if non-zero, the server is instructed to not read this</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">                     many bytes from a PUT/POST request. Ie the client sends N</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">                     bytes said in Content-Length, but the server only reads N</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">                     - skip bytes. */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">rcmd</a>;       <span class="comment">/* doing a special command, see defines above */</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">prot_version</a>;  <span class="comment">/* HTTP version * 10 */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a>;   <span class="comment">/* true if request is pipelined */</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">  123</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">callcount</a>;  <span class="comment">/* times ProcessRequest() gets called */</span></div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">  124</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">connmon</a>;   <span class="comment">/* monitor the state of the connection, log disconnects */</span></div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">  125</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">upgrade</a>;   <span class="comment">/* test case allows upgrade to http2 */</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">  126</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">upgrade_request</a>; <span class="comment">/* upgrade request found and allowed */</span></div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">  127</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">close</a>;     <span class="comment">/* similar to swsclose in response: close connection after</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">                     response is sent */</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">  129</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;};</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="sws_8c.html#ab54cda52ee639aa3c47cfa330904e776">  132</a></span>&#160;<span class="preprocessor">#define MAX_SOCKETS 1024</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> all_sockets[<a class="code" href="sws_8c.html#ab54cda52ee639aa3c47cfa330904e776">MAX_SOCKETS</a>];</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> num_sockets = 0;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ProcessRequest(<span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> storerequest(<span class="keyword">const</span> <span class="keywordtype">char</span> *reqbuf, <span class="keywordtype">size_t</span> totalsize);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="sws_8c.html#a16b710f592bf8f7900666392adc444dc">  140</a></span>&#160;<span class="preprocessor">#define DEFAULT_PORT 8999</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#ifndef DEFAULT_LOGFILE</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="sws_8c.html#a4d68235dfa433dea9c42f14784f80f6a">  143</a></span>&#160;<span class="preprocessor">#define DEFAULT_LOGFILE &quot;log/sws.log&quot;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="sws_8c.html#a97a20211ff266e7b4180dd6c49c06eed">  146</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="sws_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = <a class="code" href="sws_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="sws_8c.html#a69158a2c34c2d0206517e1db48794d46">  148</a></span>&#160;<span class="preprocessor">#define SWSVERSION &quot;curl test suite HTTP server/0.1&quot;</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="sws_8c.html#a8f2abe1d4a220962be19a09283940e55">  150</a></span>&#160;<span class="preprocessor">#define REQUEST_DUMP  &quot;log/server.input&quot;</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="sws_8c.html#a49b1e4513f79dc7f48f8a4632808e1ce">  151</a></span>&#160;<span class="preprocessor">#define RESPONSE_DUMP &quot;log/server.response&quot;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/* when told to run as proxy, we store the logs in different files so that</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">   they can co-exist with the same program running as a &quot;server&quot; */</span></div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="sws_8c.html#a138025e9d2f5640254e627174b3f4c5a">  155</a></span>&#160;<span class="preprocessor">#define REQUEST_PROXY_DUMP  &quot;log/proxy.input&quot;</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="sws_8c.html#a15ea8c6ddfb1cc36ee45cfa7aa2acb72">  156</a></span>&#160;<span class="preprocessor">#define RESPONSE_PROXY_DUMP &quot;log/proxy.response&quot;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">/* very-big-path support */</span></div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="sws_8c.html#a78dc3db0719361b1f970f9e944180f01">  159</a></span>&#160;<span class="preprocessor">#define MAXDOCNAMELEN 140000</span></div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="sws_8c.html#a6bb1ed9df56d0ca048d0d324960e8275">  160</a></span>&#160;<span class="preprocessor">#define MAXDOCNAMELEN_TXT &quot;139999&quot;</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="sws_8c.html#af339bf71a92deed94f3bd9ba013824f2">  162</a></span>&#160;<span class="preprocessor">#define REQUEST_KEYWORD_SIZE 256</span></div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="sws_8c.html#a62244eaa0906d8fc0899b402ef5f30c3">  163</a></span>&#160;<span class="preprocessor">#define REQUEST_KEYWORD_SIZE_TXT &quot;255&quot;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="sws_8c.html#a2bc6ab9482576c6b7c8305d6a4a01d8e">  165</a></span>&#160;<span class="preprocessor">#define CMD_AUTH_REQUIRED &quot;auth_required&quot;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">/* &#39;idle&#39; means that it will accept the request fine but never respond</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">   any data. Just keep the connection alive. */</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="sws_8c.html#a433697a25587c6ffe8a14f02e5be9066">  169</a></span>&#160;<span class="preprocessor">#define CMD_IDLE &quot;idle&quot;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">/* &#39;stream&#39; means to send a never-ending stream of data */</span></div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="sws_8c.html#a4cea6319ddbc62debdc8315eb4549df5">  172</a></span>&#160;<span class="preprocessor">#define CMD_STREAM &quot;stream&quot;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">/* &#39;connection-monitor&#39; will output when a server/proxy connection gets</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">   disconnected as for some cases it is important that it gets done at the</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">   proper point - like with NTLM */</span></div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="sws_8c.html#afe88de1a053104bb8099bc5cd891781d">  177</a></span>&#160;<span class="preprocessor">#define CMD_CONNECTIONMONITOR &quot;connection-monitor&quot;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">/* upgrade to http2 */</span></div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="sws_8c.html#a4fe5fe775dbb31c3e46c2a29c46b49c1">  180</a></span>&#160;<span class="preprocessor">#define CMD_UPGRADE &quot;upgrade&quot;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/* close connection */</span></div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="sws_8c.html#a8814470e1da1725bef5b432e97413240">  183</a></span>&#160;<span class="preprocessor">#define CMD_SWSCLOSE &quot;swsclose&quot;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="sws_8c.html#abe70b4bde2491e4a4cd405d121383d5f">  185</a></span>&#160;<span class="preprocessor">#define END_OF_HEADERS &quot;\r\n\r\n&quot;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">enum</span> {</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">  188</a></span>&#160;  <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a> = -4,</div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">  189</a></span>&#160;  <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">DOCNUMBER_QUIT</a>    = -3,</div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">  190</a></span>&#160;  <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">DOCNUMBER_WERULEZ</a> = -2,</div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216">  191</a></span>&#160;  <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216">DOCNUMBER_404</a>     = -1</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;};</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *end_of_headers = <a class="code" href="sws_8c.html#abe70b4bde2491e4a4cd405d121383d5f">END_OF_HEADERS</a>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">/* sent as reply to a QUIT */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *docquit =</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">&quot;HTTP/1.1 200 Goodbye&quot;</span> <a class="code" href="sws_8c.html#abe70b4bde2491e4a4cd405d121383d5f">END_OF_HEADERS</a>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">/* send back this on 404 file not found */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *doc404 = <span class="stringliteral">&quot;HTTP/1.1 404 Not Found\r\n&quot;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="stringliteral">&quot;Server: &quot;</span> <a class="code" href="sws_8c.html#a69158a2c34c2d0206517e1db48794d46">SWSVERSION</a> <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="stringliteral">&quot;Connection: close\r\n&quot;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="stringliteral">&quot;Content-Type: text/html&quot;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="sws_8c.html#abe70b4bde2491e4a4cd405d121383d5f">END_OF_HEADERS</a></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="stringliteral">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//IETF//DTD HTML 2.0//EN\&quot;&gt;\n&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="stringliteral">&quot;&lt;HTML&gt;&lt;HEAD&gt;\n&quot;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="stringliteral">&quot;&lt;TITLE&gt;404 Not Found&lt;/TITLE&gt;\n&quot;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="stringliteral">&quot;&lt;/HEAD&gt;&lt;BODY&gt;\n&quot;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="stringliteral">&quot;&lt;H1&gt;Not Found&lt;/H1&gt;\n&quot;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="stringliteral">&quot;The requested URL was not found on this server.\n&quot;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="stringliteral">&quot;&lt;P&gt;&lt;HR&gt;&lt;ADDRESS&gt;&quot;</span> <a class="code" href="sws_8c.html#a69158a2c34c2d0206517e1db48794d46">SWSVERSION</a> <span class="stringliteral">&quot;&lt;/ADDRESS&gt;\n&quot;</span> <span class="stringliteral">&quot;&lt;/BODY&gt;&lt;/HTML&gt;\n&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/* do-nothing macro replacement for systems which lack siginterrupt() */</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">#ifndef HAVE_SIGINTERRUPT</span></div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="sws_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">  217</a></span>&#160;<span class="preprocessor">#define siginterrupt(x,y) do {} while(0)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">/* vars used to keep around previous signal handlers */</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">  222</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> (*<a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a>)(int);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sighup_handler  = SIG_ERR;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigpipe_handler = SIG_ERR;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigalrm_handler = SIG_ERR;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigint_handler  = SIG_ERR;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigterm_handler = SIG_ERR;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> <a class="code" href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a> old_sigbreak_handler = SIG_ERR;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">/* var which if set indicates that the program should finish execution */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">  250</a></span>&#160;<a class="code" href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a> <a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 0;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">/* if next is set indicates the first signal handled in exit_signal_handler */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> exit_signal = 0;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">/* signal handler that will be triggered to indicate that the program</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  should finish its execution in a controlled manner as soon as possible.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  The first time this is called it will set got_exit_signal to one and</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  store in exit_signal the signal that triggered its execution. */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keyword">static</span> <a class="code" href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> exit_signal_handler(<span class="keywordtype">int</span> signum)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">int</span> old_errno = errno;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> == 0) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a> = 1;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    exit_signal = signum;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  (void)signal(signum, exit_signal_handler);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  errno = old_errno;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> install_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">/* ignore SIGHUP signal */</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  old_sighup_handler = signal(SIGHUP, SIG_IGN);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span>(old_sighup_handler == SIG_ERR)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGHUP handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">/* ignore SIGPIPE signal */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  old_sigpipe_handler = signal(SIGPIPE, SIG_IGN);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span>(old_sigpipe_handler == SIG_ERR)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGPIPE handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">/* ignore SIGALRM signal */</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  old_sigalrm_handler = signal(SIGALRM, SIG_IGN);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">if</span>(old_sigalrm_handler == SIG_ERR)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGALRM handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">/* handle SIGINT signal with our exit_signal_handler */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  old_sigint_handler = signal(SIGINT, exit_signal_handler);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">if</span>(old_sigint_handler == SIG_ERR)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGINT handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="sws_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGINT, 1);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">/* handle SIGTERM signal with our exit_signal_handler */</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  old_sigterm_handler = signal(SIGTERM, exit_signal_handler);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">if</span>(old_sigterm_handler == SIG_ERR)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGTERM handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="sws_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGTERM, 1);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">/* handle SIGBREAK signal with our exit_signal_handler */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  old_sigbreak_handler = signal(SIGBREAK, exit_signal_handler);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span>(old_sigbreak_handler == SIG_ERR)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;cannot install SIGBREAK handler: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="sws_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a>(SIGBREAK, 1);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> restore_signal_handlers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;{</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">#ifdef SIGHUP</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sighup_handler)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    (void)signal(SIGHUP, old_sighup_handler);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#ifdef SIGPIPE</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigpipe_handler)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    (void)signal(SIGPIPE, old_sigpipe_handler);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#ifdef SIGALRM</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigalrm_handler)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    (void)signal(SIGALRM, old_sigalrm_handler);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">#ifdef SIGINT</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigint_handler)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    (void)signal(SIGINT, old_sigint_handler);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#ifdef SIGTERM</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigterm_handler)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    (void)signal(SIGTERM, old_sigterm_handler);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#if defined(SIGBREAK) &amp;&amp; defined(WIN32)</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span>(SIG_ERR != old_sigbreak_handler)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    (void)signal(SIGBREAK, old_sigbreak_handler);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">/* returns true if the current socket is an IP one */</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> socket_domain_is_ip(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">switch</span>(socket_domain) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">/* case AF_UNIX: */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/* based on the testno, parse the correct server commands */</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> parse_servercmd(<span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;{</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <a class="code" href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">FILE</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = <a class="code" href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">close</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = fopen(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    error = errno;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  [1] Error opening file: %s&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  Couldn&#39;t open test file %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* closes connection */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordtype">char</span> *orgcmd = NULL;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">char</span> *cmd = NULL;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordtype">size_t</span> cmdsize = 0;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordtype">int</span> num = 0;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">/* get the custom server control &quot;commands&quot; */</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    error = <a class="code" href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a>(&amp;orgcmd, &amp;cmdsize, <span class="stringliteral">&quot;reply&quot;</span>, <span class="stringliteral">&quot;servercmd&quot;</span>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    fclose(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getpart() failed with error: %d&quot;</span>, error);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* closes connection */</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">connmon</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    cmd = orgcmd;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">while</span>(cmd &amp;&amp; cmdsize) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordtype">char</span> *check;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#a2bc6ab9482576c6b7c8305d6a4a01d8e">CMD_AUTH_REQUIRED</a>, cmd, strlen(<a class="code" href="sws_8c.html#a2bc6ab9482576c6b7c8305d6a4a01d8e">CMD_AUTH_REQUIRED</a>))) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to require authorization header&quot;</span>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">auth_req</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#a433697a25587c6ffe8a14f02e5be9066">CMD_IDLE</a>, cmd, strlen(<a class="code" href="sws_8c.html#a433697a25587c6ffe8a14f02e5be9066">CMD_IDLE</a>))) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to idle&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">rcmd</a> = <a class="code" href="sws_8c.html#a2aa5f996860068a5651be03dfc12c98e">RCMD_IDLE</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#a4cea6319ddbc62debdc8315eb4549df5">CMD_STREAM</a>, cmd, strlen(<a class="code" href="sws_8c.html#a4cea6319ddbc62debdc8315eb4549df5">CMD_STREAM</a>))) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to stream&quot;</span>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">rcmd</a> = <a class="code" href="sws_8c.html#a9fedc81bea3ea0591b4be172e4a18382">RCMD_STREAM</a>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#afe88de1a053104bb8099bc5cd891781d">CMD_CONNECTIONMONITOR</a>, cmd,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                       strlen(<a class="code" href="sws_8c.html#afe88de1a053104bb8099bc5cd891781d">CMD_CONNECTIONMONITOR</a>))) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;enabled connection monitoring&quot;</span>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">connmon</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#a4fe5fe775dbb31c3e46c2a29c46b49c1">CMD_UPGRADE</a>, cmd, strlen(<a class="code" href="sws_8c.html#a4fe5fe775dbb31c3e46c2a29c46b49c1">CMD_UPGRADE</a>))) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;enabled upgrade to http2&quot;</span>);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">upgrade</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strncmp(<a class="code" href="sws_8c.html#a8814470e1da1725bef5b432e97413240">CMD_SWSCLOSE</a>, cmd, strlen(<a class="code" href="sws_8c.html#a8814470e1da1725bef5b432e97413240">CMD_SWSCLOSE</a>))) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;swsclose: close this connection after response&quot;</span>);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">close</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1 == sscanf(cmd, <span class="stringliteral">&quot;pipe: %d&quot;</span>, &amp;num)) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to allow a pipe size of %d&quot;</span>, num);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span>(num &lt; 0)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;negative pipe size ignored&quot;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(num &gt; 0)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a> = num-1; <span class="comment">/* decrease by one since we don&#39;t count the</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">                                first request in this number */</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1 == sscanf(cmd, <span class="stringliteral">&quot;skip: %d&quot;</span>, &amp;num)) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to skip this number of bytes %d&quot;</span>, num);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a> = num;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(1 == sscanf(cmd, <span class="stringliteral">&quot;writedelay: %d&quot;</span>, &amp;num)) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to delay %d secs between packets&quot;</span>, num);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a> = num;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Unknown &lt;servercmd&gt; instruction found: %s&quot;</span>, cmd);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="comment">/* try to deal with CRLF or just LF */</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      check = strchr(cmd, <span class="charliteral">&#39;\r&#39;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keywordflow">if</span>(!check)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        check = strchr(cmd, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">if</span>(check) {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">/* get to the letter following the newline */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">while</span>((*check == <span class="charliteral">&#39;\r&#39;</span>) || (*check == <span class="charliteral">&#39;\n&#39;</span>))</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          check++;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span>(!*check)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          <span class="comment">/* if we reached a zero, get out */</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        cmd = check;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(orgcmd);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">return</span> 0; <span class="comment">/* OK! */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ProcessRequest(<span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;{</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = &amp;req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>[req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a>];</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordtype">bool</span> chunked = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> request[<a class="code" href="sws_8c.html#af339bf71a92deed94f3bd9ba013824f2">REQUEST_KEYWORD_SIZE</a>];</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> doc[<a class="code" href="sws_8c.html#a78dc3db0719361b1f970f9e944180f01">MAXDOCNAMELEN</a>];</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordtype">char</span> logbuf[456];</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordtype">int</span> prot_major, prot_minor;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordtype">char</span> *end = strstr(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, end_of_headers);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">callcount</a>++;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Process %d bytes request%s&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;         req-&gt;<a class="code" href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">callcount</a> &gt; 1?<span class="stringliteral">&quot; [CONTINUED]&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">/* try to figure out the request characteristics as soon as possible, but</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">     only once! */</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">if</span>(use_gopher &amp;&amp;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;     (req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>) &amp;&amp;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;     !strncmp(<span class="stringliteral">&quot;/verifiedserver&quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, 15)) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Are-we-friendly question received&quot;</span>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">DOCNUMBER_WERULEZ</a>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>) &amp;&amp;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;     sscanf(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>,</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="stringliteral">&quot;%&quot;</span> <a class="code" href="sws_8c.html#a62244eaa0906d8fc0899b402ef5f30c3">REQUEST_KEYWORD_SIZE_TXT</a><span class="stringliteral">&quot;s %&quot;</span> <a class="code" href="sws_8c.html#a6bb1ed9df56d0ca048d0d324960e8275">MAXDOCNAMELEN_TXT</a> <span class="stringliteral">&quot;s HTTP/%d.%d&quot;</span>,</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            request,</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            doc,</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            &amp;prot_major,</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            &amp;prot_minor) == 4) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">prot_version</a> = prot_major*10 + prot_minor;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">/* find the last slash */</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strrchr(doc, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">/* get the number after it */</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span>((strlen(doc) + strlen(request)) &lt; 400)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf), <span class="stringliteral">&quot;Got request: %s %s HTTP/%d.%d&quot;</span>,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                  request, doc, prot_major, prot_minor);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf), <span class="stringliteral">&quot;Got a *HUGE* request HTTP/%d.%d&quot;</span>,</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                  prot_major, prot_minor);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">if</span>(!strncmp(<span class="stringliteral">&quot;/verifiedserver&quot;</span>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 15)) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Are-we-friendly question received&quot;</span>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">DOCNUMBER_WERULEZ</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">if</span>(!strncmp(<span class="stringliteral">&quot;/quit&quot;</span>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 5)) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Request-to-quit received&quot;</span>);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">DOCNUMBER_QUIT</a>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++; <span class="comment">/* skip the slash */</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="comment">/* skip all non-numericals following the slash */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; !<a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = strtol(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 10);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> &gt; 10000) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> % 10000;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> /= 10000;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = 0;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf), <span class="stringliteral">&quot;Requested test number %ld part %ld&quot;</span>,</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                  req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="comment">/* find and parse &lt;servercmd&gt; for this test */</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        parse_servercmd(req);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">/* didn&#39;t find any in the first scan, try alternative test case</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">         number placements */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">if</span>(sscanf(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;CONNECT %&quot;</span> <a class="code" href="sws_8c.html#a6bb1ed9df56d0ca048d0d324960e8275">MAXDOCNAMELEN_TXT</a> <span class="stringliteral">&quot;s HTTP/%d.%d&quot;</span>,</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                doc, &amp;prot_major, &amp;prot_minor) == 3) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordtype">char</span> *portp = NULL;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf),</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                  <span class="stringliteral">&quot;Received a CONNECT %s HTTP/%d.%d request&quot;</span>,</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                  doc, prot_major, prot_minor);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">prot_version</a> == 10)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* HTTP 1.0 closes connection by default */</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span>(doc[0] == <span class="charliteral">&#39;[&#39;</span>) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          <span class="keywordtype">char</span> *<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> = &amp;doc[1];</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structpart.html">part</a> = 0;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="comment">/* scan through the hexgroups and store the value of the last group</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">             in the &#39;part&#39; variable and use as test case number!! */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          <span class="keywordflow">while</span>(*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> &amp;&amp; (<a class="code" href="curl__ctype_8h.html#ac0e84c3fd48c096e0f836d1cdbe310bb">ISXDIGIT</a>(*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>) || (*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39;:&#39;</span>) || (*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> == <span class="charliteral">&#39;.&#39;</span>))) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordtype">char</span> *endp;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="structpart.html">part</a> = strtoul(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>, &amp;endp, 16);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="curl__ctype_8h.html#ac0e84c3fd48c096e0f836d1cdbe310bb">ISXDIGIT</a>(*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>))</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;              <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> = endp;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;              <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a>++;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;          }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="keywordflow">if</span>(*<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> != <span class="charliteral">&#39;]&#39;</span>)</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Invalid CONNECT IPv6 address format&quot;</span>);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*(<a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> + 1) != <span class="charliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Invalid CONNECT IPv6 port format&quot;</span>);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            portp = <a class="code" href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a> + 1;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="structpart.html">part</a>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          portp = strchr(doc, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span>(portp &amp;&amp; (*(portp + 1) != <span class="charliteral">&#39;\0&#39;</span>) &amp;&amp; <a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*(portp + 1))) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulnum = strtoul(portp + 1, NULL, 10);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="keywordflow">if</span>(!ulnum || (ulnum &gt; 65535UL))</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Invalid CONNECT port received&quot;</span>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            req-&gt;<a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a> = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(ulnum);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Port number: %d, test case number: %ld&quot;</span>,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;               req-&gt;<a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a>, req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">/* check for a Testno: header with the test case number */</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordtype">char</span> *testno = strstr(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="stringliteral">&quot;\nTestno: &quot;</span>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordflow">if</span>(testno) {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = strtol(&amp;testno[9], NULL, 10);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Found test number %d in Testno: header!&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>) {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">/* Still no test case number. Try to get the the number off the last dot</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">         instead, IE we consider the TLD to be the test number. Test 123 can</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">         then be written as &quot;example.com.123&quot;. */</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">/* find the last dot */</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strrchr(doc, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="comment">/* get the number after it */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++; <span class="comment">/* skip the dot */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = strtol(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 10);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> &gt; 10000) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> % 10000;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> /= 10000;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;found test %d in requested host name&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf),</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                  <span class="stringliteral">&quot;Requested test number %ld part %ld (from host name)&quot;</span>,</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                  req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Did not find test number in PATH&quot;</span>);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216">DOCNUMBER_404</a>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        parse_servercmd(req);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> &gt;= 3) &amp;&amp; (req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>)) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;** Unusual request. Starts with %02x %02x %02x&quot;</span>,</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;           <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[0], <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[1], <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>[2]);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">if</span>(!end) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">/* we don&#39;t have a complete request yet! */</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;request not complete yet&quot;</span>);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">return</span> 0; <span class="comment">/* not complete yet */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;- request found to be complete&quot;</span>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">if</span>(use_gopher) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">/* when using gopher we cannot check the request until the entire</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">       thing has been received */</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">/* find the last slash in the line */</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strrchr(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++; <span class="comment">/* skip the slash */</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">/* skip all non-numericals following the slash */</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; !<a class="code" href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = strtol(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, 10);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> &gt; 10000) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> % 10000;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> /= 10000;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = 0;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(logbuf, <span class="keyword">sizeof</span>(logbuf),</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                <span class="stringliteral">&quot;Requested GOPHER test number %ld part %ld&quot;</span>,</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>)</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">/* we do have a full set, advance the checkindex to after the end of the</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">       headers, for the pipelining case mostly */</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> += (end - <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>) + strlen(end_of_headers);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="comment">/* **** Persistence ****</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">   * If the request is a HTTP/1.0 one, we close the connection unconditionally</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">   * when we&#39;re done.</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">   * If the request is a HTTP/1.1 one, we MUST check for a &quot;Connection:&quot;</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">   * header that might say &quot;close&quot;. If it does, we close a connection when</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">   * this request is processed. Otherwise, we keep the connection alive for X</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">   * seconds.</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span>((req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> == 0) &amp;&amp; <a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;Content-Length:&quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, 15)) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="comment">/* If we don&#39;t ignore content-length, we read it and we read the whole</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">         request including the body before we return. If we&#39;ve been told to</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">         ignore the content-length, we will return as soon as all headers</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">         have been received */</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> + 15;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> clen = 0;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordflow">while</span>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; <a class="code" href="curl__ctype_8h.html#aad859b17f001ee9fd0b0e49a7deb27b2">ISSPACE</a>(*<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>))</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      endptr = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      errno = 0;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      clen = strtoul(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;endptr, 10);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">if</span>((<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> == endptr) || !<a class="code" href="curl__ctype_8h.html#aad859b17f001ee9fd0b0e49a7deb27b2">ISSPACE</a>(*endptr) || (ERANGE == errno)) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">/* this assumes that a zero Content-Length is valid */</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Found invalid Content-Length: (%s) in the request&quot;</span>, <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* closes connection */</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> = clen - req-&gt;<a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Found Content-Length: %lu in the request&quot;</span>, clen);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a>)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;... but will abort after %zu bytes&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a>);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a>(<span class="stringliteral">&quot;Transfer-Encoding: chunked&quot;</span>, <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>,</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                            strlen(<span class="stringliteral">&quot;Transfer-Encoding: chunked&quot;</span>))) {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">/* chunked data coming in */</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      chunked = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span>(chunked) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span>(strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;\r\n0\r\n\r\n&quot;</span>))</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">/* end of chunks reached */</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">return</span> 0; <span class="comment">/* not done */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = strchr(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>++;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  } <span class="keywordflow">while</span>(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">auth</a> &amp;&amp; strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization:&quot;</span>)) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">auth</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* Authorization: header present! */</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">auth_req</a>)</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Authorization header found, as required&quot;</span>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordflow">if</span>(strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization: Negotiate&quot;</span>)) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">/* Negotiate iterations */</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">long</span> prev_testno = -1;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">long</span> prev_partno = -1;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Negotiate: prev_testno: %d, prev_partno: %d&quot;</span>,</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            prev_testno, prev_partno);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> != prev_testno) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      prev_testno = req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      prev_partno = req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    prev_partno += 1;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = prev_partno;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#a68cb27c4ca497c45f27138a1e737800d">digest</a> &amp;&amp; strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization: Digest&quot;</span>)) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">/* If the client is passing this Digest-header, we set the part number</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">       to 1000. Not only to spice up the complexity of this, but to make</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">       Digest stuff to work in the test suite. */</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> += 1000;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a68cb27c4ca497c45f27138a1e737800d">digest</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* header found */</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Received Digest request, sending back data %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a> &amp;&amp;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;          strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization: NTLM TlRMTVNTUAAD&quot;</span>)) {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">/* If the client is passing this type-3 NTLM header */</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> += 1002;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* NTLM found */</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Received NTLM type-3, sending back data %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a>) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  Expecting %zu POSTed bytes&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a> &amp;&amp;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization: NTLM TlRMTVNTUAAB&quot;</span>)) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">/* If the client is passing this type-1 NTLM header */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> += 1001;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* NTLM found */</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Received NTLM type-1, sending back data %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>((req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> &gt;= 1000) &amp;&amp;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Authorization: Basic&quot;</span>)) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">/* If the client is passing this Basic-header and the part number is</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">       already &gt;=1000, we add 1 to the part number.  This allows simple Basic</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">       authentication negotiation to work in the test suite. */</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> += 1;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Received Basic request, sending back data %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keywordflow">if</span>(strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Connection: close&quot;</span>))</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* close connection after this request */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a> &amp;&amp;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;     req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> &amp;&amp;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;     req-&gt;<a class="code" href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">prot_version</a> &gt;= 11 &amp;&amp;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;     end &amp;&amp;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;     req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a> + req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> &gt; end + strlen(end_of_headers) &amp;&amp;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;     !req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> &amp;&amp;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;     (!strncmp(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;GET&quot;</span>, strlen(<span class="stringliteral">&quot;GET&quot;</span>)) ||</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      !strncmp(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;HEAD&quot;</span>, strlen(<span class="stringliteral">&quot;HEAD&quot;</span>)))) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">/* If we have a persistent connection, HTTP version &gt;= 1.1</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">       and GET/HEAD request, enable pipelining. */</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> = (end - req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>) + strlen(end_of_headers);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  }</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">while</span>(req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">/* scan for more header ends within this chunk */</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a> = &amp;req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>[req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a>];</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    end = strstr(<a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>, end_of_headers);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">if</span>(!end)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> += (end - <a class="code" href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a>) + strlen(end_of_headers);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>--;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">/* If authentication is required and no auth was provided, end now. This</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">     makes the server NOT wait for PUT/POST data and you can then make the</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">     test case send a rejection before any such data has been sent. Test case</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">     154 uses this.*/</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">auth_req</a> &amp;&amp; !req-&gt;<a class="code" href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">auth</a>) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Return early due to auth requested by none provided&quot;</span>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">upgrade</a> &amp;&amp; strstr(req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>, <span class="stringliteral">&quot;Upgrade:&quot;</span>)) {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">/* we allow upgrade and there was one! */</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Found Upgrade: in request and allows it&quot;</span>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">upgrade_request</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> &gt; 0) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> &lt;= req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> - (end - req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>) - strlen(end_of_headers))</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">return</span> 0; <span class="comment">/* not complete yet */</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">return</span> 1; <span class="comment">/* done */</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">/* store the entire request in a file */</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> storerequest(<span class="keyword">const</span> <span class="keywordtype">char</span> *reqbuf, <span class="keywordtype">size_t</span> totalsize)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;{</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordtype">int</span> error = 0;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">size_t</span> writeleft;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">FILE</a> *<a class="code" href="namespaceimpacket_1_1spnego.html#af2435af20421ab1fb0f5178e5f3b57a3">dump</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *dumpfile = is_proxy?<a class="code" href="sws_8c.html#a138025e9d2f5640254e627174b3f4c5a">REQUEST_PROXY_DUMP</a>:<a class="code" href="sws_8c.html#a8f2abe1d4a220962be19a09283940e55">REQUEST_DUMP</a>;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">if</span>(reqbuf == NULL)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordflow">if</span>(totalsize == 0)</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="namespaceimpacket_1_1spnego.html#af2435af20421ab1fb0f5178e5f3b57a3">dump</a> = fopen(dumpfile, <span class="stringliteral">&quot;ab&quot;</span>);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  } <span class="keywordflow">while</span>((dump == NULL) &amp;&amp; ((error = errno) == EINTR));</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">if</span>(dump == NULL) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[2] Error opening file %s error: %d %s&quot;</span>,</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;           dumpfile, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Failed to write request input &quot;</span>);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  writeleft = totalsize;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> = <a class="code" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(&amp;reqbuf[totalsize-writeleft],</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                     1, writeleft, dump);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">goto</span> storerequest_cleanup;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> &gt; 0)</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      writeleft -= <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  } <span class="keywordflow">while</span>((writeleft &gt; 0) &amp;&amp; ((error = errno) == EINTR));</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span>(writeleft == 0)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Wrote request (%zu bytes) input to %s&quot;</span>, totalsize, dumpfile);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(writeleft &gt; 0) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error writing file %s error: %d %s&quot;</span>,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;           dumpfile, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Wrote only (%zu bytes) of (%zu bytes) request input to %s&quot;</span>,</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;           totalsize-writeleft, totalsize, dumpfile);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;storerequest_cleanup:</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    res = fclose(dump);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  } <span class="keywordflow">while</span>(res &amp;&amp; ((error = errno) == EINTR));</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span>(res)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error closing file %s error: %d %s&quot;</span>,</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;           dumpfile, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;}</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> init_httprequest(<span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;{</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="comment">/* Pipelining is already set, so do not initialize it here. Only initialize</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">     checkindex and offset if pipelining is not set, since in a pipeline they</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">     need to be inherited from the previous request. */</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a>) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> = 0;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> = 0;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> = <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a>;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> = 0;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">auth_req</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">auth</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a> = 0;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a68cb27c4ca497c45f27138a1e737800d">digest</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">ntlm</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a> = 0;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a> = 0;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a> = 0;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">rcmd</a> = <a class="code" href="sws_8c.html#a865bb81bb1dff4a12dae46642759138b">RCMD_NORMALREQ</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">prot_version</a> = 0;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">callcount</a> = 0;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a> = 0;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a> = 0;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">upgrade</a> = 0;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">upgrade_request</a> = 0;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;}</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">/* returns 1 if the connection should be serviced again immediately, 0 if there</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">   is no data waiting, or &lt; 0 if it should be closed */</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> get_request(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock, <span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;{</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> = 0;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">char</span> *reqbuf = req-&gt;<a class="code" href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">reqbuf</a>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> got = 0;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordtype">int</span> overflow = 0;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">char</span> *pipereq = NULL;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordtype">size_t</span> pipereq_length = 0;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a>) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    pipereq = reqbuf + req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    pipereq_length = req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> - req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a>;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">/* Now that we&#39;ve got the pipelining info we can reset the</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">       pipelining-related vars which were skipped in init_httprequest */</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> = 0;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> = 0;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> &gt;= <a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">/* buffer is already full; do nothing */</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    overflow = 1;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">if</span>(pipereq_length &amp;&amp; pipereq) {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      memmove(reqbuf, pipereq, pipereq_length);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      got = <a class="code" href="warnless_8c.html#a4191cac6787b6271e407e6c22fe60f25">curlx_uztosz</a>(pipereq_length);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      pipereq_length = 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">skip</a>)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="comment">/* we are instructed to not read the entire thing, so we make sure to</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">           only read what we&#39;re supposed to and NOT read the enire thing the</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">           client wants to send! */</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        got = sread(sock, reqbuf + req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>, req-&gt;<a class="code" href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">cl</a>);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        got = sread(sock, reqbuf + req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>, <a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1 - req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span>(got == 0) {</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Connection closed by client&quot;</span>);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> = 1;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(got &lt; 0) {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordtype">int</span> error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a> == error || EWOULDBLOCK == error) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="comment">/* nothing to read at the moment */</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;recv() returned error: (%d) %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> = 1;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a>) {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">/* dump the request received so far to the external file */</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      reqbuf[req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      storerequest(reqbuf, req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Read %zd bytes&quot;</span>, got);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> += (size_t)got;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    reqbuf[req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a> = ProcessRequest(req);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a> &amp;&amp; req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Waiting for another piped request&quot;</span>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a> = 0;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#a86b9438f853849b779530840a546d07c">pipe</a>--;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordflow">if</span>(overflow || (req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> == <a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1 &amp;&amp; got &gt; 0)) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Request would overflow buffer, closing connection&quot;</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">/* dump request received so far to external file anyway */</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    reqbuf[<a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> = 1;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  }</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a> &gt; <a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1) {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Request buffer overflow, closing connection&quot;</span>);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="comment">/* dump request received so far to external file anyway */</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    reqbuf[<a class="code" href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a>-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> = 1;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    reqbuf[req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="comment">/* at the end of a request dump it to an external file */</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> || req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a>)</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    storerequest(reqbuf, req-&gt;<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a> ? req-&gt;<a class="code" href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">checkindex</a> : req-&gt;<a class="code" href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">offset</a>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a> ? -1 : 1;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;}</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">/* returns -1 on failure */</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> send_doc(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock, <span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;{</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordtype">size_t</span> count;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = NULL;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <a class="code" href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">FILE</a> *<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordtype">char</span> *cmd = NULL;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordtype">size_t</span> cmdsize = 0;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">FILE</a> *<a class="code" href="namespaceimpacket_1_1spnego.html#af2435af20421ab1fb0f5178e5f3b57a3">dump</a>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordtype">bool</span> persistent = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">bool</span> sendfailure = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordtype">size_t</span> responsesize;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordtype">int</span> error = 0;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *responsedump = is_proxy?<a class="code" href="sws_8c.html#a15ea8c6ddfb1cc36ee45cfa7aa2acb72">RESPONSE_PROXY_DUMP</a>:<a class="code" href="sws_8c.html#a49b1e4513f79dc7f48f8a4632808e1ce">RESPONSE_DUMP</a>;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> weare[256];</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordflow">switch</span>(req-&gt;<a class="code" href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">rcmd</a>) {</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#a865bb81bb1dff4a12dae46642759138b">RCMD_NORMALREQ</a>:</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordflow">break</span>; <span class="comment">/* continue with business as usual */</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#a9fedc81bea3ea0591b4be172e4a18382">RCMD_STREAM</a>:</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">#define STREAMTHIS &quot;a string to stream 01234567890\n&quot;</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    count = strlen(<a class="code" href="sws_8c.html#ae3ac4ff1dd05a5101d71b2317ca216d3">STREAMTHIS</a>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> = swrite(sock, <a class="code" href="sws_8c.html#ae3ac4ff1dd05a5101d71b2317ca216d3">STREAMTHIS</a>, count);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> != (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)count) {</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Stopped streaming&quot;</span>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#a2aa5f996860068a5651be03dfc12c98e">RCMD_IDLE</a>:</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">/* Do nothing. Sit idle. Pretend it rains. */</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> &lt; 0) {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordtype">size_t</span> msglen;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordtype">char</span> msgbuf[64];</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">switch</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">DOCNUMBER_QUIT</a>:</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Replying to QUIT&quot;</span>);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> = docquit;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">DOCNUMBER_WERULEZ</a>:</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="comment">/* we got a &quot;friends?&quot; question, reply back that we sure are */</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Identifying ourselves as friends&quot;</span>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(msgbuf, <span class="keyword">sizeof</span>(msgbuf), <span class="stringliteral">&quot;WE ROOLZ: %ld\r\n&quot;</span>, (<span class="keywordtype">long</span>)getpid());</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      msglen = strlen(msgbuf);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <span class="keywordflow">if</span>(use_gopher)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(weare, <span class="keyword">sizeof</span>(weare), <span class="stringliteral">&quot;%s&quot;</span>, msgbuf);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(weare, <span class="keyword">sizeof</span>(weare),</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                  <span class="stringliteral">&quot;HTTP/1.1 200 OK\r\nContent-Length: %zu\r\n\r\n%s&quot;</span>,</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                  msglen, msgbuf);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> = weare;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216">DOCNUMBER_404</a>:</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Replying to with a 404&quot;</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> = doc404;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    count = strlen(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordtype">char</span> partbuf[80];</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> = <a class="code" href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">/* select the &lt;data&gt; tag for &quot;normal&quot; requests and the &lt;connect&gt; one</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">       for CONNECT requests (within the &lt;reply&gt; section) */</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *section = req-&gt;<a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a>?<span class="stringliteral">&quot;connect&quot;</span>:<span class="stringliteral">&quot;data&quot;</span>;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>)</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(partbuf, <span class="keyword">sizeof</span>(partbuf), <span class="stringliteral">&quot;%s%ld&quot;</span>, section, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(partbuf, <span class="keyword">sizeof</span>(partbuf), <span class="stringliteral">&quot;%s&quot;</span>, section);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Send response test%ld section &lt;%s&gt;&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>, partbuf);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = fopen(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      error = errno;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  [3] Error opening file: %s&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    }</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      error = <a class="code" href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a>(&amp;<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, &amp;count, <span class="stringliteral">&quot;reply&quot;</span>, partbuf, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      fclose(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getpart() failed with error: %d&quot;</span>, error);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> = <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">/* re-open the same file again */</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a> = fopen(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>) {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      error = errno;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  [4] Error opening file: %s&quot;</span>, <a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="comment">/* get the custom server control &quot;commands&quot; */</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      error = <a class="code" href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a>(&amp;cmd, &amp;cmdsize, <span class="stringliteral">&quot;reply&quot;</span>, <span class="stringliteral">&quot;postcmd&quot;</span>, <a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      fclose(<a class="code" href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a>);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;getpart() failed with error: %d&quot;</span>, error);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">/* If the word &#39;swsclose&#39; is present anywhere in the reply chunk, the</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">     connection will be closed after the data has been sent to the requesting</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">     client... */</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">if</span>(strstr(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="stringliteral">&quot;swsclose&quot;</span>) || !count || req-&gt;<a class="code" href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">close</a>) {</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    persistent = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;connection close instruction \&quot;swsclose\&quot; found in response&quot;</span>);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  }</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordflow">if</span>(strstr(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="stringliteral">&quot;swsbounce&quot;</span>)) {</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    prevbounce = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;enable \&quot;swsbounce\&quot; in the next request&quot;</span>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  }</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    prevbounce = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <a class="code" href="namespaceimpacket_1_1spnego.html#af2435af20421ab1fb0f5178e5f3b57a3">dump</a> = fopen(responsedump, <span class="stringliteral">&quot;ab&quot;</span>);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="keywordflow">if</span>(!dump) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    error = errno;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;fopen() failed with error: %d %s&quot;</span>, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;  [5] Error opening file: %s&quot;</span>, responsedump);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  responsesize = count;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="comment">/* Ok, we send no more than N bytes at a time, just to make sure that</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">       larger chunks are split up so that the client will need to do multiple</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">       recv() calls to get it and thus we exercise that code better */</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordtype">size_t</span> num = count;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">if</span>(num &gt; 20)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      num = 20;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    retry:</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> = swrite(sock, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, num);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a> &lt; 0) {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="keywordflow">if</span>((EWOULDBLOCK == <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>) || (<a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a> == <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>)) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(10);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">goto</span> retry;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      sendfailure = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">/* write to file as well */</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <a class="code" href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 1, (<span class="keywordtype">size_t</span>)<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>, dump);</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    count -= <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> += <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a>) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordtype">int</span> quarters = req-&gt;<a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a> * 4;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Pausing %d seconds&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">writedelay</a>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keywordflow">while</span>((quarters &gt; 0) &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        quarters--;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(250);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  } <span class="keywordflow">while</span>((count &gt; 0) &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    res = fclose(dump);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  } <span class="keywordflow">while</span>(res &amp;&amp; ((error = errno) == EINTR));</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="keywordflow">if</span>(res)</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error closing file %s error: %d %s&quot;</span>,</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;           responsedump, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordflow">if</span>(sendfailure) {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Sending response failed. Only (%zu bytes) of (%zu bytes) &quot;</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;           <span class="stringliteral">&quot;were sent&quot;</span>,</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;           responsesize-count, responsesize);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  }</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Response sent (%zu bytes) and written to %s&quot;</span>,</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         responsesize, responsedump);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">if</span>(cmdsize &gt; 0) {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>[32];</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">int</span> quarters;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordtype">int</span> num;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = cmd;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">if</span>(2 == sscanf(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, <span class="stringliteral">&quot;%31s %d&quot;</span>, <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, &amp;num)) {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;wait&quot;</span>, <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>)) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Told to sleep for %d seconds&quot;</span>, num);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;          quarters = num * 4;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          <span class="keywordflow">while</span>((quarters &gt; 0) &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            quarters--;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            res = <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(250);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordflow">if</span>(res) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;              <span class="comment">/* should not happen */</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;              error = errno;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;wait_ms() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                     error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            }</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;          <span class="keywordflow">if</span>(!quarters)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Continuing after sleeping %d seconds&quot;</span>, num);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        }</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Unknown command in reply command section&quot;</span>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = strchr(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>++;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> = NULL;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    } <span class="keywordflow">while</span>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a> &amp;&amp; *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a> = use_gopher?<a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>:persistent;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  prevtestno = req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a>;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  prevpartno = req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> connect_to(<span class="keyword">const</span> <span class="keywordtype">char</span> *ipaddr, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port)</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;{</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> serveraddr;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> serverfd;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = 0;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *op_br = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *cl_br = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <span class="keywordflow">if</span>(socket_domain == AF_INET6) {</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    op_br = <span class="stringliteral">&quot;[&quot;</span>;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    cl_br = <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  }</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="keywordflow">if</span>(!ipaddr)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;about to connect to %s%s%s:%hu&quot;</span>,</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;         op_br, ipaddr, cl_br, port);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  serverfd = socket(socket_domain, SOCK_STREAM, 0);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == serverfd) {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error creating socket for server connection: (%d) %s&quot;</span>,</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="preprocessor">#ifdef TCP_NODELAY</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="keywordflow">if</span>(socket_domain_is_ip()) {</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">/* Disable the Nagle algorithm */</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> flag = 1;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">if</span>(0 != setsockopt(serverfd, IPPROTO_TCP, TCP_NODELAY,</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                       (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag)))</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; TCP_NODELAY for server connection failed&quot;</span>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  }</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">switch</span>(socket_domain) {</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>, 0, <span class="keyword">sizeof</span>(serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port = htons(port);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET, ipaddr, &amp;serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr) &lt; 1) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error inet_pton failed AF_INET conversion of &#39;%s&#39;&quot;</span>, ipaddr);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(serverfd, &amp;serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;serveraddr.sa6, 0, <span class="keyword">sizeof</span>(serveraddr.sa6));</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    serveraddr.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    serveraddr.sa6.sin6_port = htons(port);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, ipaddr, &amp;serveraddr.sa6.sin6_addr) &lt; 1) {</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error inet_pton failed AF_INET6 conversion of &#39;%s&#39;&quot;</span>, ipaddr);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(serverfd, &amp;serveraddr.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(serveraddr.sa6));</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">case</span> AF_UNIX:</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Proxying through Unix socket is not (yet?) supported.&quot;</span>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_UNIX_SOCKETS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  }</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error connecting to server port %hu: (%d) %s&quot;</span>,</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;           port, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;connected fine to %s%s%s:%hu, now tunnel&quot;</span>,</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;         op_br, ipaddr, cl_br, port);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="keywordflow">return</span> serverfd;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;}</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment"> * A CONNECT has been received, a CONNECT response has been sent.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment"> * This function needs to connect to the server, and then pass data between</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment"> * the client and the server back and forth until the connection is closed by</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment"> * either end.</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"> * When doing FTP through a CONNECT proxy, we expect that the data connection</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment"> * will be setup while the first connect is still being kept up. Therefore we</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment"> * must accept a new connection and deal with it appropriately.</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"><a class="line" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362"> 1438</a></span>&#160;<span class="preprocessor">#define data_or_ctrl(x) ((x)?&quot;DATA&quot;:&quot;CTRL&quot;)</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"><a class="line" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618"> 1440</a></span>&#160;<span class="preprocessor">#define CTRL  0</span></div><div class="line"><a name="l01441"></a><span class="lineno"><a class="line" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045"> 1441</a></span>&#160;<span class="preprocessor">#define DATA  1</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> http_connect(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> *infdp,</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                         <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> rootfd,</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">char</span> *ipaddr,</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ipport)</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;{</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> serverfd[2] = {<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>, <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>};</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> clientfd[2] = {<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>, <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>};</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> toc[2] = {0, 0}; <span class="comment">/* number of bytes to client */</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> tos[2] = {0, 0}; <span class="comment">/* number of bytes to server */</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordtype">char</span> readclient[2][256];</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <span class="keywordtype">char</span> readserver[2][256];</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keywordtype">bool</span> poll_client_rd[2] = { <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> };</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="keywordtype">bool</span> poll_server_rd[2] = { <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> };</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keywordtype">bool</span> poll_client_wr[2] = { <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> };</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  <span class="keywordtype">bool</span> poll_server_wr[2] = { <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> };</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="keywordtype">bool</span> primary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordtype">bool</span> secondary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="keywordtype">int</span> max_tunnel_idx; <span class="comment">/* CTRL or DATA */</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a>;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordtype">int</span> timeout_count = 0;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="comment">/* primary tunnel client endpoint already connected */</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  clientfd[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] = *infdp;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="comment">/* Sleep here to make sure the client reads CONNECT response&#39;s</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">     &#39;end of headers&#39; separate from the server data that follows.</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">     This is done to prevent triggering libcurl known bug #39. */</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> = 2; (<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> &gt; 0) &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a>--)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(250);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">goto</span> http_connect_cleanup;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  serverfd[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] = connect_to(ipaddr, ipport);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="keywordflow">if</span>(serverfd[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>)</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordflow">goto</span> http_connect_cleanup;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="comment">/* Primary tunnel socket endpoints are now connected. Tunnel data back and</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">     forth over the primary tunnel until client or server breaks the primary</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">     tunnel, simultaneously allowing establishment, operation and teardown of</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">     a secondary tunnel that may be used for passive FTP data connection. */</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  max_tunnel_idx = <a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  primary = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    fd_set <a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a95352e9b879226d3d33c388c03c03414">input</a>;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    fd_set <a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtimeval.html">timeval</a> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = {1, 0}; <span class="comment">/* 1000 ms */</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> maxfd = (<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a>)-1;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    FD_ZERO(&amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    FD_ZERO(&amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span>((clientfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) &amp;&amp;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;       (serverfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) &amp;&amp;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;       poll_client_rd[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] &amp;&amp; poll_client_wr[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] &amp;&amp;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;       poll_server_rd[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>] &amp;&amp; poll_server_wr[<a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>]) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <span class="comment">/* listener socket is monitored to allow client to establish</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">         secondary tunnel only when this tunnel is not established</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">         and primary one is fully operational */</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      FD_SET(rootfd, &amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      maxfd = rootfd;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="comment">/* set tunnel sockets to wait for */</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt;= max_tunnel_idx; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="comment">/* client side socket monitoring */</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="keywordflow">if</span>(poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;          <span class="comment">/* unless told not to do so, monitor readability */</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          FD_SET(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;          <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt; maxfd)</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            maxfd = clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="keywordflow">if</span>(poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;          <span class="comment">/* unless told not to do so, monitor writability</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">             if there is data ready to be sent to client */</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;          FD_SET(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;          <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt; maxfd)</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            maxfd = clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        }</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      <span class="comment">/* server side socket monitoring */</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        <span class="keywordflow">if</span>(poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;          <span class="comment">/* unless told not to do so, monitor readability */</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;          FD_SET(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;          <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt; maxfd)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            maxfd = serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="keywordflow">if</span>(poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          <span class="comment">/* unless told not to do so, monitor writability</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">             if there is data ready to be sent to server */</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;          FD_SET(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;          <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt; maxfd)</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            maxfd = serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        }</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    }</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = select((<span class="keywordtype">int</span>)maxfd + 1, &amp;<a class="code" href="structinput.html">input</a>, &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>, NULL, &amp;<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    } <span class="keywordflow">while</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0 &amp;&amp; errno == EINTR &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &gt; 0) {</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      <span class="comment">/* socket action */</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="keywordtype">bool</span> tcp_fin_wr = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      timeout_count = 0;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      <span class="comment">/* ---------------------------------------------------------- */</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="comment">/* passive mode FTP may establish a secondary tunnel */</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keywordflow">if</span>((clientfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) &amp;&amp;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;         (serverfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) &amp;&amp; FD_ISSET(rootfd, &amp;<a class="code" href="structinput.html">input</a>)) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="comment">/* a new connection on listener socket (most likely from client) */</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> datafd = accept(rootfd, NULL, NULL);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keywordflow">if</span>(datafd != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;          <span class="keyword">struct </span><a class="code" href="structhttprequest.html">httprequest</a> req2;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;          <span class="keywordtype">int</span> err = 0;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;          <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;req2, 0, <span class="keyword">sizeof</span>(req2));</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;          <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client connect DATA&quot;</span>);</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="preprocessor">#ifdef TCP_NODELAY</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;          <span class="keywordflow">if</span>(socket_domain_is_ip()) {</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            <span class="comment">/* Disable the Nagle algorithm */</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            <a class="code" href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a> flag = 1;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;            <span class="keywordflow">if</span>(0 != setsockopt(datafd, IPPROTO_TCP, TCP_NODELAY,</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                               (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag)))</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; TCP_NODELAY for client DATA connection failed&quot;</span>);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          }</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;          req2.<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          init_httprequest(&amp;req2);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;          <span class="keywordflow">while</span>(!req2.<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a>) {</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            err = get_request(datafd, &amp;req2);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            <span class="keywordflow">if</span>(err &lt; 0) {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;              <span class="comment">/* this socket must be closed, done or not */</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;          }</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;          <span class="comment">/* skip this and close the socket if err &lt; 0 */</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;          <span class="keywordflow">if</span>(err &gt;= 0) {</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            err = send_doc(datafd, &amp;req2);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            <span class="keywordflow">if</span>(!err &amp;&amp; req2.<a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a>) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;              <span class="comment">/* sleep to prevent triggering libcurl known bug #39. */</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;              <span class="keywordflow">for</span>(<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> = 2; (<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> &gt; 0) &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a>--)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(250);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;              <span class="keywordflow">if</span>(!<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                <span class="comment">/* connect to the server */</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                serverfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = connect_to(ipaddr, req2.<a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a>);</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                <span class="keywordflow">if</span>(serverfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                  <span class="comment">/* secondary tunnel established, now we have two</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">                     connections */</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                  poll_client_rd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                  poll_client_wr[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                  poll_server_rd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                  poll_server_wr[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                  max_tunnel_idx = <a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                  secondary = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                  toc[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = 0;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                  tos[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = 0;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                  clientfd[<a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>] = datafd;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                  datafd = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                }</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;              }</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            }</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          }</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;          <span class="keywordflow">if</span>(datafd != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            <span class="comment">/* secondary tunnel not established */</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            shutdown(datafd, SHUT_RDWR);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(datafd);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;          }</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        }</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      }</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <span class="comment">/* ---------------------------------------------------------- */</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="comment">/* react to tunnel endpoint readable/writable notifications */</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt;= max_tunnel_idx; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;          <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = <span class="keyword">sizeof</span>(readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) - tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &amp;&amp; FD_ISSET(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="structinput.html">input</a>)) {</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            <span class="comment">/* read from client */</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = sread(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]], <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] got %zd, STOP READING client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;              shutdown(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RD);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;              poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            }</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] READ %zd bytes from client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] READ \&quot;%s\&quot;&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>),</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                     <a class="code" href="util_8c.html#a4441845b2b00ca8025c6eac62569e5f1">data_to_hex</a>(&amp;readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]], <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>));</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;              tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            }</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = <span class="keyword">sizeof</span>(readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>])-toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &amp;&amp; FD_ISSET(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="structinput.html">input</a>)) {</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            <span class="comment">/* read from server */</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = sread(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]], <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] got %zd, STOP READING server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;              shutdown(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RD);</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;              poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            }</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] READ %zd bytes from server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] READ \&quot;%s\&quot;&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>),</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                     <a class="code" href="util_8c.html#a4441845b2b00ca8025c6eac62569e5f1">data_to_hex</a>(&amp;readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]], <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>));</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;              toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] += <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            }</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          }</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        }</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;          <span class="keywordflow">if</span>(toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; FD_ISSET(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>)) {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            <span class="comment">/* write to client */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = swrite(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] got %zd, STOP WRITING client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;              shutdown(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_WR);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;              poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;              tcp_fin_wr = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            }</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] SENT %zd bytes to client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] SENT \&quot;%s\&quot;&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>),</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                     <a class="code" href="util_8c.html#a4441845b2b00ca8025c6eac62569e5f1">data_to_hex</a>(readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>));</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;              <span class="keywordflow">if</span>(toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] - <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>)</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                memmove(&amp;readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][0], &amp;readserver[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>], toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]-<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;              toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] -= <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;          }</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        }</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;          <span class="keywordflow">if</span>(tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; FD_ISSET(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>)) {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="comment">/* write to server */</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = swrite(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] got %zd, STOP WRITING server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;              shutdown(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_WR);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;              poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;              tcp_fin_wr = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] SENT %zd bytes to server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>), <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] SENT \&quot;%s\&quot;&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>),</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                     <a class="code" href="util_8c.html#a4441845b2b00ca8025c6eac62569e5f1">data_to_hex</a>(readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>));</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;              <span class="keywordflow">if</span>(tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] - <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>)</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                memmove(&amp;readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][0], &amp;readclient[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>][<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>], tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]-<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;              tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] -= <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;          }</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        }</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      }</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="comment">/* ---------------------------------------------------------- */</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="comment">/* endpoint read/write disabling, endpoint closing and tunnel teardown */</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt;= max_tunnel_idx; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> = 2; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> &gt; 0; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a>--) {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;          <span class="comment">/* loop twice to satisfy condition interdependencies without</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">             having to await select timeout or another socket event */</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;          <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            <span class="keywordflow">if</span>(poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] DISABLED READING client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;              shutdown(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RD);</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;              poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            }</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            <span class="keywordflow">if</span>(poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !toc[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] DISABLED WRITING client&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;              shutdown(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_WR);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;              poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;              tcp_fin_wr = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;          }</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            <span class="keywordflow">if</span>(poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] DISABLED READING server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;              shutdown(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RD);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;              poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            }</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">if</span>(poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !tos[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] DISABLED WRITING server&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;              shutdown(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_WR);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;              poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;              tcp_fin_wr = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            }</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      }</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      <span class="keywordflow">if</span>(tcp_fin_wr)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <span class="comment">/* allow kernel to place FIN bit packet on the wire */</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(250);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      <span class="comment">/* socket clearing */</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt;= max_tunnel_idx; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> = 2; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a> &gt; 0; <a class="code" href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a>--) {</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;          <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;            <span class="keywordflow">if</span>(!poll_client_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_client_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] CLOSING client socket&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;              <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;              clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;              <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] ENDING&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> == <a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>)</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                  secondary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                  primary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;              }</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            }</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;          }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            <span class="keywordflow">if</span>(!poll_server_wr[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &amp;&amp; !poll_server_rd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;              <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] CLOSING server socket&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;              <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;              serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;              <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] == <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] ENDING&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> == <a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                  secondary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                  primary = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;              }</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            }</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;          }</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        }</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      }</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      <span class="comment">/* ---------------------------------------------------------- */</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      max_tunnel_idx = secondary ? <a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a> : <a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="keywordflow">if</span>(!primary)</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="comment">/* exit loop upon primary tunnel teardown */</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    } <span class="comment">/* (rc &gt; 0) */</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      timeout_count++;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">if</span>(timeout_count &gt; 5) {</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;CONNECT proxy timeout after %d idle seconds!&quot;</span>, timeout_count);</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      }</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    }</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  }</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;http_connect_cleanup:</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt;= <a class="code" href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>--) {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="keywordflow">if</span>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] CLOSING server socket (cleanup)&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      shutdown(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RDWR);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordflow">if</span>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] CLOSING client socket (cleanup)&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      shutdown(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>], SHUT_RDWR);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]);</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    }</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keywordflow">if</span>((serverfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) ||</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;       (clientfd[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>)) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;[%s] ABORTING&quot;</span>, <a class="code" href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>));</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    }</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  *infdp = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;}</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> http2(<span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req)</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;{</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  (void)req;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;switched to http2&quot;</span>);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">/* left to implement */</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;}</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">/* returns a socket handle, or 0 if there are no more waiting sockets,</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">   or &lt; 0 if there was an error */</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> accept_connection(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock)</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;{</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> msgsock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordtype">int</span> flag = 1;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#ab54cda52ee639aa3c47cfa330904e776">MAX_SOCKETS</a> == num_sockets) {</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Too many open sockets!&quot;</span>);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  }</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  msgsock = accept(sock, NULL, NULL);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> != msgsock)</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(msgsock);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  }</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == msgsock) {</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a> == error || EWOULDBLOCK == error) {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="comment">/* nothing to accept */</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;MAJOR ERROR: accept() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  }</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(msgsock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)) {</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;curlx_nonblock failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(msgsock);</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  }</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  <span class="keywordflow">if</span>(0 != setsockopt(msgsock, SOL_SOCKET, SO_KEEPALIVE,</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                     (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag))) {</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;setsockopt(SO_KEEPALIVE) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(msgsock);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">  ** As soon as this server accepts a connection from the test harness it</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">  ** must set the server logs advisor read lock to indicate that server</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">  ** logs should not be read until this lock is removed by this server.</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="keywordflow">if</span>(!serverlogslocked)</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <a class="code" href="util_8c.html#a88279b927418889863e8247e98cb5d17">set_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  serverlogslocked += 1;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client connect&quot;</span>);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  all_sockets[num_sockets] = msgsock;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  num_sockets += 1;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="preprocessor">#ifdef TCP_NODELAY</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  <span class="keywordflow">if</span>(socket_domain_is_ip()) {</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">     * Disable the Nagle algorithm to make it easier to send out a large</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">     * response in many small segments to torture the clients more.</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordflow">if</span>(0 != setsockopt(msgsock, IPPROTO_TCP, TCP_NODELAY,</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                       (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag)))</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; TCP_NODELAY failed&quot;</span>);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  }</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keywordflow">return</span> msgsock;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;}</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">/* returns 1 if the connection should be serviced again immediately, 0 if there</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">   is no data waiting, or &lt; 0 if it should be closed */</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> service_connection(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> msgsock, <span class="keyword">struct</span> <a class="code" href="structhttprequest.html">httprequest</a> *req,</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                              <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> listensock,</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">char</span> *connecthost)</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;{</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <span class="keywordflow">while</span>(!req-&gt;<a class="code" href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">done_processing</a>) {</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = get_request(msgsock, req);</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt;= 0) {</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <span class="comment">/* Nothing further to read now, possibly because the socket was closed */</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    }</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="keywordflow">if</span>(prevbounce) {</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="comment">/* bounce treatment requested */</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">if</span>((req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == prevtestno) &amp;&amp;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;       (req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a> == prevpartno)) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>++;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;BOUNCE part number to %ld&quot;</span>, req-&gt;<a class="code" href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">partno</a>);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      prevbounce = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      prevtestno = -1;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      prevpartno = -1;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    }</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  send_doc(msgsock, req);</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> &lt; 0) {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;special request received, no persistency&quot;</span>);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <span class="keywordflow">if</span>(!req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a>) {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;instructed to close connection after server-reply&quot;</span>);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">connect_request</a>) {</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="comment">/* a CONNECT request, setup and talk the tunnel */</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">if</span>(!is_proxy) {</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;received CONNECT but isn&#39;t running as proxy!&quot;</span>);</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    }</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      http_connect(&amp;msgsock, listensock, connecthost, req-&gt;<a class="code" href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">connect_port</a>);</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    }</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">upgrade_request</a>) {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="comment">/* an upgrade request, switch to http2 here */</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    http2(req);</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  }</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="comment">/* if we got a CONNECT, loop and get another request as well! */</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  <span class="keywordflow">if</span>(req-&gt;<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a>) {</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;=&gt; persistent connection request ended, awaits new request\n&quot;</span>);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;}</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"><a class="line" href="sws_8c.html#a0ddf1224851353fc92bfbff6f499fa97"> 1986</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="sws_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;{</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <a class="code" href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a> me;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sock = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="keywordtype">int</span> wrotepidfile = 0;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = <a class="code" href="sws_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a>;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *unix_socket = NULL;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  <span class="keywordtype">bool</span> unlink_socket = <span class="keyword">false</span>;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *pidname = <span class="stringliteral">&quot;.http.pid&quot;</span>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keyword">struct </span><a class="code" href="structhttprequest.html">httprequest</a> req;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = 0;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  <span class="keywordtype">int</span> error;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  <span class="keywordtype">int</span> arg = 1;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  <span class="keywordtype">long</span> pid;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *connecthost = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *socket_type = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordtype">char</span> port_str[11];</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *location_str = port_str;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="comment">/* a default CONNECT port is basically pointless but still ... */</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordtype">size_t</span> socket_idx;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;req, 0, <span class="keyword">sizeof</span>(req));</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="keywordflow">while</span>(argc&gt;arg) {</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--version&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <a class="code" href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a>(<span class="stringliteral">&quot;sws IPv4&quot;</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;#ifdef <a class="code" href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;             <span class="stringliteral">&quot;/IPv6&quot;</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;#endif</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;#ifdef <a class="code" href="config-os400_8h.html#a0905f99ed657b831de0abece48991b7d">USE_UNIX_SOCKETS</a></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;             <span class="stringliteral">&quot;/unix&quot;</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;#endif</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;          );</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--pidfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      arg++;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        pidname = argv[arg++];</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    }</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--logfile&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      arg++;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg)</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <a class="code" href="sws_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a> = argv[arg++];</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--gopher&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      arg++;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      use_gopher = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      end_of_headers = <span class="stringliteral">&quot;\r\n&quot;</span>; <span class="comment">/* gopher style is much simpler */</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    }</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv4&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      socket_type = <span class="stringliteral">&quot;IPv4&quot;</span>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      socket_domain = AF_INET;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      location_str = port_str;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      arg++;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    }</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--ipv6&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      socket_type = <span class="stringliteral">&quot;IPv6&quot;</span>;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      socket_domain = AF_INET6;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      location_str = port_str;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      arg++;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--unix-socket&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      arg++;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        unix_socket = argv[arg];</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        <span class="keywordflow">if</span>(strlen(unix_socket) &gt;= <span class="keyword">sizeof</span>(me.sau.sun_path)) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;          <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(stderr, <span class="stringliteral">&quot;sws: socket path must be shorter than %zu chars\n&quot;</span>,</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                  <span class="keyword">sizeof</span>(me.sau.sun_path));</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        socket_type = <span class="stringliteral">&quot;unix&quot;</span>;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        socket_domain = AF_UNIX;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        location_str = unix_socket;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        arg++;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      }</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    }</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--port&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      arg++;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        <span class="keywordtype">char</span> *endptr;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulnum = strtoul(argv[arg], &amp;endptr, 10);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="keywordflow">if</span>((endptr != argv[arg] + strlen(argv[arg])) ||</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;           (ulnum &lt; 1025UL) || (ulnum &gt; 65535UL)) {</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          <a class="code" href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a>(stderr, <span class="stringliteral">&quot;sws: invalid --port argument (%s)\n&quot;</span>,</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                  argv[arg]);</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        }</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        port = <a class="code" href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a>(ulnum);</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        arg++;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      }</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    }</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--srcdir&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      arg++;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <a class="code" href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a> = argv[arg];</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        arg++;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      }</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    }</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(<span class="stringliteral">&quot;--connect&quot;</span>, argv[arg])) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="comment">/* The connect host IP number that the proxy will connect to no matter</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">         what the client asks for, but also use this as a hint that we run as</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">         a proxy and do a few different internal choices */</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      arg++;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="keywordflow">if</span>(argc&gt;arg) {</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        connecthost = argv[arg];</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        arg++;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        is_proxy = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Run as proxy, CONNECT to host %s&quot;</span>, connecthost);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      }</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    }</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <a class="code" href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a>(<span class="stringliteral">&quot;Usage: sws [option]\n&quot;</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;           <span class="stringliteral">&quot; --version\n&quot;</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;           <span class="stringliteral">&quot; --logfile [file]\n&quot;</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;           <span class="stringliteral">&quot; --pidfile [file]\n&quot;</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;           <span class="stringliteral">&quot; --ipv4\n&quot;</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;           <span class="stringliteral">&quot; --ipv6\n&quot;</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;           <span class="stringliteral">&quot; --unix-socket [file]\n&quot;</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;           <span class="stringliteral">&quot; --port [port]\n&quot;</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;           <span class="stringliteral">&quot; --srcdir [path]\n&quot;</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;           <span class="stringliteral">&quot; --connect [ip4-addr]\n&quot;</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;           <span class="stringliteral">&quot; --gopher&quot;</span>);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    }</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  }</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(port_str, <span class="keyword">sizeof</span>(port_str), <span class="stringliteral">&quot;port %hu&quot;</span>, port);</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  win32_init();</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  atexit(win32_cleanup);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  install_signal_handlers();</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;  pid = (long)getpid();</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  sock = socket(socket_domain, SOCK_STREAM, 0);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  all_sockets[0] = sock;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  num_sockets = 1;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == sock) {</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error creating socket: (%d) %s&quot;</span>,</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  }</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  flag = 1;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;  <span class="keywordflow">if</span>(0 != setsockopt(sock, SOL_SOCKET, SO_REUSEADDR,</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                     (<span class="keywordtype">void</span> *)&amp;flag, <span class="keyword">sizeof</span>(flag))) {</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;setsockopt(SO_REUSEADDR) failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a>(sock, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)) {</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;curlx_nonblock failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  }</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="keywordflow">switch</span>(socket_domain) {</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="keywordflow">case</span> AF_INET:</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>, 0, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_family = AF_INET;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_addr.s_addr = <a class="code" href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">INADDR_ANY</a>;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>.sin_port = htons(port);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">sa4</a>));</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  <span class="keywordflow">case</span> AF_INET6:</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.sa6, 0, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    me.sa6.sin6_family = AF_INET6;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    me.sa6.sin6_addr = in6addr_any;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    me.sa6.sin6_port = htons(port);</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sa6));</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <span class="keywordflow">case</span> AF_UNIX:</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;me.sau, 0, <span class="keyword">sizeof</span>(me.sau));</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    me.sau.sun_family = AF_UNIX;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    strncpy(me.sau.sun_path, unix_socket, <span class="keyword">sizeof</span>(me.sau.sun_path));</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sau));</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &amp;&amp; errno == EADDRINUSE) {</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="keyword">struct </span><a class="code" href="config-win32ce_8h.html#ad4ea824bd0fcae61733c900a5cab1e01">stat</a> statbuf;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="comment">/* socket already exists. Perhaps it is stale? */</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="keywordtype">int</span> unixfd = socket(AF_UNIX, SOCK_STREAM, 0);</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == unixfd) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket, failed to create socket at %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;               unix_socket, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      }</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="comment">/* check whether the server is alive */</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a>(unixfd, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sau));</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      error = errno;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      close(unixfd);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <span class="keywordflow">if</span>(ECONNREFUSED != error) {</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket, failed to connect to %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;               unix_socket, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      }</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="comment">/* socket server is not alive, now check if it was actually a socket.</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">       * Systems which have Unix sockets will also have lstat */</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = lstat(unix_socket, &amp;statbuf);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket, failed to stat %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;               unix_socket, errno, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      }</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="keywordflow">if</span>((statbuf.st_mode &amp; S_IFSOCK) != S_IFSOCK) {</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket, failed to stat %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;               unix_socket, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      }</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="comment">/* dead socket, cleanup and retry bind */</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = unlink(unix_socket);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket, failed to unlink %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;               unix_socket, errno, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      }</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <span class="comment">/* stale socket is gone, retry bind */</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = <a class="code" href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a>(sock, &amp;me.<a class="code" href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">sa</a>, <span class="keyword">sizeof</span>(me.sau));</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_UNIX_SOCKETS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  }</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Error binding socket on %s: (%d) %s&quot;</span>,</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;           location_str, error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  }</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;Running %s %s version on %s&quot;</span>,</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;         use_gopher?<span class="stringliteral">&quot;GOPHER&quot;</span>:<span class="stringliteral">&quot;HTTP&quot;</span>, socket_type, location_str);</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;  <span class="comment">/* start accepting connections */</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = listen(sock, 5);</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  <span class="keywordflow">if</span>(0 != <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>) {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;listen() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;           error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="comment">/* listen succeeds, so let&#39;s assume a valid listening Unix socket */</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  unlink_socket = <span class="keyword">true</span>;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">  ** As soon as this server writes its pid file the test harness will</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment">  ** attempt to connect to this server and initiate its verification.</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  wrotepidfile = <a class="code" href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a>(pidname);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="keywordflow">if</span>(!wrotepidfile)</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="comment">/* initialization of httprequest struct is done before get_request(), but</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment">     the pipelining struct field must be initialized previously to FALSE</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment">     every time a new connection arrives. */</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  req.<a class="code" href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">pipelining</a> = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  init_httprequest(&amp;req);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    fd_set <a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a95352e9b879226d3d33c388c03c03414">input</a>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    fd_set <a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtimeval.html">timeval</a> <a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a> = {0, 250000L}; <span class="comment">/* 250 ms */</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> maxfd = (<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a>)-1;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="comment">/* Clear out closed sockets */</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordflow">for</span>(socket_idx = num_sockets - 1; socket_idx &gt;= 1; --socket_idx) {</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == all_sockets[socket_idx]) {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="keywordtype">char</span> *dst = (<span class="keywordtype">char</span> *) (all_sockets + socket_idx);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordtype">char</span> *src = (<span class="keywordtype">char</span> *) (all_sockets + socket_idx + 1);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        <span class="keywordtype">char</span> *end = (<span class="keywordtype">char</span> *) (all_sockets + num_sockets);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        memmove(dst, src, end - src);</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        num_sockets -= 1;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      }</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;      <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="comment">/* Set up for select */</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    FD_ZERO(&amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    FD_ZERO(&amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>);</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="keywordflow">for</span>(socket_idx = 0; socket_idx &lt; num_sockets; ++socket_idx) {</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="comment">/* Listen on all sockets */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      FD_SET(all_sockets[socket_idx], &amp;<a class="code" href="structinput.html">input</a>);</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="keywordflow">if</span>(all_sockets[socket_idx] &gt; maxfd)</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        maxfd = all_sockets[socket_idx];</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    }</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = select((<span class="keywordtype">int</span>)maxfd + 1, &amp;<a class="code" href="structinput.html">input</a>, &amp;<a class="code" href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a>, NULL, &amp;<a class="code" href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a>);</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    } <span class="keywordflow">while</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0 &amp;&amp; errno == EINTR &amp;&amp; !<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      error = <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;select() failed with error: (%d) %s&quot;</span>,</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;             error, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(error));</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    }</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> == 0) {</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      <span class="comment">/* Timed out - try again */</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    }</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <span class="comment">/* Check if the listening socket is ready to accept */</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <span class="keywordflow">if</span>(FD_ISSET(all_sockets[0], &amp;<a class="code" href="structinput.html">input</a>)) {</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="comment">/* Service all queued connections */</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> msgsock;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        msgsock = accept_connection(sock);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;accept_connection %d returned %d&quot;</span>, sock, msgsock);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a> == msgsock)</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;          <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      } <span class="keywordflow">while</span>(msgsock &gt; 0);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    }</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <span class="comment">/* Service all connections that are ready */</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="keywordflow">for</span>(socket_idx = 1; socket_idx &lt; num_sockets; ++socket_idx) {</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      <span class="keywordflow">if</span>(FD_ISSET(all_sockets[socket_idx], &amp;<a class="code" href="structinput.html">input</a>)) {</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        <span class="comment">/* Service this connection until it has nothing available */</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        <span class="keywordflow">do</span> {</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;          <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = service_connection(all_sockets[socket_idx], &amp;req, sock,</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                                  connecthost);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;            <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &lt; 0) {</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;            <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;====&gt; Client disconnect %d&quot;</span>, req.<a class="code" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">connmon</a>);</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keywordflow">if</span>(req.<a class="code" href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">connmon</a>) {</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">char</span> *keepopen = <span class="stringliteral">&quot;[DISCONNECT]\n&quot;</span>;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;              storerequest(keepopen, strlen(keepopen));</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;            }</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <span class="keywordflow">if</span>(!req.<a class="code" href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">open</a>)</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;              <span class="comment">/* When instructed to close connection after server-reply we</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment">                 wait a very small amount of time before doing so. If this</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment">                 is not done client might get an ECONNRESET before reading</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">                 a single byte of server-reply. */</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;              <a class="code" href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a>(50);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;            <span class="keywordflow">if</span>(all_sockets[socket_idx] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>) {</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;              <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(all_sockets[socket_idx]);</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;              all_sockets[socket_idx] = <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;            }</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            serverlogslocked -= 1;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            <span class="keywordflow">if</span>(!serverlogslocked)</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;              <a class="code" href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;            <span class="keywordflow">if</span>(req.<a class="code" href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">testno</a> == <a class="code" href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">DOCNUMBER_QUIT</a>)</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;              <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;          }</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;          <span class="comment">/* Reset the request, unless we&#39;re still in the middle of reading */</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != 0)</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;            init_httprequest(&amp;req);</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        } <span class="keywordflow">while</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> &gt; 0);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      }</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    }</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      <span class="keywordflow">goto</span> sws_cleanup;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  }</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;sws_cleanup:</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordflow">for</span>(socket_idx = 1; socket_idx &lt; num_sockets; ++socket_idx)</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">if</span>((all_sockets[socket_idx] != sock) &amp;&amp;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;     (all_sockets[socket_idx] != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>))</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(all_sockets[socket_idx]);</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="keywordflow">if</span>(sock != <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>)</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <a class="code" href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a>(sock);</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="preprocessor">#ifdef USE_UNIX_SOCKETS</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <span class="keywordflow">if</span>(unlink_socket &amp;&amp; socket_domain == AF_UNIX) {</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = unlink(unix_socket);</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;unlink(%s) = %d (%s)&quot;</span>, unix_socket, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>));</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  }</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>)</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;signalled to die&quot;</span>);</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordflow">if</span>(wrotepidfile)</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    unlink(pidname);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="keywordflow">if</span>(serverlogslocked) {</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    serverlogslocked = 0;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    <a class="code" href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a>(<a class="code" href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a>);</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  }</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  restore_signal_handlers();</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a>) {</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;========&gt; %s sws (%s pid: %ld) exits with signal (%d)&quot;</span>,</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;           socket_type, location_str, pid, exit_signal);</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">     * To properly set the return status of the process we</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment">     * must raise the same signal SIGINT or SIGTERM that we</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">     * caught and let the old handler take care of it.</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="keyword">raise</span>(exit_signal);</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  }</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <a class="code" href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a>(<span class="stringliteral">&quot;========&gt; sws quits&quot;</span>);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;}</div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="sws_8c_html_a16b710f592bf8f7900666392adc444dc"><div class="ttname"><a href="sws_8c.html#a16b710f592bf8f7900666392adc444dc">DEFAULT_PORT</a></div><div class="ttdeci">#define DEFAULT_PORT</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00140">sws.c:140</a></div></div>
<div class="ttc" id="sws_8c_html_a4cea6319ddbc62debdc8315eb4549df5"><div class="ttname"><a href="sws_8c.html#a4cea6319ddbc62debdc8315eb4549df5">CMD_STREAM</a></div><div class="ttdeci">#define CMD_STREAM</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00172">sws.c:172</a></div></div>
<div class="ttc" id="url_8d_html_a1bc9666de113dffcfaf5d5c84eac6469"><div class="ttname"><a href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a></div><div class="ttdeci">Long POP3 or SMTP then that protocol will be otherwise HTTP will be used.Since..guessing can be disabled by setting a default see proto default for details.This option may be used any number of times.To control where this URL is written</div><div class="ttdef"><b>Definition:</b> <a href="url_8d_source.html#l00010">url.d:10</a></div></div>
<div class="ttc" id="sws_8c_html_a2aa5f996860068a5651be03dfc12c98e"><div class="ttname"><a href="sws_8c.html#a2aa5f996860068a5651be03dfc12c98e">RCMD_IDLE</a></div><div class="ttdeci">#define RCMD_IDLE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00094">sws.c:94</a></div></div>
<div class="ttc" id="sws_8c_html_ad5a1ca718c29b220d382e70a5913f7a4"><div class="ttname"><a href="sws_8c.html#ad5a1ca718c29b220d382e70a5913f7a4">siginterrupt</a></div><div class="ttdeci">#define siginterrupt(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00217">sws.c:217</a></div></div>
<div class="ttc" id="sws_8c_html_afe88de1a053104bb8099bc5cd891781d"><div class="ttname"><a href="sws_8c.html#afe88de1a053104bb8099bc5cd891781d">CMD_CONNECTIONMONITOR</a></div><div class="ttdeci">#define CMD_CONNECTIONMONITOR</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00177">sws.c:177</a></div></div>
<div class="ttc" id="sws_8c_html_a4d68235dfa433dea9c42f14784f80f6a"><div class="ttname"><a href="sws_8c.html#a4d68235dfa433dea9c42f14784f80f6a">DEFAULT_LOGFILE</a></div><div class="ttdeci">#define DEFAULT_LOGFILE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00143">sws.c:143</a></div></div>
<div class="ttc" id="setup-os400_8h_html_af65cc88d9ccb2274b94e0025d25d965f"><div class="ttname"><a href="setup-os400_8h.html#af65cc88d9ccb2274b94e0025d25d965f">bind</a></div><div class="ttdeci">#define bind</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00211">setup-os400.h:211</a></div></div>
<div class="ttc" id="structhttprequest_html_ae33da63576679ea1d7026d72aef0e241"><div class="ttname"><a href="structhttprequest.html#ae33da63576679ea1d7026d72aef0e241">httprequest::testno</a></div><div class="ttdeci">long testno</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00101">rtspd.c:101</a></div></div>
<div class="ttc" id="structhttprequest_html_a253baae1f9b358a138f1fe7f84f47513"><div class="ttname"><a href="structhttprequest.html#a253baae1f9b358a138f1fe7f84f47513">httprequest::prot_version</a></div><div class="ttdeci">int prot_version</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00118">rtspd.c:118</a></div></div>
<div class="ttc" id="unit1309_8c_html_a9e2730b68a97dbfb591cdc0e802bb4f5"><div class="ttname"><a href="unit1309_8c.html#a9e2730b68a97dbfb591cdc0e802bb4f5">puts</a></div><div class="ttdeci">puts(&quot;Result:&quot;)</div></div>
<div class="ttc" id="curl__setup__once_8h_html_abc0fa768a42a766f444259b91e5c6c0f"><div class="ttname"><a href="curl__setup__once_8h.html#abc0fa768a42a766f444259b91e5c6c0f">sclose</a></div><div class="ttdeci">#define sclose(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00264">curl_setup_once.h:264</a></div></div>
<div class="ttc" id="util_8c_html_a4441845b2b00ca8025c6eac62569e5f1"><div class="ttname"><a href="util_8c.html#a4441845b2b00ca8025c6eac62569e5f1">data_to_hex</a></div><div class="ttdeci">char * data_to_hex(char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00076">util.c:76</a></div></div>
<div class="ttc" id="sws_8c_html_afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216"><div class="ttname"><a href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea74aacf356fd7c14d8d56bdebd0eae216">DOCNUMBER_404</a></div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00191">sws.c:191</a></div></div>
<div class="ttc" id="structhttprequest_html_a78f69d3ff8d3ad6ca886b2096f19bb8d"><div class="ttname"><a href="structhttprequest.html#a78f69d3ff8d3ad6ca886b2096f19bb8d">httprequest::pipelining</a></div><div class="ttdeci">bool pipelining</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00119">rtspd.c:119</a></div></div>
<div class="ttc" id="sws_8c_html_ac856443856cf95a3f7f4fe7d3a9b3333"><div class="ttname"><a href="sws_8c.html#ac856443856cf95a3f7f4fe7d3a9b3333">REQBUFSIZ</a></div><div class="ttdeci">#define REQBUFSIZ</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00084">sws.c:84</a></div></div>
<div class="ttc" id="sws_8c_html_aec67ea35c886267fb4518f150e80808b"><div class="ttname"><a href="sws_8c.html#aec67ea35c886267fb4518f150e80808b">SIGHANDLER_T</a></div><div class="ttdeci">RETSIGTYPE(* SIGHANDLER_T)(int)</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00222">sws.c:222</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_ad4ea824bd0fcae61733c900a5cab1e01"><div class="ttname"><a href="config-win32ce_8h.html#ad4ea824bd0fcae61733c900a5cab1e01">stat</a></div><div class="ttdeci">int stat(const char *path, struct stat *buffer)</div></div>
<div class="ttc" id="sws_8c_html_af339bf71a92deed94f3bd9ba013824f2"><div class="ttname"><a href="sws_8c.html#af339bf71a92deed94f3bd9ba013824f2">REQUEST_KEYWORD_SIZE</a></div><div class="ttdeci">#define REQUEST_KEYWORD_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00162">sws.c:162</a></div></div>
<div class="ttc" id="_sample_h_i_d_keyboard_8cpp_html_a3baed8fd316b19ffc4765639221cf225"><div class="ttname"><a href="_sample_h_i_d_keyboard_8cpp.html#a3baed8fd316b19ffc4765639221cf225">output</a></div><div class="ttdeci">BLECharacteristic * output</div><div class="ttdef"><b>Definition:</b> <a href="_sample_h_i_d_keyboard_8cpp_source.html#l00020">SampleHIDKeyboard.cpp:20</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="config-dos_8h_html_adbe5dcee9c146b338794974137c55e70"><div class="ttname"><a href="config-dos_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a></div><div class="ttdeci">#define RETSIGTYPE</div><div class="ttdef"><b>Definition:</b> <a href="config-dos_8h_source.html#l00087">config-dos.h:87</a></div></div>
<div class="ttc" id="structhttprequest_html_ac062ed2f6a03482d7bc1a4924b678c27"><div class="ttname"><a href="structhttprequest.html#ac062ed2f6a03482d7bc1a4924b678c27">httprequest::ntlm</a></div><div class="ttdeci">bool ntlm</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00109">rtspd.c:109</a></div></div>
<div class="ttc" id="structhttprequest_html_af9fcf90ab7337fef4604b70c9703c212"><div class="ttname"><a href="structhttprequest.html#af9fcf90ab7337fef4604b70c9703c212">httprequest::connmon</a></div><div class="ttdeci">bool connmon</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00124">sws.c:124</a></div></div>
<div class="ttc" id="sws_8c_html_a8f2abe1d4a220962be19a09283940e55"><div class="ttname"><a href="sws_8c.html#a8f2abe1d4a220962be19a09283940e55">REQUEST_DUMP</a></div><div class="ttdeci">#define REQUEST_DUMP</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00150">sws.c:150</a></div></div>
<div class="ttc" id="structinput_html"><div class="ttname"><a href="structinput.html">input</a></div><div class="ttdef"><b>Definition:</b> <a href="http2-upload_8c_source.html#l00169">http2-upload.c:169</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="multi-uv_8c_html_afb43b78d9a22f95e721353db4408304c"><div class="ttname"><a href="multi-uv_8c.html#afb43b78d9a22f95e721353db4408304c">timeout</a></div><div class="ttdeci">uv_timer_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00042">multi-uv.c:42</a></div></div>
<div class="ttc" id="sws_8c_html_aad9ae913bdfab20dd94ad04ee2d5b045"><div class="ttname"><a href="sws_8c.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a></div><div class="ttdeci">#define DATA</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l01441">sws.c:1441</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="first_8c_html_ad9df668cd7e7913338d1919a8520f76f"><div class="ttname"><a href="first_8c.html#ad9df668cd7e7913338d1919a8520f76f">wait_ms</a></div><div class="ttdeci">void wait_ms(int ms)</div><div class="ttdef"><b>Definition:</b> <a href="first_8c_source.html#l00066">first.c:66</a></div></div>
<div class="ttc" id="sws_8c_html_a69158a2c34c2d0206517e1db48794d46"><div class="ttname"><a href="sws_8c.html#a69158a2c34c2d0206517e1db48794d46">SWSVERSION</a></div><div class="ttdeci">#define SWSVERSION</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00148">sws.c:148</a></div></div>
<div class="ttc" id="sws_8c_html_ae3ac4ff1dd05a5101d71b2317ca216d3"><div class="ttname"><a href="sws_8c.html#ae3ac4ff1dd05a5101d71b2317ca216d3">STREAMTHIS</a></div><div class="ttdeci">#define STREAMTHIS</div></div>
<div class="ttc" id="_sample_h_i_d_keyboard_8cpp_html_a95352e9b879226d3d33c388c03c03414"><div class="ttname"><a href="_sample_h_i_d_keyboard_8cpp.html#a95352e9b879226d3d33c388c03c03414">input</a></div><div class="ttdeci">BLECharacteristic * input</div><div class="ttdef"><b>Definition:</b> <a href="_sample_h_i_d_keyboard_8cpp_source.html#l00019">SampleHIDKeyboard.cpp:19</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="util_8c_html_a4ed279d3ab8f2e8b9d8c3f051e514783"><div class="ttname"><a href="util_8c.html#a4ed279d3ab8f2e8b9d8c3f051e514783">write_pidfile</a></div><div class="ttdeci">int write_pidfile(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00260">util.c:260</a></div></div>
<div class="ttc" id="sws_8c_html_a15ea8c6ddfb1cc36ee45cfa7aa2acb72"><div class="ttname"><a href="sws_8c.html#a15ea8c6ddfb1cc36ee45cfa7aa2acb72">RESPONSE_PROXY_DUMP</a></div><div class="ttdeci">#define RESPONSE_PROXY_DUMP</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00156">sws.c:156</a></div></div>
<div class="ttc" id="sws_8c_html_ab54cda52ee639aa3c47cfa330904e776"><div class="ttname"><a href="sws_8c.html#ab54cda52ee639aa3c47cfa330904e776">MAX_SOCKETS</a></div><div class="ttdeci">#define MAX_SOCKETS</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00132">sws.c:132</a></div></div>
<div class="ttc" id="config-os400_8h_html_a7a1524cf833450776ffc81c38a78c370"><div class="ttname"><a href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="ttdeci">#define ENABLE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00071">config-os400.h:71</a></div></div>
<div class="ttc" id="sws_8c_html_a9fedc81bea3ea0591b4be172e4a18382"><div class="ttname"><a href="sws_8c.html#a9fedc81bea3ea0591b4be172e4a18382">RCMD_STREAM</a></div><div class="ttdeci">#define RCMD_STREAM</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00095">sws.c:95</a></div></div>
<div class="ttc" id="util_8c_html_ad313740f510df6ccee72c71c03cf9c66"><div class="ttname"><a href="util_8c.html#ad313740f510df6ccee72c71c03cf9c66">clear_advisor_read_lock</a></div><div class="ttdeci">void clear_advisor_read_lock(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00300">util.c:300</a></div></div>
<div class="ttc" id="multi-uv_8c_html_add769cb3887f840e6e7be962492de960"><div class="ttname"><a href="multi-uv_8c.html#add769cb3887f840e6e7be962492de960">loop</a></div><div class="ttdeci">uv_loop_t * loop</div><div class="ttdef"><b>Definition:</b> <a href="multi-uv_8c_source.html#l00040">multi-uv.c:40</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_aad859b17f001ee9fd0b0e49a7deb27b2"><div class="ttname"><a href="curl__ctype_8h.html#aad859b17f001ee9fd0b0e49a7deb27b2">ISSPACE</a></div><div class="ttdeci">#define ISSPACE(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00064">curl_ctype.h:64</a></div></div>
<div class="ttc" id="warnless_8c_html_a4191cac6787b6271e407e6c22fe60f25"><div class="ttname"><a href="warnless_8c.html#a4191cac6787b6271e407e6c22fe60f25">curlx_uztosz</a></div><div class="ttdeci">ssize_t curlx_uztosz(size_t uznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00328">warnless.c:328</a></div></div>
<div class="ttc" id="unit1394_8c_html_a0fb9c3165f64b5b79f3928b404818be9"><div class="ttname"><a href="unit1394_8c.html#a0fb9c3165f64b5b79f3928b404818be9">p</a></div><div class="ttdeci">const char ** p</div><div class="ttdef"><b>Definition:</b> <a href="unit1394_8c_source.html#l00079">unit1394.c:79</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="structhttprequest_html_a68cb27c4ca497c45f27138a1e737800d"><div class="ttname"><a href="structhttprequest.html#a68cb27c4ca497c45f27138a1e737800d">httprequest::digest</a></div><div class="ttdeci">bool digest</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00108">rtspd.c:108</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="util_8h_html_a52cb8153a3777a126985be9c268311eb"><div class="ttname"><a href="util_8h.html#a52cb8153a3777a126985be9c268311eb">SERVERLOGS_LOCK</a></div><div class="ttdeci">#define SERVERLOGS_LOCK</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00032">util.h:32</a></div></div>
<div class="ttc" id="structhttprequest_html_a6b9b9858c56bc220c290caa12640074c"><div class="ttname"><a href="structhttprequest.html#a6b9b9858c56bc220c290caa12640074c">httprequest::done_processing</a></div><div class="ttdeci">int done_processing</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00129">sws.c:129</a></div></div>
<div class="ttc" id="sws_8c_html_a4fe5fe775dbb31c3e46c2a29c46b49c1"><div class="ttname"><a href="sws_8c.html#a4fe5fe775dbb31c3e46c2a29c46b49c1">CMD_UPGRADE</a></div><div class="ttdeci">#define CMD_UPGRADE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00180">sws.c:180</a></div></div>
<div class="ttc" id="sws_8c_html_af20374e5ccf80a4502412c0f8be33362"><div class="ttname"><a href="sws_8c.html#af20374e5ccf80a4502412c0f8be33362">data_or_ctrl</a></div><div class="ttdeci">#define data_or_ctrl(x)</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l01438">sws.c:1438</a></div></div>
<div class="ttc" id="nonblock_8c_html_a0b0747a29eed9acae52471c25a66e042"><div class="ttname"><a href="nonblock_8c.html#a0b0747a29eed9acae52471c25a66e042">curlx_nonblock</a></div><div class="ttdeci">int curlx_nonblock(curl_socket_t sockfd, int nonblock)</div><div class="ttdef"><b>Definition:</b> <a href="nonblock_8c_source.html#l00047">nonblock.c:47</a></div></div>
<div class="ttc" id="form_8d_html_a2ff994e16bf9521154de4cf659a3b689"><div class="ttname"><a href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a></div><div class="ttdeci">filename</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00057">form.d:57</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="curlx_8h_html"><div class="ttname"><a href="curlx_8h.html">curlx.h</a></div></div>
<div class="ttc" id="warnless_8c_html_a5cda9889c201b12398833787bff13e6e"><div class="ttname"><a href="warnless_8c.html#a5cda9889c201b12398833787bff13e6e">curlx_ultous</a></div><div class="ttdeci">unsigned short curlx_ultous(unsigned long ulnum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00124">warnless.c:124</a></div></div>
<div class="ttc" id="sws_8c_html_afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f"><div class="ttname"><a href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea0f806a7f6e0a51e9bcb5309267f8263f">DOCNUMBER_NOTHING</a></div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00188">sws.c:188</a></div></div>
<div class="ttc" id="inet__pton_8h_html"><div class="ttname"><a href="inet__pton_8h.html">inet_pton.h</a></div></div>
<div class="ttc" id="quote_8d_html_ae7102b102f9ed4847a2862ff6984ca3f"><div class="ttname"><a href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a></div><div class="ttdeci">Long to be exact.To make commands take place after a successful prefix them with a dash.To make commands be sent after curl has changed the working just before the transfer command(s)</div></div>
<div class="ttc" id="util_8c_html_a9fab34cec25b3714a6b19cc623733954"><div class="ttname"><a href="util_8c.html#a9fab34cec25b3714a6b19cc623733954">logmsg</a></div><div class="ttdeci">void logmsg(const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00099">util.c:99</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1smb3_html_ae260bcf9c1467602a2139dd3a1a0cbab"><div class="ttname"><a href="namespaceimpacket_1_1smb3.html#ae260bcf9c1467602a2139dd3a1a0cbab">impacket.smb3.FILE</a></div><div class="ttdeci">dictionary FILE</div><div class="ttdef"><b>Definition:</b> <a href="smb3_8py_source.html#l00061">smb3.py:61</a></div></div>
<div class="ttc" id="sws_8c_html_a6bb1ed9df56d0ca048d0d324960e8275"><div class="ttname"><a href="sws_8c.html#a6bb1ed9df56d0ca048d0d324960e8275">MAXDOCNAMELEN_TXT</a></div><div class="ttdeci">#define MAXDOCNAMELEN_TXT</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00160">sws.c:160</a></div></div>
<div class="ttc" id="output_8d_html_a7bcb6a773be04cbd4890bfe10fa42696"><div class="ttname"><a href="output_8d.html#a7bcb6a773be04cbd4890bfe10fa42696">line</a></div><div class="ttdeci">Long you can use specifier.That variable will be replaced with the current string for the URL being fetched.Like if you specify two URLs on the same command line</div><div class="ttdef"><b>Definition:</b> <a href="output_8d_source.html#l00008">output.d:8</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a0071bfd21ec79c6616e860f8b4c20015"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a0071bfd21ec79c6616e860f8b4c20015">srvr_sockaddr_union_t::sa</a></div><div class="ttdeci">struct sockaddr sa</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00031">server_sockaddr.h:31</a></div></div>
<div class="ttc" id="sws_8c_html_a865bb81bb1dff4a12dae46642759138b"><div class="ttname"><a href="sws_8c.html#a865bb81bb1dff4a12dae46642759138b">RCMD_NORMALREQ</a></div><div class="ttdeci">#define RCMD_NORMALREQ</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00093">sws.c:93</a></div></div>
<div class="ttc" id="config-os400_8h_html_a0905f99ed657b831de0abece48991b7d"><div class="ttname"><a href="config-os400_8h.html#a0905f99ed657b831de0abece48991b7d">USE_UNIX_SOCKETS</a></div><div class="ttdeci">#define USE_UNIX_SOCKETS</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00553">config-os400.h:553</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_af0fac1cea1165b4debec7f686edf3313"><div class="ttname"><a href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a></div><div class="ttdeci">#define EAGAIN</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00444">config-win32ce.h:444</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1spnego_html_af2435af20421ab1fb0f5178e5f3b57a3"><div class="ttname"><a href="namespaceimpacket_1_1spnego.html#af2435af20421ab1fb0f5178e5f3b57a3">impacket.spnego.dump</a></div><div class="ttdeci">def dump(self)</div><div class="ttdef"><b>Definition:</b> <a href="spnego_8py_source.html#l00131">spnego.py:131</a></div></div>
<div class="ttc" id="structhttprequest_html_aabb74822590caa297b94a5e90d9c194c"><div class="ttname"><a href="structhttprequest.html#aabb74822590caa297b94a5e90d9c194c">httprequest::skip</a></div><div class="ttdeci">int skip</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00112">rtspd.c:112</a></div></div>
<div class="ttc" id="sws_8c_html_ac9420823bfeba78fce625fc105e3b01da4d055a12ec2d2e6282ae3c6008dd970b"><div class="ttname"><a href="sws_8c.html#ac9420823bfeba78fce625fc105e3b01da4d055a12ec2d2e6282ae3c6008dd970b">socket_domain_inet</a></div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00072">sws.c:72</a></div></div>
<div class="ttc" id="structhttprequest_html_a7504123ce7d05526da9875be15a5409e"><div class="ttname"><a href="structhttprequest.html#a7504123ce7d05526da9875be15a5409e">httprequest::auth</a></div><div class="ttdeci">bool auth</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00106">rtspd.c:106</a></div></div>
<div class="ttc" id="strcase_8h_html_a48c605aaef9b3681c41d91096b6baad0"><div class="ttname"><a href="strcase_8h.html#a48c605aaef9b3681c41d91096b6baad0">strncasecompare</a></div><div class="ttdeci">#define strncasecompare(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00036">strcase.h:36</a></div></div>
<div class="ttc" id="structhttprequest_html_a86b9438f853849b779530840a546d07c"><div class="ttname"><a href="structhttprequest.html#a86b9438f853849b779530840a546d07c">httprequest::pipe</a></div><div class="ttdeci">int pipe</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00110">rtspd.c:110</a></div></div>
<div class="ttc" id="server__sockaddr_8h_html"><div class="ttname"><a href="server__sockaddr_8h.html">server_sockaddr.h</a></div></div>
<div class="ttc" id="data-binary_8d_html_a3ac969eb89029f16e1971dc874d41dab"><div class="ttname"><a href="data-binary_8d.html#a3ac969eb89029f16e1971dc874d41dab">stream</a></div><div class="ttdeci">Long the rest should be a filename.Data is posted in a similar manner as data except that newlines and carriage returns are preserved and conversions are never done.Like data the default content type sent to the server is application x www form urlencoded.If you want the data to be treated as arbitrary binary data by the server then set the content type to octet stream</div><div class="ttdef"><b>Definition:</b> <a href="data-binary_8d_source.html#l00008">data-binary.d:8</a></div></div>
<div class="ttc" id="structtimeval_html"><div class="ttname"><a href="structtimeval.html">timeval</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00109">curl_setup_once.h:109</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="setup-os400_8h_html_adfd4ee688142ebda1142c1b0c7577e91"><div class="ttname"><a href="setup-os400_8h.html#adfd4ee688142ebda1142c1b0c7577e91">connect</a></div><div class="ttdeci">#define connect</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00210">setup-os400.h:210</a></div></div>
<div class="ttc" id="structhttprequest_html_a9fd911f7c7e7e50da3c512ee593f2d36"><div class="ttname"><a href="structhttprequest.html#a9fd911f7c7e7e50da3c512ee593f2d36">httprequest::callcount</a></div><div class="ttdeci">int callcount</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00123">sws.c:123</a></div></div>
<div class="ttc" id="structhttprequest_html_a81cccf85fed25860cc7f448a3cd73fb9"><div class="ttname"><a href="structhttprequest.html#a81cccf85fed25860cc7f448a3cd73fb9">httprequest::checkindex</a></div><div class="ttdeci">size_t checkindex</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00099">rtspd.c:99</a></div></div>
<div class="ttc" id="fail-early_8d_html_a2b978ebca1e6cb7fcbcb9a6b51701ce3"><div class="ttname"><a href="fail-early_8d.html#a2b978ebca1e6cb7fcbcb9a6b51701ce3">fail</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply fail</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="sws_8c_html_a8814470e1da1725bef5b432e97413240"><div class="ttname"><a href="sws_8c.html#a8814470e1da1725bef5b432e97413240">CMD_SWSCLOSE</a></div><div class="ttdeci">#define CMD_SWSCLOSE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00183">sws.c:183</a></div></div>
<div class="ttc" id="inet__pton_8c_html_a8d1e996e3cc6d70e844c787b1a8614cc"><div class="ttname"><a href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a></div><div class="ttdeci">int Curl_inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="inet__pton_8c_source.html#l00066">inet_pton.c:66</a></div></div>
<div class="ttc" id="sws_8c_html_abe70b4bde2491e4a4cd405d121383d5f"><div class="ttname"><a href="sws_8c.html#abe70b4bde2491e4a4cd405d121383d5f">END_OF_HEADERS</a></div><div class="ttdeci">#define END_OF_HEADERS</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00185">sws.c:185</a></div></div>
<div class="ttc" id="sws_8c_html_af5bcf329d3c9613928c46e186752d618"><div class="ttname"><a href="sws_8c.html#af5bcf329d3c9613928c46e186752d618">CTRL</a></div><div class="ttdeci">#define CTRL</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l01440">sws.c:1440</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html">srvr_sockaddr_union_t</a></div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00030">server_sockaddr.h:30</a></div></div>
<div class="ttc" id="structhttprequest_html_adf5c59315f375ab57c859f5a38766a1b"><div class="ttname"><a href="structhttprequest.html#adf5c59315f375ab57c859f5a38766a1b">httprequest::connect_port</a></div><div class="ttdeci">unsigned short connect_port</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00100">sws.c:100</a></div></div>
<div class="ttc" id="unit1652_8c_html_a1d19b0eef3b3acd31be88886a0277c2e"><div class="ttname"><a href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a></div><div class="ttdeci">memset(input, '\0', sizeof(input))</div></div>
<div class="ttc" id="sws_8c_html_a138025e9d2f5640254e627174b3f4c5a"><div class="ttname"><a href="sws_8c.html#a138025e9d2f5640254e627174b3f4c5a">REQUEST_PROXY_DUMP</a></div><div class="ttdeci">#define REQUEST_PROXY_DUMP</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00155">sws.c:155</a></div></div>
<div class="ttc" id="structhttprequest_html_a51355f055a434ed5cc21957846b20882"><div class="ttname"><a href="structhttprequest.html#a51355f055a434ed5cc21957846b20882">httprequest::close</a></div><div class="ttdeci">bool close</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00127">sws.c:127</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a7ddf85b622bfeaf8d3b158e18ed6794a"><div class="ttname"><a href="curl__setup__once_8h.html#a7ddf85b622bfeaf8d3b158e18ed6794a">SIG_ATOMIC_T</a></div><div class="ttdeci">#define SIG_ATOMIC_T</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00370">curl_setup_once.h:370</a></div></div>
<div class="ttc" id="getpart_8h_html"><div class="ttname"><a href="getpart_8h.html">getpart.h</a></div></div>
<div class="ttc" id="structhttprequest_html_a3b2dd8862688eba27db855d3c6dcaf6d"><div class="ttname"><a href="structhttprequest.html#a3b2dd8862688eba27db855d3c6dcaf6d">httprequest::rcmd</a></div><div class="ttdeci">int rcmd</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00116">rtspd.c:116</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="structhttprequest_html_a37c667faaeab6953f29488d12566b247"><div class="ttname"><a href="structhttprequest.html#a37c667faaeab6953f29488d12566b247">httprequest::writedelay</a></div><div class="ttdeci">int writedelay</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00112">sws.c:112</a></div></div>
<div class="ttc" id="sws_8c_html_a62244eaa0906d8fc0899b402ef5f30c3"><div class="ttname"><a href="sws_8c.html#a62244eaa0906d8fc0899b402ef5f30c3">REQUEST_KEYWORD_SIZE_TXT</a></div><div class="ttdeci">#define REQUEST_KEYWORD_SIZE_TXT</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00163">sws.c:163</a></div></div>
<div class="ttc" id="server__setup_8h_html"><div class="ttname"><a href="server__setup_8h.html">server_setup.h</a></div></div>
<div class="ttc" id="sws_8c_html_afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e"><div class="ttname"><a href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea7de20784df11a014d7c91e2e5515f01e">DOCNUMBER_WERULEZ</a></div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00190">sws.c:190</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="structhttprequest_html"><div class="ttname"><a href="structhttprequest.html">httprequest</a></div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00097">rtspd.c:97</a></div></div>
<div class="ttc" id="sws_8c_html_a4a9d8a1ce1202fc103170f815364076b"><div class="ttname"><a href="sws_8c.html#a4a9d8a1ce1202fc103170f815364076b">got_exit_signal</a></div><div class="ttdeci">SIG_ATOMIC_T got_exit_signal</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00250">sws.c:250</a></div></div>
<div class="ttc" id="structhttprequest_html_ade54821174f80346f7eacbd9e245d6e7"><div class="ttname"><a href="structhttprequest.html#ade54821174f80346f7eacbd9e245d6e7">httprequest::cl</a></div><div class="ttdeci">size_t cl</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00107">rtspd.c:107</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_acc3e9b1176bd8c62c4fe0e017007e719"><div class="ttname"><a href="curl__ctype_8h.html#acc3e9b1176bd8c62c4fe0e017007e719">ISDIGIT</a></div><div class="ttdeci">#define ISDIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00065">curl_ctype.h:65</a></div></div>
<div class="ttc" id="sws_8c_html_a433697a25587c6ffe8a14f02e5be9066"><div class="ttname"><a href="sws_8c.html#a433697a25587c6ffe8a14f02e5be9066">CMD_IDLE</a></div><div class="ttdeci">#define CMD_IDLE</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00169">sws.c:169</a></div></div>
<div class="ttc" id="sws_8c_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="sws_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l01986">sws.c:1986</a></div></div>
<div class="ttc" id="sws_8c_html_a2bc6ab9482576c6b7c8305d6a4a01d8e"><div class="ttname"><a href="sws_8c.html#a2bc6ab9482576c6b7c8305d6a4a01d8e">CMD_AUTH_REQUIRED</a></div><div class="ttdeci">#define CMD_AUTH_REQUIRED</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00165">sws.c:165</a></div></div>
<div class="ttc" id="structhttprequest_html_ab0261b7acbe62d22e362298afd3edbe4"><div class="ttname"><a href="structhttprequest.html#ab0261b7acbe62d22e362298afd3edbe4">httprequest::offset</a></div><div class="ttdeci">size_t offset</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00100">rtspd.c:100</a></div></div>
<div class="ttc" id="unionsrvr__sockaddr__union__t_html_a5bc1a3f8c40f644488914bfd7707afb8"><div class="ttname"><a href="unionsrvr__sockaddr__union__t.html#a5bc1a3f8c40f644488914bfd7707afb8">srvr_sockaddr_union_t::sa4</a></div><div class="ttdeci">struct sockaddr_in sa4</div><div class="ttdef"><b>Definition:</b> <a href="server__sockaddr_8h_source.html#l00032">server_sockaddr.h:32</a></div></div>
<div class="ttc" id="util_8c_html_aad214ae87462a3193220c3165758f91d"><div class="ttname"><a href="util_8c.html#aad214ae87462a3193220c3165758f91d">test2file</a></div><div class="ttdeci">char * test2file(long testno)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00196">util.c:196</a></div></div>
<div class="ttc" id="curl__printf_8h_html_aab6e63106cf29e5160e5c2d63db86d27"><div class="ttname"><a href="curl__printf_8h.html#aab6e63106cf29e5160e5c2d63db86d27">fprintf</a></div><div class="ttdeci">#define fprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00041">curl_printf.h:41</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_a69d5b2daf8dd402fc8b43abb4ffbd44e"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#a69d5b2daf8dd402fc8b43abb4ffbd44e">impacket.nmb.INADDR_ANY</a></div><div class="ttdeci">string INADDR_ANY</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00048">nmb.py:48</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="getpart_8c_html_ad3165ecba75413cf3d2eedef212975a1"><div class="ttname"><a href="getpart_8c.html#ad3165ecba75413cf3d2eedef212975a1">getpart</a></div><div class="ttdeci">int getpart(char **outbuf, size_t *outlen, const char *main, const char *sub, FILE *stream)</div><div class="ttdef"><b>Definition:</b> <a href="getpart_8c_source.html#l00278">getpart.c:278</a></div></div>
<div class="ttc" id="structhttprequest_html_a0e9d86ee6f0e566902d8a6fec4c12073"><div class="ttname"><a href="structhttprequest.html#a0e9d86ee6f0e566902d8a6fec4c12073">httprequest::reqbuf</a></div><div class="ttdeci">char reqbuf[REQBUFSIZ]</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00098">rtspd.c:98</a></div></div>
<div class="ttc" id="structhttprequest_html_a856e217eaf750193193b5dedfefb8507"><div class="ttname"><a href="structhttprequest.html#a856e217eaf750193193b5dedfefb8507">httprequest::open</a></div><div class="ttdeci">bool open</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00103">rtspd.c:103</a></div></div>
<div class="ttc" id="structhttprequest_html_a897a50910f461d10bba5767558c8f9c4"><div class="ttname"><a href="structhttprequest.html#a897a50910f461d10bba5767558c8f9c4">httprequest::connect_request</a></div><div class="ttdeci">bool connect_request</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00099">sws.c:99</a></div></div>
<div class="ttc" id="structhttprequest_html_ae2383dfde69976a2aa703b5045842b2c"><div class="ttname"><a href="structhttprequest.html#ae2383dfde69976a2aa703b5045842b2c">httprequest::auth_req</a></div><div class="ttdeci">bool auth_req</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00104">rtspd.c:104</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="curl__ctype_8h_html_ac0e84c3fd48c096e0f836d1cdbe310bb"><div class="ttname"><a href="curl__ctype_8h.html#ac0e84c3fd48c096e0f836d1cdbe310bb">ISXDIGIT</a></div><div class="ttdeci">#define ISXDIGIT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__ctype_8h_source.html#l00067">curl_ctype.h:67</a></div></div>
<div class="ttc" id="structhttprequest_html_a80a8cfb445d179cb4950c481b68d5747"><div class="ttname"><a href="structhttprequest.html#a80a8cfb445d179cb4950c481b68d5747">httprequest::upgrade</a></div><div class="ttdeci">bool upgrade</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00125">sws.c:125</a></div></div>
<div class="ttc" id="components_2curl_2include_2curl_2_system_8h_html_af89f74b4f46628d93e3cc829fcd69801"><div class="ttname"><a href="components_2curl_2include_2curl_2_system_8h.html#af89f74b4f46628d93e3cc829fcd69801">curl_socklen_t</a></div><div class="ttdeci">CURL_TYPEOF_CURL_SOCKLEN_T curl_socklen_t</div><div class="ttdef"><b>Definition:</b> <a href="components_2curl_2include_2curl_2_system_8h_source.html#l00436">system.h:436</a></div></div>
<div class="ttc" id="stdcheaders_8h_html_ae791f89cbd418b3074b1349d8f5075dd"><div class="ttname"><a href="stdcheaders_8h.html#ae791f89cbd418b3074b1349d8f5075dd">fwrite</a></div><div class="ttdeci">size_t fwrite(const void *, size_t, size_t, FILE *)</div></div>
<div class="ttc" id="sws_8c_html_a97a20211ff266e7b4180dd6c49c06eed"><div class="ttname"><a href="sws_8c.html#a97a20211ff266e7b4180dd6c49c06eed">serverlogfile</a></div><div class="ttdeci">const char * serverlogfile</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00146">sws.c:146</a></div></div>
<div class="ttc" id="structhttprequest_html_ace2e458efe8e36cc80c80decaf7b47b4"><div class="ttname"><a href="structhttprequest.html#ace2e458efe8e36cc80c80decaf7b47b4">httprequest::partno</a></div><div class="ttdeci">long partno</div><div class="ttdef"><b>Definition:</b> <a href="rtspd_8c_source.html#l00102">rtspd.c:102</a></div></div>
<div class="ttc" id="util_8c_html_a88279b927418889863e8247e98cb5d17"><div class="ttname"><a href="util_8c.html#a88279b927418889863e8247e98cb5d17">set_advisor_read_lock</a></div><div class="ttdeci">void set_advisor_read_lock(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00277">util.c:277</a></div></div>
<div class="ttc" id="structhttprequest_html_afb9fdcb6c1ae67a45469e921ffc6d339"><div class="ttname"><a href="structhttprequest.html#afb9fdcb6c1ae67a45469e921ffc6d339">httprequest::upgrade_request</a></div><div class="ttdeci">bool upgrade_request</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00126">sws.c:126</a></div></div>
<div class="ttc" id="sws_8c_html_afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c"><div class="ttname"><a href="sws_8c.html#afa9be5679ab03d785820f2474c5ccc6ea9f283a0ee43355b560f48b221138340c">DOCNUMBER_QUIT</a></div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00189">sws.c:189</a></div></div>
<div class="ttc" id="sws_8c_html_a49b1e4513f79dc7f48f8a4632808e1ce"><div class="ttname"><a href="sws_8c.html#a49b1e4513f79dc7f48f8a4632808e1ce">RESPONSE_DUMP</a></div><div class="ttdeci">#define RESPONSE_DUMP</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00151">sws.c:151</a></div></div>
<div class="ttc" id="sws_8c_html_a78dc3db0719361b1f970f9e944180f01"><div class="ttname"><a href="sws_8c.html#a78dc3db0719361b1f970f9e944180f01">MAXDOCNAMELEN</a></div><div class="ttdeci">#define MAXDOCNAMELEN</div><div class="ttdef"><b>Definition:</b> <a href="sws_8c_source.html#l00159">sws.c:159</a></div></div>
<div class="ttc" id="util_8c_html_a3b02c6de5c049804444a246f7fdf46b4"><div class="ttname"><a href="util_8c.html#a3b02c6de5c049804444a246f7fdf46b4">path</a></div><div class="ttdeci">const char * path</div><div class="ttdef"><b>Definition:</b> <a href="util_8c_source.html#l00194">util.c:194</a></div></div>
<div class="ttc" id="structpart_html"><div class="ttname"><a href="structpart.html">part</a></div><div class="ttdef"><b>Definition:</b> <a href="lib1560_8c_source.html#l00037">lib1560.c:37</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_c8a2a421f641dc9212666197c7c3274f.html">tests</a></li><li class="navelem"><a class="el" href="dir_a56cf240bd760590f7435b1cc527e3dc.html">server</a></li><li class="navelem"><a class="el" href="sws_8c.html">sws.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
