<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/security.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('security_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">security.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="security_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* This source code was modified by Martin Hedenfalk &lt;mhe@stacken.kth.se&gt; for</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * use in Curl. His latest changes were done 2000-09-18.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * It has since been patched and modified a lot by Daniel Stenberg</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * &lt;daniel@haxx.se&gt; to make it better applied to curl conditions, and to make</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * it not use globals, pollute name space and more. This source code awaits a</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * rewrite to work around the paragraph 2 in the BSD licenses as explained</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * below.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Copyright (c) 1998, 1999, 2017 Kungliga Tekniska Högskolan</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * (Royal Institute of Technology, Stockholm, Sweden).</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Copyright (C) 2001 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * All rights reserved.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * are met:</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in the</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *    documentation and/or other materials provided with the distribution.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * 3. Neither the name of the Institute nor the names of its contributors</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *    may be used to endorse or promote products derived from this software</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *    without specific prior written permission.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS&#39;&#39; AND</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * SUCH DAMAGE.  */</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_FTP</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#ifdef HAVE_GSSAPI</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#ifdef HAVE_NETDB_H</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__base64_8h.html">curl_base64.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__sec_8h.html">curl_sec.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ftp_8h.html">ftp.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strcase_8h.html">strcase.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="warnless_8h.html">warnless.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strdup_8h.html">strdup.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/* The last 3 #include files should be in this order */</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keyword">enum</span> protection_level level;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;} level_names[] = {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  { PROT_CLEAR, <span class="stringliteral">&quot;clear&quot;</span> },</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  { PROT_SAFE, <span class="stringliteral">&quot;safe&quot;</span> },</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  { PROT_CONFIDENTIAL, <span class="stringliteral">&quot;confidential&quot;</span> },</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  { PROT_PRIVATE, <span class="stringliteral">&quot;private&quot;</span> }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;};</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> protection_level</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;name_to_level(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; (int)<span class="keyword">sizeof</span>(level_names)/(int)<span class="keyword">sizeof</span>(level_names[0]); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++)</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="strcase_8h.html#a23b67e200b6f4c3ead633c94b3edcdb3">checkprefix</a>(<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>, level_names[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a>))</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">return</span> level_names[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].level;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">return</span> PROT_NONE;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/* Convert a protocol |level| to its char representation.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">   We take an int to catch programming mistakes. */</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> level_to_char(<span class="keywordtype">int</span> level)</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">switch</span>(level) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">case</span> PROT_CLEAR:</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span> <span class="charliteral">&#39;C&#39;</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">case</span> PROT_SAFE:</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">return</span> <span class="charliteral">&#39;S&#39;</span>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">case</span> PROT_CONFIDENTIAL:</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">return</span> <span class="charliteral">&#39;E&#39;</span>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">case</span> PROT_PRIVATE:</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> <span class="charliteral">&#39;P&#39;</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">case</span> PROT_CMD:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">/* Those 2 cases should not be reached! */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(0);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">/* Default to the most secure alternative. */</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">return</span> <span class="charliteral">&#39;P&#39;</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">/* Send an FTP command defined by |message| and the optional arguments. The</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">   function returns the ftp_code. If an error occurs, -1 is returned. */</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ftp_send_command(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *message, ...)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">int</span> ftp_code;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread = 0;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  va_list args;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">char</span> print_buffer[50];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  va_start(args, message);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="curl__printf_8h.html#afc68cf69040d2c835650f9a217b98439">mvsnprintf</a>(print_buffer, <span class="keyword">sizeof</span>(print_buffer), message, args);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  va_end(args);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#ab65c9f67cc4c67672341d00c4b7110f5">Curl_ftpsend</a>(conn, print_buffer)) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    ftp_code = -1;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a>(&amp;nread, conn, &amp;ftp_code))</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      ftp_code = -1;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  (void)nread; <span class="comment">/* Unused */</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">return</span> ftp_code;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">/* Read |len| from the socket |fd| and store it in |to|. Return a CURLcode</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   saying whether an error occurred or CURLE_OK if |len| was read. */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;socket_read(<a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd, <span class="keywordtype">void</span> *<a class="code" href="form_8d.html#ac776e8c2aa1a100ee6a391f59441ccf4">to</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">char</span> *to_p = <a class="code" href="form_8d.html#ac776e8c2aa1a100ee6a391f59441ccf4">to</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 0) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#a00c49d227c9a5f1b8f1df9e8c7204102">Curl_read_plain</a>(fd, to_p, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;nread);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= nread;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      to_p += nread;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">/* FIXME: We are doing a busy wait */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">/* Write |len| bytes from the buffer |to| to the socket |fd|. Return a</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">   CURLcode saying whether an error occurred or CURLE_OK if |len| was</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">   written. */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;socket_write(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="form_8d.html#ac776e8c2aa1a100ee6a391f59441ccf4">to</a>,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;             <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *to_p = <a class="code" href="form_8d.html#ac776e8c2aa1a100ee6a391f59441ccf4">to</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 0) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a>(conn, fd, to_p, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;<a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      to_p += <a class="code" href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="comment">/* FIXME: We are doing a busy wait */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> read_data(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                          <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd,</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                          <span class="keyword">struct</span> krb5buffer *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;{</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordtype">void</span> *tmp = NULL;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = socket_read(fd, &amp;<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <span class="keyword">sizeof</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>));</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">/* only realloc if there was a length */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = ntohl(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    tmp = <a class="code" href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;data, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span>(tmp == NULL)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;data = tmp;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = socket_read(fd, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;data, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;size = conn-&gt;mech-&gt;decode(conn-&gt;app_data, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;data, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                 conn-&gt;data_prot, conn);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;index = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;buffer_read(<span class="keyword">struct</span> krb5buffer *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">void</span> *<a class="code" href="structdata.html">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;size - <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;index &lt; <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;size - <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;index;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="structdata.html">data</a>, (<span class="keywordtype">char</span> *)<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;data + <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;index, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>-&gt;index += <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/* Matches Curl_recv signature */</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> sec_recv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;{</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">size_t</span> bytes_read;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordtype">size_t</span> total_read = 0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">/* Handle clear text response. */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;sec_complete == 0 || conn-&gt;data_prot == PROT_CLEAR)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">return</span> read(fd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;in_buffer.eof_flag) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    conn-&gt;in_buffer.eof_flag = 0;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  bytes_read = buffer_read(&amp;conn-&gt;in_buffer, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= bytes_read;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  total_read += bytes_read;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> += bytes_read;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &gt; 0) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span>(read_data(conn, fd, &amp;conn-&gt;in_buffer))</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;in_buffer.size == 0) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">if</span>(bytes_read &gt; 0)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        conn-&gt;in_buffer.eof_flag = 1;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">return</span> bytes_read;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    bytes_read = buffer_read(&amp;conn-&gt;in_buffer, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= bytes_read;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    total_read += bytes_read;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> += bytes_read;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">/* FIXME: Check for overflow */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">return</span> total_read;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/* Send |length| bytes from |from| to the |fd| socket taking care of encoding</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">   and negociating with the server. |from| can be NULL. */</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">/* FIXME: We don&#39;t check for errors nor report any! */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> do_sec_send(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span> *from, <span class="keywordtype">int</span> length)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">int</span> bytes, htonl_bytes; <span class="comment">/* 32-bit integers for htonl */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> = NULL;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">char</span> *cmd_buffer;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">size_t</span> cmd_size = 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> error;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keyword">enum</span> protection_level prot_level = conn-&gt;data_prot;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">bool</span> iscmd = (prot_level == PROT_CMD)?<a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>:<a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(prot_level &gt; PROT_NONE &amp;&amp; prot_level &lt; PROT_LAST);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">if</span>(iscmd) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">if</span>(!strncmp(from, <span class="stringliteral">&quot;PASS &quot;</span>, 5) || !strncmp(from, <span class="stringliteral">&quot;ACCT &quot;</span>, 5))</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      prot_level = PROT_PRIVATE;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      prot_level = conn-&gt;command_prot;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  bytes = conn-&gt;mech-&gt;encode(conn-&gt;app_data, from, length, prot_level,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                             (<span class="keywordtype">void</span> **)&amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> || bytes &lt;= 0)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">/* error */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">if</span>(iscmd) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    error = <a class="code" href="base64_8c.html#a1208ff63d0b4ca9cead4a3cdefc033c2">Curl_base64_encode</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="warnless_8c.html#aac8918e24555de89db40527e6d87475d">curlx_sitouz</a>(bytes),</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                               &amp;cmd_buffer, &amp;cmd_size);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span>(error) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">return</span>; <span class="comment">/* error */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span>(cmd_size &gt; 0) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *enc = <span class="stringliteral">&quot;ENC &quot;</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *mic = <span class="stringliteral">&quot;MIC &quot;</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">if</span>(prot_level == PROT_PRIVATE)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        socket_write(conn, fd, enc, 4);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        socket_write(conn, fd, mic, 4);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      socket_write(conn, fd, cmd_buffer, cmd_size);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      socket_write(conn, fd, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Send: %s%s\n&quot;</span>, prot_level == PROT_PRIVATE?enc:mic,</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            cmd_buffer);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cmd_buffer);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    htonl_bytes = htonl(bytes);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    socket_write(conn, fd, &amp;htonl_bytes, <span class="keyword">sizeof</span>(htonl_bytes));</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    socket_write(conn, fd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="warnless_8c.html#aac8918e24555de89db40527e6d87475d">curlx_sitouz</a>(bytes));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> sec_write(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd,</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> length)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> tx = 0, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = conn-&gt;buffer_size;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> -= conn-&gt;mech-&gt;overhead(conn-&gt;app_data, conn-&gt;data_prot,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                              <a class="code" href="warnless_8c.html#a40217f7b524689590750a9feb6b64657">curlx_sztosi</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>));</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> &lt;= 0)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = length;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">while</span>(length) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span>(length &lt; (<span class="keywordtype">size_t</span>)<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = length;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    do_sec_send(conn, fd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="warnless_8c.html#a40217f7b524689590750a9feb6b64657">curlx_sztosi</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>));</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    length -= <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> += <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    tx += <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">return</span> tx;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">/* Matches Curl_send signature */</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> sec_send(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *err)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> fd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  *err = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">return</span> sec_write(conn, fd, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordtype">int</span> Curl_sec_read_msg(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                      <span class="keyword">enum</span> protection_level level)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">/* decoded_len should be size_t or ssize_t but conn-&gt;mech-&gt;decode returns an</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">     int */</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordtype">int</span> decoded_len;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordtype">int</span> ret_code = 0;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordtype">size_t</span> decoded_sz = 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> error;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;mech)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">/* not inititalized, return error */</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(level &gt; PROT_NONE &amp;&amp; level &lt; PROT_LAST);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  error = <a class="code" href="base64_8c.html#a3b1d7d4873cc224ffb2ce6ff201bc2e6">Curl_base64_decode</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> + 4, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **)&amp;<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, &amp;decoded_sz);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span>(error || decoded_sz == 0)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span>(decoded_sz &gt; (<span class="keywordtype">size_t</span>)INT_MAX) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  decoded_len = <a class="code" href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a>(decoded_sz);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  decoded_len = conn-&gt;mech-&gt;decode(conn-&gt;app_data, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, decoded_len,</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                   level, conn);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">if</span>(decoded_len &lt;= 0) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">set</a>.<a class="code" href="struct_user_defined.html#a5a5553b0cb30c0014b4c53d2ba0825f3">verbose</a>) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[decoded_len] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <a class="code" href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a7d8a29d35245d116245a1bd1f31f0175">CURLINFO_HEADER_IN</a>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, decoded_len + 1);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[decoded_len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span>(decoded_len &lt;= 3)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">/* suspiciously short */</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[3] != <span class="charliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">/* safe to ignore return code */</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    (void)sscanf(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="stringliteral">&quot;%d&quot;</span>, &amp;ret_code);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[decoded_len - 1] == <span class="charliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[decoded_len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">/* FIXME: Is |buffer| length always greater than |decoded_len|? */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  strcpy(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">return</span> ret_code;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/* FIXME: The error code returned here is never checked. */</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sec_set_protection_level(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;{</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordtype">char</span> *pbsz;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buffer_size = 1 &lt;&lt; 20; <span class="comment">/* 1048576 */</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">enum</span> protection_level level = conn-&gt;request_data_prot;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(level &gt; PROT_NONE &amp;&amp; level &lt; PROT_LAST);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">if</span>(!conn-&gt;sec_complete) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Trying to change the protection level after the&quot;</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                      <span class="stringliteral">&quot; completion of the data exchange.\n&quot;</span>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">/* Bail out if we try to set up the same level */</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;data_prot == level)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span>(level) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = ftp_send_command(conn, <span class="stringliteral">&quot;PBSZ %u&quot;</span>, buffer_size);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> &lt; 0)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>/100 != 2) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed to set the protection&#39;s buffer size.&quot;</span>);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    conn-&gt;buffer_size = buffer_size;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    pbsz = strstr(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>-&gt;<a class="code" href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">state</a>.<a class="code" href="struct_url_state.html#a049af7985a282087c2a21aa90cee0e1c">buffer</a>, <span class="stringliteral">&quot;PBSZ=&quot;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span>(pbsz) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="comment">/* ignore return code, use default value if it fails */</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      (void)sscanf(pbsz, <span class="stringliteral">&quot;PBSZ=%u&quot;</span>, &amp;buffer_size);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">if</span>(buffer_size &lt; conn-&gt;buffer_size)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        conn-&gt;buffer_size = buffer_size;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">/* Now try to negiociate the protection level. */</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = ftp_send_command(conn, <span class="stringliteral">&quot;PROT %c&quot;</span>, level_to_char(level));</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> &lt; 0)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a>/100 != 2) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;Failed to set the protection level.&quot;</span>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  conn-&gt;data_prot = level;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span>(level == PROT_PRIVATE)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    conn-&gt;command_prot = level;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordtype">int</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;Curl_sec_request_prot(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *level)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keyword">enum</span> protection_level l = name_to_level(level);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span>(l == PROT_NONE)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(l &gt; PROT_NONE &amp;&amp; l &lt; PROT_LAST);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  conn-&gt;request_data_prot = l;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> choose_mech(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordtype">void</span> *tmp_allocation;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__sec__client__mech.html">Curl_sec_client_mech</a> *mech = &amp;Curl_krb5_client_mech;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  tmp_allocation = <a class="code" href="curl__memory_8h.html#aa568500a9ca507b5a53de5372c81f26a">realloc</a>(conn-&gt;app_data, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#a8fd5c1d6abd6910982bb806c63acff83">size</a>);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">if</span>(tmp_allocation == NULL) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed realloc of size %zu&quot;</span>, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#a8fd5c1d6abd6910982bb806c63acff83">size</a>);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    mech = NULL;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  conn-&gt;app_data = tmp_allocation;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span>(mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#a7eb4029a8fe519b275f55b5d5744d27e">init</a>) {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    ret = mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#a7eb4029a8fe519b275f55b5d5744d27e">init</a>(conn-&gt;app_data);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span>(ret) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Failed initialization for %s. Skipping it.\n&quot;</span>,</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">name</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Trying mechanism %s...\n&quot;</span>, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">name</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  ret = ftp_send_command(conn, <span class="stringliteral">&quot;AUTH %s&quot;</span>, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">name</a>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span>(ret &lt; 0)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">/* FIXME: This error is too generic but it is OK for now. */</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordflow">if</span>(ret/100 != 3) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">switch</span>(ret) {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">case</span> 504:</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Mechanism %s is not supported by the server (server &quot;</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <span class="stringliteral">&quot;returned ftp code: 504).\n&quot;</span>, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">name</a>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">case</span> 534:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Mechanism %s was rejected by the server (server returned &quot;</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="stringliteral">&quot;ftp code: 534).\n&quot;</span>, mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">name</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">if</span>(ret/100 == 5) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;server does not support the security extensions\n&quot;</span>);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">/* Authenticate */</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  ret = mech-&gt;<a class="code" href="struct_curl__sec__client__mech.html#aa9e0b369682b6f704faa6ee2c8eaf0ef">auth</a>(conn-&gt;app_data, conn);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordflow">if</span>(ret != <a class="code" href="curl__sec_8h.html#a685a12ac086401d6ca0c0c1bc4e6bf14">AUTH_CONTINUE</a>) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span>(ret != <a class="code" href="curl__sec_8h.html#a3eec421a4aa4499514a884eb909a63c8">AUTH_OK</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="comment">/* Mechanism has dumped the error to stderr, don&#39;t error here. */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(ret == <a class="code" href="curl__sec_8h.html#a3eec421a4aa4499514a884eb909a63c8">AUTH_OK</a>);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    conn-&gt;mech = mech;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    conn-&gt;sec_complete = 1;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>] = sec_recv;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>] = sec_send;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = sec_recv;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[<a class="code" href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a>] = sec_send;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    conn-&gt;command_prot = PROT_SAFE;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">/* Set the requested protection level */</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">/* BLOCKING */</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    (void)sec_set_protection_level(conn);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;Curl_sec_login(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;{</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">return</span> choose_mech(conn);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;Curl_sec_end(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;{</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;mech != NULL &amp;&amp; conn-&gt;mech-&gt;end)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    conn-&gt;mech-&gt;end(conn-&gt;app_data);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(conn-&gt;app_data);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  conn-&gt;app_data = NULL;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;in_buffer.<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(conn-&gt;in_buffer.<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    conn-&gt;in_buffer.<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a> = NULL;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    conn-&gt;in_buffer.size = 0;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    conn-&gt;in_buffer.index = 0;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">/* FIXME: Is this really needed? */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    conn-&gt;in_buffer.eof_flag = 0;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  conn-&gt;sec_complete = 0;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  conn-&gt;data_prot = PROT_CLEAR;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  conn-&gt;mech = NULL;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;}</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_GSSAPI */</span><span class="preprocessor"></span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_DISABLE_FTP */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="struct_curl__easy_html_a15aced4a015c44ff454787debee23520"><div class="ttname"><a href="struct_curl__easy.html#a15aced4a015c44ff454787debee23520">Curl_easy::state</a></div><div class="ttdeci">struct UrlState state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01795">urldata.h:1795</a></div></div>
<div class="ttc" id="url_8d_html_a1bc9666de113dffcfaf5d5c84eac6469"><div class="ttname"><a href="url_8d.html#a1bc9666de113dffcfaf5d5c84eac6469">written</a></div><div class="ttdeci">Long POP3 or SMTP then that protocol will be otherwise HTTP will be used.Since..guessing can be disabled by setting a default see proto default for details.This option may be used any number of times.To control where this URL is written</div><div class="ttdef"><b>Definition:</b> <a href="url_8d_source.html#l00010">url.d:10</a></div></div>
<div class="ttc" id="ftp_8c_html_ab65c9f67cc4c67672341d00c4b7110f5"><div class="ttname"><a href="ftp_8c.html#ab65c9f67cc4c67672341d00c4b7110f5">Curl_ftpsend</a></div><div class="ttdeci">CURLcode Curl_ftpsend(struct connectdata *conn, const char *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l03956">ftp.c:3956</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae3a33eef0d22573e545dc857bf3e6105">CURLE_USE_SSL_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00536">curl.h:536</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="struct_curl__sec__client__mech_html_a8fd5c1d6abd6910982bb806c63acff83"><div class="ttname"><a href="struct_curl__sec__client__mech.html#a8fd5c1d6abd6910982bb806c63acff83">Curl_sec_client_mech::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00027">curl_sec.h:27</a></div></div>
<div class="ttc" id="strcase_8h_html"><div class="ttname"><a href="strcase_8h.html">strcase.h</a></div></div>
<div class="ttc" id="structconnectdata_html_aec2de2220c36ec447f6101e85bf0a52b"><div class="ttname"><a href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">connectdata::recv</a></div><div class="ttdeci">Curl_recv * recv[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00879">urldata.h:879</a></div></div>
<div class="ttc" id="curl_8h_html_a9704d2633927f77efaa3e3c6f1c23a14a7d8a29d35245d116245a1bd1f31f0175"><div class="ttname"><a href="curl_8h.html#a9704d2633927f77efaa3e3c6f1c23a14a7d8a29d35245d116245a1bd1f31f0175">CURLINFO_HEADER_IN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00434">curl.h:434</a></div></div>
<div class="ttc" id="base64_8c_html_a3b1d7d4873cc224ffb2ce6ff201bc2e6"><div class="ttname"><a href="base64_8c.html#a3b1d7d4873cc224ffb2ce6ff201bc2e6">Curl_base64_decode</a></div><div class="ttdeci">CURLcode Curl_base64_decode(const char *src, unsigned char **outptr, size_t *outlen)</div><div class="ttdef"><b>Definition:</b> <a href="base64_8c_source.html#l00099">base64.c:99</a></div></div>
<div class="ttc" id="struct_curl__sec__client__mech_html_ac4ad556db25cf135fb615b7cbae71924"><div class="ttname"><a href="struct_curl__sec__client__mech.html#ac4ad556db25cf135fb615b7cbae71924">Curl_sec_client_mech::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00026">curl_sec.h:26</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="sendf_8c_html_a22e207bc5193c73143f3445e788204c2"><div class="ttname"><a href="sendf_8c.html#a22e207bc5193c73143f3445e788204c2">Curl_write_plain</a></div><div class="ttdeci">CURLcode Curl_write_plain(struct connectdata *conn, curl_socket_t sockfd, const void *mem, size_t len, ssize_t *written)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00428">sendf.c:428</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="unit1608_8c_html_afb9ed1b8a27eb20854efe6e23e297683"><div class="ttname"><a href="unit1608_8c.html#afb9ed1b8a27eb20854efe6e23e297683">code</a></div><div class="ttdeci">CURLcode code</div><div class="ttdef"><b>Definition:</b> <a href="unit1608_8c_source.html#l00047">unit1608.c:47</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="warnless_8c_html_aac8918e24555de89db40527e6d87475d"><div class="ttname"><a href="warnless_8c.html#aac8918e24555de89db40527e6d87475d">curlx_sitouz</a></div><div class="ttdeci">size_t curlx_sitouz(int sinum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00445">warnless.c:445</a></div></div>
<div class="ttc" id="base64_8c_html_a1208ff63d0b4ca9cead4a3cdefc033c2"><div class="ttname"><a href="base64_8c.html#a1208ff63d0b4ca9cead4a3cdefc033c2">Curl_base64_encode</a></div><div class="ttdeci">CURLcode Curl_base64_encode(struct Curl_easy *data, const char *inputbuff, size_t insize, char **outptr, size_t *outlen)</div><div class="ttdef"><b>Definition:</b> <a href="base64_8c_source.html#l00290">base64.c:290</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="ftp_8c_html_a6c80331789cf6af62a7379f76f6202f6"><div class="ttname"><a href="ftp_8c.html#a6c80331789cf6af62a7379f76f6202f6">Curl_GetFTPResponse</a></div><div class="ttdeci">CURLcode Curl_GetFTPResponse(ssize_t *nreadp, struct connectdata *conn, int *ftpcode)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00628">ftp.c:628</a></div></div>
<div class="ttc" id="struct_curl__sec__client__mech_html_a7eb4029a8fe519b275f55b5d5744d27e"><div class="ttname"><a href="struct_curl__sec__client__mech.html#a7eb4029a8fe519b275f55b5d5744d27e">Curl_sec_client_mech::init</a></div><div class="ttdeci">int(* init)(void *)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00028">curl_sec.h:28</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00564">curl.h:564</a></div></div>
<div class="ttc" id="urldata_8h_html_ac1138557ffc9ee3a520805205b76daee"><div class="ttname"><a href="urldata_8h.html#ac1138557ffc9ee3a520805205b76daee">SECONDARYSOCKET</a></div><div class="ttdeci">#define SECONDARYSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00481">urldata.h:481</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa568500a9ca507b5a53de5372c81f26a"><div class="ttname"><a href="curl__memory_8h.html#aa568500a9ca507b5a53de5372c81f26a">realloc</a></div><div class="ttdeci">#define realloc(ptr, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00128">curl_memory.h:128</a></div></div>
<div class="ttc" id="warnless_8c_html_a02468fae1f563370c5e18045d5bc2ecb"><div class="ttname"><a href="warnless_8c.html#a02468fae1f563370c5e18045d5bc2ecb">curlx_uztosi</a></div><div class="ttdeci">int curlx_uztosi(size_t uznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00203">warnless.c:203</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="sendf_8c_html_a00c49d227c9a5f1b8f1df9e8c7204102"><div class="ttname"><a href="sendf_8c.html#a00c49d227c9a5f1b8f1df9e8c7204102">Curl_read_plain</a></div><div class="ttdeci">CURLcode Curl_read_plain(curl_socket_t sockfd, char *buf, size_t bytesfromsocket, ssize_t *n)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00682">sendf.c:682</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a600c484dc2160f73477f9e1b2d3db513">CURLE_LOGIN_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00540">curl.h:540</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="struct_curl__sec__client__mech_html"><div class="ttname"><a href="struct_curl__sec__client__mech.html">Curl_sec_client_mech</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00025">curl_sec.h:25</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curl__sec_8h_html_a685a12ac086401d6ca0c0c1bc4e6bf14"><div class="ttname"><a href="curl__sec_8h.html#a685a12ac086401d6ca0c0c1bc4e6bf14">AUTH_CONTINUE</a></div><div class="ttdeci">#define AUTH_CONTINUE</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00038">curl_sec.h:38</a></div></div>
<div class="ttc" id="ftp_8h_html"><div class="ttname"><a href="ftp_8h.html">ftp.h</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="curl__printf_8h_html_afc68cf69040d2c835650f9a217b98439"><div class="ttname"><a href="curl__printf_8h.html#afc68cf69040d2c835650f9a217b98439">mvsnprintf</a></div><div class="ttdeci">#define mvsnprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00045">curl_printf.h:45</a></div></div>
<div class="ttc" id="strdup_8c_html_a3a3f98ad97deebcb223f165b377f3879"><div class="ttname"><a href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a></div><div class="ttdeci">void * Curl_saferealloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="strdup_8c_source.html#l00093">strdup.c:93</a></div></div>
<div class="ttc" id="remote-name_8d_html_aa335f8bb20424b03700f57b150bf0aa6"><div class="ttname"><a href="remote-name_8d.html#aa335f8bb20424b03700f57b150bf0aa6">name</a></div><div class="ttdeci">Long the path is cut off.The file will be saved in the current working directory.If you want the file saved in a different make sure you change the current working directory before invoking curl with this option.The remote file name to use for saving is extracted from the given nothing and if it already exists it will be overwritten.If you want the server to be able to choose the file name refer to remote header name which can be used in addition to this option.If the server chooses a file name and that name already exists it will not be overwritten.There is no URL decoding done on the file name.If it has or other URL encoded parts of the name</div><div class="ttdef"><b>Definition:</b> <a href="remote-name_8d_source.html#l00006">remote-name.d:6</a></div></div>
<div class="ttc" id="struct_curl__sec__client__mech_html_aa9e0b369682b6f704faa6ee2c8eaf0ef"><div class="ttname"><a href="struct_curl__sec__client__mech.html#aa9e0b369682b6f704faa6ee2c8eaf0ef">Curl_sec_client_mech::auth</a></div><div class="ttdeci">int(* auth)(void *, struct connectdata *)</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00029">curl_sec.h:29</a></div></div>
<div class="ttc" id="sendf_8c_html_a8b0f0a06869b888abb80a069182d0d5a"><div class="ttname"><a href="sendf_8c.html#a8b0f0a06869b888abb80a069182d0d5a">Curl_debug</a></div><div class="ttdeci">int Curl_debug(struct Curl_easy *data, curl_infotype type, char *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8c_source.html#l00776">sendf.c:776</a></div></div>
<div class="ttc" id="structconnectdata_html_ada83cbd7d295b87033b7ea635c0a5dd5"><div class="ttname"><a href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">connectdata::send</a></div><div class="ttdeci">Curl_send * send[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00880">urldata.h:880</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="strdup_8h_html"><div class="ttname"><a href="strdup_8h.html">strdup.h</a></div></div>
<div class="ttc" id="struct_curl__easy_html_abcc5aa61af150adc1388b1a3492c2599"><div class="ttname"><a href="struct_curl__easy.html#abcc5aa61af150adc1388b1a3492c2599">Curl_easy::set</a></div><div class="ttdeci">struct UserDefined set</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01788">urldata.h:1788</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a90b98fc82c9d84afa3a8a3f82d283388">CURLE_COULDNT_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00466">curl.h:466</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a7c5e621b8f31e5f941e6044519b4c9c9">CURLE_FAILED_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00460">curl.h:460</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="warnless_8c_html_a40217f7b524689590750a9feb6b64657"><div class="ttname"><a href="warnless_8c.html#a40217f7b524689590750a9feb6b64657">curlx_sztosi</a></div><div class="ttdeci">int curlx_sztosi(ssize_t sznum)</div><div class="ttdef"><b>Definition:</b> <a href="warnless_8c_source.html#l00366">warnless.c:366</a></div></div>
<div class="ttc" id="struct_user_defined_html_a5a5553b0cb30c0014b4c53d2ba0825f3"><div class="ttname"><a href="struct_user_defined.html#a5a5553b0cb30c0014b4c53d2ba0825f3">UserDefined::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01643">urldata.h:1643</a></div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="curl__sec_8h_html_a3eec421a4aa4499514a884eb909a63c8"><div class="ttname"><a href="curl__sec_8h.html#a3eec421a4aa4499514a884eb909a63c8">AUTH_OK</a></div><div class="ttdeci">#define AUTH_OK</div><div class="ttdef"><b>Definition:</b> <a href="curl__sec_8h_source.html#l00037">curl_sec.h:37</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="curl__sec_8h_html"><div class="ttname"><a href="curl__sec_8h.html">curl_sec.h</a></div></div>
<div class="ttc" id="strcase_8h_html_a23b67e200b6f4c3ead633c94b3edcdb3"><div class="ttname"><a href="strcase_8h.html#a23b67e200b6f4c3ead633c94b3edcdb3">checkprefix</a></div><div class="ttdeci">#define checkprefix(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="strcase_8h_source.html#l00046">strcase.h:46</a></div></div>
<div class="ttc" id="struct_url_state_html_a049af7985a282087c2a21aa90cee0e1c"><div class="ttname"><a href="struct_url_state.html#a049af7985a282087c2a21aa90cee0e1c">UrlState::buffer</a></div><div class="ttdeci">char * buffer</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01258">urldata.h:1258</a></div></div>
<div class="ttc" id="warnless_8h_html"><div class="ttname"><a href="warnless_8h.html">warnless.h</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="form_8d_html_ac776e8c2aa1a100ee6a391f59441ccf4"><div class="ttname"><a href="form_8d.html#ac776e8c2aa1a100ee6a391f59441ccf4">to</a></div><div class="ttdeci">since the full size is unknown before the transfer such data is sent as chunks by HTTP and rejected by IMAP.where &amp;profile is the name of the form field to which the file portrait.jpg will be the but get the contents for it from a local in a manner similar to</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00028">form.d:28</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="curl__base64_8h_html"><div class="ttname"><a href="curl__base64_8h.html">curl_base64.h</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="security_8c.html">security.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
