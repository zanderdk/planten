<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cpp_utils/MFRC522.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_m_f_r_c522_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MFRC522.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_m_f_r_c522_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">* MFRC522.cpp - Library to use ARDUINO RFID MODULE KIT 13.56 MHZ WITH TAGS SPI W AND R BY COOQROBOT.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* NOTE: Please also check the comments in MFRC522.h - they provide useful hints and background information.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">* Released into the public domain.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Notes:</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * This source file modified from the Github project found here:</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * https://github.com/miguelbalboa/rfid</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Changes made to accommodate native ESP32 and ESP32 C++ class wrappers.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * Neil Kolban, July 2017.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_m_f_r_c522_8h.html">MFRC522.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_m_f_r_c522_debug_8h.html">MFRC522Debug.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_free_r_t_o_s_8h.html">FreeRTOS.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_g_p_i_o_8h.html">GPIO.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;esp_log.h&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> LOG_TAG[] = <span class="stringliteral">&quot;MFRC522&quot;</span>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//#include &quot;MFRC522Debug.h&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// Functions for setting up the Arduino</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// Basic interface functions for communicating with the MFRC522</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">   47</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">MFRC522::PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    uint8_t <a class="code" href="structdata.html">data</a>[2];</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="structdata.html">data</a>[0] = reg;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="structdata.html">data</a>[1] = <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a83984b2c70af70005b39071ea88fb45c">ESP32CPP::GPIO::low</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Select slave</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#a3d0d6d9b84a7191b4a95971eee25f746">transfer</a>(<a class="code" href="structdata.html">data</a>, 2);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Release slave</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;} <span class="comment">// End PCD_WriteRegister()</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a846b4b9d0468b62d853b125d4b269054">   66</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">MFRC522::PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> count, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    uint8_t* pData = <span class="keyword">new</span> uint8_t[count + 1];</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    pData[0] = reg;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(pData + 1, <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>, count);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a83984b2c70af70005b39071ea88fb45c">ESP32CPP::GPIO::low</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Select slave</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#a3d0d6d9b84a7191b4a95971eee25f746">transfer</a>(pData, count + 1);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Release slave</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keyword">delete</span>[] pData;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;} <span class="comment">// End PCD_WriteRegister()</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">   84</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">MFRC522::PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    uint8_t <a class="code" href="structdata.html">data</a>[2];</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="structdata.html">data</a>[0] = reg | 0x80;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="structdata.html">data</a>[1] = 0;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a83984b2c70af70005b39071ea88fb45c">ESP32CPP::GPIO::low</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Select slave</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#a3d0d6d9b84a7191b4a95971eee25f746">transfer</a>(<a class="code" href="structdata.html">data</a>, 2);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Release slave</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structdata.html">data</a>[1];</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;} <span class="comment">// End PCD_ReadRegister()</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ae84aeb5b0cab567ac0445ae76c16a86b">  105</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">MFRC522::PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> count, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> rxAlign) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (count == 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">//Serial.print(F(&quot;Reading &quot;));  Serial.print(count); Serial.println(F(&quot; bytes from register.&quot;));</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> address = 0x80 | reg;              <span class="comment">// MSB == 1 is for reading. LSB is not used in address. Datasheet section 8.1.2.3.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> index = 0;                         <span class="comment">// Index in values array.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    count--;                                <span class="comment">// One read is performed outside of the loop</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a83984b2c70af70005b39071ea88fb45c">ESP32CPP::GPIO::low</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Select slave</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#aff890367df7fa27734d18c772eb227df">transferByte</a>(address);                    <span class="comment">// Tell MFRC522 which address we want to read</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (rxAlign) {      <span class="comment">// Only update bit positions rxAlign..7 in values[0]</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="comment">// Create bit mask for bit positions rxAlign..7</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> mask = (0xFF &lt;&lt; rxAlign) &amp; 0xFF;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// Read value and tell that we want to read the same address again.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#aff890367df7fa27734d18c772eb227df">transferByte</a>(address);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// Apply mask to both current value of values[0] and the new data in value.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[0] = (<a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[0] &amp; ~mask) | (<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; mask);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        index++;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">while</span> (index &lt; count) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[index] = <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#aff890367df7fa27734d18c772eb227df">transferByte</a>(address);    <span class="comment">// Read value and tell that we want to read the same address again.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        index++;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[index] = <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#aff890367df7fa27734d18c772eb227df">transferByte</a>(0);          <span class="comment">// Read the final byte. Send 0 to stop reading.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>); <span class="comment">// Release slave</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} <span class="comment">// End PCD_ReadRegister()</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#acebb9a90249419f2a53281c4a13727d1">  138</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#acebb9a90249419f2a53281c4a13727d1">MFRC522::PCD_SetRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> mask) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> tmp;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    tmp = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(reg);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(reg, tmp | mask);     <span class="comment">// set bit mask</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;} <span class="comment">// End PCD_SetRegisterBitMask()</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">  150</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">MFRC522::PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">PCD_Register</a> reg, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> mask) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> tmp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    tmp = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(reg);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(reg, tmp &amp; (~mask));      <span class="comment">// clear bit mask</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;} <span class="comment">// End PCD_ClearRegisterBitMask()</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">  164</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">MFRC522::PCD_CalculateCRC</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="structdata.html">data</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> length, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9">PCD_Idle</a>);        <span class="comment">// Stop any active command.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a95e26d5ece97ae43c34d08797205a356">DivIrqReg</a>, 0x04);             <span class="comment">// Clear the CRCIRq interrupt request bit</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">FIFOLevelReg</a>, 0x80);          <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, length, <a class="code" href="structdata.html">data</a>);   <span class="comment">// Write data to the FIFO</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a61d1786d5518a1ad71aac8413941f0ac">PCD_CalcCRC</a>);     <span class="comment">// Start the calculation</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// Wait for the CRC calculation to complete. Each iteration of the while-loop takes 17.73μs.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// TODO check/modify for other architectures than Arduino Uno 16bit</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// Wait for the CRC calculation to complete. Each iteration of the while-loop takes 17.73us.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">for</span> (uint16_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 5000; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt; 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>--) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">// DivIrqReg[7..0] bits are: Set2 reserved reserved MfinActIRq reserved CRCIRq reserved reserved</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a95e26d5ece97ae43c34d08797205a356">DivIrqReg</a>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &amp; 0x04) {                             <span class="comment">// CRCIRq bit set - calculation done</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9">PCD_Idle</a>);    <span class="comment">// Stop calculating CRC for new content in the FIFO.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="comment">// Transfer the result from the registers to the result buffer</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>[0] = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a4be013336d7bab727dc0e7e150dcd03c">CRCResultRegL</a>);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>[1] = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a430d34a355d45528d674ad839a187494">CRCResultRegH</a>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// 89ms passed and nothing happend. Communication with the MFRC522 might be down.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">STATUS_TIMEOUT</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;} <span class="comment">// End PCD_CalculateCRC()</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">// Functions for manipulating the MFRC522</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ad681e424fc68a57941bea5702cee05eb">  197</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#ad681e424fc68a57941bea5702cee05eb">MFRC522::PCD_Init</a>() {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">//m_spi.setHost(VSPI_HOST);</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#ac1599d926502a487e0e7518dc343a833">ESP32CPP::GPIO::setOutput</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">m_spi</a>.<a class="code" href="class_s_p_i.html#a832556869c632024fe6ab92473854131">init</a>();</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">bool</span> hardReset = <span class="keyword">false</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// Set the chipSelectPin as digital output, do not select the slave yet</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// pinMode(_chipSelectPin, OUTPUT);</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// digitalWrite(_chipSelectPin, HIGH);</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// If a valid pin number has been set, pull device out of power down / reset state.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a> != <a class="code" href="class_m_f_r_c522.html#a41313d0e4a8a674271e64362d24e1d6b">UNUSED_PIN</a>) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// Set the resetPowerDownPin as digital output, do not reset or power down.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">//pinMode(_resetPowerDownPin, OUTPUT);</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#afd43e7bc27885215900f7780197a0247">ESP32CPP::GPIO::setInput</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a>);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#add68250ce86665c502405a353ef1c870">ESP32CPP::GPIO::read</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a>)) {    <span class="comment">// The MFRC522 chip is in power down mode.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#ac1599d926502a487e0e7518dc343a833">ESP32CPP::GPIO::setOutput</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <a class="code" href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a>((gpio_num_t)<a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a>);       <span class="comment">// Exit power down mode. This triggers a hard reset.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="comment">// Section 8.8.2 in the datasheet says the oscillator start-up time is the start up time of the crystal + 37,74μs. Let us be generous: 50ms.</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <a class="code" href="class_free_r_t_o_s.html#abea19fd141147c054f47c6a00e77f2ff">FreeRTOS::sleep</a>(50);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            hardReset = <span class="keyword">true</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (!hardReset) { <span class="comment">// Perform a soft reset if we haven&#39;t triggered a hard reset above.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="class_m_f_r_c522.html#a9886678ea0a65021bf602cfb110caa15">PCD_Reset</a>();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Reset baud rates</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad4fe18ad01abc83d4559369226fe7992">TxModeReg</a>, 0x00);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a7e0d6ae1fdd25be6d80d1b76b2274764">RxModeReg</a>, 0x00);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// Reset ModWidthReg</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad69a6a3d883ebfc993fc6fbdbc035508">ModWidthReg</a>, 0x26);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// When communicating with a PICC we need a timeout if something goes wrong.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// f_timer = 13.56 MHz / (2*TPreScaler+1) where TPreScaler = [TPrescaler_Hi:TPrescaler_Lo].</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// TPrescaler_Hi are the four low bits in TModeReg. TPrescaler_Lo is TPrescalerReg.</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a1ed52e7f88c8bf3fda91bf31bb62afe4">TModeReg</a>, 0x80);          <span class="comment">// TAuto=1; timer starts automatically at the end of the transmission in all communication modes at all speeds</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ac9a037a517ada62924c47d5e4b62a14c">TReloadRegH</a>, 0x03);       <span class="comment">// Reload timer with 0x3E8 = 1000, ie 25ms before timeout.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a88c2ad7cdfb7178ea775c157f4ce5213">TPrescalerReg</a>, 0xA9);  <span class="comment">// TPreScaler = TModeReg[3..0]:TPrescalerReg, ie 0x0A9 = 169 =&gt; f_timer=40kHz, ie a timer period of 25μs.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ac9a037a517ada62924c47d5e4b62a14c">TReloadRegH</a>, 0x03);   <span class="comment">// Reload timer with 0x3E8 = 1000, ie 25ms before timeout.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afa3348d82b026de8fecdd18d58e92e2a">TReloadRegL</a>, 0xE8);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ac9de33ca066ca9481bd01d5642a0c879">TxASKReg</a>, 0x40);     <span class="comment">// Default 0x00. Force a 100 % ASK modulation independent of the ModGsPReg register setting</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a2cd647ad1ac1327d2a632115cd9c4477">ModeReg</a>, 0x3D);       <span class="comment">// Default 0x3F. Set the preset value for the CRC coprocessor for the CalcCRC command to 0x6363 (ISO 14443-3 part 6.2.4)</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a044be037a5f172e9cea7d8ce1dcf32e0">PCD_AntennaOn</a>();                         <span class="comment">// Enable the antenna driver pins TX1 and TX2 (they were disabled by the reset)</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;} <span class="comment">// End PCD_Init()</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a3a14c851e9a2f62956db01d5666c284b">  255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#ad681e424fc68a57941bea5702cee05eb">MFRC522::PCD_Init</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> chipSelectPin, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> resetPowerDownPin) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">_chipSelectPin</a> = chipSelectPin;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">_resetPowerDownPin</a> = resetPowerDownPin;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// Set the chipSelectPin as digital output, do not select the slave yet</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="class_m_f_r_c522.html#ad681e424fc68a57941bea5702cee05eb">PCD_Init</a>();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;} <span class="comment">// End PCD_Init()</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a9886678ea0a65021bf602cfb110caa15">  266</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a9886678ea0a65021bf602cfb110caa15">MFRC522::PCD_Reset</a>() {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a8f54a569867f812163c6a9bc3461d03a">PCD_SoftReset</a>);   <span class="comment">// Issue the SoftReset command.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// The datasheet does not mention how long the SoftRest command takes to complete.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// But the MFRC522 might have been in soft power-down mode (triggered by bit 4 of CommandReg)</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// Section 8.8.2 in the datasheet says the oscillator start-up time is the start up time of the crystal + 37,74μs. Let us be generous: 50ms.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="class_free_r_t_o_s.html#abea19fd141147c054f47c6a00e77f2ff">FreeRTOS::sleep</a>(50);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// Wait for the PowerDown bit in CommandReg to be cleared</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>) &amp; (1 &lt;&lt; 4)) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment">// PCD still restarting - unlikely after waiting 50ms, but better safe than sorry.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;} <span class="comment">// End PCD_Reset()</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a044be037a5f172e9cea7d8ce1dcf32e0">  283</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a044be037a5f172e9cea7d8ce1dcf32e0">MFRC522::PCD_AntennaOn</a>() {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a73dc12b03f05177a400263e5e2bcf0cc">TxControlReg</a>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; 0x03) != 0x03) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a73dc12b03f05177a400263e5e2bcf0cc">TxControlReg</a>, <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> | 0x03);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;} <span class="comment">// End PCD_AntennaOn()</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a2098ebe85700109b20c5026643f1dad7">  294</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a2098ebe85700109b20c5026643f1dad7">MFRC522::PCD_AntennaOff</a>() {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a73dc12b03f05177a400263e5e2bcf0cc">TxControlReg</a>, 0x03);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;} <span class="comment">// End PCD_AntennaOff()</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aa02ae994a9ebf146475f46fc538cef28">  306</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="class_m_f_r_c522.html#aa02ae994a9ebf146475f46fc538cef28">MFRC522::PCD_GetAntennaGain</a>() {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0c99eea491c71e9d2a02bf8a86988adf">RFCfgReg</a>) &amp; (0x07 &lt;&lt; 4);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;} <span class="comment">// End PCD_GetAntennaGain()</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a5ce84dd855f2ae297dd00fafaf62ef78">  316</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a5ce84dd855f2ae297dd00fafaf62ef78">MFRC522::PCD_SetAntennaGain</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> mask) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_m_f_r_c522.html#aa02ae994a9ebf146475f46fc538cef28">PCD_GetAntennaGain</a>() != mask) {         <span class="comment">// only bother if there is a change</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0c99eea491c71e9d2a02bf8a86988adf">RFCfgReg</a>, (0x07 &lt;&lt; 4));    <span class="comment">// clear needed to allow 000 pattern</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="class_m_f_r_c522.html#acebb9a90249419f2a53281c4a13727d1">PCD_SetRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0c99eea491c71e9d2a02bf8a86988adf">RFCfgReg</a>, mask &amp; (0x07&lt;&lt;4)); <span class="comment">// only set RxGain[2:0] bits</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;} <span class="comment">// End PCD_SetAntennaGain()</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a25f052c9c340da34128c365662370b01">  330</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_m_f_r_c522.html#a25f052c9c340da34128c365662370b01">MFRC522::PCD_PerformSelfTest</a>() {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// This follows directly the steps outlined in 16.1.1</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// 1. Perform a soft reset.</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a9886678ea0a65021bf602cfb110caa15">PCD_Reset</a>();</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// 2. Clear the internal buffer by writing 25 bytes of 00h</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> ZEROES[25] = {0x00};</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">FIFOLevelReg</a>, 0x80);      <span class="comment">// flush the FIFO buffer</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, 25, ZEROES); <span class="comment">// write 25 bytes of 00h to FIFO</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a2f3a9f820c74cb11fabdc00e20c7e2fe">PCD_Mem</a>);     <span class="comment">// transfer to internal buffer</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// 3. Enable self-test</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a9583618ad17a8a20b7a735c7677c8e56">AutoTestReg</a>, 0x09);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// 4. Write 00h to FIFO buffer</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, 0x00);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// 5. Start self-test by issuing the CalcCRC command</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a61d1786d5518a1ad71aac8413941f0ac">PCD_CalcCRC</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// 6. Wait for self-test to complete</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 0xFF; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">// The datasheet does not specify exact completion condition except</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">// that FIFO buffer should contain 64 bytes.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// While selftest is initiated by CalcCRC command</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment">// it behaves differently from normal CRC computation,</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="comment">// so one can&#39;t reliably use DivIrqReg to check for completion.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment">// It is reported that some devices does not trigger CRCIRq flag</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment">// during selftest.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">FIFOLevelReg</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &gt;= 64) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9">PCD_Idle</a>);        <span class="comment">// Stop calculating CRC for new content in the FIFO.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// 7. Read out resulting 64 bytes from the FIFO buffer.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>[64];</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, 64, <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>, 0);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// Auto self-test done</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// Reset AutoTestReg register to be 0 again. Required for normal operation.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a9583618ad17a8a20b7a735c7677c8e56">AutoTestReg</a>, 0x00);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// Determine firmware version (see section 9.3.4.8 in spec)</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a4281c25cf6743163ed2e2f903cf17ba9">VersionReg</a>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// Pick the appropriate reference values</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keyword">const</span> <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> *reference;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a>) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">case</span> 0x88:  <span class="comment">// Fudan Semiconductor FM17522 clone</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            reference = <a class="code" href="_m_f_r_c522_8h.html#a040e482a6d103ae2d02987bec8c3277e">FM17522_firmware_reference</a>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">case</span> 0x90:  <span class="comment">// Version 0.0</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            reference = <a class="code" href="_m_f_r_c522_8h.html#a22163b77459e20191d7f3141a6ef6a13">MFRC522_firmware_referenceV0_0</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">case</span> 0x91:  <span class="comment">// Version 1.0</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            reference = <a class="code" href="_m_f_r_c522_8h.html#a1822b5145427f25cf8a046438f01268a">MFRC522_firmware_referenceV1_0</a>;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">case</span> 0x92:  <span class="comment">// Version 2.0</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            reference = <a class="code" href="_m_f_r_c522_8h.html#a6441056e4526a6a02f9314b16651f4b1">MFRC522_firmware_referenceV2_0</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">default</span>:    <span class="comment">// Unknown version</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// abort test</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// Verify that the results match up to our expectations</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 64; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != (reference[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>])) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// Test passed; all is good.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;} <span class="comment">// End PCD_PerformSelfTest()</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">// Functions for communicating with PICCs</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">  422</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">MFRC522::PCD_TransceiveData</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* sendData, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sendLen, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* backData, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* backLen, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* validBits, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> rxAlign, <span class="keywordtype">bool</span> checkCRC) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> waitIRq = 0x30;        <span class="comment">// RxIRq and IdleIRq</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">PCD_CommunicateWithPICC</a>(<a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd">PCD_Transceive</a>, waitIRq, sendData, sendLen, backData, backLen, validBits, rxAlign, checkCRC);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;} <span class="comment">// End PCD_TransceiveData()</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">  443</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">MFRC522::PCD_CommunicateWithPICC</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> waitIRq, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* sendData, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sendLen, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* backData, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* backLen, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* validBits, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> rxAlign, <span class="keywordtype">bool</span> checkCRC) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// Prepare values for BitFramingReg</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> txLastBits = validBits ? *validBits : (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>) 0;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bitFraming = (rxAlign &lt;&lt; 4) + txLastBits;      <span class="comment">// RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9">PCD_Idle</a>);            <span class="comment">// Stop any active command.</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a76b2a615444982e04566784bdb5c9841">ComIrqReg</a>, 0x7F);                 <span class="comment">// Clear all seven interrupt request bits</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">FIFOLevelReg</a>, 0x80);              <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, sendLen, sendData);  <span class="comment">// Write sendData to the FIFO</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669aaf8beb5a739cd8bf94b8b5c8d2d109ce">BitFramingReg</a>, bitFraming);       <span class="comment">// Bit adjustments</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">CommandReg</a>, <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>);             <span class="comment">// Execute the command</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a> == <a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd">PCD_Transceive</a>) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="class_m_f_r_c522.html#acebb9a90249419f2a53281c4a13727d1">PCD_SetRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669aaf8beb5a739cd8bf94b8b5c8d2d109ce">BitFramingReg</a>, 0x80);    <span class="comment">// StartSend=1, transmission of data starts</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// Wait for the command to complete.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// In PCD_Init() we set the TAuto flag in TModeReg. This means the timer automatically starts when the PCD stops transmitting.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// Each iteration of the do-while-loop takes 17.86μs.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// TODO check/modify for other architectures than Arduino Uno 16bit</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    uint16_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 2000; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt; 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>--) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a76b2a615444982e04566784bdb5c9841">ComIrqReg</a>);   <span class="comment">// ComIrqReg[7..0] bits are: Set1 TxIRq RxIRq IdleIRq HiAlertIRq LoAlertIRq ErrIRq TimerIRq</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &amp; waitIRq) {                  <span class="comment">// One of the interrupts that signal success has been set.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &amp; 0x01) {                     <span class="comment">// Timer interrupt - nothing received in 25ms</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">STATUS_TIMEOUT</a>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// 35.7ms and nothing happend. Communication with the MFRC522 might be down.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> == 0) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">STATUS_TIMEOUT</a>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Stop now if any errors except collisions were detected.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> errorRegValue = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a240aa03a1d9542235b89cdef377a5796">ErrorReg</a>); <span class="comment">// ErrorReg[7..0] bits are: WrErr TempErr reserved BufferOvfl CollErr CRCErr ParityErr ProtocolErr</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (errorRegValue &amp; 0x13) {  <span class="comment">// BufferOvfl ParityErr ProtocolErr</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">STATUS_ERROR</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> _validBits = 0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">// If the caller wants data back, get it from the MFRC522.</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (backData &amp;&amp; backLen) {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">FIFOLevelReg</a>);    <span class="comment">// Number of bytes in the FIFO</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &gt; *backLen) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a45ce24f67052f4813df3b0f4efaafea8">STATUS_NO_ROOM</a>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        *backLen = <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;                       <span class="comment">// Number of bytes returned</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">FIFODataReg</a>, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, backData, rxAlign);    <span class="comment">// Get received data from FIFO</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        _validBits = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a9d0df9e03ad6706004b003e20127a76a">ControlReg</a>) &amp; 0x07;       <span class="comment">// RxLastBits[2:0] indicates the number of valid bits in the last received byte. If this value is 000b, the whole byte is valid.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">if</span> (validBits) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            *validBits = _validBits;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Tell about collisions</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (errorRegValue &amp; 0x08) {     <span class="comment">// CollErr</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993">STATUS_COLLISION</a>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// Perform CRC_A validation if requested.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span> (backData &amp;&amp; backLen &amp;&amp; checkCRC) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">// In this case a MIFARE Classic NAK is not OK.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> (*backLen == 1 &amp;&amp; _validBits == 4) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ad14f5e1a33047c90b50fa829cb669109">STATUS_MIFARE_NACK</a>;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">// We need at least the CRC_A value and all 8 bits of the last byte must be received.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">if</span> (*backLen &lt; 2 || _validBits != 0) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ac25a91c2efa2dc7638758321374f7566">STATUS_CRC_WRONG</a>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment">// Verify CRC_A - do our own calculation and store the control in controlBuffer.</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> controlBuffer[2];</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> status = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(&amp;backData[0], *backLen - 2, &amp;controlBuffer[0]);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span> (status != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span> ((backData[*backLen - 2] != controlBuffer[0]) || (backData[*backLen - 1] != controlBuffer[1])) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ac25a91c2efa2dc7638758321374f7566">STATUS_CRC_WRONG</a>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;} <span class="comment">// End PCD_CommunicateWithPICC()</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a4e0ac6edf5e8f6ade351b009278fbbc7">  527</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a4e0ac6edf5e8f6ade351b009278fbbc7">MFRC522::PICC_RequestA</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferATQA, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferSize) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a639d27ac072bc0dfa478d0957591afcc">PICC_REQA_or_WUPA</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341aee3203a0a40028d3059861464198b688">PICC_CMD_REQA</a>, bufferATQA, bufferSize);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;} <span class="comment">// End PICC_RequestA()</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ad00a1efcfa6dc203ca885d43f4d02125">  540</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#ad00a1efcfa6dc203ca885d43f4d02125">MFRC522::PICC_WakeupA</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferATQA, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferSize) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a639d27ac072bc0dfa478d0957591afcc">PICC_REQA_or_WUPA</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a9b8fbd1c87d0a6bbe2ef78d192001b3a">PICC_CMD_WUPA</a>, bufferATQA, bufferSize);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;} <span class="comment">// End PICC_WakeupA()</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a639d27ac072bc0dfa478d0957591afcc">  554</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a639d27ac072bc0dfa478d0957591afcc">MFRC522::PICC_REQA_or_WUPA</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferATQA, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferSize) {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> validBits;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> status;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afafb7ec88f79c9b1f195195497d0ca07">CollReg</a>, 0x80);        <span class="comment">// ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    validBits = 7;                                  <span class="comment">// For REQA and WUPA we need the short frame format - transmit only 7 bits of the last (and only) byte. TxLastBits = BitFramingReg[2..0]</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (bufferATQA == <span class="keyword">nullptr</span> || *bufferSize &lt; 2) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a45ce24f67052f4813df3b0f4efaafea8">STATUS_NO_ROOM</a>; <span class="comment">// The ATQA response is 2 bytes long.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    status = <a class="code" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">PCD_TransceiveData</a>(&amp;<a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, 1, bufferATQA, bufferSize, &amp;validBits);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (status != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> (*bufferSize != 2 || validBits != 0) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">STATUS_ERROR</a>; <span class="comment">// ATQA must be exactly 16 bits.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;} <span class="comment">// End PICC_REQA_or_WUPA()</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a7a78c629cb4e1d90cc2d7526b17d6c22">  586</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a7a78c629cb4e1d90cc2d7526b17d6c22">MFRC522::PICC_Select</a>(<a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> validBits) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">bool</span> uidComplete;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordtype">bool</span> selectDone;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">bool</span> useCascadeTag;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cascadeLevel = 1;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> count;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> index;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> uidIndex;                  <span class="comment">// The first index in uid-&gt;uidByte[] that is used in the current Cascade Level.</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    int8_t currentLevelKnownBits;       <span class="comment">// The number of known UID bits in the current Cascade Level.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[9];                 <span class="comment">// The SELECT/ANTICOLLISION commands uses a 7 byte standard frame + 2 bytes CRC_A</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bufferUsed;                <span class="comment">// The number of bytes used in the buffer, ie the number of bytes to transfer to the FIFO.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> rxAlign;                   <span class="comment">// Used in BitFramingReg. Defines the bit position for the first bit received.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> txLastBits;                <span class="comment">// Used in BitFramingReg. The number of valid bits in the last transmitted byte.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* responseBuffer;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> responseLength;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// Description of buffer structure:</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">//      Byte 0: SEL                 Indicates the Cascade Level: PICC_CMD_SEL_CL1, PICC_CMD_SEL_CL2 or PICC_CMD_SEL_CL3</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">//      Byte 1: NVB                 Number of Valid Bits (in complete command, not just the UID): High nibble: complete bytes, Low nibble: Extra bits.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">//      Byte 2: UID-data or CT      See explanation below. CT means Cascade Tag.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">//      Byte 3: UID-data</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">//      Byte 4: UID-data</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="comment">//      Byte 5: UID-data</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">//      Byte 6: BCC                 Block Check Character - XOR of bytes 2-5</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">//      Byte 7: CRC_A</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">//      Byte 8: CRC_A</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// The BCC and CRC_A are only transmitted if we know all the UID bits of the current Cascade Level.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// Description of bytes 2-5: (Section 6.5.4 of the ISO/IEC 14443-3 draft: UID contents and cascade levels)</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="comment">//      UID size    Cascade level   Byte2   Byte3   Byte4   Byte5</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">//      ========    =============   =====   =====   =====   =====</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">//       4 bytes        1           uid0    uid1    uid2    uid3</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">//       7 bytes        1           CT      uid0    uid1    uid2</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//                      2           uid3    uid4    uid5    uid6</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">//      10 bytes        1           CT      uid0    uid1    uid2</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">//                      2           CT      uid3    uid4    uid5</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">//                      3           uid6    uid7    uid8    uid9</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">// Sanity checks</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> (validBits &gt; 80) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5">STATUS_INVALID</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">// Prepare MFRC522</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afafb7ec88f79c9b1f195195497d0ca07">CollReg</a>, 0x80);        <span class="comment">// ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">// Repeat Cascade Level loop until we have a complete UID.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    uidComplete = <span class="keyword">false</span>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">while</span> (!uidComplete) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="comment">// Set the Cascade Level in the SEL byte, find out if we need to use the Cascade Tag in byte 2.</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">switch</span> (cascadeLevel) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341aa9329ee8f72f61f5d73bb893b64c08d0">PICC_CMD_SEL_CL1</a>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                uidIndex = 0;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                useCascadeTag = validBits &amp;&amp; <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">size</a> &gt; 4; <span class="comment">// When we know that the UID has more than 4 bytes</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ab0399cde7122f0bb6dedb584254455c2">PICC_CMD_SEL_CL2</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                uidIndex = 3;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                useCascadeTag = validBits &amp;&amp; <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">size</a> &gt; 7; <span class="comment">// When we know that the UID has more than 7 bytes</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a291c265bc0a7b3f303b361582b95cc85">PICC_CMD_SEL_CL3</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                uidIndex = 6;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                useCascadeTag = <span class="keyword">false</span>;                      <span class="comment">// Never used in CL3.</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a851307266f677fd58db61540ffe76855">STATUS_INTERNAL_ERROR</a>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">// How many UID bits are known in this Cascade Level?</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        currentLevelKnownBits = validBits - (8 * uidIndex);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> (currentLevelKnownBits &lt; 0) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            currentLevelKnownBits = 0;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="comment">// Copy the known bits from uid-&gt;uidByte[] to buffer[]</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        index = 2; <span class="comment">// destination index in buffer[]</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">if</span> (useCascadeTag) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index++] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ac532079d67a5325cc5b3505cccf6ac8b">PICC_CMD_CT</a>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bytesToCopy = currentLevelKnownBits / 8 + (currentLevelKnownBits % 8 ? 1 : 0); <span class="comment">// The number of bytes needed to represent the known bits for this level.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordflow">if</span> (bytesToCopy) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> maxBytes = useCascadeTag ? 3 : 4; <span class="comment">// Max 4 bytes in each Cascade Level. Only 3 left if we use the Cascade Tag</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">if</span> (bytesToCopy &gt; maxBytes) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                bytesToCopy = maxBytes;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <span class="keywordflow">for</span> (count = 0; count &lt; bytesToCopy; count++) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index++] = <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a5581167c1e1c8beb98c44ff86f4fbc52">uidByte</a>[uidIndex + count];</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="comment">// Now that the data has been copied we need to include the 8 bits in CT in currentLevelKnownBits</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> (useCascadeTag) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            currentLevelKnownBits += 8;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="comment">// Repeat anti collision loop until we can transmit all UID bits + BCC and receive a SAK - max 32 iterations.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        selectDone = <span class="keyword">false</span>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">while</span> (!selectDone) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="comment">// Find out how many bits and bytes to send and receive.</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordflow">if</span> (currentLevelKnownBits &gt;= 32) { <span class="comment">// All UID bits in this Cascade Level are known. This is a SELECT.</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                <span class="comment">//Serial.print(F(&quot;SELECT: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1] = 0x70; <span class="comment">// NVB - Number of Valid Bits: Seven whole bytes</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="comment">// Calculate BCC - Block Check Character</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[6] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2] ^ <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3] ^ <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[4] ^ <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[5];</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                <span class="comment">// Calculate CRC_A</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 7, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[7]);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                txLastBits      = 0; <span class="comment">// 0 =&gt; All 8 bits are valid.</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                bufferUsed      = 9;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <span class="comment">// Store response in the last 3 bytes of buffer (BCC and CRC_A - not needed after tx)</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                responseBuffer  = &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[6];</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                responseLength  = 3;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">// This is an ANTICOLLISION.</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                <span class="comment">//Serial.print(F(&quot;ANTICOLLISION: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                txLastBits      = currentLevelKnownBits % 8;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                count           = currentLevelKnownBits / 8;    <span class="comment">// Number of whole bytes in the UID part.</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                index           = 2 + count;                    <span class="comment">// Number of whole bytes: SEL + NVB + UIDs</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1]       = (index &lt;&lt; 4) + txLastBits;    <span class="comment">// NVB - Number of Valid Bits</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                bufferUsed      = index + (txLastBits ? 1 : 0);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="comment">// Store response in the unused part of buffer</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                responseBuffer  = &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index];</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                responseLength  = <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>) - index;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="comment">// Set bit adjustments</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            rxAlign = txLastBits;                                           <span class="comment">// Having a separate variable is overkill. But it makes the next line easier to read.</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669aaf8beb5a739cd8bf94b8b5c8d2d109ce">BitFramingReg</a>, (rxAlign &lt;&lt; 4) + txLastBits);  <span class="comment">// RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="comment">// Transmit the buffer and receive the response.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">PCD_TransceiveData</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, bufferUsed, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993">STATUS_COLLISION</a>) { <span class="comment">// More than one PICC in the field =&gt; collision.</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> valueOfCollReg = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afafb7ec88f79c9b1f195195497d0ca07">CollReg</a>); <span class="comment">// CollReg[7..0] bits are: ValuesAfterColl reserved CollPosNotValid CollPos[4:0]</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                <span class="keywordflow">if</span> (valueOfCollReg &amp; 0x20) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993">STATUS_COLLISION</a>; <span class="comment">// CollPosNotValid, Without a valid collision position we cannot continue</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> collisionPos = valueOfCollReg &amp; 0x1F; <span class="comment">// Values 0-31, 0 means bit 32.</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="keywordflow">if</span> (collisionPos == 0) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    collisionPos = 32;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="keywordflow">if</span> (collisionPos &lt;= currentLevelKnownBits) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a851307266f677fd58db61540ffe76855">STATUS_INTERNAL_ERROR</a>; <span class="comment">// No progress - should not happen</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <span class="comment">// Choose the PICC with the bit set.</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                currentLevelKnownBits = collisionPos;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                count           = (currentLevelKnownBits - 1) % 8; <span class="comment">// The bit to modify</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                index           = 1 + (currentLevelKnownBits / 8) + (count ? 1 : 0); <span class="comment">// First byte is index 0.</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index]   |= (1 &lt;&lt; count);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">else</span> { <span class="comment">// STATUS_OK</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="keywordflow">if</span> (currentLevelKnownBits &gt;= 32) { <span class="comment">// This was a SELECT.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    selectDone = <span class="keyword">true</span>; <span class="comment">// No more anticollision</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    <span class="comment">// We continue below outside the while.</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">// This was an ANTICOLLISION.</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    <span class="comment">// We now have all 32 bits of the UID in this Cascade Level</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    currentLevelKnownBits = 32;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    <span class="comment">// Run loop again to do the SELECT.</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        } <span class="comment">// End of while (!selectDone)</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="comment">// We do not check the CBB - it was constructed by us above.</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">// Copy the found UID bytes from buffer[] to uid-&gt;uidByte[]</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        index           = (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2] == <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ac532079d67a5325cc5b3505cccf6ac8b">PICC_CMD_CT</a>) ? 3 : 2; <span class="comment">// source index in buffer[]</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        bytesToCopy     = (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2] == <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ac532079d67a5325cc5b3505cccf6ac8b">PICC_CMD_CT</a>) ? 3 : 4;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">for</span> (count = 0; count &lt; bytesToCopy; count++) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a5581167c1e1c8beb98c44ff86f4fbc52">uidByte</a>[uidIndex + count] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index++];</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">// Check response SAK (Select Acknowledge)</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">if</span> (responseLength != 3 || txLastBits != 0) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">STATUS_ERROR</a>; <span class="comment">// SAK must be exactly 24 bits (1 byte + CRC_A).</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="comment">// Verify CRC_A - do our own calculation and store the control in buffer[2..3] - those bytes are not needed anymore.</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(responseBuffer, 1, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2]);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2] != responseBuffer[1]) || (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3] != responseBuffer[2])) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ac25a91c2efa2dc7638758321374f7566">STATUS_CRC_WRONG</a>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">if</span> (responseBuffer[0] &amp; 0x04) { <span class="comment">// Cascade bit set - UID not complete yes</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            cascadeLevel++;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            uidComplete = <span class="keyword">true</span>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a90aa2fd57a03011252148c2ccdc8875b">sak</a> = responseBuffer[0];</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    } <span class="comment">// End of while (!uidComplete)</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="comment">// Set correct uid-&gt;size</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">size</a> = 3 * cascadeLevel + 1;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;} <span class="comment">// End PICC_Select()</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a8874921b4ed26c5b73d89c90f76d4933">  782</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a8874921b4ed26c5b73d89c90f76d4933">MFRC522::PICC_HaltA</a>() {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[4];</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// Build command buffer</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ad1e0cf89f52ca1b503297e59c600ca57">PICC_CMD_HLTA</a>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1] = 0;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// Calculate CRC_A</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 2, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2]);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// Send the command.</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// The standard says:</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">//      If the PICC responds with any modulation during a period of 1 ms after the end of the frame containing the</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">//      HLTA command, this response shall be interpreted as &#39;not acknowledge&#39;.</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// We interpret that this way: Only STATUS_TIMEOUT is a success.</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">PCD_TransceiveData</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>), <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">STATUS_TIMEOUT</a>) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">STATUS_ERROR</a>; <span class="comment">// That is ironically NOT ok in this case ;-)</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;} <span class="comment">// End PICC_HaltA()</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">// Functions for communicating with MIFARE PICCs</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a6c2313c4aa98806cc2bf0e9cca993ec0">  827</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a6c2313c4aa98806cc2bf0e9cca993ec0">MFRC522::PCD_Authenticate</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, <a class="code" href="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key.html">MIFARE_Key</a>* <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> waitIRq = 0x10;        <span class="comment">// IdleIRq</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="comment">// Build command buffer</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sendData[12];</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    sendData[0] = <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    sendData[1] = blockAddr;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; <a class="code" href="class_m_f_r_c522.html#a92c17a5b83cc4fde3cc3454c03b8eedea410c51021b253b680b7ec518ccc818ce">MF_KEY_SIZE</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {    <span class="comment">// 6 key bytes</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        sendData[2 + <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>-&gt;keyByte[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="comment">// Use the last uid bytes as specified in http://cache.nxp.com/documents/application_note/AN10927.pdf</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// section 3.2.5 &quot;MIFARE Classic Authentication&quot;.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// The only missed case is the MF1Sxxxx shortcut activation,</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// but it requires cascade tag (CT) byte, that is not part of uid.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 4; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {      <span class="comment">// The last 4 bytes of the UID</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        sendData[8 + <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a5581167c1e1c8beb98c44ff86f4fbc52">uidByte</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">size</a> - 4];</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// Start the authentication.</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">PCD_CommunicateWithPICC</a>(<a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a903753278eed75d5d1af2390649ec0c2">PCD_MFAuthent</a>, waitIRq, &amp;sendData[0], <span class="keyword">sizeof</span>(sendData));</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;} <span class="comment">// End PCD_Authenticate()</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a24d3ab7b2170fdfa3f0121a7256f12d9">  854</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a24d3ab7b2170fdfa3f0121a7256f12d9">MFRC522::PCD_StopCrypto1</a>() {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// Clear MFCrypto1On bit</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">PCD_ClearRegisterBitMask</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a8fb1a8c28b7a860793831566373f172f">Status2Reg</a>, 0x08); <span class="comment">// Status2Reg[7..0] bits are: TempSensClear I2CForceHS reserved reserved MFCrypto1On ModemState[2:0]</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;} <span class="comment">// End PCD_StopCrypto1()</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">  879</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">MFRC522::MIFARE_Read</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* bufferSize) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// Sanity check</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> == <span class="keyword">nullptr</span> || *bufferSize &lt; 18) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a45ce24f67052f4813df3b0f4efaafea8">STATUS_NO_ROOM</a>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// Build command buffer</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a2ea95497e35adbc7acbc32c0cb8a574a">PICC_CMD_MF_READ</a>;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1] = blockAddr;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">// Calculate CRC_A</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 2, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2]);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="comment">// Transmit the buffer and receive the response, validate CRC_A.</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">PCD_TransceiveData</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, bufferSize, <span class="keyword">nullptr</span>, 0, <span class="keyword">true</span>);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;} <span class="comment">// End MIFARE_Read()</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a0dc5fb05769779ec3ed708bd153706b3">  910</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a0dc5fb05769779ec3ed708bd153706b3">MFRC522::MIFARE_Write</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bufferSize) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="comment">// Sanity check</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> == <span class="keyword">nullptr</span> || bufferSize &lt; 16) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5">STATUS_INVALID</a>;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="comment">// Mifare Classic protocol requires two communications to perform a write.</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="comment">// Step 1: Tell the PICC we want to write to block blockAddr.</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBuffer[2];</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    cmdBuffer[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a02ccb020ccc6d49d563f0ed1489d8025">PICC_CMD_MF_WRITE</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    cmdBuffer[1] = blockAddr;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>(cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">// Step 2: Transfer the data</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, bufferSize); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;} <span class="comment">// End MIFARE_Write()</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a7053e61540b68e6aa5c6cbea308836c4">  939</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a7053e61540b68e6aa5c6cbea308836c4">MFRC522::MIFARE_Ultralight_Write</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> page, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bufferSize) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">// Sanity check</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> == <span class="keyword">nullptr</span> || bufferSize &lt; 4) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5">STATUS_INVALID</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">// Build commmand buffer</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBuffer[6];</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    cmdBuffer[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ae8aeabd1ddb73db2f04259c76eaccd8e">PICC_CMD_UL_WRITE</a>;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    cmdBuffer[1] = page;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(&amp;cmdBuffer[2], <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 4);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// Perform the write</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>(cmdBuffer, 6); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;} <span class="comment">// End MIFARE_Ultralight_Write()</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aeab21496c761cdecb29c69f9f3fa6150">  969</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#aeab21496c761cdecb29c69f9f3fa6150">MFRC522::MIFARE_Decrement</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, int32_t delta) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6">MIFARE_TwoStepHelper</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a69b2bb1cd2dc0437d6d1fb11eb2796e7">PICC_CMD_MF_DECREMENT</a>, blockAddr, delta);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;} <span class="comment">// End MIFARE_Decrement()</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#af9566664f23d4d67efd270e42c3dc723">  984</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#af9566664f23d4d67efd270e42c3dc723">MFRC522::MIFARE_Increment</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, int32_t delta) {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6">MIFARE_TwoStepHelper</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a454e12c2c815a861a0450d40273f98ef">PICC_CMD_MF_INCREMENT</a>, blockAddr, delta);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;} <span class="comment">// End MIFARE_Increment()</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a946ba7e7e244f40adcb9f900d8fd3a48">  998</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a946ba7e7e244f40adcb9f900d8fd3a48">MFRC522::MIFARE_Restore</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// The datasheet describes Restore as a two step operation, but does not explain what data to transfer in step 2.</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// Doing only a single step does not work, so I chose to transfer 0L in step two.</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6">MIFARE_TwoStepHelper</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ab8ed49cb6ed6228acb0c911d60758486">PICC_CMD_MF_RESTORE</a>, blockAddr, 0L);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;} <span class="comment">// End MIFARE_Restore()</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6"> 1013</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6">MFRC522::MIFARE_TwoStepHelper</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, int32_t <a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBuffer[2]; <span class="comment">// We only need room for 2 bytes.</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">// Step 1: Tell the PICC the command and block address</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    cmdBuffer[0] = <a class="code" href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    cmdBuffer[1] = blockAddr;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>(cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">// Step 2: Transfer the data</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>((<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>*) &amp;<a class="code" href="structdata.html">data</a>, 4, <span class="keyword">true</span>); <span class="comment">// Adds CRC_A and accept timeout as success.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;} <span class="comment">// End MIFARE_TwoStepHelper()</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a16ee66df69fda8a3065bc9218b45de0b"> 1039</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#a16ee66df69fda8a3065bc9218b45de0b">MFRC522::MIFARE_Transfer</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBuffer[2]; <span class="comment">// We only need room for 2 bytes.</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// Tell the PICC we want to transfer the result into block blockAddr.</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    cmdBuffer[0] = <a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a5d2309094d9fa17125dc90394e5aeaa0">PICC_CMD_MF_TRANSFER</a>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    cmdBuffer[1] = blockAddr;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">PCD_MIFARE_Transceive</a>(cmdBuffer, 2); <span class="comment">// Adds CRC_A and checks that the response is MF_ACK.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;} <span class="comment">// End MIFARE_Transfer()</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ab4009cbdd5150b1b3a62084aa2033807"> 1063</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#ab4009cbdd5150b1b3a62084aa2033807">MFRC522::MIFARE_GetValue</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, int32_t* <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> status;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[18];</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a> = <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// Read the block</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    status = <a class="code" href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">MIFARE_Read</a>(blockAddr, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, &amp;<a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">if</span> (status == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="comment">// Extract the value</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        *<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3]) &lt;&lt; 24) | (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2]) &lt;&lt; 16) | (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1]) &lt;&lt; 8) | int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0]);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;} <span class="comment">// End MIFARE_GetValue()</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#af19fc75e9415322fbe89245ed70a784b"> 1089</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#af19fc75e9415322fbe89245ed70a784b">MFRC522::MIFARE_SetValue</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr, int32_t <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a>) {</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[18];</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// Translate the int32_t into 4 bytes; repeated 2x in value block</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[ 8] = (<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; 0xFF);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[ 9] = (<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; 0xFF00) &gt;&gt; 8;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[10] = (<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; 0xFF0000) &gt;&gt; 16;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[11] = (<a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &amp; 0xFF000000) &gt;&gt; 24;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// Inverse 4 bytes also found in value block</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[4] = ~<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0];</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[5] = ~<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1];</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[6] = ~<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2];</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[7] = ~<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3];</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">// Address 2x with inverse address 2x</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[12] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[14] = blockAddr;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[13] = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[15] = ~blockAddr;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">// Write the whole data block</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a0dc5fb05769779ec3ed708bd153706b3">MIFARE_Write</a>(blockAddr, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, 16);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;} <span class="comment">// End MIFARE_SetValue()</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#acb47eb7a05ae58825b4085efeb7a09bb"> 1120</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#acb47eb7a05ae58825b4085efeb7a09bb">MFRC522::PCD_NTAG216_AUTH</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* passWord, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> pACK[]) { <span class="comment">//Authenticate with 32bit password</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">// TODO: Fix cmdBuffer length and rxlength. They really should match.</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">//       (Better still, rxlength should not even be necessary.)</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>                cmdBuffer[18]; <span class="comment">// We need room for 16 bytes data and 2 bytes CRC_A.</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    cmdBuffer[0] = 0x1B; <span class="comment">//Comando de autentificacion</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 4; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        cmdBuffer[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> + 1] = passWord[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(cmdBuffer, 5, &amp;cmdBuffer[5]);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>!=<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// Transceive the data, store the reply in cmdBuffer[]</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> waitIRq        = 0x30; <span class="comment">// RxIRq and IdleIRq</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">//  byte cmdBufferSize  = sizeof(cmdBuffer);</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> validBits      = 0;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> rxlength       = 5;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">PCD_CommunicateWithPICC</a>(<a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd">PCD_Transceive</a>, waitIRq, cmdBuffer, 7, cmdBuffer, &amp;rxlength, &amp;validBits);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    pACK[0] = cmdBuffer[0];</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    pACK[1] = cmdBuffer[1];</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>!=<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;} <span class="comment">// End PCD_NTAG216_AUTH()</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">// Support functions</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b"> 1167</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">MFRC522::PCD_MIFARE_Transceive</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* sendData, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sendLen, <span class="keywordtype">bool</span> acceptTimeout) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBuffer[18]; <span class="comment">// We need room for 16 bytes data and 2 bytes CRC_A.</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="comment">// Sanity check</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">if</span> (sendData == <span class="keyword">nullptr</span> || sendLen &gt; 16) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5">STATUS_INVALID</a>;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">// Copy sendData[] to cmdBuffer[] and add CRC_A</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(cmdBuffer, sendData, sendLen);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">PCD_CalculateCRC</a>(cmdBuffer, sendLen, &amp;cmdBuffer[sendLen]);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    sendLen += 2;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">// Transceive the data, store the reply in cmdBuffer[]</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> waitIRq = 0x30;        <span class="comment">// RxIRq and IdleIRq</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> cmdBufferSize = <span class="keyword">sizeof</span>(cmdBuffer);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> validBits = 0;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">PCD_CommunicateWithPICC</a>(<a class="code" href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd">PCD_Transceive</a>, waitIRq, cmdBuffer, sendLen, cmdBuffer, &amp;cmdBufferSize, &amp;validBits);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (acceptTimeout &amp;&amp; <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">STATUS_TIMEOUT</a>) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// The PICC must reply with a 4 bit ACK</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span> (cmdBufferSize != 1 || validBits != 4) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">STATUS_ERROR</a>;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (cmdBuffer[0] != <a class="code" href="class_m_f_r_c522.html#a92c17a5b83cc4fde3cc3454c03b8eedea3b5fce9bf15481d218872d4584743a1c">MF_ACK</a>) <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ad14f5e1a33047c90b50fa829cb669109">STATUS_MIFARE_NACK</a>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;} <span class="comment">// End PCD_MIFARE_Transceive()</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ac80a18228260bdde07dff5d4ac23bb53"> 1200</a></span>&#160;<a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2">MFRC522::PICC_Type</a> <a class="code" href="class_m_f_r_c522.html#ac80a18228260bdde07dff5d4ac23bb53">MFRC522::PICC_GetType</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sak) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="comment">// http://www.nxp.com/documents/application_note/AN10833.pdf</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">// 3.2 Coding of Select Acknowledge (SAK)</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">// ignore 8-bit (iso14443 starts with LSBit = bit 1)</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="comment">// fixes wrong type for manufacturer Infineon (http://nfc-tools.org/index.php?title=ISO14443A)</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    sak &amp;= 0x7F;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">switch</span> (sak) {</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keywordflow">case</span> 0x04:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a06fbbb7628bd0c595c58b96547cb8960">PICC_TYPE_NOT_COMPLETE</a>;  <span class="comment">// UID not complete</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <span class="keywordflow">case</span> 0x09:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a58d34a16ef064d4679cae921ecc4b505">PICC_TYPE_MIFARE_MINI</a>;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">case</span> 0x08:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a948d034c12fd457923b65f929b1538fb">PICC_TYPE_MIFARE_1K</a>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordflow">case</span> 0x18:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a7d2d0cfef1abe1c457fb72ebcf81fad4">PICC_TYPE_MIFARE_4K</a>;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordflow">case</span> 0x00:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a905f84b972470f7d80ed017817ae300c">PICC_TYPE_MIFARE_UL</a>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordflow">case</span> 0x10:</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">case</span> 0x11:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a16d53e0355d6214dbe7faf7e37c99002">PICC_TYPE_MIFARE_PLUS</a>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">case</span> 0x01:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a3efaeaa8963b24323f274bab4c1eaf8f">PICC_TYPE_TNP3XXX</a>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="keywordflow">case</span> 0x20:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a5c8147b0f3970c9db0a177cb44592bc7">PICC_TYPE_ISO_14443_4</a>;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">case</span> 0x40:  <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a6d211bf0d6e1bed8f7cdb375e9137360">PICC_TYPE_ISO_18092</a>;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">default</span>:    <span class="keywordflow">return</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2aceba425b4eb6fd85de456a04e1ce1565">PICC_TYPE_UNKNOWN</a>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    }</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;} <span class="comment">// End PICC_GetType()</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a41c31c6932a59646eeff470c60a4d20d"> 1226</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a41c31c6932a59646eeff470c60a4d20d">MFRC522::PCD_DumpVersionToSerial</a>() {</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// Get the MFRC522 firmware version</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> v = <a class="code" href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">PCD_ReadRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a4281c25cf6743163ed2e2f903cf17ba9">VersionReg</a>);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;Firmware Version: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; (int)v;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="comment">// Lookup which version</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">switch</span>(v) {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">case</span> 0x88: oss &lt;&lt; <span class="stringliteral">&quot; = (clone)&quot;</span>;  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keywordflow">case</span> 0x90: oss &lt;&lt; <span class="stringliteral">&quot; = v0.0&quot;</span>;     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">case</span> 0x91: oss &lt;&lt; <span class="stringliteral">&quot; = v1.0&quot;</span>;     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        <span class="keywordflow">case</span> 0x92: oss &lt;&lt; <span class="stringliteral">&quot; = v2.0&quot;</span>;     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <span class="keywordflow">default</span>:   oss &lt;&lt; <span class="stringliteral">&quot; = (unknown)&quot;</span>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    }</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="comment">// When 0x00 or 0xFF is returned, communication probably failed</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">if</span> ((v == 0x00) || (v == 0xFF)) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;WARNING: Communication failure, is the MFRC522 properly connected?&quot;</span>);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;} <span class="comment">// End PCD_DumpVersionToSerial()</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a6f324d43c6fbbd0e260b171747186037"> 1257</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a6f324d43c6fbbd0e260b171747186037">MFRC522::PICC_DumpToSerial</a>(<a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <a class="code" href="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key.html">MIFARE_Key</a> <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="comment">// Dump UID, SAK and Type</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a3b9a2c6da6505e0ff7b58c37d7aeff37">PICC_DumpDetailsToSerial</a>(<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="comment">// Dump contents</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2">PICC_Type</a> piccType = <a class="code" href="class_m_f_r_c522.html#ac80a18228260bdde07dff5d4ac23bb53">PICC_GetType</a>(<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a90aa2fd57a03011252148c2ccdc8875b">sak</a>);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordflow">switch</span> (piccType) {</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a58d34a16ef064d4679cae921ecc4b505">PICC_TYPE_MIFARE_MINI</a>:</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a948d034c12fd457923b65f929b1538fb">PICC_TYPE_MIFARE_1K</a>:</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a7d2d0cfef1abe1c457fb72ebcf81fad4">PICC_TYPE_MIFARE_4K</a>:</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="comment">// All keys are set to FFFFFFFFFFFFh at chip delivery from the factory.</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; 6; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>.keyByte[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 0xFF;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            }</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <a class="code" href="class_m_f_r_c522.html#aafba2e74124efa2d736c1672ea104190">PICC_DumpMifareClassicToSerial</a>(<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>, piccType, &amp;<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a905f84b972470f7d80ed017817ae300c">PICC_TYPE_MIFARE_UL</a>:</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            <a class="code" href="class_m_f_r_c522.html#ac148d28877dd577606a28e9e7e4b6809">PICC_DumpMifareUltralightToSerial</a>();</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a5c8147b0f3970c9db0a177cb44592bc7">PICC_TYPE_ISO_14443_4</a>:</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2ac6d7ac25fc66f5a56bd60d618ba072d4">PICC_TYPE_MIFARE_DESFIRE</a>:</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a6d211bf0d6e1bed8f7cdb375e9137360">PICC_TYPE_ISO_18092</a>:</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a16d53e0355d6214dbe7faf7e37c99002">PICC_TYPE_MIFARE_PLUS</a>:</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a3efaeaa8963b24323f274bab4c1eaf8f">PICC_TYPE_TNP3XXX</a>:</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Dumping memory contents not implemented for that PICC type.&quot;</span>);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2aceba425b4eb6fd85de456a04e1ce1565">PICC_TYPE_UNKNOWN</a>:</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a06fbbb7628bd0c595c58b96547cb8960">PICC_TYPE_NOT_COMPLETE</a>:</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            <span class="keywordflow">break</span>; <span class="comment">// No memory dump here</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    }</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a8874921b4ed26c5b73d89c90f76d4933">PICC_HaltA</a>(); <span class="comment">// Already done if it was a MIFARE Classic PICC.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;} <span class="comment">// End PICC_DumpToSerial()</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a3b9a2c6da6505e0ff7b58c37d7aeff37"> 1304</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a3b9a2c6da6505e0ff7b58c37d7aeff37">MFRC522::PICC_DumpDetailsToSerial</a>(<a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid) {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">// UID</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    oss &lt;&lt; std::hex &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;Card UID: &quot;</span>;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">size</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        oss &lt;&lt; std::setw(2) &lt;&lt; (int)<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a5581167c1e1c8beb98c44ff86f4fbc52">uidByte</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    }</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">// SAK</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    oss.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot;Card SAK: &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; (int)<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a90aa2fd57a03011252148c2ccdc8875b">sak</a>;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">// (suggested) PICC type</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2">PICC_Type</a> piccType = <a class="code" href="class_m_f_r_c522.html#ac80a18228260bdde07dff5d4ac23bb53">PICC_GetType</a>(<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>-&gt;<a class="code" href="struct_m_f_r_c522_1_1_uid.html#a90aa2fd57a03011252148c2ccdc8875b">sak</a>);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    oss.str(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;PICC type: &quot;</span> &lt;&lt; <a class="code" href="class_m_f_r_c522_debug.html#a9aab221078968e193f0ce44e56a2edd7">MFRC522Debug::PICC_GetTypeName</a>(piccType);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;} <span class="comment">// End PICC_DumpDetailsToSerial()</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aafba2e74124efa2d736c1672ea104190"> 1336</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#aafba2e74124efa2d736c1672ea104190">MFRC522::PICC_DumpMifareClassicToSerial</a>(<a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid, <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2">PICC_Type</a> piccType, <a class="code" href="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key.html">MIFARE_Key</a>* <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>) {</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> no_of_sectors = 0;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">switch</span> (piccType) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a58d34a16ef064d4679cae921ecc4b505">PICC_TYPE_MIFARE_MINI</a>:</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            <span class="comment">// Has 5 sectors * 4 blocks/sector * 16 bytes/block = 320 bytes.</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            no_of_sectors = 5;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a948d034c12fd457923b65f929b1538fb">PICC_TYPE_MIFARE_1K</a>:</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            <span class="comment">// Has 16 sectors * 4 blocks/sector * 16 bytes/block = 1024 bytes.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            no_of_sectors = 16;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a7d2d0cfef1abe1c457fb72ebcf81fad4">PICC_TYPE_MIFARE_4K</a>:</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            <span class="comment">// Has (32 sectors * 4 blocks/sector + 8 sectors * 16 blocks/sector) * 16 bytes/block = 4096 bytes.</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            no_of_sectors = 40;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">default</span>: <span class="comment">// Should not happen. Ignore.</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">// Dump sectors, highest address first.</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">if</span> (no_of_sectors) {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;Sector Block   0  1  2  3   4  5  6  7   8  9 10 11  12 13 14 15  AccessBits&quot;</span>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keywordflow">for</span> (int8_t <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = no_of_sectors - 1; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &gt;= 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>--) {</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <a class="code" href="class_m_f_r_c522.html#a20c559f09927a7c5f91295f6158e4342">PICC_DumpMifareClassicSectorToSerial</a>(<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a8874921b4ed26c5b73d89c90f76d4933">PICC_HaltA</a>(); <span class="comment">// Halt the PICC before stopping the encrypted session.</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a24d3ab7b2170fdfa3f0121a7256f12d9">PCD_StopCrypto1</a>();</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;} <span class="comment">// End PICC_DumpMifareClassicToSerial()</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a20c559f09927a7c5f91295f6158e4342"> 1376</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#a20c559f09927a7c5f91295f6158e4342">MFRC522::PICC_DumpMifareClassicSectorToSerial</a>(<a class="code" href="struct_m_f_r_c522_1_1_uid.html">Uid</a>* uid, <a class="code" href="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key.html">MIFARE_Key</a>* <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> sector) {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> status;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> firstBlock;        <span class="comment">// Address of lowest address to dump actually last block dumped)</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> no_of_blocks;      <span class="comment">// Number of blocks in sector</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordtype">bool</span> isSectorTrailer;   <span class="comment">// Set to true while handling the &quot;last&quot; (ie highest address) in the sector.</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="comment">// The access bits are stored in a peculiar fashion.</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="comment">// There are four groups:</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="comment">//      g[3]    Access bits for the sector trailer, block 3 (for sectors 0-31) or block 15 (for sectors 32-39)</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="comment">//      g[2]    Access bits for block 2 (for sectors 0-31) or blocks 10-14 (for sectors 32-39)</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="comment">//      g[1]    Access bits for block 1 (for sectors 0-31) or blocks 5-9 (for sectors 32-39)</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="comment">//      g[0]    Access bits for block 0 (for sectors 0-31) or blocks 0-4 (for sectors 32-39)</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <span class="comment">// Each group has access bits [C1 C2 C3]. In this code C1 is MSB and C3 is LSB.</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="comment">// The four CX bits are stored together in a nible cx and an inverted nible cx_.</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> c1, c2, c3;        <span class="comment">// Nibbles</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> c1_, c2_, c3_;     <span class="comment">// Inverted nibbles</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordtype">bool</span> invertedError;     <span class="comment">// True if one of the inverted nibbles did not match</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> g[4];              <span class="comment">// Access bits for each of the four groups.</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> group;             <span class="comment">// 0-3 - active group for access bits</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordtype">bool</span> firstInGroup;      <span class="comment">// True for the first block dumped in the group</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">// Determine position and size of sector.</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">if</span> (sector &lt; 32) { <span class="comment">// Sectors 0..31 has 4 blocks each</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        no_of_blocks = 4;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        firstBlock = sector * no_of_blocks;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    }</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sector &lt; 40) { <span class="comment">// Sectors 32-39 has 16 blocks each</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        no_of_blocks = 16;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        firstBlock = 128 + (sector - 32) * no_of_blocks;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// Illegal input, no MIFARE Classic PICC has more than 40 sectors.</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">// Dump blocks, highest address first.</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> byteCount;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[18];</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> blockAddr;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    isSectorTrailer = <span class="keyword">true</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    invertedError = <span class="keyword">false</span>;  <span class="comment">// Avoid &quot;unused variable&quot; warning.</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">for</span> (int8_t blockOffset = no_of_blocks - 1; blockOffset &gt;= 0; blockOffset--) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        blockAddr = firstBlock + blockOffset;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="comment">// Sector number - only on first line</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        std::ostringstream oss;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <span class="keywordflow">if</span> (isSectorTrailer) {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            <span class="keywordflow">if</span> (sector &lt; 10) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>; <span class="comment">// Pad with spaces</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>; <span class="comment">// Pad with spaces</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            }</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            oss &lt;&lt; (int) sector;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            oss &lt;&lt;  <span class="stringliteral">&quot;   &quot;</span>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot;       &quot;</span>;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="comment">// Block number</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keywordflow">if</span> (blockAddr &lt; 10) {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>; <span class="comment">// Pad with spaces</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            <span class="keywordflow">if</span> (blockAddr &lt; 100) {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>; <span class="comment">// Pad with spaces</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot; &quot;</span>; <span class="comment">// Pad with spaces</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            }</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        }</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        oss &lt;&lt; (int) blockAddr;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        oss &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="comment">// Establish encrypted communications before reading the first block</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <span class="keywordflow">if</span> (isSectorTrailer) {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            status = <a class="code" href="class_m_f_r_c522.html#a6c2313c4aa98806cc2bf0e9cca993ec0">PCD_Authenticate</a>(<a class="code" href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a7ab2b1b2d0f0d668dfb3ac53ec7f08d6">PICC_CMD_MF_AUTH_KEY_A</a>, firstBlock, <a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            <span class="keywordflow">if</span> (status != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) {</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot;PCD_Authenticate() failed: &quot;</span>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                oss &lt;&lt; (int) <a class="code" href="class_m_f_r_c522_debug.html#a3d209dc1514445c4b6095a50e873ff6a">MFRC522Debug::GetStatusCodeName</a>(status);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;            }</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        }</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <span class="comment">// Read block</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        byteCount = <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        status = <a class="code" href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">MIFARE_Read</a>(blockAddr, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, &amp;byteCount);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="keywordflow">if</span> (status != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot;MIFARE_Read() failed: &quot;</span>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            oss &lt;&lt; (int)<a class="code" href="class_m_f_r_c522_debug.html#a3d209dc1514445c4b6095a50e873ff6a">MFRC522Debug::GetStatusCodeName</a>(status);</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="comment">// Dump data</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        oss &lt;&lt; std::hex &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> index = 0; index &lt; 16; index++) {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; (int)<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[index];</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            <span class="keywordflow">if</span> ((index % 4) == 3) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            }</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <span class="comment">// Parse sector trailer data</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">if</span> (isSectorTrailer) {</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            c1  = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[7] &gt;&gt; 4;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            c2  = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[8] &amp; 0xF;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            c3  = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[8] &gt;&gt; 4;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            c1_ = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[6] &amp; 0xF;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            c2_ = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[6] &gt;&gt; 4;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            c3_ = <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[7] &amp; 0xF;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            invertedError = (c1 != (~c1_ &amp; 0xF)) || (c2 != (~c2_ &amp; 0xF)) || (c3 != (~c3_ &amp; 0xF));</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            g[0] = ((c1 &amp; 1) &lt;&lt; 2) | ((c2 &amp; 1) &lt;&lt; 1) | ((c3 &amp; 1) &lt;&lt; 0);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            g[1] = ((c1 &amp; 2) &lt;&lt; 1) | ((c2 &amp; 2) &lt;&lt; 0) | ((c3 &amp; 2) &gt;&gt; 1);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            g[2] = ((c1 &amp; 4) &lt;&lt; 0) | ((c2 &amp; 4) &gt;&gt; 1) | ((c3 &amp; 4) &gt;&gt; 2);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            g[3] = ((c1 &amp; 8) &gt;&gt; 1) | ((c2 &amp; 8) &gt;&gt; 2) | ((c3 &amp; 8) &gt;&gt; 3);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            isSectorTrailer = <span class="keyword">false</span>;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        }</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment">// Which access group is this block in?</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> (no_of_blocks == 4) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            group = blockOffset;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            firstInGroup = <span class="keyword">true</span>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            group = blockOffset / 5;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            firstInGroup = (group == 3) || (group != (blockOffset + 1) / 5);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        }</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">if</span> (firstInGroup) {</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <span class="comment">// Print access bits</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            oss &lt;&lt; std::dec;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot; [ &quot;</span> &lt;&lt; ((g[group] &gt;&gt; 2) &amp; 1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ((g[group] &gt;&gt; 1) &amp; 1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ((g[group] &gt;&gt; 0) &amp; 1) &lt;&lt; <span class="stringliteral">&quot; ] &quot;</span>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="keywordflow">if</span> (invertedError) {</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                oss &lt;&lt; <span class="stringliteral">&quot; Inverted access bits did not match! &quot;</span>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        }</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordflow">if</span> (group != 3 &amp;&amp; (g[group] == 1 || g[group] == 6)) { <span class="comment">// Not a sector trailer, a value block</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            int32_t <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> = (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[3]) &lt;&lt; 24) | (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[2]) &lt;&lt; 16) | (int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[1]) &lt;&lt; 8) | int32_t(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[0]);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot; Value=0x&quot;</span> &lt;&lt; std::hex &lt;&lt; <a class="code" href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a> &lt;&lt; <span class="stringliteral">&quot; Adr=0x&quot;</span> &lt;&lt; (int) <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[12];</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        }</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;} <span class="comment">// End PICC_DumpMifareClassicSectorToSerial()</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ac148d28877dd577606a28e9e7e4b6809"> 1517</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#ac148d28877dd577606a28e9e7e4b6809">MFRC522::PICC_DumpMifareUltralightToSerial</a>() {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> status;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> byteCount;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[18];</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;Page  0  1  2  3&quot;</span>;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">// Try the mpages of the original Ultralight. Ultralight C has more pages.</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> page = 0; page &lt; 16; page += 4) { <span class="comment">// Read returns data for 4 pages at a time.</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="comment">// Read pages</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        byteCount = <span class="keyword">sizeof</span>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        status = <a class="code" href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">MIFARE_Read</a>(page, <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, &amp;byteCount);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        <span class="keywordflow">if</span> (status != <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot;MIFARE_Read() failed: &quot;</span>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            oss &lt;&lt; std::dec &lt;&lt; (int) <a class="code" href="class_m_f_r_c522_debug.html#a3d209dc1514445c4b6095a50e873ff6a">MFRC522Debug::GetStatusCodeName</a>(status);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="comment">// Dump data</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        oss &lt;&lt; std::dec;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> offset = 0; offset &lt; 4; offset++) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = page + offset;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            oss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; (int) <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> index = 0; index &lt; 4; index++) {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 4 * offset + index;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                oss &lt;&lt; std::hex &lt;&lt; std::setw(2) &lt;&lt; (int) <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            }</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            ESP_LOGD(LOG_TAG, <span class="stringliteral">&quot;%s&quot;</span>, oss.str().c_str());</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        }</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;} <span class="comment">// End PICC_DumpMifareUltralightToSerial()</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#ab8c712963189654e9bc368be8783e2ab"> 1561</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_m_f_r_c522.html#ab8c712963189654e9bc368be8783e2ab">MFRC522::MIFARE_SetAccessBits</a>(<a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a>* accessBitBuffer, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> g0, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> g1, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> g2, <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> g3) {</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> c1 = ((g3 &amp; 4) &lt;&lt; 1) | ((g2 &amp; 4) &lt;&lt; 0) | ((g1 &amp; 4) &gt;&gt; 1) | ((g0 &amp; 4) &gt;&gt; 2);</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> c2 = ((g3 &amp; 2) &lt;&lt; 2) | ((g2 &amp; 2) &lt;&lt; 1) | ((g1 &amp; 2) &lt;&lt; 0) | ((g0 &amp; 2) &gt;&gt; 1);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> c3 = ((g3 &amp; 1) &lt;&lt; 3) | ((g2 &amp; 1) &lt;&lt; 2) | ((g1 &amp; 1) &lt;&lt; 1) | ((g0 &amp; 1) &lt;&lt; 0);</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    accessBitBuffer[0] = (~c2 &amp; 0xF) &lt;&lt; 4 | (~c1 &amp; 0xF);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    accessBitBuffer[1] =          c1 &lt;&lt; 4 | (~c3 &amp; 0xF);</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    accessBitBuffer[2] =          c3 &lt;&lt; 4 | c2;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;} <span class="comment">// End MIFARE_SetAccessBits()</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">// Convenience functions - does not add extra functionality</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#a3adca9d3b455c680ebcde3b74c4e567b"> 1582</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_m_f_r_c522.html#a3adca9d3b455c680ebcde3b74c4e567b">MFRC522::PICC_IsNewCardPresent</a>() {</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bufferATQA[2];</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <a class="code" href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a> bufferSize = <span class="keyword">sizeof</span>(bufferATQA);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="comment">// Reset baud rates</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad4fe18ad01abc83d4559369226fe7992">TxModeReg</a>, 0x00);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a7e0d6ae1fdd25be6d80d1b76b2274764">RxModeReg</a>, 0x00);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="comment">// Reset ModWidthReg</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <a class="code" href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">PCD_WriteRegister</a>(<a class="code" href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad69a6a3d883ebfc993fc6fbdbc035508">ModWidthReg</a>, 0x26);</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a4e0ac6edf5e8f6ade351b009278fbbc7">PICC_RequestA</a>(bufferATQA, &amp;bufferSize);</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a> || <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993">STATUS_COLLISION</a>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;} <span class="comment">// End PICC_IsNewCardPresent()</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"><a class="line" href="class_m_f_r_c522.html#aab1218c71cec9cc17ee3ac8a683df106"> 1605</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_m_f_r_c522.html#aab1218c71cec9cc17ee3ac8a683df106">MFRC522::PICC_ReadCardSerial</a>() {</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="class_m_f_r_c522.html#a7a78c629cb4e1d90cc2d7526b17d6c22">PICC_Select</a>(&amp;<a class="code" href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">uid</a>);</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">STATUS_OK</a>);</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;} <span class="comment">// End</span></div><div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a69b2bb1cd2dc0437d6d1fb11eb2796e7"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a69b2bb1cd2dc0437d6d1fb11eb2796e7">MFRC522::PICC_CMD_MF_DECREMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00267">MFRC522.h:267</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a948d034c12fd457923b65f929b1538fb"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a948d034c12fd457923b65f929b1538fb">MFRC522::PICC_TYPE_MIFARE_1K</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00289">MFRC522.h:289</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669ac9de33ca066ca9481bd01d5642a0c879"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ac9de33ca066ca9481bd01d5642a0c879">MFRC522::TxASKReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00171">MFRC522.h:171</a></div></div>
<div class="ttc" id="_m_f_r_c522_debug_8h_html"><div class="ttname"><a href="_m_f_r_c522_debug_8h.html">MFRC522Debug.h</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2aceba425b4eb6fd85de456a04e1ce1565"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2aceba425b4eb6fd85de456a04e1ce1565">MFRC522::PICC_TYPE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00285">MFRC522.h:285</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341ab8ed49cb6ed6228acb0c911d60758486"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ab8ed49cb6ed6228acb0c911d60758486">MFRC522::PICC_CMD_MF_RESTORE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00269">MFRC522.h:269</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669aaf8beb5a739cd8bf94b8b5c8d2d109ce"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669aaf8beb5a739cd8bf94b8b5c8d2d109ce">MFRC522::BitFramingReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00161">MFRC522.h:161</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a25f052c9c340da34128c365662370b01"><div class="ttname"><a href="class_m_f_r_c522.html#a25f052c9c340da34128c365662370b01">MFRC522::PCD_PerformSelfTest</a></div><div class="ttdeci">bool PCD_PerformSelfTest()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00330">MFRC522.cpp:330</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a16ee66df69fda8a3065bc9218b45de0b"><div class="ttname"><a href="class_m_f_r_c522.html#a16ee66df69fda8a3065bc9218b45de0b">MFRC522::MIFARE_Transfer</a></div><div class="ttdeci">StatusCode MIFARE_Transfer(byte blockAddr)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01039">MFRC522.cpp:1039</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a9d0df9e03ad6706004b003e20127a76a"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a9d0df9e03ad6706004b003e20127a76a">MFRC522::ControlReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00160">MFRC522.h:160</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7053e61540b68e6aa5c6cbea308836c4"><div class="ttname"><a href="class_m_f_r_c522.html#a7053e61540b68e6aa5c6cbea308836c4">MFRC522::MIFARE_Ultralight_Write</a></div><div class="ttdeci">StatusCode MIFARE_Ultralight_Write(byte page, byte *buffer, byte bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00939">MFRC522.cpp:939</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a2ea95497e35adbc7acbc32c0cb8a574a"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a2ea95497e35adbc7acbc32c0cb8a574a">MFRC522::PICC_CMD_MF_READ</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00265">MFRC522.h:265</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2ac6d7ac25fc66f5a56bd60d618ba072d4"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2ac6d7ac25fc66f5a56bd60d618ba072d4">MFRC522::PICC_TYPE_MIFARE_DESFIRE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00293">MFRC522.h:293</a></div></div>
<div class="ttc" id="class_s_p_i_html_a832556869c632024fe6ab92473854131"><div class="ttname"><a href="class_s_p_i.html#a832556869c632024fe6ab92473854131">SPI::init</a></div><div class="ttdeci">void init(int mosiPin=DEFAULT_MOSI_PIN, int misoPin=DEFAULT_MISO_PIN, int clkPin=DEFAULT_CLK_PIN, int csPin=DEFAULT_CS_PIN)</div><div class="ttdoc">Initialize SPI. </div><div class="ttdef"><b>Definition:</b> <a href="_s_p_i_8cpp_source.html#l00047">SPI.cpp:47</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341ab0399cde7122f0bb6dedb584254455c2"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ab0399cde7122f0bb6dedb584254455c2">MFRC522::PICC_CMD_SEL_CL2</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00257">MFRC522.h:257</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a95e26d5ece97ae43c34d08797205a356"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a95e26d5ece97ae43c34d08797205a356">MFRC522::DivIrqReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00153">MFRC522.h:153</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ad00a1efcfa6dc203ca885d43f4d02125"><div class="ttname"><a href="class_m_f_r_c522.html#ad00a1efcfa6dc203ca885d43f4d02125">MFRC522::PICC_WakeupA</a></div><div class="ttdeci">StatusCode PICC_WakeupA(byte *bufferATQA, byte *bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00540">MFRC522.cpp:540</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341ae8aeabd1ddb73db2f04259c76eaccd8e"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ae8aeabd1ddb73db2f04259c76eaccd8e">MFRC522::PICC_CMD_UL_WRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00273">MFRC522.h:273</a></div></div>
<div class="ttc" id="class_free_r_t_o_s_html_abea19fd141147c054f47c6a00e77f2ff"><div class="ttname"><a href="class_free_r_t_o_s.html#abea19fd141147c054f47c6a00e77f2ff">FreeRTOS::sleep</a></div><div class="ttdeci">static void sleep(uint32_t ms)</div><div class="ttdef"><b>Definition:</b> <a href="_free_r_t_o_s_8cpp_source.html#l00023">FreeRTOS.cpp:23</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a905f84b972470f7d80ed017817ae300c"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a905f84b972470f7d80ed017817ae300c">MFRC522::PICC_TYPE_MIFARE_UL</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00291">MFRC522.h:291</a></div></div>
<div class="ttc" id="struct_m_f_r_c522_1_1_uid_html_a49c06f93c7748abe00a9ab5899d479b7"><div class="ttname"><a href="struct_m_f_r_c522_1_1_uid.html#a49c06f93c7748abe00a9ab5899d479b7">MFRC522::Uid::size</a></div><div class="ttdeci">byte size</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00314">MFRC522.h:314</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ad456545d41962dd7f8bd4210f5618498"><div class="ttname"><a href="class_m_f_r_c522.html#ad456545d41962dd7f8bd4210f5618498">MFRC522::uid</a></div><div class="ttdeci">Uid uid</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00325">MFRC522.h:325</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a73dc12b03f05177a400263e5e2bcf0cc"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a73dc12b03f05177a400263e5e2bcf0cc">MFRC522::TxControlReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00170">MFRC522.h:170</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9886678ea0a65021bf602cfb110caa15"><div class="ttname"><a href="class_m_f_r_c522.html#a9886678ea0a65021bf602cfb110caa15">MFRC522::PCD_Reset</a></div><div class="ttdeci">void PCD_Reset()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00266">MFRC522.cpp:266</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a430d34a355d45528d674ad839a187494"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a430d34a355d45528d674ad839a187494">MFRC522::CRCResultRegH</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00185">MFRC522.h:185</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a06fbbb7628bd0c595c58b96547cb8960"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a06fbbb7628bd0c595c58b96547cb8960">MFRC522::PICC_TYPE_NOT_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00295">MFRC522.h:295</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aa02ae994a9ebf146475f46fc538cef28"><div class="ttname"><a href="class_m_f_r_c522.html#aa02ae994a9ebf146475f46fc538cef28">MFRC522::PCD_GetAntennaGain</a></div><div class="ttdeci">byte PCD_GetAntennaGain()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00306">MFRC522.cpp:306</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a4e0ac6edf5e8f6ade351b009278fbbc7"><div class="ttname"><a href="class_m_f_r_c522.html#a4e0ac6edf5e8f6ade351b009278fbbc7">MFRC522::PICC_RequestA</a></div><div class="ttdeci">StatusCode PICC_RequestA(byte *bufferATQA, byte *bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00527">MFRC522.cpp:527</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a02ccb020ccc6d49d563f0ed1489d8025"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a02ccb020ccc6d49d563f0ed1489d8025">MFRC522::PICC_CMD_MF_WRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00266">MFRC522.h:266</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9aa3b0624b83ba5934292d671c73638a54">MFRC522::STATUS_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00302">MFRC522.h:302</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a45ce24f67052f4813df3b0f4efaafea8"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a45ce24f67052f4813df3b0f4efaafea8">MFRC522::STATUS_NO_ROOM</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00305">MFRC522.h:305</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341aee3203a0a40028d3059861464198b688"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341aee3203a0a40028d3059861464198b688">MFRC522::PICC_CMD_REQA</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00253">MFRC522.h:253</a></div></div>
<div class="ttc" id="class_e_s_p32_c_p_p_1_1_g_p_i_o_html_afd43e7bc27885215900f7780197a0247"><div class="ttname"><a href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#afd43e7bc27885215900f7780197a0247">ESP32CPP::GPIO::setInput</a></div><div class="ttdeci">static void setInput(gpio_num_t pin)</div><div class="ttdoc">Set the pin as input. </div><div class="ttdef"><b>Definition:</b> <a href="_g_p_i_o_8cpp_source.html#l00131">GPIO.cpp:131</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a8fb1a8c28b7a860793831566373f172f"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a8fb1a8c28b7a860793831566373f172f">MFRC522::Status2Reg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00156">MFRC522.h:156</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a639d27ac072bc0dfa478d0957591afcc"><div class="ttname"><a href="class_m_f_r_c522.html#a639d27ac072bc0dfa478d0957591afcc">MFRC522::PICC_REQA_or_WUPA</a></div><div class="ttdeci">StatusCode PICC_REQA_or_WUPA(byte command, byte *bufferATQA, byte *bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00554">MFRC522.cpp:554</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a4281c25cf6743163ed2e2f903cf17ba9"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a4281c25cf6743163ed2e2f903cf17ba9">MFRC522::VersionReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00209">MFRC522.h:209</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a0c99eea491c71e9d2a02bf8a86988adf"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0c99eea491c71e9d2a02bf8a86988adf">MFRC522::RFCfgReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00190">MFRC522.h:190</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a7ab2b1b2d0f0d668dfb3ac53ec7f08d6"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a7ab2b1b2d0f0d668dfb3ac53ec7f08d6">MFRC522::PICC_CMD_MF_AUTH_KEY_A</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00263">MFRC522.h:263</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8a8f54a569867f812163c6a9bc3461d03a"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a8f54a569867f812163c6a9bc3461d03a">MFRC522::PCD_SoftReset</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00231">MFRC522.h:231</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a58d34a16ef064d4679cae921ecc4b505"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a58d34a16ef064d4679cae921ecc4b505">MFRC522::PICC_TYPE_MIFARE_MINI</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00288">MFRC522.h:288</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_ab8ef12fab634c171394422d0ee8baf94"><div class="ttname"><a href="_m_f_r_c522_8h.html#ab8ef12fab634c171394422d0ee8baf94">byte</a></div><div class="ttdeci">uint8_t byte</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00082">MFRC522.h:82</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafba2e74124efa2d736c1672ea104190"><div class="ttname"><a href="class_m_f_r_c522.html#aafba2e74124efa2d736c1672ea104190">MFRC522::PICC_DumpMifareClassicToSerial</a></div><div class="ttdeci">void PICC_DumpMifareClassicToSerial(Uid *uid, PICC_Type piccType, MIFARE_Key *key)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01336">MFRC522.cpp:1336</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a7d2d0cfef1abe1c457fb72ebcf81fad4"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a7d2d0cfef1abe1c457fb72ebcf81fad4">MFRC522::PICC_TYPE_MIFARE_4K</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00290">MFRC522.h:290</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html"><div class="ttname"><a href="_m_f_r_c522_8h.html">MFRC522.h</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a454e12c2c815a861a0450d40273f98ef"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a454e12c2c815a861a0450d40273f98ef">MFRC522::PICC_CMD_MF_INCREMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00268">MFRC522.h:268</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a7e0d6ae1fdd25be6d80d1b76b2274764"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a7e0d6ae1fdd25be6d80d1b76b2274764">MFRC522::RxModeReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00169">MFRC522.h:169</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9ac25a91c2efa2dc7638758321374f7566"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ac25a91c2efa2dc7638758321374f7566">MFRC522::STATUS_CRC_WRONG</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00308">MFRC522.h:308</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a1ed52e7f88c8bf3fda91bf31bb62afe4"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a1ed52e7f88c8bf3fda91bf31bb62afe4">MFRC522::TModeReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00194">MFRC522.h:194</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a2098ebe85700109b20c5026643f1dad7"><div class="ttname"><a href="class_m_f_r_c522.html#a2098ebe85700109b20c5026643f1dad7">MFRC522::PCD_AntennaOff</a></div><div class="ttdeci">void PCD_AntennaOff()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00294">MFRC522.cpp:294</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669ad4fe18ad01abc83d4559369226fe7992"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad4fe18ad01abc83d4559369226fe7992">MFRC522::TxModeReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00168">MFRC522.h:168</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ad681e424fc68a57941bea5702cee05eb"><div class="ttname"><a href="class_m_f_r_c522.html#ad681e424fc68a57941bea5702cee05eb">MFRC522::PCD_Init</a></div><div class="ttdeci">void PCD_Init()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00197">MFRC522.cpp:197</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669">MFRC522::PCD_Register</a></div><div class="ttdeci">PCD_Register</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00146">MFRC522.h:146</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a5ce84dd855f2ae297dd00fafaf62ef78"><div class="ttname"><a href="class_m_f_r_c522.html#a5ce84dd855f2ae297dd00fafaf62ef78">MFRC522::PCD_SetAntennaGain</a></div><div class="ttdeci">void PCD_SetAntennaGain(byte mask)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00316">MFRC522.cpp:316</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8af0b7178e7638038db6f8e7016892fafd">MFRC522::PCD_Transceive</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00229">MFRC522.h:229</a></div></div>
<div class="ttc" id="class_m_f_r_c522_debug_html_a3d209dc1514445c4b6095a50e873ff6a"><div class="ttname"><a href="class_m_f_r_c522_debug.html#a3d209dc1514445c4b6095a50e873ff6a">MFRC522Debug::GetStatusCodeName</a></div><div class="ttdeci">static const char * GetStatusCodeName(MFRC522::StatusCode code)</div><div class="ttdef"><b>Definition:</b> <a href="_m_r_f_c522_debug_8cpp_source.html#l00035">MRFC522Debug.cpp:35</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ac148d28877dd577606a28e9e7e4b6809"><div class="ttname"><a href="class_m_f_r_c522.html#ac148d28877dd577606a28e9e7e4b6809">MFRC522::PICC_DumpMifareUltralightToSerial</a></div><div class="ttdeci">void PICC_DumpMifareUltralightToSerial()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01517">MFRC522.cpp:1517</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a2ad63357ec8c38f712ea6fd811056993">MFRC522::STATUS_COLLISION</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00303">MFRC522.h:303</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_acb47eb7a05ae58825b4085efeb7a09bb"><div class="ttname"><a href="class_m_f_r_c522.html#acb47eb7a05ae58825b4085efeb7a09bb">MFRC522::PCD_NTAG216_AUTH</a></div><div class="ttdeci">StatusCode PCD_NTAG216_AUTH(byte *passWord, byte pACK[])</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01120">MFRC522.cpp:1120</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a35e5daf30358a0a271dadf50ba6bb4e7">MFRC522::FIFOLevelReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00158">MFRC522.h:158</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a76b2a615444982e04566784bdb5c9841"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a76b2a615444982e04566784bdb5c9841">MFRC522::ComIrqReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00152">MFRC522.h:152</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a5c8147b0f3970c9db0a177cb44592bc7"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a5c8147b0f3970c9db0a177cb44592bc7">MFRC522::PICC_TYPE_ISO_14443_4</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00286">MFRC522.h:286</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a16d53e0355d6214dbe7faf7e37c99002"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a16d53e0355d6214dbe7faf7e37c99002">MFRC522::PICC_TYPE_MIFARE_PLUS</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00292">MFRC522.h:292</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669afa3348d82b026de8fecdd18d58e92e2a"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afa3348d82b026de8fecdd18d58e92e2a">MFRC522::TReloadRegL</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00197">MFRC522.h:197</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669afafb7ec88f79c9b1f195195497d0ca07"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afafb7ec88f79c9b1f195195497d0ca07">MFRC522::CollReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00162">MFRC522.h:162</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669afdbfd2f397b96d1043c808ec26e80328">MFRC522::FIFODataReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00157">MFRC522.h:157</a></div></div>
<div class="ttc" id="class_s_p_i_html_aff890367df7fa27734d18c772eb227df"><div class="ttname"><a href="class_s_p_i.html#aff890367df7fa27734d18c772eb227df">SPI::transferByte</a></div><div class="ttdeci">uint8_t transferByte(uint8_t value)</div><div class="ttdoc">Send and receive a single byte. </div><div class="ttdef"><b>Definition:</b> <a href="_s_p_i_8cpp_source.html#l00141">SPI.cpp:141</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3adca9d3b455c680ebcde3b74c4e567b"><div class="ttname"><a href="class_m_f_r_c522.html#a3adca9d3b455c680ebcde3b74c4e567b">MFRC522::PICC_IsNewCardPresent</a></div><div class="ttdeci">virtual bool PICC_IsNewCardPresent()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01582">MFRC522.cpp:1582</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a2cd647ad1ac1327d2a632115cd9c4477"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a2cd647ad1ac1327d2a632115cd9c4477">MFRC522::ModeReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00167">MFRC522.h:167</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8afe5ffdce88fe7544cbc49f8947df9ad9">MFRC522::PCD_Idle</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00222">MFRC522.h:222</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341ac532079d67a5325cc5b3505cccf6ac8b"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ac532079d67a5325cc5b3505cccf6ac8b">MFRC522::PICC_CMD_CT</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00255">MFRC522.h:255</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="class_m_f_r_c522_html_affaa7030ec6e5984cce845a8ed6df1b2"><div class="ttname"><a href="class_m_f_r_c522.html#affaa7030ec6e5984cce845a8ed6df1b2">MFRC522::_chipSelectPin</a></div><div class="ttdeci">byte _chipSelectPin</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00409">MFRC522.h:409</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a90e43966451c979e5e08b633286c6a4d"><div class="ttname"><a href="class_m_f_r_c522.html#a90e43966451c979e5e08b633286c6a4d">MFRC522::m_spi</a></div><div class="ttdeci">SPI m_spi</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00415">MFRC522.h:415</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669ad69a6a3d883ebfc993fc6fbdbc035508"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ad69a6a3d883ebfc993fc6fbdbc035508">MFRC522::ModWidthReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00188">MFRC522.h:188</a></div></div>
<div class="ttc" id="quote_8d_html_ae7102b102f9ed4847a2862ff6984ca3f"><div class="ttname"><a href="quote_8d.html#ae7102b102f9ed4847a2862ff6984ca3f">command</a></div><div class="ttdeci">Long to be exact.To make commands take place after a successful prefix them with a dash.To make commands be sent after curl has changed the working just before the transfer command(s)</div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3885cb4bb582de0045cff2829d59006f"><div class="ttname"><a href="class_m_f_r_c522.html#a3885cb4bb582de0045cff2829d59006f">MFRC522::_resetPowerDownPin</a></div><div class="ttdeci">byte _resetPowerDownPin</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00410">MFRC522.h:410</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_af9566664f23d4d67efd270e42c3dc723"><div class="ttname"><a href="class_m_f_r_c522.html#af9566664f23d4d67efd270e42c3dc723">MFRC522::MIFARE_Increment</a></div><div class="ttdeci">StatusCode MIFARE_Increment(byte blockAddr, int32_t delta)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00984">MFRC522.cpp:984</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a946ba7e7e244f40adcb9f900d8fd3a48"><div class="ttname"><a href="class_m_f_r_c522.html#a946ba7e7e244f40adcb9f900d8fd3a48">MFRC522::MIFARE_Restore</a></div><div class="ttdeci">StatusCode MIFARE_Restore(byte blockAddr)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00998">MFRC522.cpp:998</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aeab21496c761cdecb29c69f9f3fa6150"><div class="ttname"><a href="class_m_f_r_c522.html#aeab21496c761cdecb29c69f9f3fa6150">MFRC522::MIFARE_Decrement</a></div><div class="ttdeci">StatusCode MIFARE_Decrement(byte blockAddr, int32_t delta)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00969">MFRC522.cpp:969</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7c65647b1d72b6ee7557797322030643"><div class="ttname"><a href="class_m_f_r_c522.html#a7c65647b1d72b6ee7557797322030643">MFRC522::PCD_CalculateCRC</a></div><div class="ttdeci">StatusCode PCD_CalculateCRC(byte *data, byte length, byte *result)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00164">MFRC522.cpp:164</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a6441056e4526a6a02f9314b16651f4b1"><div class="ttname"><a href="_m_f_r_c522_8h.html#a6441056e4526a6a02f9314b16651f4b1">MFRC522_firmware_referenceV2_0</a></div><div class="ttdeci">const byte MFRC522_firmware_referenceV2_0[]</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00114">MFRC522.h:114</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a6c2313c4aa98806cc2bf0e9cca993ec0"><div class="ttname"><a href="class_m_f_r_c522.html#a6c2313c4aa98806cc2bf0e9cca993ec0">MFRC522::PCD_Authenticate</a></div><div class="ttdeci">StatusCode PCD_Authenticate(byte command, byte blockAddr, MIFARE_Key *key, Uid *uid)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00827">MFRC522.cpp:827</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3b9a2c6da6505e0ff7b58c37d7aeff37"><div class="ttname"><a href="class_m_f_r_c522.html#a3b9a2c6da6505e0ff7b58c37d7aeff37">MFRC522::PICC_DumpDetailsToSerial</a></div><div class="ttdeci">void PICC_DumpDetailsToSerial(Uid *uid)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01304">MFRC522.cpp:1304</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aaa96aa7ec4f95e0835cb758ad0450d74"><div class="ttname"><a href="class_m_f_r_c522.html#aaa96aa7ec4f95e0835cb758ad0450d74">MFRC522::PCD_TransceiveData</a></div><div class="ttdeci">StatusCode PCD_TransceiveData(byte *sendData, byte sendLen, byte *backData, byte *backLen, byte *validBits=nullptr, byte rxAlign=0, bool checkCRC=false)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00422">MFRC522.cpp:422</a></div></div>
<div class="ttc" id="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key_html"><div class="ttname"><a href="struct_m_f_r_c522_1_1_m_i_f_a_r_e___key.html">MFRC522::MIFARE_Key</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00320">MFRC522.h:320</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a5d2309094d9fa17125dc90394e5aeaa0"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a5d2309094d9fa17125dc90394e5aeaa0">MFRC522::PICC_CMD_MF_TRANSFER</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00270">MFRC522.h:270</a></div></div>
<div class="ttc" id="class_e_s_p32_c_p_p_1_1_g_p_i_o_html_a9c168a825e68fa07f9d707c5832230f0"><div class="ttname"><a href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a9c168a825e68fa07f9d707c5832230f0">ESP32CPP::GPIO::high</a></div><div class="ttdeci">static void high(gpio_num_t pin)</div><div class="ttdoc">Set the pin high. </div><div class="ttdef"><b>Definition:</b> <a href="_g_p_i_o_8cpp_source.html#l00057">GPIO.cpp:57</a></div></div>
<div class="ttc" id="class_m_f_r_c522_debug_html_a9aab221078968e193f0ce44e56a2edd7"><div class="ttname"><a href="class_m_f_r_c522_debug.html#a9aab221078968e193f0ce44e56a2edd7">MFRC522Debug::PICC_GetTypeName</a></div><div class="ttdeci">static const char * PICC_GetTypeName(MFRC522::PICC_Type type)</div><div class="ttdef"><b>Definition:</b> <a href="_m_r_f_c522_debug_8cpp_source.html#l00011">MRFC522Debug.cpp:11</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a1db4d2ed757f0a638e5018fb994071ae">MFRC522::STATUS_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00304">MFRC522.h:304</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1822b5145427f25cf8a046438f01268a"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1822b5145427f25cf8a046438f01268a">MFRC522_firmware_referenceV1_0</a></div><div class="ttdeci">const byte MFRC522_firmware_referenceV1_0[]</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00102">MFRC522.h:102</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a851307266f677fd58db61540ffe76855"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a851307266f677fd58db61540ffe76855">MFRC522::STATUS_INTERNAL_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00306">MFRC522.h:306</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a240aa03a1d9542235b89cdef377a5796"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a240aa03a1d9542235b89cdef377a5796">MFRC522::ErrorReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00154">MFRC522.h:154</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a040e482a6d103ae2d02987bec8c3277e"><div class="ttname"><a href="_m_f_r_c522_8h.html#a040e482a6d103ae2d02987bec8c3277e">FM17522_firmware_reference</a></div><div class="ttdeci">const byte FM17522_firmware_reference[]</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00126">MFRC522.h:126</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a9b8fbd1c87d0a6bbe2ef78d192001b3a"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a9b8fbd1c87d0a6bbe2ef78d192001b3a">MFRC522::PICC_CMD_WUPA</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00254">MFRC522.h:254</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_af19fc75e9415322fbe89245ed70a784b"><div class="ttname"><a href="class_m_f_r_c522.html#af19fc75e9415322fbe89245ed70a784b">MFRC522::MIFARE_SetValue</a></div><div class="ttdeci">StatusCode MIFARE_SetValue(byte blockAddr, int32_t value)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01089">MFRC522.cpp:1089</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a88d450f43a9d22ead5db926808599fb5">MFRC522::STATUS_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00307">MFRC522.h:307</a></div></div>
<div class="ttc" id="struct_m_f_r_c522_1_1_uid_html_a5581167c1e1c8beb98c44ff86f4fbc52"><div class="ttname"><a href="struct_m_f_r_c522_1_1_uid.html#a5581167c1e1c8beb98c44ff86f4fbc52">MFRC522::Uid::uidByte</a></div><div class="ttdeci">byte uidByte[10]</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00315">MFRC522.h:315</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a86cb4ad38f61b823dfe97103b1b1f9d6"><div class="ttname"><a href="class_m_f_r_c522.html#a86cb4ad38f61b823dfe97103b1b1f9d6">MFRC522::MIFARE_TwoStepHelper</a></div><div class="ttdeci">StatusCode MIFARE_TwoStepHelper(byte command, byte blockAddr, int32_t data)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01013">MFRC522.cpp:1013</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7a78c629cb4e1d90cc2d7526b17d6c22"><div class="ttname"><a href="class_m_f_r_c522.html#a7a78c629cb4e1d90cc2d7526b17d6c22">MFRC522::PICC_Select</a></div><div class="ttdeci">virtual StatusCode PICC_Select(Uid *uid, byte validBits=0)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00586">MFRC522.cpp:586</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9a3e34ac777020ad63ef7e346dfb813fe7">MFRC522::STATUS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00301">MFRC522.h:301</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a8874921b4ed26c5b73d89c90f76d4933"><div class="ttname"><a href="class_m_f_r_c522.html#a8874921b4ed26c5b73d89c90f76d4933">MFRC522::PICC_HaltA</a></div><div class="ttdeci">StatusCode PICC_HaltA()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00782">MFRC522.cpp:782</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab8c712963189654e9bc368be8783e2ab"><div class="ttname"><a href="class_m_f_r_c522.html#ab8c712963189654e9bc368be8783e2ab">MFRC522::MIFARE_SetAccessBits</a></div><div class="ttdeci">void MIFARE_SetAccessBits(byte *accessBitBuffer, byte g0, byte g1, byte g2, byte g3)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01561">MFRC522.cpp:1561</a></div></div>
<div class="ttc" id="max-time_8d_html_a578487ceabd31e8c8e81291ef6fd4e45"><div class="ttname"><a href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a></div><div class="ttdeci">Long this option accepts decimal values</div><div class="ttdef"><b>Definition:</b> <a href="max-time_8d_source.html#l00009">max-time.d:9</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a4be013336d7bab727dc0e7e150dcd03c"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a4be013336d7bab727dc0e7e150dcd03c">MFRC522::CRCResultRegL</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00186">MFRC522.h:186</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_acb2b1e74bc49fda2704450a684faa845"><div class="ttname"><a href="class_m_f_r_c522.html#acb2b1e74bc49fda2704450a684faa845">MFRC522::PCD_CommunicateWithPICC</a></div><div class="ttdeci">StatusCode PCD_CommunicateWithPICC(byte command, byte waitIRq, byte *sendData, byte sendLen, byte *backData=nullptr, byte *backLen=nullptr, byte *validBits=nullptr, byte rxAlign=0, bool checkCRC=false)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00443">MFRC522.cpp:443</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a0ec37643fa721f476b0cd4359e3c7ef1">MFRC522::CommandReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00149">MFRC522.h:149</a></div></div>
<div class="ttc" id="class_s_p_i_html_a3d0d6d9b84a7191b4a95971eee25f746"><div class="ttname"><a href="class_s_p_i.html#a3d0d6d9b84a7191b4a95971eee25f746">SPI::transfer</a></div><div class="ttdeci">void transfer(uint8_t *data, size_t dataLen)</div><div class="ttdoc">Send and receive data through SPI. This is a blocking call. </div><div class="ttdef"><b>Definition:</b> <a href="_s_p_i_8cpp_source.html#l00111">SPI.cpp:111</a></div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a22163b77459e20191d7f3141a6ef6a13"><div class="ttname"><a href="_m_f_r_c522_8h.html#a22163b77459e20191d7f3141a6ef6a13">MFRC522_firmware_referenceV0_0</a></div><div class="ttdeci">const byte MFRC522_firmware_referenceV0_0[]</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00090">MFRC522.h:90</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a3efaeaa8963b24323f274bab4c1eaf8f"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a3efaeaa8963b24323f274bab4c1eaf8f">MFRC522::PICC_TYPE_TNP3XXX</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00294">MFRC522.h:294</a></div></div>
<div class="ttc" id="_free_r_t_o_s_8h_html"><div class="ttname"><a href="_free_r_t_o_s_8h.html">FreeRTOS.h</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a76193f4f8916f688fe2b7976d0fd1dc2"><div class="ttname"><a href="class_m_f_r_c522.html#a76193f4f8916f688fe2b7976d0fd1dc2">MFRC522::PCD_ClearRegisterBitMask</a></div><div class="ttdeci">void PCD_ClearRegisterBitMask(PCD_Register reg, byte mask)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00150">MFRC522.cpp:150</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab4009cbdd5150b1b3a62084aa2033807"><div class="ttname"><a href="class_m_f_r_c522.html#ab4009cbdd5150b1b3a62084aa2033807">MFRC522::MIFARE_GetValue</a></div><div class="ttdeci">StatusCode MIFARE_GetValue(byte blockAddr, int32_t *value)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01063">MFRC522.cpp:1063</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a20c559f09927a7c5f91295f6158e4342"><div class="ttname"><a href="class_m_f_r_c522.html#a20c559f09927a7c5f91295f6158e4342">MFRC522::PICC_DumpMifareClassicSectorToSerial</a></div><div class="ttdeci">void PICC_DumpMifareClassicSectorToSerial(Uid *uid, MIFARE_Key *key, byte sector)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01376">MFRC522.cpp:1376</a></div></div>
<div class="ttc" id="_b_l_e_eddystone_t_l_m_8h_html_ab22abc2906422da61885ac6c8e6a1a59"><div class="ttname"><a href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a></div><div class="ttdeci">uint8_t version</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_eddystone_t_l_m_8h_source.html#l00041">BLEEddystoneTLM.h:41</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a6f324d43c6fbbd0e260b171747186037"><div class="ttname"><a href="class_m_f_r_c522.html#a6f324d43c6fbbd0e260b171747186037">MFRC522::PICC_DumpToSerial</a></div><div class="ttdeci">void PICC_DumpToSerial(Uid *uid)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01257">MFRC522.cpp:1257</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2">MFRC522::PICC_Type</a></div><div class="ttdeci">PICC_Type</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00284">MFRC522.h:284</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a0dc5fb05769779ec3ed708bd153706b3"><div class="ttname"><a href="class_m_f_r_c522.html#a0dc5fb05769779ec3ed708bd153706b3">MFRC522::MIFARE_Write</a></div><div class="ttdeci">StatusCode MIFARE_Write(byte blockAddr, byte *buffer, byte bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00910">MFRC522.cpp:910</a></div></div>
<div class="ttc" id="class_e_s_p32_c_p_p_1_1_g_p_i_o_html_add68250ce86665c502405a353ef1c870"><div class="ttname"><a href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#add68250ce86665c502405a353ef1c870">ESP32CPP::GPIO::read</a></div><div class="ttdeci">static bool read(gpio_num_t pin)</div><div class="ttdoc">Read a value from the given pin. </div><div class="ttdef"><b>Definition:</b> <a href="_g_p_i_o_8cpp_source.html#l00119">GPIO.cpp:119</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_acebb9a90249419f2a53281c4a13727d1"><div class="ttname"><a href="class_m_f_r_c522.html#acebb9a90249419f2a53281c4a13727d1">MFRC522::PCD_SetRegisterBitMask</a></div><div class="ttdeci">void PCD_SetRegisterBitMask(PCD_Register reg, byte mask)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00138">MFRC522.cpp:138</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a92c17a5b83cc4fde3cc3454c03b8eedea3b5fce9bf15481d218872d4584743a1c"><div class="ttname"><a href="class_m_f_r_c522.html#a92c17a5b83cc4fde3cc3454c03b8eedea3b5fce9bf15481d218872d4584743a1c">MFRC522::MF_ACK</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00278">MFRC522.h:278</a></div></div>
<div class="ttc" id="_g_p_i_o_8h_html"><div class="ttname"><a href="_g_p_i_o_8h.html">GPIO.h</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8a61d1786d5518a1ad71aac8413941f0ac"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a61d1786d5518a1ad71aac8413941f0ac">MFRC522::PCD_CalcCRC</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00225">MFRC522.h:225</a></div></div>
<div class="ttc" id="unit1602_8c_html_a1f81d06f9ccd5ec47176a7fc466b6030"><div class="ttname"><a href="unit1602_8c.html#a1f81d06f9ccd5ec47176a7fc466b6030">value</a></div><div class="ttdeci">UNITTEST_START int * value</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00051">unit1602.c:51</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aab1218c71cec9cc17ee3ac8a683df106"><div class="ttname"><a href="class_m_f_r_c522.html#aab1218c71cec9cc17ee3ac8a683df106">MFRC522::PICC_ReadCardSerial</a></div><div class="ttdeci">virtual bool PICC_ReadCardSerial()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01605">MFRC522.cpp:1605</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8a2f3a9f820c74cb11fabdc00e20c7e2fe"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a2f3a9f820c74cb11fabdc00e20c7e2fe">MFRC522::PCD_Mem</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00223">MFRC522.h:223</a></div></div>
<div class="ttc" id="class_e_s_p32_c_p_p_1_1_g_p_i_o_html_ac1599d926502a487e0e7518dc343a833"><div class="ttname"><a href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#ac1599d926502a487e0e7518dc343a833">ESP32CPP::GPIO::setOutput</a></div><div class="ttdeci">static void setOutput(gpio_num_t pin)</div><div class="ttdoc">Set the pin as output. </div><div class="ttdef"><b>Definition:</b> <a href="_g_p_i_o_8cpp_source.html#l00167">GPIO.cpp:167</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a24d3ab7b2170fdfa3f0121a7256f12d9"><div class="ttname"><a href="class_m_f_r_c522.html#a24d3ab7b2170fdfa3f0121a7256f12d9">MFRC522::PCD_StopCrypto1</a></div><div class="ttdeci">void PCD_StopCrypto1()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00854">MFRC522.cpp:854</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a044be037a5f172e9cea7d8ce1dcf32e0"><div class="ttname"><a href="class_m_f_r_c522.html#a044be037a5f172e9cea7d8ce1dcf32e0">MFRC522::PCD_AntennaOn</a></div><div class="ttdeci">void PCD_AntennaOn()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00283">MFRC522.cpp:283</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a9a9be34ff94660db8bf098745d9fc1d8a903753278eed75d5d1af2390649ec0c2"><div class="ttname"><a href="class_m_f_r_c522.html#a9a9be34ff94660db8bf098745d9fc1d8a903753278eed75d5d1af2390649ec0c2">MFRC522::PCD_MFAuthent</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00230">MFRC522.h:230</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669ac9a037a517ada62924c47d5e4b62a14c"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669ac9a037a517ada62924c47d5e4b62a14c">MFRC522::TReloadRegH</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00196">MFRC522.h:196</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9ad14f5e1a33047c90b50fa829cb669109"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9ad14f5e1a33047c90b50fa829cb669109">MFRC522::STATUS_MIFARE_NACK</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00309">MFRC522.h:309</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341aa9329ee8f72f61f5d73bb893b64c08d0"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341aa9329ee8f72f61f5d73bb893b64c08d0">MFRC522::PICC_CMD_SEL_CL1</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00256">MFRC522.h:256</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a6ed93e88913ea104420f3bb4a88cce52"><div class="ttname"><a href="class_m_f_r_c522.html#a6ed93e88913ea104420f3bb4a88cce52">MFRC522::MIFARE_Read</a></div><div class="ttdeci">StatusCode MIFARE_Read(byte blockAddr, byte *buffer, byte *bufferSize)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00879">MFRC522.cpp:879</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a92c17a5b83cc4fde3cc3454c03b8eedea410c51021b253b680b7ec518ccc818ce"><div class="ttname"><a href="class_m_f_r_c522.html#a92c17a5b83cc4fde3cc3454c03b8eedea410c51021b253b680b7ec518ccc818ce">MFRC522::MF_KEY_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00279">MFRC522.h:279</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a7cb2a1ad6f06e49fddac5c62399c81a9"><div class="ttname"><a href="class_m_f_r_c522.html#a7cb2a1ad6f06e49fddac5c62399c81a9">MFRC522::StatusCode</a></div><div class="ttdeci">StatusCode</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00300">MFRC522.h:300</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ac80a18228260bdde07dff5d4ac23bb53"><div class="ttname"><a href="class_m_f_r_c522.html#ac80a18228260bdde07dff5d4ac23bb53">MFRC522::PICC_GetType</a></div><div class="ttdeci">static PICC_Type PICC_GetType(byte sak)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01200">MFRC522.cpp:1200</a></div></div>
<div class="ttc" id="struct_m_f_r_c522_1_1_uid_html"><div class="ttname"><a href="struct_m_f_r_c522_1_1_uid.html">MFRC522::Uid</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00313">MFRC522.h:313</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aafd15c276e5cf3b677885b7b95e71ca2a6d211bf0d6e1bed8f7cdb375e9137360"><div class="ttname"><a href="class_m_f_r_c522.html#aafd15c276e5cf3b677885b7b95e71ca2a6d211bf0d6e1bed8f7cdb375e9137360">MFRC522::PICC_TYPE_ISO_18092</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00287">MFRC522.h:287</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aa88d28676b3ffb5985af8db35d39077b"><div class="ttname"><a href="class_m_f_r_c522.html#aa88d28676b3ffb5985af8db35d39077b">MFRC522::PCD_MIFARE_Transceive</a></div><div class="ttdeci">StatusCode PCD_MIFARE_Transceive(byte *sendData, byte sendLen, bool acceptTimeout=false)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01167">MFRC522.cpp:1167</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341ad1e0cf89f52ca1b503297e59c600ca57"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341ad1e0cf89f52ca1b503297e59c600ca57">MFRC522::PICC_CMD_HLTA</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00259">MFRC522.h:259</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a41313d0e4a8a674271e64362d24e1d6b"><div class="ttname"><a href="class_m_f_r_c522.html#a41313d0e4a8a674271e64362d24e1d6b">MFRC522::UNUSED_PIN</a></div><div class="ttdeci">static constexpr uint8_t UNUSED_PIN</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00142">MFRC522.h:142</a></div></div>
<div class="ttc" id="class_e_s_p32_c_p_p_1_1_g_p_i_o_html_a83984b2c70af70005b39071ea88fb45c"><div class="ttname"><a href="class_e_s_p32_c_p_p_1_1_g_p_i_o.html#a83984b2c70af70005b39071ea88fb45c">ESP32CPP::GPIO::low</a></div><div class="ttdeci">static void low(gpio_num_t pin)</div><div class="ttdoc">Set the pin low. </div><div class="ttdef"><b>Definition:</b> <a href="_g_p_i_o_8cpp_source.html#l00107">GPIO.cpp:107</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_aa5e5825adb4c784d8a5a60242c135fb7"><div class="ttname"><a href="class_m_f_r_c522.html#aa5e5825adb4c784d8a5a60242c135fb7">MFRC522::PCD_WriteRegister</a></div><div class="ttdeci">void PCD_WriteRegister(PCD_Register reg, byte value)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00047">MFRC522.cpp:47</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_ab57242c2e8a0ca7de1a968c2ccb55341a291c265bc0a7b3f303b361582b95cc85"><div class="ttname"><a href="class_m_f_r_c522.html#ab57242c2e8a0ca7de1a968c2ccb55341a291c265bc0a7b3f303b361582b95cc85">MFRC522::PICC_CMD_SEL_CL3</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00258">MFRC522.h:258</a></div></div>
<div class="ttc" id="unit1602_8c_html_a35af0be900467fedbb610bd6ea65ed78"><div class="ttname"><a href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a></div><div class="ttdeci">int key</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00056">unit1602.c:56</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a4289838c6f24f2d62eb8dc0e7a6647d1"><div class="ttname"><a href="class_m_f_r_c522.html#a4289838c6f24f2d62eb8dc0e7a6647d1">MFRC522::PCD_ReadRegister</a></div><div class="ttdeci">byte PCD_ReadRegister(PCD_Register reg)</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l00084">MFRC522.cpp:84</a></div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="struct_m_f_r_c522_1_1_uid_html_a90aa2fd57a03011252148c2ccdc8875b"><div class="ttname"><a href="struct_m_f_r_c522_1_1_uid.html#a90aa2fd57a03011252148c2ccdc8875b">MFRC522::Uid::sak</a></div><div class="ttdeci">byte sak</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00316">MFRC522.h:316</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a41c31c6932a59646eeff470c60a4d20d"><div class="ttname"><a href="class_m_f_r_c522.html#a41c31c6932a59646eeff470c60a4d20d">MFRC522::PCD_DumpVersionToSerial</a></div><div class="ttdeci">void PCD_DumpVersionToSerial()</div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8cpp_source.html#l01226">MFRC522.cpp:1226</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a9583618ad17a8a20b7a735c7677c8e56"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a9583618ad17a8a20b7a735c7677c8e56">MFRC522::AutoTestReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00208">MFRC522.h:208</a></div></div>
<div class="ttc" id="class_m_f_r_c522_html_a3f25eb3421a80d3aeca247c9640f0669a88c2ad7cdfb7178ea775c157f4ce5213"><div class="ttname"><a href="class_m_f_r_c522.html#a3f25eb3421a80d3aeca247c9640f0669a88c2ad7cdfb7178ea775c157f4ce5213">MFRC522::TPrescalerReg</a></div><div class="ttdef"><b>Definition:</b> <a href="_m_f_r_c522_8h_source.html#l00195">MFRC522.h:195</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_e66062f3a4d2a5b6b6746a6b0f9c85ac.html">cpp_utils</a></li><li class="navelem"><a class="el" href="_m_f_r_c522_8cpp.html">MFRC522.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
