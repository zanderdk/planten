<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: components/curl/lib/vtls/darwinssl.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('darwinssl_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">darwinssl.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="darwinssl_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 2012 - 2017, Nick Zitzmann, &lt;nickzman@gmail.com&gt;.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Copyright (C) 2012 - 2018, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Source file for all iOS and macOS SecureTransport-specific code for the</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * TLS/SSL layer. No code but vtls.c should ever call or use these functions.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__setup_8h.html">curl_setup.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span> <span class="comment">/* for the Curl_easy definition */</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__base64_8h.html">curl_base64.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strtok_8h.html">strtok.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifdef USE_DARWINSSL</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifdef __clang__</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#pragma clang diagnostic push</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wtautological-pointer-compare&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* __clang__ */</span><span class="preprocessor"></span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;Security/Security.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/* For some reason, when building for iOS, the omnibus header above does</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * not include SecureTransport.h as of iOS SDK 5.1. */</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;Security/SecureTransport.h&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;CoreFoundation/CoreFoundation.h&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;CommonCrypto/CommonDigest.h&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/* The Security framework has changed greatly between iOS and different macOS</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">   versions, and we will try to support as many of them as we can (back to</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">   Leopard and iOS 5) by using macros and weak-linking.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">   In general, you want to build this using the most recent OS SDK, since some</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">   features require curl to be built against the latest SDK. TLS 1.1 and 1.2</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">   support, for instance, require the macOS 10.8 SDK or later. TLS 1.3</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">   requires the macOS 10.13 or iOS 11 SDK or later. */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#if (TARGET_OS_MAC &amp;&amp; !(TARGET_OS_EMBEDDED || TARGET_OS_IPHONE))</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#if MAC_OS_X_VERSION_MAX_ALLOWED &lt; 1050</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#error &quot;The darwinssl back-end requires Leopard or later.&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MAC_OS_X_VERSION_MAX_ALLOWED &lt; 1050 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS 0</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_7 0</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_9 0</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_11 0</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC 1</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/* This is the maximum API level we are allowed to use when building: */</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_5 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1050</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_6 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1060</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_7 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1070</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_8 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1080</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_9 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1090</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_11 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 101100</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_13 MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 101300</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/* These macros mean &quot;the following code is present to allow runtime backward</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">   compatibility with at least this cat or earlier&quot;:</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">   (You set this at build-time using the compiler command line option</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">   &quot;-mmacos-version-min.&quot;) */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_5 MAC_OS_X_VERSION_MIN_REQUIRED &lt;= 1050</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_6 MAC_OS_X_VERSION_MIN_REQUIRED &lt;= 1060</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_7 MAC_OS_X_VERSION_MIN_REQUIRED &lt;= 1070</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_8 MAC_OS_X_VERSION_MIN_REQUIRED &lt;= 1080</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_9 MAC_OS_X_VERSION_MIN_REQUIRED &lt;= 1090</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#elif TARGET_OS_EMBEDDED || TARGET_OS_IPHONE</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS 1</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_7 __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_9 __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 90000</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#define CURL_BUILD_IOS_11 __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 110000</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC 0</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_5 0</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_6 0</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_7 0</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_8 0</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_9 0</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_11 0</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#define CURL_BUILD_MAC_10_13 0</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_5 0</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_6 0</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_7 0</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_8 0</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#define CURL_SUPPORT_MAC_10_9 0</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#error &quot;The darwinssl back-end requires iOS or OS X.&quot;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* (TARGET_OS_MAC &amp;&amp; !(TARGET_OS_EMBEDDED || TARGET_OS_IPHONE)) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#include &lt;sys/sysctl.h&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC */</span><span class="preprocessor"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urldata_8h.html">urldata.h</a>&quot;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sendf_8h.html">sendf.h</a>&quot;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="inet__pton_8h.html">inet_pton.h</a>&quot;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connect_8h.html">connect.h</a>&quot;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="select_8h.html">select.h</a>&quot;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vtls_8h.html">vtls.h</a>&quot;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="darwinssl_8h.html">darwinssl.h</a>&quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__printf_8h.html">curl_printf.h</a>&quot;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="strdup_8h.html">strdup.h</a>&quot;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="curl__memory_8h.html">curl_memory.h</a>&quot;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/* The last #include file should be: */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memdebug_8h.html">memdebug.h</a>&quot;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">/* From MacTypes.h (which we can&#39;t include because it isn&#39;t present in iOS: */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#define ioErr -36</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#define paramErr -50</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">struct </span>ssl_backend_data {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  SSLContextRef ssl_ctx;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> ssl_sockfd;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">bool</span> ssl_direction; <span class="comment">/* true if writing, false if reading */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">size_t</span> ssl_write_buffered_length;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;};</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#define BACKEND connssl-&gt;backend</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/* pinned public key support tests */</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/* version 1 supports macOS 10.12+ and iOS 10+ */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#if ((TARGET_OS_IPHONE &amp;&amp; __IPHONE_OS_VERSION_MIN_REQUIRED &gt;= 100000) || \</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">    (!TARGET_OS_IPHONE &amp;&amp; __MAC_OS_X_VERSION_MIN_REQUIRED  &gt;= 101200))</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#define DARWIN_SSL_PINNEDPUBKEY_V1 1</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/* version 2 supports MacOSX 10.7+ */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#if (!TARGET_OS_IPHONE &amp;&amp; __MAC_OS_X_VERSION_MIN_REQUIRED &gt;= 1070)</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#define DARWIN_SSL_PINNEDPUBKEY_V2 1</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#if defined(DARWIN_SSL_PINNEDPUBKEY_V1) || defined(DARWIN_SSL_PINNEDPUBKEY_V2)</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/* this backend supports CURLOPT_PINNEDPUBLICKEY */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#define DARWIN_SSL_PINNEDPUBKEY 1</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY */</span><span class="preprocessor"></span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/* both new and old APIs return rsa keys missing the spki header (not DER) */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rsa4096SpkiHeader[] = {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                       0x30, 0x82, 0x02, 0x22, 0x30, 0x0d,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                                       0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                       0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05,</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                       0x00, 0x03, 0x82, 0x02, 0x0f, 0x00};</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rsa2048SpkiHeader[] = {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                       0x30, 0x82, 0x01, 0x22, 0x30, 0x0d,</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                       0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                       0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05,</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                       0x00, 0x03, 0x82, 0x01, 0x0f, 0x00};</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY_V1</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">/* the *new* version doesn&#39;t return DER encoded ecdsa certs like the old... */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ecDsaSecp256r1SpkiHeader[] = {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                       0x30, 0x59, 0x30, 0x13, 0x06, 0x07,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                       0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                                       0x01, 0x06, 0x08, 0x2a, 0x86, 0x48,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                       0xce, 0x3d, 0x03, 0x01, 0x07, 0x03,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                       0x42, 0x00};</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ecDsaSecp384r1SpkiHeader[] = {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                       0x30, 0x76, 0x30, 0x10, 0x06, 0x07,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                       0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                       0x01, 0x06, 0x05, 0x2b, 0x81, 0x04,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                       0x00, 0x22, 0x03, 0x62, 0x00};</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY_V1 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY */</span><span class="preprocessor"></span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">/* The following two functions were ripped from Apple sample code,</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * with some modifications: */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">static</span> OSStatus SocketRead(SSLConnectionRef <a class="code" href="pinnedpubkey_8d.html#afe9b7efeec45b7ade0025abb3fbff79b">connection</a>,</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                           <span class="keywordtype">void</span> *<a class="code" href="structdata.html">data</a>,          <span class="comment">/* owned by</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">                                                 * caller, data</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">                                                 * RETURNED */</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                           <span class="keywordtype">size_t</span> *dataLength)  <span class="comment">/* IN/OUT */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordtype">size_t</span> bytesToGo = *dataLength;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">size_t</span> initLen = bytesToGo;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  UInt8 *currData = (UInt8 *)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">/*int sock = *(int *)connection;*/</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = (<span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *)<a class="code" href="pinnedpubkey_8d.html#afe9b7efeec45b7ade0025abb3fbff79b">connection</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">int</span> sock = BACKEND-&gt;ssl_sockfd;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  OSStatus rtn = noErr;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">size_t</span> bytesRead;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> rrtn;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">int</span> theErr;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  *dataLength = 0;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    bytesRead = 0;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    rrtn = read(sock, currData, bytesToGo);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span>(rrtn &lt;= 0) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">/* this is guesswork... */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      theErr = errno;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">if</span>(rrtn == 0) { <span class="comment">/* EOF = server hung up */</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">/* the framework will turn this into errSSLClosedNoNotify */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        rtn = errSSLClosedGraceful;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">else</span> <span class="comment">/* do the switch */</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">switch</span>(theErr) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;          <span class="keywordflow">case</span> ENOENT:</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="comment">/* connection closed */</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            rtn = errSSLClosedGraceful;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          <span class="keywordflow">case</span> ECONNRESET:</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            rtn = errSSLClosedAbort;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          <span class="keywordflow">case</span> <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            rtn = errSSLWouldBlock;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            BACKEND-&gt;ssl_direction = <span class="keyword">false</span>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;          <span class="keywordflow">default</span>:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            rtn = ioErr;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      bytesRead = rrtn;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    bytesToGo -= bytesRead;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    currData  += bytesRead;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span>(bytesToGo == 0) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">/* filled buffer with incoming data, done */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  *dataLength = initLen - bytesToGo;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">return</span> rtn;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">static</span> OSStatus SocketWrite(SSLConnectionRef <a class="code" href="pinnedpubkey_8d.html#afe9b7efeec45b7ade0025abb3fbff79b">connection</a>,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                            <span class="keywordtype">size_t</span> *dataLength)  <span class="comment">/* IN/OUT */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">size_t</span> bytesSent = 0;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">/*int sock = *(int *)connection;*/</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = (<span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *)<a class="code" href="pinnedpubkey_8d.html#afe9b7efeec45b7ade0025abb3fbff79b">connection</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">int</span> sock = BACKEND-&gt;ssl_sockfd;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> length;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">size_t</span> dataLen = *dataLength;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">const</span> UInt8 *dataPtr = (UInt8 *)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  OSStatus ortn;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">int</span> theErr;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  *dataLength = 0;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    length = write(sock,</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                   (<span class="keywordtype">char</span> *)dataPtr + bytesSent,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                   dataLen - bytesSent);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  } <span class="keywordflow">while</span>((length &gt; 0) &amp;&amp;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;           ( (bytesSent += length) &lt; dataLen) );</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span>(length &lt;= 0) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    theErr = errno;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span>(theErr == <a class="code" href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a>) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      ortn = errSSLWouldBlock;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      BACKEND-&gt;ssl_direction = <span class="keyword">true</span>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      ortn = ioErr;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    ortn = noErr;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  *dataLength = bytesSent;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">return</span> ortn;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;CF_INLINE <span class="keyword">const</span> <span class="keywordtype">char</span> *SSLCipherNameForNumber(SSLCipherSuite cipher)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">switch</span>(cipher) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/* SSL version 3.0 */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_MD5:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_NULL_MD5&quot;</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_RC4_40_MD5:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_EXPORT_WITH_RC4_40_MD5&quot;</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_MD5:</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5&quot;</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_IDEA_CBC_SHA:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_IDEA_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">case</span> SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">case</span> SSL_DH_DSS_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_DSS_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">case</span> SSL_DH_DSS_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_DSS_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">case</span> SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">case</span> SSL_DH_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_RSA_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">case</span> SSL_DH_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_DSS_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_DSS_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_RSA_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">case</span> SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_EXPORT_WITH_RC4_40_MD5:</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_anon_EXPORT_WITH_RC4_40_MD5&quot;</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_WITH_RC4_128_MD5:</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_anon_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_anon_EXPORT_WITH_DES40_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_WITH_DES_CBC_SHA:</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_anon_WITH_DES_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_DH_anon_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">case</span> SSL_FORTEZZA_DMS_WITH_NULL_SHA:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_FORTEZZA_DMS_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">case</span> SSL_FORTEZZA_DMS_WITH_FORTEZZA_CBC_SHA:</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_FORTEZZA_DMS_WITH_FORTEZZA_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">/* TLS 1.0 with AES (RFC 3268)</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">       (Apparently these are used in SSLv3 implementations as well.) */</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">/* SSL version 2.0 */</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_RC2_CBC_MD5:</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_RC2_CBC_MD5&quot;</span>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_IDEA_CBC_MD5:</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_IDEA_CBC_MD5&quot;</span>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_DES_CBC_MD5:</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_DES_CBC_MD5&quot;</span>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_3DES_EDE_CBC_MD5:</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_RSA_WITH_3DES_EDE_CBC_MD5&quot;</span>;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&quot;SSL_NULL_WITH_NULL_NULL&quot;</span>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;CF_INLINE <span class="keyword">const</span> <span class="keywordtype">char</span> *TLSCipherNameForNumber(SSLCipherSuite cipher)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;{</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">switch</span>(cipher) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">/* TLS 1.0 with AES (RFC 3268) */</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_6 || CURL_BUILD_IOS</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">/* TLS 1.0 with ECDSA (RFC 4492) */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_NULL_SHA:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_NULL_SHA:</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_anon_WITH_NULL_SHA:</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_anon_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_anon_WITH_RC4_128_SHA:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_anon_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_anon_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_anon_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_anon_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_anon_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_6 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">/* TLS 1.2 (RFC 5246) */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_NULL_MD5:</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_NULL_MD5&quot;</span>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_RC4_128_MD5:</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_NULL_SHA256:</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_NULL_SHA256&quot;</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_RC4_128_MD5:</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_256_CBC_SHA256:</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_256_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">/* TLS 1.2 with AES GCM (RFC 5288) */</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_RSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_RSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">case</span> TLS_DH_RSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_RSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_DSS_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_DSS_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">case</span> TLS_DH_DSS_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_DSS_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">/* TLS 1.2 with elliptic curve ciphers (RFC 5289) */</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">case</span> TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">case</span> TLS_EMPTY_RENEGOTIATION_INFO_SCSV:</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_EMPTY_RENEGOTIATION_INFO_SCSV&quot;</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_MD5:</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_NULL_MD5&quot;</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_MD5:</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">case</span> SSL_RSA_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_WITH_RC4_128_MD5:</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_RC4_128_MD5&quot;</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">case</span> SSL_DH_anon_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DH_anon_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_9 || CURL_BUILD_IOS_7</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">/* TLS PSK (RFC 4279): */</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_RC4_128_SHA:</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_RC4_128_SHA:</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_RC4_128_SHA:</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_RC4_128_SHA&quot;</span>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_3DES_EDE_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_AES_128_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_AES_256_CBC_SHA&quot;</span>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">/* More TLS PSK (RFC 4785): */</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_NULL_SHA:</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_NULL_SHA:</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_NULL_SHA:</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_NULL_SHA&quot;</span>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">/* Even more TLS PSK (RFC 5487): */</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_128_GCM_SHA256:</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_256_GCM_SHA384:</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_NULL_SHA256:</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_NULL_SHA256&quot;</span>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">case</span> TLS_PSK_WITH_NULL_SHA384:</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_PSK_WITH_NULL_SHA384&quot;</span>;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_NULL_SHA256:</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_DHE_PSK_WITH_NULL_SHA256&quot;</span>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">case</span> TLS_DHE_PSK_WITH_NULL_SHA384:</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_NULL_SHA384&quot;</span>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_128_CBC_SHA256:</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_AES_128_CBC_SHA256&quot;</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_AES_256_CBC_SHA384:</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_AES_256_CBC_SHA384&quot;</span>;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_NULL_SHA256:</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_NULL_SHA256&quot;</span>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">case</span> TLS_RSA_PSK_WITH_NULL_SHA384:</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_RSA_PSK_WITH_NULL_SHA384&quot;</span>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_9 || CURL_BUILD_IOS_7 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">/* New ChaCha20+Poly1305 cipher-suites used by TLS 1.3: */</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">case</span> TLS_AES_128_GCM_SHA256:</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_AES_128_GCM_SHA256&quot;</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">case</span> TLS_AES_256_GCM_SHA384:</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_AES_256_GCM_SHA384&quot;</span>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">case</span> TLS_CHACHA20_POLY1305_SHA256:</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_CHACHA20_POLY1305_SHA256&quot;</span>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">case</span> TLS_AES_128_CCM_SHA256:</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_AES_128_CCM_SHA256&quot;</span>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">case</span> TLS_AES_128_CCM_8_SHA256:</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_AES_128_CCM_8_SHA256&quot;</span>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256:</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;</span>;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">case</span> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256:</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256&quot;</span>;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&quot;TLS_NULL_WITH_NULL_NULL&quot;</span>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;}</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !CURL_DISABLE_VERBOSE_STRINGS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;CF_INLINE <span class="keywordtype">void</span> GetDarwinVersionNumber(<span class="keywordtype">int</span> *<a class="code" href="_b_l_e_beacon_8h.html#a600930655b7237315b72223c48327ea8">major</a>, <span class="keywordtype">int</span> *<a class="code" href="_b_l_e_beacon_8h.html#a9f280ce3ae5b6cd9346fd7a09ff29168">minor</a>)</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;{</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordtype">int</span> mib[2];</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">char</span> *os_version;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">size_t</span> os_version_len;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">char</span> *os_version_major, *os_version_minor;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">char</span> *tok_buf;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">/* Get the Darwin kernel version from the kernel using sysctl(): */</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  mib[0] = CTL_KERN;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  mib[1] = KERN_OSRELEASE;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span>(sysctl(mib, 2, NULL, &amp;os_version_len, NULL, 0) == -1)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  os_version = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(os_version_len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordflow">if</span>(!os_version)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">if</span>(sysctl(mib, 2, os_version, &amp;os_version_len, NULL, 0) == -1) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(os_version);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  }</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">/* Parse the version: */</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  os_version_major = <a class="code" href="strtok_8h.html#abff4e21c5a2026f9982e88f1e686e63a">strtok_r</a>(os_version, <span class="stringliteral">&quot;.&quot;</span>, &amp;tok_buf);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  os_version_minor = <a class="code" href="strtok_8h.html#abff4e21c5a2026f9982e88f1e686e63a">strtok_r</a>(NULL, <span class="stringliteral">&quot;.&quot;</span>, &amp;tok_buf);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  *<a class="code" href="_b_l_e_beacon_8h.html#a600930655b7237315b72223c48327ea8">major</a> = atoi(os_version_major);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  *<a class="code" href="_b_l_e_beacon_8h.html#a9f280ce3ae5b6cd9346fd7a09ff29168">minor</a> = atoi(os_version_minor);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(os_version);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;}</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC */</span><span class="preprocessor"></span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">/* Apple provides a myriad of ways of getting information about a certificate</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">   into a string. Some aren&#39;t available under iOS or newer cats. So here&#39;s</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">   a unified function for getting a string describing the certificate that</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">   ought to work in all cats starting with Leopard. */</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;CF_INLINE CFStringRef getsubject(SecCertificateRef cert)</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;{</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  CFStringRef server_cert_summary = CFSTR(<span class="stringliteral">&quot;(null)&quot;</span>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="preprocessor">#if CURL_BUILD_IOS</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">/* iOS: There&#39;s only one way to do this. */</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  server_cert_summary = SecCertificateCopySubjectSummary(cert);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_7</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="comment">/* Lion &amp; later: Get the long description if we can. */</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">if</span>(SecCertificateCopyLongDescription != NULL)</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    server_cert_summary =</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      SecCertificateCopyLongDescription(NULL, cert, NULL);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_7 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_6</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">/* Snow Leopard: Get the certificate summary. */</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">if</span>(SecCertificateCopySubjectSummary != NULL)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    server_cert_summary = SecCertificateCopySubjectSummary(cert);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">/* Leopard is as far back as we go... */</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  (void)SecCertificateCopyCommonName(cert, &amp;server_cert_summary);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">return</span> server_cert_summary;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> CopyCertSubject(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                                SecCertificateRef cert, <span class="keywordtype">char</span> **certp)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;{</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  CFStringRef c = getsubject(cert);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *direct;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordtype">char</span> *cbuf = NULL;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  *certp = NULL;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span>(!c) {</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: invalid CA certificate subject&quot;</span>);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="comment">/* If the subject is already available as UTF-8 encoded (ie &#39;direct&#39;) then</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">     use that, else convert it. */</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  direct = CFStringGetCStringPtr(c, kCFStringEncodingUTF8);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordflow">if</span>(direct) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    *certp = <a class="code" href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a>(direct);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span>(!*certp) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: out of memory&quot;</span>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordtype">size_t</span> cbuf_size = ((size_t)CFStringGetLength(c) * 4) + 1;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    cbuf = <a class="code" href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a>(cbuf_size, 1);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span>(cbuf) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">if</span>(!CFStringGetCString(c, cbuf, cbuf_size,</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                             kCFStringEncodingUTF8)) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: invalid CA certificate subject&quot;</span>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="comment">/* pass back the buffer */</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        *certp = cbuf;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t allocate %zu bytes of memory&quot;</span>, cbuf_size);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(cbuf);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  CFRelease(c);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_6</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">/* The SecKeychainSearch API was deprecated in Lion, and using it will raise</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">   deprecation warnings, so let&#39;s not compile this unless it&#39;s necessary: */</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="keyword">static</span> OSStatus CopyIdentityWithLabelOldSchool(<span class="keywordtype">char</span> *label,</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                               SecIdentityRef *out_c_a_k)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;{</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  OSStatus status = errSecItemNotFound;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  SecKeychainAttributeList attr_list;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  SecKeychainAttribute attr;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  SecKeychainSearchRef search = NULL;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  SecCertificateRef cert = NULL;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="comment">/* Set up the attribute list: */</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  attr_list.count = 1L;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  attr_list.attr = &amp;attr;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">/* Set up our lone search criterion: */</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  attr.tag = kSecLabelItemAttr;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  attr.data = label;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  attr.length = (UInt32)strlen(label);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">/* Start searching: */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  status = SecKeychainSearchCreateFromAttributes(NULL,</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                                                 kSecCertificateItemClass,</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                                                 &amp;attr_list,</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                                 &amp;search);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordflow">if</span>(status == noErr) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    status = SecKeychainSearchCopyNext(search,</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                       (SecKeychainItemRef *)&amp;cert);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span>(status == noErr &amp;&amp; cert) {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">/* If we found a certificate, does it have a private key? */</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      status = SecIdentityCreateWithCertificate(NULL, cert, out_c_a_k);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      CFRelease(cert);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">if</span>(search)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    CFRelease(search);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_SUPPORT_MAC_10_6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keyword">static</span> OSStatus CopyIdentityWithLabel(<span class="keywordtype">char</span> *label,</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                      SecIdentityRef *out_cert_and_key)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;{</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  OSStatus status = errSecItemNotFound;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  CFArrayRef keys_list;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  CFIndex keys_list_count;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  CFIndex <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  CFStringRef common_name;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">/* SecItemCopyMatching() was introduced in iOS and Snow Leopard.</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">     kSecClassIdentity was introduced in Lion. If both exist, let&#39;s use them</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">     to find the certificate. */</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span>(SecItemCopyMatching != NULL &amp;&amp; kSecClassIdentity != NULL) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    CFTypeRef keys[5];</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    CFTypeRef <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[5];</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    CFDictionaryRef query_dict;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    CFStringRef label_cf = CFStringCreateWithCString(NULL, label,</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      kCFStringEncodingUTF8);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="comment">/* Set up our search criteria and expected results: */</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[0] = kSecClassIdentity; <span class="comment">/* we want a certificate and a key */</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    keys[0] = kSecClass;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[1] = kCFBooleanTrue;    <span class="comment">/* we want a reference */</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    keys[1] = kSecReturnRef;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[2] = kSecMatchLimitAll; <span class="comment">/* kSecMatchLimitOne would be better if the</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">                                    * label matching below worked correctly */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    keys[2] = kSecMatchLimit;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="comment">/* identity searches need a SecPolicyRef in order to work */</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[3] = SecPolicyCreateSSL(<span class="keyword">false</span>, NULL);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    keys[3] = kSecMatchPolicy;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">/* match the name of the certificate (doesn&#39;t work in macOS 10.12.1) */</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[4] = label_cf;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    keys[4] = kSecAttrLabel;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    query_dict = CFDictionaryCreate(NULL, (<span class="keyword">const</span> <span class="keywordtype">void</span> **)keys,</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                                    (<span class="keyword">const</span> <span class="keywordtype">void</span> **)<a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>, 5L,</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                                    &amp;kCFCopyStringDictionaryKeyCallBacks,</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                                    &amp;kCFTypeDictionaryValueCallBacks);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    CFRelease(<a class="code" href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a>[3]);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">/* Do we have a match? */</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    status = SecItemCopyMatching(query_dict, (CFTypeRef *) &amp;keys_list);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">/* Because kSecAttrLabel matching doesn&#39;t work with kSecClassIdentity,</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">     * we need to find the correct identity ourselves */</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span>(status == noErr) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      keys_list_count = CFArrayGetCount(keys_list);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      *out_cert_and_key = NULL;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      status = 1;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;keys_list_count; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        OSStatus err = noErr;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        SecCertificateRef cert = NULL;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        SecIdentityRef identity =</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          (SecIdentityRef) CFArrayGetValueAtIndex(keys_list, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        err = SecIdentityCopyCertificate(identity, &amp;cert);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">if</span>(err == noErr) {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">#if CURL_BUILD_IOS</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          common_name = SecCertificateCopySubjectSummary(cert);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="preprocessor">#elif CURL_BUILD_MAC_10_7</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;          SecCertificateCopyCommonName(cert, &amp;common_name);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;          <span class="keywordflow">if</span>(CFStringCompare(common_name, label_cf, 0) == kCFCompareEqualTo) {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            CFRelease(cert);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            CFRelease(common_name);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            CFRetain(identity);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            *out_cert_and_key = identity;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            status = noErr;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          CFRelease(common_name);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        CFRelease(cert);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">if</span>(keys_list)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      CFRelease(keys_list);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    CFRelease(query_dict);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    CFRelease(label_cf);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  }</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_6</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">/* On Leopard and Snow Leopard, fall back to SecKeychainSearch. */</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    status = CopyIdentityWithLabelOldSchool(label, out_cert_and_key);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_SUPPORT_MAC_10_6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">#elif CURL_SUPPORT_MAC_10_6</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">/* For developers building on older cats, we have no choice but to fall back</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">     to SecKeychainSearch. */</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  status = CopyIdentityWithLabelOldSchool(label, out_cert_and_key);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;}</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="keyword">static</span> OSStatus CopyIdentityFromPKCS12File(<span class="keyword">const</span> <span class="keywordtype">char</span> *cPath,</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">char</span> *cPassword,</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                                           SecIdentityRef *out_cert_and_key)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;{</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  OSStatus status = errSecItemNotFound;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  CFURLRef pkcs_url = CFURLCreateFromFileSystemRepresentation(NULL,</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    (<span class="keyword">const</span> UInt8 *)cPath, strlen(cPath), <span class="keyword">false</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  CFStringRef password = cPassword ? CFStringCreateWithCString(NULL,</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    cPassword, kCFStringEncodingUTF8) : NULL;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  CFDataRef pkcs_data = NULL;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="comment">/* We can import P12 files on iOS or OS X 10.7 or later: */</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="comment">/* These constants are documented as having first appeared in 10.6 but they</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">     raise linker errors when used on that cat for some reason. */</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordflow">if</span>(CFURLCreateDataAndPropertiesFromResource(NULL, pkcs_url, &amp;pkcs_data,</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   NULL, NULL, &amp;status)) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    CFArrayRef items = NULL;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="comment">/* On iOS SecPKCS12Import will never add the client certificate to the</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">   * Keychain.</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">   * It gives us back a SecIdentityRef that we can use directly. */</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#if CURL_BUILD_IOS</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">void</span> *cKeys[] = {kSecImportExportPassphrase};</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">void</span> *cValues[] = {password};</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    CFDictionaryRef <a class="code" href="fail-early_8d.html#a188ba6f263db5df5a64e1cc11fb0c098">options</a> = CFDictionaryCreate(NULL, cKeys, cValues,</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      password ? 1L : 0L, NULL, NULL);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="fail-early_8d.html#a188ba6f263db5df5a64e1cc11fb0c098">options</a> != NULL) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      status = SecPKCS12Import(pkcs_data, <a class="code" href="fail-early_8d.html#a188ba6f263db5df5a64e1cc11fb0c098">options</a>, &amp;items);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      CFRelease(<a class="code" href="fail-early_8d.html#a188ba6f263db5df5a64e1cc11fb0c098">options</a>);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="comment">/* On macOS SecPKCS12Import will always add the client certificate to</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">   * the Keychain.</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">   * As this doesn&#39;t match iOS, and apps may not want to see their client</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">   * certificate saved in the the user&#39;s keychain, we use SecItemImport</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">   * with a NULL keychain to avoid importing it.</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">   * This returns a SecCertificateRef from which we can construct a</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">   * SecIdentityRef.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="preprocessor">#elif CURL_BUILD_MAC_10_7</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    SecItemImportExportKeyParameters keyParams;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    SecExternalFormat inputFormat = kSecFormatPKCS12;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    SecExternalItemType inputType = kSecItemTypeCertificate;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a>(&amp;keyParams, 0x00, <span class="keyword">sizeof</span>(keyParams));</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    keyParams.version    = SEC_KEY_IMPORT_EXPORT_PARAMS_VERSION;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    keyParams.passphrase = password;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    status = SecItemImport(pkcs_data, NULL, &amp;inputFormat, &amp;inputType,</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                           0, &amp;keyParams, NULL, &amp;items);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">/* Extract the SecIdentityRef */</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">if</span>(status == errSecSuccess &amp;&amp; items &amp;&amp; CFArrayGetCount(items)) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      CFIndex <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, count;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      count = CFArrayGetCount(items);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; count; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        CFTypeRef item = (CFTypeRef) CFArrayGetValueAtIndex(items, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        CFTypeID  itemID = CFGetTypeID(item);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">if</span>(itemID == CFDictionaryGetTypeID()) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;          CFTypeRef identity = (CFTypeRef) CFDictionaryGetValue(</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                                                 (CFDictionaryRef) item,</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                                                 kSecImportItemIdentity);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;          CFRetain(identity);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          *out_cert_and_key = (SecIdentityRef) identity;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_7</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(itemID == SecCertificateGetTypeID()) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          status = SecIdentityCreateWithCertificate(NULL,</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                                 (SecCertificateRef) item,</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                                                 out_cert_and_key);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        }</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    }</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordflow">if</span>(items)</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      CFRelease(items);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    CFRelease(pkcs_data);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordflow">if</span>(password)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    CFRelease(password);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  CFRelease(pkcs_url);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">/* This code was borrowed from nss.c, with some modifications:</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment"> * Determine whether the nickname passed in is a filename that needs to</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment"> * be loaded as a PEM or a regular NSS nickname.</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"> * returns 1 for a file</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment"> * returns 0 for not a file</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;CF_INLINE <span class="keywordtype">bool</span> is_file(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;{</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <a class="code" href="curl__setup_8h.html#a1c6e64692c9b7c6e7dc70adb398b3115">struct_stat</a> st;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a> == NULL)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="config-win32ce_8h.html#ad4ea824bd0fcae61733c900a5cab1e01">stat</a>(<a class="code" href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a>, &amp;st) == 0)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">return</span> S_ISREG(st.st_mode);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;}</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> darwinssl_version_from_curl(SSLProtocol *darwinver,</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                            <span class="keywordtype">long</span> ssl_version)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;{</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordflow">switch</span>(ssl_version) {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      *darwinver = kTLSProtocol1;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      *darwinver = kTLSProtocol11;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      *darwinver = kTLSProtocol12;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="comment">/* TLS 1.3 support first appeared in iOS 11 and macOS 10.13 */</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#if (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp; HAVE_BUILTIN_AVAILABLE == 1</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">if</span>(__builtin_available(macOS 10.13, iOS 11.0, *)) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        *darwinver = kTLSProtocol13;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      }</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp;</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">          HAVE_BUILTIN_AVAILABLE == 1 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  }</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;}</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;set_ssl_version_min_max(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;{</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordtype">long</span> ssl_version = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(<a class="code" href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a>);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="keywordtype">long</span> ssl_version_max = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(version_max);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordtype">long</span> max_supported_version_by_os;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="comment">/* macOS 10.5-10.7 supported TLS 1.0 only.</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">     macOS 10.8 and later, and iOS 5 and later, added TLS 1.1 and 1.2.</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">     macOS 10.13 and later, and iOS 11 and later, added TLS 1.3. */</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="preprocessor">#if (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp; HAVE_BUILTIN_AVAILABLE == 1</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordflow">if</span>(__builtin_available(macOS 10.13, iOS 11.0, *)) {</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    max_supported_version_by_os = <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468">CURL_SSLVERSION_MAX_TLSv1_3</a>;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    max_supported_version_by_os = <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5">CURL_SSLVERSION_MAX_TLSv1_2</a>;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  }</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  max_supported_version_by_os = <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5">CURL_SSLVERSION_MAX_TLSv1_2</a>;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp;</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">          HAVE_BUILTIN_AVAILABLE == 1 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordflow">switch</span>(ssl_version) {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      ssl_version = <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      ssl_version_max = max_supported_version_by_os;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  }</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="keywordflow">switch</span>(ssl_version_max) {</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dadd0b0bf93854f50974d52f324d3259df">CURL_SSLVERSION_MAX_NONE</a>:</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da724f1960f9dd1cfe462c0eca7f4e7da0">CURL_SSLVERSION_MAX_DEFAULT</a>:</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      ssl_version_max = max_supported_version_by_os;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  }</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordflow">if</span>(SSLSetProtocolVersionMax != NULL) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    SSLProtocol darwin_ver_min = kTLSProtocol1;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    SSLProtocol darwin_ver_max = kTLSProtocol1;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_version_from_curl(&amp;darwin_ver_min,</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                                                  ssl_version);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unsupported min version passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    }</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_version_from_curl(&amp;darwin_ver_max,</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                                         ssl_version_max &gt;&gt; 16);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;unsupported max version passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    }</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    (void)SSLSetProtocolVersionMin(BACKEND-&gt;ssl_ctx, darwin_ver_min);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, darwin_ver_max);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  }</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordtype">long</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = ssl_version;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                       kSSLProtocolAll,</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                       <span class="keyword">false</span>);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keywordflow">for</span>(; i &lt;= (ssl_version_max &gt;&gt; 16); <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="keywordflow">switch</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;          (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                                            kTLSProtocol1,</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                                            <span class="keyword">true</span>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;          (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                                            kTLSProtocol11,</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                            <span class="keyword">true</span>);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                                            kTLSProtocol12,</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                            <span class="keyword">true</span>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support TLSv1.3&quot;</span>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      }</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;DarwinSSL: cannot set SSL protocol&quot;</span>);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;}</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> darwinssl_connect_step1(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                                        <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;{</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_cafile = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(CAfile);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> verifypeer = <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifypeer);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordtype">char</span> * <span class="keyword">const</span> ssl_cert = <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="structhostname.html">hostname</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> :</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> port = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">port</a> : conn-&gt;<a class="code" href="structconnectdata.html#a82d9732a096255f5d8741c4a0ea990eb">remote_port</a>;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="preprocessor">#ifdef ENABLE_IPV6</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keyword">struct </span>in6_addr addr;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keyword">struct </span>in_addr addr;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ENABLE_IPV6 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordtype">size_t</span> all_ciphers_count = 0UL, allowed_ciphers_count = 0UL, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  SSLCipherSuite *all_ciphers = NULL, *allowed_ciphers = NULL;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  OSStatus err = noErr;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordtype">int</span> darwinver_maj = 0, darwinver_min = 0;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  GetDarwinVersionNumber(&amp;darwinver_maj, &amp;darwinver_min);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC */</span><span class="preprocessor"></span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordflow">if</span>(SSLCreateContext != NULL) {  <span class="comment">/* use the newer API if available */</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      CFRelease(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    BACKEND-&gt;ssl_ctx = SSLCreateContext(NULL, kSSLClientSide, kSSLStreamType);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">if</span>(!BACKEND-&gt;ssl_ctx) {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t create a context!&quot;</span>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    }</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="comment">/* The old ST API does not exist under iOS, so don&#39;t compile it: */</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx)</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      (void)SSLDisposeContext(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    err = SSLNewContext(<span class="keyword">false</span>, &amp;(BACKEND-&gt;ssl_ctx));</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t create a context: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx)</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    (void)SSLDisposeContext(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  err = SSLNewContext(<span class="keyword">false</span>, &amp;(BACKEND-&gt;ssl_ctx));</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: couldn&#39;t create a context: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  }</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  BACKEND-&gt;ssl_write_buffered_length = 0UL; <span class="comment">/* reset buffered write length */</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="comment">/* check to see if we&#39;ve been told to use an explicit SSL/TLS version */</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keywordflow">if</span>(SSLSetProtocolVersionMax != NULL) {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">switch</span>(conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#ac276158be45d7efe6872bfbfc009b417">version</a>) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      (void)SSLSetProtocolVersionMin(BACKEND-&gt;ssl_ctx, kTLSProtocol1);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#if (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp; HAVE_BUILTIN_AVAILABLE == 1</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="keywordflow">if</span>(__builtin_available(macOS 10.13, iOS 11.0, *)) {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, kTLSProtocol13);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      }</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, kTLSProtocol12);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, kTLSProtocol12);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp;</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">          HAVE_BUILTIN_AVAILABLE == 1 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      {</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = set_ssl_version_min_max(conn, sockindex);</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>)</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a>:</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      err = SSLSetProtocolVersionMin(BACKEND-&gt;ssl_ctx, kSSLProtocol3);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv3&quot;</span>);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, kSSLProtocol3);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a>:</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      err = SSLSetProtocolVersionMin(BACKEND-&gt;ssl_ctx, kSSLProtocol2);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv2&quot;</span>);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      (void)SSLSetProtocolVersionMax(BACKEND-&gt;ssl_ctx, kSSLProtocol2);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unrecognized parameter passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                                       kSSLProtocolAll,</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                                       <span class="keyword">false</span>);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">switch</span>(conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#ac276158be45d7efe6872bfbfc009b417">version</a>) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                                         kTLSProtocol1,</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                                         <span class="keyword">true</span>);</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                                         kTLSProtocol11,</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                                         <span class="keyword">true</span>);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                                         kTLSProtocol12,</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                                         <span class="keyword">true</span>);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = set_ssl_version_min_max(conn, sockindex);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>)</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      }</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a>:</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      err = SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                                         kSSLProtocol3,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                                         <span class="keyword">true</span>);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv3&quot;</span>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      }</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a>:</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      err = SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                                         kSSLProtocol2,</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                                         <span class="keyword">true</span>);</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv2&quot;</span>);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unrecognized parameter passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    }</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  }</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#aaaea4d07233992dd9e14488afa8cd390">version_max</a> != <a class="code" href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dadd0b0bf93854f50974d52f324d3259df">CURL_SSLVERSION_MAX_NONE</a>) {</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support to set maximum&quot;</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                <span class="stringliteral">&quot; SSL/TLS version&quot;</span>);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  }</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx, kSSLProtocolAll, <span class="keyword">false</span>);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">switch</span>(conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#ac276158be45d7efe6872bfbfc009b417">version</a>) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a>:</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a>:</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a>:</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    (void)SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                                       kTLSProtocol1,</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                                       <span class="keyword">true</span>);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a>:</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support TLSv1.1&quot;</span>);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a>:</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support TLSv1.2&quot;</span>);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a>:</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support TLSv1.3&quot;</span>);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a>:</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    err = SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                                       kSSLProtocol2,</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                                       <span class="keyword">true</span>);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv2&quot;</span>);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    }</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a>:</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    err = SSLSetProtocolVersionEnabled(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                                       kSSLProtocol3,</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                                       <span class="keyword">true</span>);</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Your version of the OS does not support SSLv3&quot;</span>);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unrecognized parameter passed via CURLOPT_SSLVERSION&quot;</span>);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="preprocessor">#if (CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp; HAVE_BUILTIN_AVAILABLE == 1</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">tls_enable_alpn</a>) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">if</span>(__builtin_available(macOS 10.13.4, iOS 11, *)) {</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      CFMutableArrayRef alpnArr = CFArrayCreateMutable(NULL, 0,</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                                                       &amp;kCFTypeArrayCallBacks);</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.httpversion &gt;= <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a> &amp;&amp;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;         (!<a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() || !conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">tunnel_proxy</a>)) {</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        CFArrayAppendValue(alpnArr, CFSTR(NGHTTP2_PROTO_VERSION_ID));</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, offering %s\n&quot;</span>, NGHTTP2_PROTO_VERSION_ID);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      }</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      CFArrayAppendValue(alpnArr, CFSTR(<a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>));</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, offering %s\n&quot;</span>, <a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="comment">/* expects length prefixed preference ordered list of protocols in wire</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">       * format</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      err = SSLSetALPNProtocols(BACKEND-&gt;ssl_ctx, alpnArr);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordflow">if</span>(err != noErr)</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: failed to set ALPN protocols; OSStatus %d\n&quot;</span>,</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;              err);</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      CFRelease(alpnArr);</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    }</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  }</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(<a class="code" href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a>)) {</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: SSL: CURLOPT_SSLKEY is ignored by Secure &quot;</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          <span class="stringliteral">&quot;Transport. The private key must be in the Keychain.\n&quot;</span>);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  }</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keywordflow">if</span>(ssl_cert) {</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    SecIdentityRef cert_and_key = NULL;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordtype">bool</span> is_cert_file = is_file(ssl_cert);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="comment">/* User wants to authenticate with a client cert. Look for it:</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">       If we detect that this is a file on disk, then let&#39;s load it.</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">       Otherwise, assume that the user wants to use an identity loaded</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">       from the Keychain. */</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">if</span>(is_cert_file) {</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert_type))</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: SSL: Certificate type not set, assuming &quot;</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                    <span class="stringliteral">&quot;PKCS#12 format.\n&quot;</span>);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert_type), <span class="stringliteral">&quot;P12&quot;</span>,</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        strlen(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(cert_type))) != 0)</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: SSL: The Security framework only supports &quot;</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                    <span class="stringliteral">&quot;loading identities that are in PKCS#12 format.\n&quot;</span>);</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      err = CopyIdentityFromPKCS12File(ssl_cert,</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(key_passwd), &amp;cert_and_key);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    }</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      err = CopyIdentityWithLabel(ssl_cert, &amp;cert_and_key);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordflow">if</span>(err == noErr &amp;&amp; cert_and_key) {</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      SecCertificateRef cert = NULL;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      CFTypeRef certs_c[1];</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      CFArrayRef certs;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="comment">/* If we found one, print it out: */</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      err = SecIdentityCopyCertificate(cert_and_key, &amp;cert);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keywordflow">if</span>(err == noErr) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, cert, &amp;certp);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Client certificate: %s\n&quot;</span>, certp);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        CFRelease(cert);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> == <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>)</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a>;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      }</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      certs_c[0] = cert_and_key;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      certs = CFArrayCreate(NULL, (<span class="keyword">const</span> <span class="keywordtype">void</span> **)certs_c, 1L,</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                            &amp;kCFTypeArrayCallBacks);</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      err = SSLSetCertificate(BACKEND-&gt;ssl_ctx, certs);</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordflow">if</span>(certs)</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        CFRelease(certs);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetCertificate() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a>;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      }</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      CFRelease(cert_and_key);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    }</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordflow">case</span> errSecAuthFailed: <span class="keywordflow">case</span> -25264: <span class="comment">/* errSecPkcs12VerifyFailure */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Incorrect password for the certificate \&quot;%s\&quot; &quot;</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                    <span class="stringliteral">&quot;and its private key.&quot;</span>, ssl_cert);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <span class="keywordflow">case</span> -26275: <span class="comment">/* errSecDecode */</span> <span class="keywordflow">case</span> -25257: <span class="comment">/* errSecUnknownFormat */</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Couldn&#39;t make sense of the data in the &quot;</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                    <span class="stringliteral">&quot;certificate \&quot;%s\&quot; and its private key.&quot;</span>,</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                    ssl_cert);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">case</span> -25260: <span class="comment">/* errSecPassphraseRequired */</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL The certificate \&quot;%s\&quot; requires a password.&quot;</span>,</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                    ssl_cert);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="keywordflow">case</span> errSecItemNotFound:</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Can&#39;t find the certificate \&quot;%s\&quot; and its private &quot;</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                    <span class="stringliteral">&quot;key in the Keychain.&quot;</span>, ssl_cert);</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Can&#39;t load the certificate \&quot;%s\&quot; and its private &quot;</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                    <span class="stringliteral">&quot;key: OSStatus %d&quot;</span>, ssl_cert, err);</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a>;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    }</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="comment">/* SSL always tries to verify the peer, this only says whether it should</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="comment">   * fail to connect if the verification fails, or if it should continue</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">   * anyway. In the latter case the result of the verification is checked with</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">   * SSL_get_verify_result() below. */</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_6 || CURL_BUILD_IOS</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="comment">/* Snow Leopard introduced the SSLSetSessionOption() function, but due to</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">     a library bug with the way the kSSLSessionOptionBreakOnServerAuth flag</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">     works, it doesn&#39;t work as expected under Snow Leopard, Lion or</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">     Mountain Lion.</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">     So we need to call SSLSetEnableCertVerify() on those older cats in order</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">     to disable certificate validation if the user turned that off.</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">     (SecureTransport will always validate the certificate chain by</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">     default.)</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">  Note:</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">  Darwin 11.x.x is Lion (10.7)</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">  Darwin 12.x.x is Mountain Lion (10.8)</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">  Darwin 13.x.x is Mavericks (10.9)</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">  Darwin 14.x.x is Yosemite (10.10)</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">  Darwin 15.x.x is El Capitan (10.11)</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">if</span>(SSLSetSessionOption != NULL &amp;&amp; darwinver_maj &gt;= 13) {</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordflow">if</span>(SSLSetSessionOption != NULL) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC */</span><span class="preprocessor"></span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordtype">bool</span> break_on_auth = !conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#a7b1be18084f5fa42645c28a34b75d166">verifypeer</a> || ssl_cafile;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    err = SSLSetSessionOption(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                              kSSLSessionOptionBreakOnServerAuth,</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                              break_on_auth);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetSessionOption() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    }</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  }</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    err = SSLSetEnableCertVerify(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                                 conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#a7b1be18084f5fa42645c28a34b75d166">verifypeer</a>?<span class="keyword">true</span>:<span class="keyword">false</span>);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetEnableCertVerify() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    }</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  }</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  err = SSLSetEnableCertVerify(BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                               conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#a7b1be18084f5fa42645c28a34b75d166">verifypeer</a>?<span class="keyword">true</span>:<span class="keyword">false</span>);</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetEnableCertVerify() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  }</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_6 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordflow">if</span>(ssl_cafile &amp;&amp; verifypeer) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordtype">bool</span> is_cert_file = is_file(ssl_cafile);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordflow">if</span>(!is_cert_file) {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: can&#39;t load CA certificate file %s&quot;</span>, ssl_cafile);</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  }</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="comment">/* Configure hostname check. SNI is used if available.</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">   * Both hostname check and SNI require SSLSetPeerDomainName().</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">   * Also: the verifyhost setting influences SNI usage */</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">ssl_config</a>.<a class="code" href="structssl__primary__config.html#af116cf82e957a2ca2f0b39eb0c709d43">verifyhost</a>) {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    err = SSLSetPeerDomainName(BACKEND-&gt;ssl_ctx, <a class="code" href="structhostname.html">hostname</a>,</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    strlen(<a class="code" href="structhostname.html">hostname</a>));</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: SSL: SSLSetPeerDomainName() failed: OSStatus %d\n&quot;</span>,</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            err);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET, <a class="code" href="structhostname.html">hostname</a>, &amp;addr))</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  #ifdef <a class="code" href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    || (<a class="code" href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a>(AF_INET6, <a class="code" href="structhostname.html">hostname</a>, &amp;addr))</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  #endif</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;       ) {</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: using IP address, SNI is being disabled by &quot;</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            <span class="stringliteral">&quot;the OS.\n&quot;</span>);</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    }</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  }</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;WARNING: disabling hostname validation also disables SNI.\n&quot;</span>);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  }</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="comment">/* Disable cipher suites that ST supports but are not safe. These ciphers</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">     are unlikely to be used in any case since ST gives other ciphers a much</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">     higher priority, but it&#39;s probably better that we not connect at all than</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">     to give the user a false sense of security if the server only supports</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">     insecure ciphers. (Note: We don&#39;t care about SSLv2-only ciphers.) */</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  err = SSLGetNumberSupportedCiphers(BACKEND-&gt;ssl_ctx, &amp;all_ciphers_count);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLGetNumberSupportedCiphers() failed: OSStatus %d&quot;</span>,</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          err);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  }</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  all_ciphers = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(all_ciphers_count*<span class="keyword">sizeof</span>(SSLCipherSuite));</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keywordflow">if</span>(!all_ciphers) {</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Failed to allocate memory for all ciphers&quot;</span>);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  }</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  allowed_ciphers = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(all_ciphers_count*<span class="keyword">sizeof</span>(SSLCipherSuite));</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="keywordflow">if</span>(!allowed_ciphers) {</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(all_ciphers);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: Failed to allocate memory for allowed ciphers&quot;</span>);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  }</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  err = SSLGetSupportedCiphers(BACKEND-&gt;ssl_ctx, all_ciphers,</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                               &amp;all_ciphers_count);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(all_ciphers);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(allowed_ciphers);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0UL ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; all_ciphers_count ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   <span class="comment">/* There&#39;s a known bug in early versions of Mountain Lion where ST&#39;s ECC</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">      ciphers (cipher suite 0xC001 through 0xC032) simply do not work.</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">      Work around the problem here by disabling those ciphers if we are</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">      running in an affected version of OS X. */</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">if</span>(darwinver_maj == 12 &amp;&amp; darwinver_min &lt;= 3 &amp;&amp;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;       all_ciphers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &gt;= 0xC001 &amp;&amp; all_ciphers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] &lt;= 0xC032) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC */</span><span class="preprocessor"></span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordflow">switch</span>(all_ciphers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]) {</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      <span class="comment">/* Disable NULL ciphersuites: */</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">case</span> SSL_NULL_WITH_NULL_NULL:</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_MD5:</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_NULL_SHA:</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <span class="keywordflow">case</span> 0x003B: <span class="comment">/* TLS_RSA_WITH_NULL_SHA256 */</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      <span class="keywordflow">case</span> SSL_FORTEZZA_DMS_WITH_NULL_SHA:</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      <span class="keywordflow">case</span> 0xC001: <span class="comment">/* TLS_ECDH_ECDSA_WITH_NULL_SHA */</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      <span class="keywordflow">case</span> 0xC006: <span class="comment">/* TLS_ECDHE_ECDSA_WITH_NULL_SHA */</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keywordflow">case</span> 0xC00B: <span class="comment">/* TLS_ECDH_RSA_WITH_NULL_SHA */</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="keywordflow">case</span> 0xC010: <span class="comment">/* TLS_ECDHE_RSA_WITH_NULL_SHA */</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keywordflow">case</span> 0x002C: <span class="comment">/* TLS_PSK_WITH_NULL_SHA */</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keywordflow">case</span> 0x002D: <span class="comment">/* TLS_DHE_PSK_WITH_NULL_SHA */</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordflow">case</span> 0x002E: <span class="comment">/* TLS_RSA_PSK_WITH_NULL_SHA */</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      <span class="keywordflow">case</span> 0x00B0: <span class="comment">/* TLS_PSK_WITH_NULL_SHA256 */</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">case</span> 0x00B1: <span class="comment">/* TLS_PSK_WITH_NULL_SHA384 */</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      <span class="keywordflow">case</span> 0x00B4: <span class="comment">/* TLS_DHE_PSK_WITH_NULL_SHA256 */</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">case</span> 0x00B5: <span class="comment">/* TLS_DHE_PSK_WITH_NULL_SHA384 */</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="keywordflow">case</span> 0x00B8: <span class="comment">/* TLS_RSA_PSK_WITH_NULL_SHA256 */</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="keywordflow">case</span> 0x00B9: <span class="comment">/* TLS_RSA_PSK_WITH_NULL_SHA384 */</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="comment">/* Disable anonymous ciphersuites: */</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <span class="keywordflow">case</span> SSL_DH_anon_EXPORT_WITH_RC4_40_MD5:</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">case</span> SSL_DH_anon_WITH_RC4_128_MD5:</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      <span class="keywordflow">case</span> SSL_DH_anon_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <span class="keywordflow">case</span> SSL_DH_anon_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">case</span> SSL_DH_anon_WITH_3DES_EDE_CBC_SHA:</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_128_CBC_SHA:</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="keywordflow">case</span> TLS_DH_anon_WITH_AES_256_CBC_SHA:</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="keywordflow">case</span> 0xC015: <span class="comment">/* TLS_ECDH_anon_WITH_NULL_SHA */</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordflow">case</span> 0xC016: <span class="comment">/* TLS_ECDH_anon_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">case</span> 0xC017: <span class="comment">/* TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA */</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">case</span> 0xC018: <span class="comment">/* TLS_ECDH_anon_WITH_AES_128_CBC_SHA */</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="keywordflow">case</span> 0xC019: <span class="comment">/* TLS_ECDH_anon_WITH_AES_256_CBC_SHA */</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">case</span> 0x006C: <span class="comment">/* TLS_DH_anon_WITH_AES_128_CBC_SHA256 */</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordflow">case</span> 0x006D: <span class="comment">/* TLS_DH_anon_WITH_AES_256_CBC_SHA256 */</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="keywordflow">case</span> 0x00A6: <span class="comment">/* TLS_DH_anon_WITH_AES_128_GCM_SHA256 */</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keywordflow">case</span> 0x00A7: <span class="comment">/* TLS_DH_anon_WITH_AES_256_GCM_SHA384 */</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="comment">/* Disable weak key ciphersuites: */</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_RC4_40_MD5:</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5:</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <span class="keywordflow">case</span> SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="keywordflow">case</span> SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">case</span> SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="keywordflow">case</span> SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA:</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      <span class="keywordflow">case</span> SSL_DH_DSS_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordflow">case</span> SSL_DH_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      <span class="keywordflow">case</span> SSL_DHE_DSS_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">case</span> SSL_DHE_RSA_WITH_DES_CBC_SHA:</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="comment">/* Disable IDEA: */</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_IDEA_CBC_SHA:</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_IDEA_CBC_MD5:</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="comment">/* Disable RC4: */</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_MD5:</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keywordflow">case</span> SSL_RSA_WITH_RC4_128_SHA:</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keywordflow">case</span> 0xC002: <span class="comment">/* TLS_ECDH_ECDSA_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="keywordflow">case</span> 0xC007: <span class="comment">/* TLS_ECDHE_ECDSA_WITH_RC4_128_SHA*/</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">case</span> 0xC00C: <span class="comment">/* TLS_ECDH_RSA_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <span class="keywordflow">case</span> 0xC011: <span class="comment">/* TLS_ECDHE_RSA_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordflow">case</span> 0x008A: <span class="comment">/* TLS_PSK_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      <span class="keywordflow">case</span> 0x008E: <span class="comment">/* TLS_DHE_PSK_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">case</span> 0x0092: <span class="comment">/* TLS_RSA_PSK_WITH_RC4_128_SHA */</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="keywordflow">default</span>: <span class="comment">/* enable everything else */</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        allowed_ciphers[allowed_ciphers_count++] = all_ciphers[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    }</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  }</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  err = SSLSetEnabledCiphers(BACKEND-&gt;ssl_ctx, allowed_ciphers,</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                             allowed_ciphers_count);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(all_ciphers);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(allowed_ciphers);</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetEnabledCiphers() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  }</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_9 || CURL_BUILD_IOS_7</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">/* We want to enable 1/n-1 when using a CBC cipher unless the user</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">     specifically doesn&#39;t want us doing that: */</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span>(SSLSetSessionOption != NULL) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="comment">/* TODO s/data-&gt;set.ssl.enable_beast/SSL_SET_OPTION(enable_beast)/g */</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    SSLSetSessionOption(BACKEND-&gt;ssl_ctx, kSSLSessionOptionSendOneByteRecord,</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                      !<a class="code" href="structdata.html">data</a>-&gt;set.ssl.enable_beast);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    SSLSetSessionOption(BACKEND-&gt;ssl_ctx, kSSLSessionOptionFalseStart,</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                      <a class="code" href="structdata.html">data</a>-&gt;set.ssl.falsestart); <span class="comment">/* false start support */</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  }</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_9 || CURL_BUILD_IOS_7 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <span class="comment">/* Check if there&#39;s a cached ID we can/should use here! */</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a>(primary.sessionid)) {</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    <span class="keywordtype">char</span> *ssl_sessionid;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordtype">size_t</span> ssl_sessionid_len;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    Curl_ssl_sessionid_lock(conn);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">if</span>(!Curl_ssl_getsessionid(conn, (<span class="keywordtype">void</span> **)&amp;ssl_sessionid,</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                              &amp;ssl_sessionid_len, sockindex)) {</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="comment">/* we got a session id, use it! */</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      err = SSLSetPeerID(BACKEND-&gt;ssl_ctx, ssl_sessionid, ssl_sessionid_len);</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetPeerID() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      }</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="comment">/* Informational message */</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL re-using session ID\n&quot;</span>);</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    }</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="comment">/* If there isn&#39;t one, then let&#39;s make one up! This has to be done prior</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment">       to starting the handshake. */</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      ssl_sessionid =</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <a class="code" href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a>(<span class="stringliteral">&quot;%s:%d:%d:%s:%hu&quot;</span>, ssl_cafile,</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                verifypeer, <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifyhost), <a class="code" href="structhostname.html">hostname</a>, port);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      ssl_sessionid_len = strlen(ssl_sessionid);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      err = SSLSetPeerID(BACKEND-&gt;ssl_ctx, ssl_sessionid, ssl_sessionid_len);</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetPeerID() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      }</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_ssl_addsessionid(conn, ssl_sessionid, ssl_sessionid_len,</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                                     sockindex);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      Curl_ssl_sessionid_unlock(conn);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;failed to store ssl session&quot;</span>);</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  err = SSLSetIOFuncs(BACKEND-&gt;ssl_ctx, SocketRead, SocketWrite);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetIOFuncs() failed: OSStatus %d&quot;</span>, err);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  }</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="comment">/* pass the raw socket into the SSL layers */</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="comment">/* We need to store the FD in a constant memory address, because</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">   * SSLSetConnection() will not copy that address. I&#39;ve found that</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">   * conn-&gt;sock[sockindex] may change on its own. */</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  BACKEND-&gt;ssl_sockfd = sockfd;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  err = SSLSetConnection(BACKEND-&gt;ssl_ctx, connssl);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: SSLSetConnection() failed: %d&quot;</span>, err);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  }</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;}</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keyword">static</span> <span class="keywordtype">long</span> pem_to_der(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **out, <span class="keywordtype">size_t</span> *outlen)</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;{</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keywordtype">char</span> *sep_start, *sep_end, *cert_start, *cert_end;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>, err;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *b64;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="comment">/* Jump through the separators at the beginning of the certificate. */</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  sep_start = strstr(<a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>, <span class="stringliteral">&quot;-----&quot;</span>);</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keywordflow">if</span>(sep_start == NULL)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  cert_start = strstr(sep_start + 1, <span class="stringliteral">&quot;-----&quot;</span>);</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <span class="keywordflow">if</span>(cert_start == NULL)</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  cert_start += 5;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <span class="comment">/* Find separator after the end of the certificate. */</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  cert_end = strstr(cert_start, <span class="stringliteral">&quot;-----&quot;</span>);</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keywordflow">if</span>(cert_end == NULL)</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  sep_end = strstr(cert_end + 1, <span class="stringliteral">&quot;-----&quot;</span>);</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  <span class="keywordflow">if</span>(sep_end == NULL)</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  sep_end += 5;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = cert_end - cert_start;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  b64 = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> + 1);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="keywordflow">if</span>(!b64)</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <span class="comment">/* Create base64 string without linefeeds. */</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0, <a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">if</span>(cert_start[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; cert_start[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] != <span class="charliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      b64[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>++] = cert_start[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  }</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  b64[<a class="code" href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  err = <a class="code" href="base64_8c.html#a3b1d7d4873cc224ffb2ce6ff201bc2e6">Curl_base64_decode</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)b64, out, outlen);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(b64);</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <span class="keywordflow">if</span>(err) {</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(*out);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  }</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <span class="keywordflow">return</span> sep_end - <a class="code" href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a>;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;}</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> read_cert(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **out, <span class="keywordtype">size_t</span> *outlen)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;{</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> = 0, cap = 512;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[512], *<a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  fd = open(<a class="code" href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a>, 0);</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keywordflow">if</span>(fd &lt; 0)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <a class="code" href="structdata.html">data</a> = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(cap);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    close(fd);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  }</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = read(fd, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>));</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &lt; 0) {</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      close(fd);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(<a class="code" href="structdata.html">data</a>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    }</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> == 0) {</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      close(fd);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    }</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> + <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> &gt;= cap) {</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      cap *= 2;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <a class="code" href="structdata.html">data</a> = <a class="code" href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a>(<a class="code" href="structdata.html">data</a>, cap);</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="structdata.html">data</a>) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        close(fd);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      }</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(<a class="code" href="structdata.html">data</a> + <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>);</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a> += <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  }</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <a class="code" href="structdata.html">data</a>[<a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  *out = <a class="code" href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a>;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  *outlen = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;}</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> append_cert_to_array(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keywordtype">size_t</span> buflen,</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                                CFMutableArrayRef array)</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;{</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    CFDataRef certdata = CFDataCreate(kCFAllocatorDefault, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, buflen);</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">if</span>(!certdata) {</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: failed to allocate array for CA certificate&quot;</span>);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    }</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    SecCertificateRef cacert =</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      SecCertificateCreateWithData(kCFAllocatorDefault, certdata);</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    CFRelease(certdata);</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="keywordflow">if</span>(!cacert) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: failed to create SecCertificate from CA certificate&quot;</span>);</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    }</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="comment">/* Check if cacert is valid. */</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, cacert, &amp;certp);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>:</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>:</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>:</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    }</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    CFArrayAppendValue(array, cacert);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    CFRelease(cacert);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;}</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> verify_cert(<span class="keyword">const</span> <span class="keywordtype">char</span> *cafile, <span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                       SSLContextRef ctx)</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;{</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a> = 0, <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="keywordtype">long</span> res;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *certbuf, *der;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <span class="keywordtype">size_t</span> buflen, derlen, offset = 0;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keywordflow">if</span>(read_cert(cafile, &amp;certbuf, &amp;buflen) &lt; 0) {</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: failed to read or invalid CA certificate&quot;</span>);</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  }</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">   * Certbuf now contains the contents of the certificate file, which can be</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">   * - a single DER certificate,</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">   * - a single PEM certificate or</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">   * - a bunch of PEM certificates (certificate bundle).</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">   *</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment">   * Go through certbuf, and convert any PEM certificate in it into DER</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">   * format.</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  CFMutableArrayRef array = CFArrayCreateMutable(kCFAllocatorDefault, 0,</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                                                 &amp;kCFTypeArrayCallBacks);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="keywordflow">if</span>(array == NULL) {</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certbuf);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: out of memory creating CA certificate array&quot;</span>);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a>;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;  <span class="keywordflow">while</span>(offset &lt; buflen) {</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>++;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment">     * Check if the certificate is in PEM format, and convert it to DER. If</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment">     * this fails, we assume the certificate is in DER format.</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    res = pem_to_der((<span class="keyword">const</span> <span class="keywordtype">char</span> *)certbuf + offset, &amp;der, &amp;derlen);</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <span class="keywordflow">if</span>(res &lt; 0) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certbuf);</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      CFRelease(array);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: invalid CA certificate #%d (offset %d) in bundle&quot;</span>,</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            <a class="code" href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a>, offset);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a>;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    }</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    offset += res;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordflow">if</span>(res == 0 &amp;&amp; offset == 0) {</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="comment">/* This is not a PEM file, probably a certificate in DER format. */</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = append_cert_to_array(<a class="code" href="structdata.html">data</a>, certbuf, buflen, array);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certbuf);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        CFRelease(array);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      }</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 0) {</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <span class="comment">/* No more certificates in the bundle. */</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certbuf);</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    }</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = append_cert_to_array(<a class="code" href="structdata.html">data</a>, der, derlen, array);</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(der);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>) {</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certbuf);</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      CFRelease(array);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    }</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  }</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  SecTrustRef trust;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  OSStatus ret = SSLCopyPeerTrust(ctx, &amp;trust);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordflow">if</span>(trust == NULL) {</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: error getting certificate chain&quot;</span>);</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    CFRelease(array);</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  }</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret != noErr) {</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    CFRelease(array);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSLCopyPeerTrust() returned error %d&quot;</span>, ret);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  }</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  ret = SecTrustSetAnchorCertificates(trust, array);</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <span class="keywordflow">if</span>(ret != noErr) {</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    CFRelease(array);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    CFRelease(trust);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SecTrustSetAnchorCertificates() returned error %d&quot;</span>, ret);</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  ret = SecTrustSetAnchorCertificatesOnly(trust, <span class="keyword">true</span>);</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="keywordflow">if</span>(ret != noErr) {</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    CFRelease(array);</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    CFRelease(trust);</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SecTrustSetAnchorCertificatesOnly() returned error %d&quot;</span>, ret);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  }</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;  SecTrustResultType trust_eval = 0;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;  ret = SecTrustEvaluate(trust, &amp;trust_eval);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  CFRelease(array);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;  CFRelease(trust);</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="keywordflow">if</span>(ret != noErr) {</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SecTrustEvaluate() returned error %d&quot;</span>, ret);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="keywordflow">switch</span>(trust_eval) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">case</span> kSecTrustResultUnspecified:</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="keywordflow">case</span> kSecTrustResultProceed:</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordflow">case</span> kSecTrustResultRecoverableTrustFailure:</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordflow">case</span> kSecTrustResultDeny:</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: certificate verification failed (result: %d)&quot;</span>,</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;            trust_eval);</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  }</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;}</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> pkp_pin_peer_pubkey(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                                    SSLContextRef ctx,</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *pinnedpubkey)</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;{  <span class="comment">/* Scratch */</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="keywordtype">size_t</span> pubkeylen, realpubkeylen, spkiHeaderLength = 24;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pubkey = NULL, *realpubkey = NULL;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *spkiHeader = NULL;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  CFDataRef publicKeyBits = NULL;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <span class="comment">/* Result is returned to caller */</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f">CURLE_SSL_PINNEDPUBKEYNOTMATCH</a>;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="comment">/* if a path wasn&#39;t specified, don&#39;t pin */</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">if</span>(!pinnedpubkey)</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="keywordflow">if</span>(!ctx)</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    SecTrustRef trust;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    OSStatus ret = SSLCopyPeerTrust(ctx, &amp;trust);</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">if</span>(ret != noErr || trust == NULL)</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    SecKeyRef keyRef = SecTrustCopyPublicKey(trust);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    CFRelease(trust);</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">if</span>(keyRef == NULL)</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY_V1</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    publicKeyBits = SecKeyCopyExternalRepresentation(keyRef, NULL);</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    CFRelease(keyRef);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordflow">if</span>(publicKeyBits == NULL)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="preprocessor">#elif DARWIN_SSL_PINNEDPUBKEY_V2</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    OSStatus success = SecItemExport(keyRef, kSecFormatOpenSSL, 0, NULL,</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                                     &amp;publicKeyBits);</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    CFRelease(keyRef);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordflow">if</span>(success != errSecSuccess || publicKeyBits == NULL)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY_V2 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    pubkeylen = CFDataGetLength(publicKeyBits);</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    pubkey = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)CFDataGetBytePtr(publicKeyBits);</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordflow">switch</span>(pubkeylen) {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <span class="keywordflow">case</span> 526:</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="comment">/* 4096 bit RSA pubkeylen == 526 */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        spkiHeader = rsa4096SpkiHeader;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      <span class="keywordflow">case</span> 270:</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        <span class="comment">/* 2048 bit RSA pubkeylen == 270 */</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        spkiHeader = rsa2048SpkiHeader;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY_V1</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <span class="keywordflow">case</span> 65:</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="comment">/* ecDSA secp256r1 pubkeylen == 65 */</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        spkiHeader = ecDsaSecp256r1SpkiHeader;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        spkiHeaderLength = 26;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keywordflow">case</span> 97:</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <span class="comment">/* ecDSA secp384r1 pubkeylen == 97 */</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        spkiHeader = ecDsaSecp384r1SpkiHeader;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        spkiHeaderLength = 23;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: unhandled public key length: %d\n&quot;</span>, pubkeylen);</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="preprocessor">#elif DARWIN_SSL_PINNEDPUBKEY_V2</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <span class="comment">/* ecDSA secp256r1 pubkeylen == 91 header already included?</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment">         * ecDSA secp384r1 header already included too</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment">         * we assume rest of algorithms do same, so do nothing</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_pin_peer_pubkey(<a class="code" href="structdata.html">data</a>, pinnedpubkey, pubkey,</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                                    pubkeylen);</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY_V2 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">/* break from loop */</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    }</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    realpubkeylen = pubkeylen + spkiHeaderLength;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    realpubkey = <a class="code" href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(realpubkeylen);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    <span class="keywordflow">if</span>(!realpubkey)</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(realpubkey, spkiHeader, spkiHeaderLength);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <a class="code" href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a>(realpubkey + spkiHeaderLength, pubkey, pubkeylen);</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = Curl_pin_peer_pubkey(<a class="code" href="structdata.html">data</a>, pinnedpubkey, realpubkey,</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                                  realpubkeylen);</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  } <span class="keywordflow">while</span>(0);</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(realpubkey);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  <span class="keywordflow">if</span>(publicKeyBits != NULL)</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    CFRelease(publicKeyBits);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;}</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY */</span><span class="preprocessor"></span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;darwinssl_connect_step2(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;{</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  OSStatus err;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  SSLCipherSuite cipher;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  SSLProtocol <a class="code" href="url_8d.html#a1e5cd9496724b33dd938aa59064c8c99">protocol</a> = 0;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="structhostname.html">hostname</a> = <a class="code" href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a>() ? conn-&gt;<a class="code" href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">http_proxy</a>.<a class="code" href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a> :</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">name</a>;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;              || <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;              || <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="comment">/* Here goes nothing: */</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  err = SSLHandshake(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      <span class="keywordflow">case</span> errSSLWouldBlock:  <span class="comment">/* they&#39;re not done with us yet */</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = BACKEND-&gt;ssl_direction ?</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;            <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> : <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a>;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="comment">/* The below is errSSLServerAuthCompleted; it&#39;s not defined in</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">        Leopard&#39;s headers */</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="keywordflow">case</span> -9841:</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(CAfile) &amp;&amp; <a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(verifypeer)) {</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;          <span class="keywordtype">int</span> res = verify_cert(<a class="code" href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a>(CAfile), <a class="code" href="structdata.html">data</a>,</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                                BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;          <span class="keywordflow">if</span>(res != <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>)</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        }</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;        <span class="comment">/* the documentation says we need to call SSLHandshake() again */</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        <span class="keywordflow">return</span> darwinssl_connect_step2(conn, sockindex);</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;      <span class="comment">/* Problem with encrypt / decrypt */</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <span class="keywordflow">case</span> errSSLPeerDecodeError:</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Decode failed&quot;</span>);</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      <span class="keywordflow">case</span> errSSLDecryptionFail:</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordflow">case</span> errSSLPeerDecryptionFail:</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Decryption failed&quot;</span>);</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="keywordflow">case</span> errSSLPeerDecryptError:</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A decryption error occurred&quot;</span>);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <span class="keywordflow">case</span> errSSLBadCipherSuite:</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A bad SSL cipher suite was encountered&quot;</span>);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordflow">case</span> errSSLCrypto:</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;An underlying cryptographic error was encountered&quot;</span>);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_11 || CURL_BUILD_IOS_9</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keywordflow">case</span> errSSLWeakPeerEphemeralDHKey:</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Indicates a weak ephemeral Diffie-Hellman key&quot;</span>);</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="comment">/* Problem with the message record validation */</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordflow">case</span> errSSLBadRecordMac:</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordflow">case</span> errSSLPeerBadRecordMac:</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A record with a bad message authentication code (MAC) &quot;</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                    <span class="stringliteral">&quot;was encountered&quot;</span>);</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <span class="keywordflow">case</span> errSSLRecordOverflow:</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="keywordflow">case</span> errSSLPeerRecordOverflow:</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A record overflow occurred&quot;</span>);</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="comment">/* Problem with zlib decompression */</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <span class="keywordflow">case</span> errSSLPeerDecompressFail:</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Decompression failed&quot;</span>);</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <span class="comment">/* Problem with access */</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="keywordflow">case</span> errSSLPeerAccessDenied:</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Access was denied&quot;</span>);</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">case</span> errSSLPeerInsufficientSecurity:</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;There is insufficient security for this operation&quot;</span>);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      <span class="comment">/* These are all certificate problems with the server: */</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordflow">case</span> errSSLXCertChainInvalid:</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: Invalid certificate chain&quot;</span>);</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordflow">case</span> errSSLUnknownRootCert:</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: Untrusted root certificate&quot;</span>);</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="keywordflow">case</span> errSSLNoRootCert:</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: No root certificate&quot;</span>);</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      <span class="keywordflow">case</span> errSSLCertNotYetValid:</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: The certificate chain had a &quot;</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                    <span class="stringliteral">&quot;certificate that is not yet valid&quot;</span>);</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="keywordflow">case</span> errSSLCertExpired:</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordflow">case</span> errSSLPeerCertExpired:</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: Certificate chain had an &quot;</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;              <span class="stringliteral">&quot;expired certificate&quot;</span>);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keywordflow">case</span> errSSLBadCert:</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="keywordflow">case</span> errSSLPeerBadCert:</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: Couldn&#39;t understand the server &quot;</span></div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;              <span class="stringliteral">&quot;certificate format&quot;</span>);</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <span class="keywordflow">case</span> errSSLPeerUnsupportedCert:</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: An unsupported certificate &quot;</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                    <span class="stringliteral">&quot;format was encountered&quot;</span>);</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="keywordflow">case</span> errSSLPeerCertRevoked:</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: The certificate was revoked&quot;</span>);</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <span class="keywordflow">case</span> errSSLPeerCertUnknown:</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate problem: The certificate is unknown&quot;</span>);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="comment">/* These are all certificate problems with the client: */</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      <span class="keywordflow">case</span> errSecAuthFailed:</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL authentication failed&quot;</span>);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="keywordflow">case</span> errSSLPeerHandshakeFail:</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL peer handshake failed, the server most likely &quot;</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;              <span class="stringliteral">&quot;requires a client certificate to connect&quot;</span>);</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      <span class="keywordflow">case</span> errSSLPeerUnknownCA:</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL server rejected the client certificate due to &quot;</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;              <span class="stringliteral">&quot;the certificate being signed by an unknown certificate &quot;</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;              <span class="stringliteral">&quot;authority&quot;</span>);</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <span class="comment">/* This error is raised if the server&#39;s cert didn&#39;t match the server&#39;s</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="comment">         host name: */</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="keywordflow">case</span> errSSLHostNameMismatch:</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL certificate peer verification failed, the &quot;</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;              <span class="stringliteral">&quot;certificate did not match \&quot;%s\&quot;\n&quot;</span>, conn-&gt;<a class="code" href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">host</a>.<a class="code" href="structhostname.html#aee7d0ff8210c25b87d6fdeacf8ea7939">dispname</a>);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a>;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <span class="comment">/* Problem with SSL / TLS negotiation */</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="keywordflow">case</span> errSSLNegotiation:</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Could not negotiate an SSL cipher suite with the server&quot;</span>);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <span class="keywordflow">case</span> errSSLBadConfiguration:</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A configuration error occurred&quot;</span>);</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="keywordflow">case</span> errSSLProtocol:</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL protocol error&quot;</span>);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      <span class="keywordflow">case</span> errSSLPeerProtocolVersion:</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A bad protocol version was encountered&quot;</span>);</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <span class="keywordflow">case</span> errSSLPeerNoRenegotiation:</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;No renegotiation is allowed&quot;</span>);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;      <span class="comment">/* Generic handshake errors: */</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      <span class="keywordflow">case</span> errSSLConnectionRefused:</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server dropped the connection during the SSL handshake&quot;</span>);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <span class="keywordflow">case</span> errSSLClosedAbort:</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server aborted the SSL handshake&quot;</span>);</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      <span class="keywordflow">case</span> errSSLClosedGraceful:</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The connection closed gracefully&quot;</span>);</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      <span class="keywordflow">case</span> errSSLClosedNoNotify:</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The server closed the session with no notification&quot;</span>);</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      <span class="comment">/* Sometimes paramErr happens with buggy ciphers: */</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      <span class="keywordflow">case</span> paramErr:</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="keywordflow">case</span> errSSLInternal:</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      <span class="keywordflow">case</span> errSSLPeerInternalError:</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Internal SSL engine error encountered during the &quot;</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;              <span class="stringliteral">&quot;SSL handshake&quot;</span>);</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <span class="keywordflow">case</span> errSSLFatalAlert:</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Fatal SSL engine error encountered during the SSL &quot;</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;              <span class="stringliteral">&quot;handshake&quot;</span>);</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="comment">/* Unclassified error */</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <span class="keywordflow">case</span> errSSLBufferOverflow:</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;An insufficient buffer was provided&quot;</span>);</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      <span class="keywordflow">case</span> errSSLIllegalParam:</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;An illegal parameter was encountered&quot;</span>);</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;      <span class="keywordflow">case</span> errSSLModuleAttach:</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Module attach failure&quot;</span>);</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <span class="keywordflow">case</span> errSSLSessionNotFound:</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;An attempt to restore an unknown session failed&quot;</span>);</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keywordflow">case</span> errSSLPeerExportRestriction:</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;An export restriction occurred&quot;</span>);</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="keywordflow">case</span> errSSLPeerUserCancelled:</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The user canceled the operation&quot;</span>);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="keywordflow">case</span> errSSLPeerUnexpectedMsg:</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Peer rejected unexpected message&quot;</span>);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_11 || CURL_BUILD_IOS_9</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <span class="comment">/* Treaing non-fatal error as fatal like before */</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <span class="keywordflow">case</span> errSSLClientHelloReceived:</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;A non-fatal result for providing a server name &quot;</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                    <span class="stringliteral">&quot;indication&quot;</span>);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <span class="comment">/* Error codes defined in the enum but should never be returned.</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="comment">         We list them here just in case. */</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_6</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="comment">/* Only returned when kSSLSessionOptionBreakOnCertRequested is set */</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      <span class="keywordflow">case</span> errSSLClientCertRequested:</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;The server has requested a client certificate&quot;</span>);</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_9</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      <span class="comment">/* Alias for errSSLLast, end of error range */</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      <span class="keywordflow">case</span> errSSLUnexpectedRecord:</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unexpected (skipped) record in DTLS&quot;</span>);</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="comment">/* May also return codes listed in Security Framework Result Codes */</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unknown SSL protocol error in connection to %s:%d&quot;</span>,</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;              <a class="code" href="structhostname.html">hostname</a>, err);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    }</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="comment">/* we have been connected fine, we&#39;re not waiting for anything else. */</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a>;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f">STRING_SSL_PINNEDPUBLICKEY_ORIG</a>]) {</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = pkp_pin_peer_pubkey(<a class="code" href="structdata.html">data</a>, BACKEND-&gt;ssl_ctx,</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                            <a class="code" href="structdata.html">data</a>-&gt;set.str[<a class="code" href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f">STRING_SSL_PINNEDPUBLICKEY_ORIG</a>]);</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL: public key does not match pinned public key!&quot;</span>);</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      }</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    }</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY */</span><span class="preprocessor"></span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <span class="comment">/* Informational message */</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    (void)SSLGetNegotiatedCipher(BACKEND-&gt;ssl_ctx, &amp;cipher);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    (void)SSLGetNegotiatedProtocolVersion(BACKEND-&gt;ssl_ctx, &amp;<a class="code" href="url_8d.html#a1e5cd9496724b33dd938aa59064c8c99">protocol</a>);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="url_8d.html#a1e5cd9496724b33dd938aa59064c8c99">protocol</a>) {</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      <span class="keywordflow">case</span> kSSLProtocol2:</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL 2.0 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;              SSLCipherNameForNumber(cipher));</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      <span class="keywordflow">case</span> kSSLProtocol3:</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL 3.0 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;              SSLCipherNameForNumber(cipher));</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <span class="keywordflow">case</span> kTLSProtocol1:</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;TLS 1.0 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;              TLSCipherNameForNumber(cipher));</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;      <span class="keywordflow">case</span> kTLSProtocol11:</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;TLS 1.1 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;              TLSCipherNameForNumber(cipher));</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      <span class="keywordflow">case</span> kTLSProtocol12:</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;TLS 1.2 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;              TLSCipherNameForNumber(cipher));</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">case</span> kTLSProtocol13:</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;TLS 1.3 connection using %s\n&quot;</span>,</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;              TLSCipherNameForNumber(cipher));</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Unknown protocol connection\n&quot;</span>);</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    }</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="preprocessor">#if(CURL_BUILD_MAC_10_13 || CURL_BUILD_IOS_11) &amp;&amp; HAVE_BUILTIN_AVAILABLE == 1</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <span class="keywordflow">if</span>(conn-&gt;<a class="code" href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">bits</a>.<a class="code" href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">tls_enable_alpn</a>) {</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">if</span>(__builtin_available(macOS 10.13.4, iOS 11, *)) {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        CFArrayRef alpnArr = NULL;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        CFStringRef chosenProtocol = NULL;</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        err = SSLCopyALPNProtocols(BACKEND-&gt;ssl_ctx, &amp;alpnArr);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <span class="keywordflow">if</span>(err == noErr &amp;&amp; alpnArr &amp;&amp; CFArrayGetCount(alpnArr) &gt;= 1)</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;          chosenProtocol = CFArrayGetValueAtIndex(alpnArr, 0);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="preprocessor">#ifdef USE_NGHTTP2</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <span class="keywordflow">if</span>(chosenProtocol &amp;&amp;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;           !CFStringCompare(chosenProtocol, CFSTR(NGHTTP2_PROTO_VERSION_ID),</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                            0)) {</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;          conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a>;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        }</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <span class="keywordflow">if</span>(chosenProtocol &amp;&amp;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;           !CFStringCompare(chosenProtocol, CFSTR(<a class="code" href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a>), 0)) {</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;          conn-&gt;<a class="code" href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">negnpn</a> = <a class="code" href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a>;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;        }</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;ALPN, server did not agree to a protocol\n&quot;</span>);</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <span class="comment">/* chosenProtocol is a reference to the string within alpnArr</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="comment">           and doesn&#39;t need to be freed separately */</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <span class="keywordflow">if</span>(alpnArr)</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;          CFRelease(alpnArr);</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      }</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    }</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  }</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;}</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="comment">/* This should be called during step3 of the connection at the earliest */</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;show_verbose_server_cert(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                         <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;{</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  CFArrayRef server_certs = NULL;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;  SecCertificateRef server_cert;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;  OSStatus err;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  CFIndex <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, count;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  SecTrustRef trust = NULL;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="keywordflow">if</span>(!BACKEND-&gt;ssl_ctx)</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="preprocessor">#if CURL_BUILD_IOS</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="preprocessor">#pragma unused(server_certs)</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  err = SSLCopyPeerTrust(BACKEND-&gt;ssl_ctx, &amp;trust);</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="comment">/* For some reason, SSLCopyPeerTrust() can return noErr and yet return</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">     a null trust, so be on guard for that: */</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="keywordflow">if</span>(err == noErr &amp;&amp; trust) {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    count = SecTrustGetCertificateCount(trust);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0L ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; count ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;      <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      server_cert = SecTrustGetCertificateAtIndex(trust, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, server_cert, &amp;certp);</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server certificate: %s\n&quot;</span>, certp);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      }</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    }</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    CFRelease(trust);</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  }</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <span class="comment">/* SSLCopyPeerCertificates() is deprecated as of Mountain Lion.</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="comment">     The function SecTrustGetCertificateAtIndex() is officially present</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="comment">     in Lion, but it is unfortunately also present in Snow Leopard as</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="comment">     private API and doesn&#39;t work as expected. So we have to look for</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment">     a different symbol to make sure this code is only executed under</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment">     Lion or later. */</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  <span class="keywordflow">if</span>(SecTrustEvaluateAsync != NULL) {</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="preprocessor">#pragma unused(server_certs)</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    err = SSLCopyPeerTrust(BACKEND-&gt;ssl_ctx, &amp;trust);</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="comment">/* For some reason, SSLCopyPeerTrust() can return noErr and yet return</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment">       a null trust, so be on guard for that: */</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="keywordflow">if</span>(err == noErr &amp;&amp; trust) {</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      count = SecTrustGetCertificateCount(trust);</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0L ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; count ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        server_cert = SecTrustGetCertificateAtIndex(trust, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, server_cert, &amp;certp);</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server certificate: %s\n&quot;</span>, certp);</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;          <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        }</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      }</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      CFRelease(trust);</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    }</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;  }</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    err = SSLCopyPeerCertificates(BACKEND-&gt;ssl_ctx, &amp;server_certs);</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    <span class="comment">/* Just in case SSLCopyPeerCertificates() returns null too... */</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <span class="keywordflow">if</span>(err == noErr &amp;&amp; server_certs) {</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      count = CFArrayGetCount(server_certs);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0L ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; count ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        server_cert = (SecCertificateRef)CFArrayGetValueAtIndex(server_certs,</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                                                                <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, server_cert, &amp;certp);</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;          <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server certificate: %s\n&quot;</span>, certp);</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;          <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        }</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      }</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      CFRelease(server_certs);</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  }</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="preprocessor">#pragma unused(trust)</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  err = SSLCopyPeerCertificates(BACKEND-&gt;ssl_ctx, &amp;server_certs);</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  <span class="keywordflow">if</span>(err == noErr) {</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    count = CFArrayGetCount(server_certs);</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0L ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; count ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;      <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;      <span class="keywordtype">char</span> *certp;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      server_cert = (SecCertificateRef)CFArrayGetValueAtIndex(server_certs, <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>);</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = CopyCertSubject(<a class="code" href="structdata.html">data</a>, server_cert, &amp;certp);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>) {</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;        <a class="code" href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;Server certificate: %s\n&quot;</span>, certp);</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        <a class="code" href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a>(certp);</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;      }</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    }</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    CFRelease(server_certs);</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  }</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_7 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;}</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !CURL_DISABLE_VERBOSE_STRINGS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;darwinssl_connect_step3(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                        <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;{</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="comment">/* There is no step 3!</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="comment">   * Well, okay, if verbose mode is on, let&#39;s print the details of the</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;<span class="comment">   * server certificates. */</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="preprocessor">#ifndef CURL_DISABLE_VERBOSE_STRINGS</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.verbose)</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    show_verbose_server_cert(conn, sockindex);</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a>;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;}</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="keyword">static</span> <a class="code" href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a> darwinssl_recv;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="keyword">static</span> <a class="code" href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a> darwinssl_send;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;darwinssl_connect_common(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                         <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                         <span class="keywordtype">bool</span> nonblocking,</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                         <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;{</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;  <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> sockfd = conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex];</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;  <span class="keywordtype">long</span> timeout_ms;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;  <span class="keywordtype">int</span> what;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  <span class="comment">/* check if the connection has already been established */</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a>) {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    *done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  }</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="comment">/* Find out how much more time we&#39;re allowed */</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    timeout_ms = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      <span class="comment">/* no need to continue if time already is up */</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    }</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_connect_step1(conn, sockindex);</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  }</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="keywordflow">while</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    <span class="comment">/* check allowed time left */</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    timeout_ms = <a class="code" href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a>(<a class="code" href="structdata.html">data</a>, NULL, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="keywordflow">if</span>(timeout_ms &lt; 0) {</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="comment">/* no need to continue if time already is up */</span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    }</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <span class="comment">/* if ssl is expecting something, check if it&#39;s available. */</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <span class="keywordflow">if</span>(connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> == <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> ||</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;       connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> == <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a>) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> writefd = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> ==</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;      connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>?sockfd:<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      <a class="code" href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a> readfd = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> ==</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>?sockfd:<a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;      what = <a class="code" href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a>(readfd, <a class="code" href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a>, writefd,</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                               nonblocking?0:timeout_ms);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      <span class="keywordflow">if</span>(what &lt; 0) {</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;        <span class="comment">/* fatal error */</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;select/poll on SSL socket, errno: %d&quot;</span>, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a>;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      }</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0 == what) {</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="keywordflow">if</span>(nonblocking) {</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;          *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        }</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;          <span class="comment">/* timeout */</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL connection timeout&quot;</span>);</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a>;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        }</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      }</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      <span class="comment">/* socket is readable or writable */</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    }</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="comment">/* Run transaction, and return to the caller if it failed or if this</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment">     * connection is done nonblocking and this loop would execute again. This</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment">     * permits the owner of a multi handle to abort a connection attempt</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment">     * before step2 has completed while ensuring that a client using select()</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment">     * or epoll() will always have a valid fdset to wait on.</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_connect_step2(conn, sockindex);</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> || (nonblocking &amp;&amp;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                  (<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                   <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> ||</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;                   <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>)))</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  } <span class="comment">/* repeat step2 until all transactions are done. */</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_connect_step3(conn, sockindex);</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  }</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a> == connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a>) {</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    connssl-&gt;<a class="code" href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">state</a> = <a class="code" href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a>;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">recv</a>[sockindex] = darwinssl_recv;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    conn-&gt;<a class="code" href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">send</a>[sockindex] = darwinssl_send;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    *done = <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  }</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    *done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;  <span class="comment">/* Reset our connect state machine */</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  connssl-&gt;<a class="code" href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">connecting_state</a> = <a class="code" href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a>;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;}</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_darwinssl_connect_nonblocking(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                                                   <span class="keywordtype">int</span> sockindex, <span class="keywordtype">bool</span> *done)</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;{</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  <span class="keywordflow">return</span> darwinssl_connect_common(conn, sockindex, <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, done);</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;}</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_darwinssl_connect(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;{</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;  <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;  <span class="keywordtype">bool</span> done = <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a> = darwinssl_connect_common(conn, sockindex, <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, &amp;done);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>)</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a>;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  <a class="code" href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a>(done);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;}</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_darwinssl_close(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;{</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx) {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    (void)SSLClose(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">if</span>(SSLCreateContext != NULL)</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;      CFRelease(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="preprocessor">#if CURL_SUPPORT_MAC_10_8</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      (<span class="keywordtype">void</span>)SSLDisposeContext(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="preprocessor">#endif  </span><span class="comment">/* CURL_SUPPORT_MAC_10_8 */</span><span class="preprocessor"></span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    (void)SSLDisposeContext(BACKEND-&gt;ssl_ctx);</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CURL_BUILD_MAC_10_8 || CURL_BUILD_IOS */</span><span class="preprocessor"></span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    BACKEND-&gt;ssl_ctx = NULL;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  }</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;  BACKEND-&gt;ssl_sockfd = 0;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;}</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Curl_darwinssl_shutdown(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn, <span class="keywordtype">int</span> sockindex)</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;{</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> = conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> nread;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="keywordtype">int</span> what;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>[120];</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="keywordflow">if</span>(!BACKEND-&gt;ssl_ctx)</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="structdata.html">data</a>-&gt;set.ftp_ccc != <a class="code" href="curl_8h.html#a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a">CURLFTPSSL_CCC_ACTIVE</a>)</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  Curl_darwinssl_close(conn, sockindex);</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = 0;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;  what = <a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex], SSL_SHUTDOWN_TIMEOUT);</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="keywordflow">if</span>(what &lt; 0) {</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      <span class="comment">/* anything that gets here is fatally bad */</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;select/poll on SSL socket, errno: %d&quot;</span>, <a class="code" href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a>);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = -1;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    }</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    <span class="keywordflow">if</span>(!what) {                                <span class="comment">/* timeout */</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;SSL shutdown timeout&quot;</span>);</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    }</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="comment">/* Something to read, let&#39;s do it and hope that it is the close</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="comment">     notify alert from the server. No way to SSL_Read now, so use read(). */</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    nread = read(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex], <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>));</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">if</span>(nread &lt; 0) {</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(<a class="code" href="structdata.html">data</a>, <span class="stringliteral">&quot;read: %s&quot;</span>, <a class="code" href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">strerror</a>(errno));</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a> = -1;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    }</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordflow">if</span>(nread &lt;= 0)</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    what = <a class="code" href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a>(conn-&gt;<a class="code" href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">sock</a>[sockindex], 0);</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  }</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">rc</a>;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;}</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> Curl_darwinssl_session_free(<span class="keywordtype">void</span> *<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>)</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;{</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;  <span class="comment">/* ST, as of iOS 5 and Mountain Lion, has no public method of deleting a</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="comment">     cached session ID inside the Security framework. There is a private</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment">     function that does this, but I don&#39;t want to have to explain to you why I</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment">     got your application rejected from the App Store due to the use of a</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">     private API, so the best we can do is free up our own char array that we</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment">     created way back in darwinssl_connect_step1... */</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;  <a class="code" href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a>(<a class="code" href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a>);</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;}</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> Curl_darwinssl_version(<span class="keywordtype">char</span> *<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>)</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;{</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a>(<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>, <a class="code" href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a>, <span class="stringliteral">&quot;SecureTransport&quot;</span>);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;}</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;<span class="comment"> * This function uses SSLGetSessionState to determine connection status.</span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment"> * Return codes:</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment"> *     1 means the connection is still in place</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment"> *     0 means the connection has been closed</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment"> *    -1 means the connection status is unknown</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> Curl_darwinssl_check_cxn(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn)</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;{</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[<a class="code" href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a>];</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;  OSStatus err;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;  SSLSessionState <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx) {</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    err = SSLGetSessionState(BACKEND-&gt;ssl_ctx, &amp;<a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a>);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <span class="keywordflow">if</span>(err == noErr)</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a> == kSSLConnected || <a class="code" href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a> == kSSLHandshake;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  }</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;}</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Curl_darwinssl_data_pending(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;                                        <span class="keywordtype">int</span> connindex)</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;{</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;  <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[connindex];</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  OSStatus err;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ssl_ctx) {  <span class="comment">/* SSL is in use */</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    err = SSLGetBufferedReadSize(BACKEND-&gt;ssl_ctx, &amp;<a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a>);</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keywordflow">if</span>(err == noErr)</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a> &gt; 0UL;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;}</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_darwinssl_random(<span class="keyword">struct</span> <a class="code" href="struct_curl__easy.html">Curl_easy</a> *<a class="code" href="structdata.html">data</a> <a class="code" href="curl__setup_8h.html#a32dce3380228f1a23cdc1f784263762b">UNUSED_PARAM</a>,</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *entropy, <span class="keywordtype">size_t</span> length)</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;{</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;  <span class="comment">/* arc4random_buf() isn&#39;t available on cats older than Lion, so let&#39;s</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;<span class="comment">     do this manually for the benefit of the older cats. */</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  <a class="code" href="setup-os400_8h.html#acb58d6261a51ba1d6fd4d00de0872f84">u_int32_t</a> random_number = 0;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  (void)<a class="code" href="structdata.html">data</a>;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0 ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; length ; <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++) {</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> % <span class="keyword">sizeof</span>(<a class="code" href="setup-os400_8h.html#acb58d6261a51ba1d6fd4d00de0872f84">u_int32_t</a>) == 0)</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      random_number = arc4random();</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    entropy[<a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = random_number &amp; 0xFF;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    random_number &gt;&gt;= 8;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;  }</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;  <a class="code" href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = random_number = 0;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;}</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_darwinssl_md5sum(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp, <span class="comment">/* input */</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;                                      <span class="keywordtype">size_t</span> tmplen,</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *md5sum, <span class="comment">/* output */</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                                      <span class="keywordtype">size_t</span> md5len)</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;{</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  (void)md5len;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  (void)CC_MD5(tmp, (CC_LONG)tmplen, md5sum);</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;}</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="keyword">static</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> Curl_darwinssl_sha256sum(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp, <span class="comment">/* input */</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                                     <span class="keywordtype">size_t</span> tmplen,</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                                     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *sha256sum, <span class="comment">/* output */</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                                     <span class="keywordtype">size_t</span> sha256len)</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;{</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;  <a class="code" href="test1_8c.html#a74bb3debd3b0d3f9c3fe210442b4cacc">assert</a>(sha256len &gt;= <a class="code" href="vtls_8h.html#a92d73bed4c4dd74c727d2fff527182dc">CURL_SHA256_DIGEST_LENGTH</a>);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  (void)CC_SHA256(tmp, (CC_LONG)tmplen, sha256sum);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;}</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Curl_darwinssl_false_start(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;{</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="preprocessor">#if CURL_BUILD_MAC_10_9 || CURL_BUILD_IOS_7</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  <span class="keywordflow">if</span>(SSLSetSessionOption != NULL)</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;}</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> darwinssl_send(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                              <span class="keywordtype">int</span> sockindex,</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                              <span class="keyword">const</span> <span class="keywordtype">void</span> *mem,</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;                              <span class="keywordtype">size_t</span> <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>,</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;                              <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *curlcode)</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;{</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;  <span class="comment">/*struct Curl_easy *data = conn-&gt;data;*/</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[sockindex];</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;  <span class="keywordtype">size_t</span> processed = 0UL;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  OSStatus err;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  <span class="comment">/* The SSLWrite() function works a little differently than expected. The</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="comment">     fourth argument (processed) is currently documented in Apple&#39;s</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment">     documentation as: &quot;On return, the length, in bytes, of the data actually</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment">     written.&quot;</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment">     Now, one could interpret that as &quot;written to the socket,&quot; but actually,</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment">     it returns the amount of data that was written to a buffer internal to</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment">     the SSLContextRef instead. So it&#39;s possible for SSLWrite() to return</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment">     errSSLWouldBlock and a number of bytes &quot;written&quot; because those bytes were</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">     encrypted and written to a buffer, not to the socket.</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment">     So if this happens, then we need to keep calling SSLWrite() over and</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment">     over again with no new data until it quits returning errSSLWouldBlock. */</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;  <span class="comment">/* Do we have buffered data to write from the last time we were called? */</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;  <span class="keywordflow">if</span>(BACKEND-&gt;ssl_write_buffered_length) {</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    <span class="comment">/* Write the buffered data: */</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    err = SSLWrite(BACKEND-&gt;ssl_ctx, NULL, 0UL, &amp;processed);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <span class="keywordflow">case</span> noErr:</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="comment">/* processed is always going to be 0 because we didn&#39;t write to</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="comment">           the buffer, so return how much was written to the socket */</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        processed = BACKEND-&gt;ssl_write_buffered_length;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        BACKEND-&gt;ssl_write_buffered_length = 0UL;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="keywordflow">case</span> errSSLWouldBlock: <span class="comment">/* argh, try again */</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SSLWrite() returned error %d&quot;</span>, err);</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    }</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  }</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="comment">/* We&#39;ve got new data to write: */</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    err = SSLWrite(BACKEND-&gt;ssl_ctx, mem, <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>, &amp;processed);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;      <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <span class="keywordflow">case</span> errSSLWouldBlock:</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;          <span class="comment">/* Data was buffered but not sent, we have to tell the caller</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;<span class="comment">             to try sending again, and remember how much was buffered */</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;          BACKEND-&gt;ssl_write_buffered_length = <a class="code" href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a>;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;          *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;          <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;          <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SSLWrite() returned error %d&quot;</span>, err);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;          *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a>;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;          <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      }</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    }</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  }</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)processed;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;}</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;<span class="keyword">static</span> <a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a> darwinssl_recv(<span class="keyword">struct</span> <a class="code" href="structconnectdata.html">connectdata</a> *conn,</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;                              <span class="keywordtype">int</span> num,</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                              <span class="keywordtype">char</span> *<a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>,</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                              <span class="keywordtype">size_t</span> buffersize,</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                              <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a> *curlcode)</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;{</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  <span class="comment">/*struct Curl_easy *data = conn-&gt;data;*/</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;  <span class="keyword">struct </span><a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl = &amp;conn-&gt;<a class="code" href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">ssl</a>[num];</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;  <span class="keywordtype">size_t</span> processed = 0UL;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;  OSStatus err = SSLRead(BACKEND-&gt;ssl_ctx, <a class="code" href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a>, buffersize, &amp;processed);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;  <span class="keywordflow">if</span>(err != noErr) {</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <span class="keywordflow">case</span> errSSLWouldBlock:  <span class="comment">/* return how much we read (if anything) */</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        <span class="keywordflow">if</span>(processed)</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;          <span class="keywordflow">return</span> (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)processed;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a>;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="comment">/* errSSLClosedGraceful - server gracefully shut down the SSL session</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment">         errSSLClosedNoNotify - server hung up on us instead of sending a</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="comment">           closure alert notice, read() is returning 0</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">         Either way, inform the caller that the server disconnected. */</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      <span class="keywordflow">case</span> errSSLClosedGraceful:</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;      <span class="keywordflow">case</span> errSSLClosedNoNotify:</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a>;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        <a class="code" href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a>(conn-&gt;<a class="code" href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">data</a>, <span class="stringliteral">&quot;SSLRead() return error %d&quot;</span>, err);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        *curlcode = <a class="code" href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a>;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        <span class="keywordflow">return</span> -1L;</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    }</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;  }</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a>)processed;</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;}</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *Curl_darwinssl_get_internals(<span class="keyword">struct</span> <a class="code" href="structssl__connect__data.html">ssl_connect_data</a> *connssl,</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;                                          <a class="code" href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7b">CURLINFO</a> info <a class="code" href="curl__setup_8h.html#a32dce3380228f1a23cdc1f784263762b">UNUSED_PARAM</a>)</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;{</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;  (void)info;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;  <span class="keywordflow">return</span> BACKEND-&gt;ssl_ctx;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;}</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct_curl__ssl.html">Curl_ssl</a> Curl_ssl_darwinssl = {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;  { <a class="code" href="curl_8h.html#a908c5b707ac681212b8f8688cf76689da66f73bb05c1675c012761aa41b1c957e">CURLSSLBACKEND_DARWINSSL</a>, <span class="stringliteral">&quot;darwinssl&quot;</span> }, <span class="comment">/* info */</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="preprocessor">#ifdef DARWIN_SSL_PINNEDPUBKEY</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;  <a class="code" href="vtls_8h.html#a932726d4856765a766c86e3a3ed29a8f">SSLSUPP_PINNEDPUBKEY</a>,</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  0,</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DARWIN_SSL_PINNEDPUBKEY */</span><span class="preprocessor"></span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;  <span class="keyword">sizeof</span>(<span class="keyword">struct </span>ssl_backend_data),</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;  <a class="code" href="vtls_8h.html#a9fe9fd14fbe2d9fc29d582a6c4ed0f83">Curl_none_init</a>,                     <span class="comment">/* init */</span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;  <a class="code" href="vtls_8h.html#ab751ac92e09399d2e4edae147629770a">Curl_none_cleanup</a>,                  <span class="comment">/* cleanup */</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;  Curl_darwinssl_version,             <span class="comment">/* version */</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;  Curl_darwinssl_check_cxn,           <span class="comment">/* check_cxn */</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;  Curl_darwinssl_shutdown,            <span class="comment">/* shutdown */</span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;  Curl_darwinssl_data_pending,        <span class="comment">/* data_pending */</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;  Curl_darwinssl_random,              <span class="comment">/* random */</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;  <a class="code" href="vtls_8h.html#afd63787510a375221ab2aba491ef2073">Curl_none_cert_status_request</a>,      <span class="comment">/* cert_status_request */</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;  Curl_darwinssl_connect,             <span class="comment">/* connect */</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;  Curl_darwinssl_connect_nonblocking, <span class="comment">/* connect_nonblocking */</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;  Curl_darwinssl_get_internals,       <span class="comment">/* get_internals */</span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;  Curl_darwinssl_close,               <span class="comment">/* close_one */</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;  <a class="code" href="vtls_8h.html#a054a6a646a0108d8f91a503d31a21671">Curl_none_close_all</a>,                <span class="comment">/* close_all */</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;  Curl_darwinssl_session_free,        <span class="comment">/* session_free */</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;  <a class="code" href="vtls_8h.html#a7ccc438dc80065afa61534a12f49716b">Curl_none_set_engine</a>,               <span class="comment">/* set_engine */</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;  <a class="code" href="vtls_8h.html#a06f0fb1d7887e2395f579c430c55e9da">Curl_none_set_engine_default</a>,       <span class="comment">/* set_engine_default */</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;  <a class="code" href="vtls_8h.html#a93de8d8215f8110779b3e2ab9d77dbd3">Curl_none_engines_list</a>,             <span class="comment">/* engines_list */</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;  Curl_darwinssl_false_start,         <span class="comment">/* false_start */</span></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  Curl_darwinssl_md5sum,              <span class="comment">/* md5sum */</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;  Curl_darwinssl_sha256sum            <span class="comment">/* sha256sum */</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;};</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;<span class="preprocessor">#ifdef __clang__</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="preprocessor">#pragma clang diagnostic pop</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* USE_DARWINSSL */</span><span class="preprocessor"></span></div><div class="ttc" id="curl__memory_8h_html_a9cc854374299a1dd933bf62029761768"><div class="ttname"><a href="curl__memory_8h.html#a9cc854374299a1dd933bf62029761768">free</a></div><div class="ttdeci">#define free(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00130">curl_memory.h:130</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aaa7a948caaac0addf8754794663f48b1">CURLE_OPERATION_TIMEDOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00498">curl.h:498</a></div></div>
<div class="ttc" id="structconnectdata_html_ab6f11cf5c5bc549e9f9af12fc65e2e23"><div class="ttname"><a href="structconnectdata.html#ab6f11cf5c5bc549e9f9af12fc65e2e23">connectdata::ssl</a></div><div class="ttdeci">struct ssl_connect_data ssl[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00885">urldata.h:885</a></div></div>
<div class="ttc" id="curl__setup_8h_html_a32dce3380228f1a23cdc1f784263762b"><div class="ttname"><a href="curl__setup_8h.html#a32dce3380228f1a23cdc1f784263762b">UNUSED_PARAM</a></div><div class="ttdeci">#define UNUSED_PARAM</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00699">curl_setup.h:699</a></div></div>
<div class="ttc" id="ftp_8c_html_a77812d4945cd21094debbd06962f0f01"><div class="ttname"><a href="ftp_8c.html#a77812d4945cd21094debbd06962f0f01">state</a></div><div class="ttdeci">#define state(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="ftp_8c_source.html#l00101">ftp.c:101</a></div></div>
<div class="ttc" id="structconnectdata_html_a9312f162d29fe7f59bc2b5dbeda85d9d"><div class="ttname"><a href="structconnectdata.html#a9312f162d29fe7f59bc2b5dbeda85d9d">connectdata::bits</a></div><div class="ttdeci">struct ConnectBits bits</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00894">urldata.h:894</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951ae6d701fdcc9728db65dadb0ec7d1eec1">CURLE_RECV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00527">curl.h:527</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a3d136f81a9d7bf281f4a050099438683">CURLE_SSL_CIPHER</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00530">curl.h:530</a></div></div>
<div class="ttc" id="struct_curl__easy_html"><div class="ttname"><a href="struct_curl__easy.html">Curl_easy</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01755">urldata.h:1755</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4dadd0b0bf93854f50974d52f324d3259df"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dadd0b0bf93854f50974d52f324d3259df">CURL_SSLVERSION_MAX_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01985">curl.h:1985</a></div></div>
<div class="ttc" id="structconnectdata_html_aec2de2220c36ec447f6101e85bf0a52b"><div class="ttname"><a href="structconnectdata.html#aec2de2220c36ec447f6101e85bf0a52b">connectdata::recv</a></div><div class="ttdeci">Curl_recv * recv[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00879">urldata.h:879</a></div></div>
<div class="ttc" id="vtls_8h_html_a594e132ba0c0e860b62140083ead1c0d"><div class="ttname"><a href="vtls_8h.html#a594e132ba0c0e860b62140083ead1c0d">SSL_CONN_CONFIG</a></div><div class="ttdeci">#define SSL_CONN_CONFIG(var)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00138">vtls.h:138</a></div></div>
<div class="ttc" id="base64_8c_html_a3b1d7d4873cc224ffb2ce6ff201bc2e6"><div class="ttname"><a href="base64_8c.html#a3b1d7d4873cc224ffb2ce6ff201bc2e6">Curl_base64_decode</a></div><div class="ttdeci">CURLcode Curl_base64_decode(const char *src, unsigned char **outptr, size_t *outlen)</div><div class="ttdef"><b>Definition:</b> <a href="base64_8c_source.html#l00099">base64.c:99</a></div></div>
<div class="ttc" id="struct_curl__ssl_html"><div class="ttname"><a href="struct_curl__ssl.html">Curl_ssl</a></div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00036">vtls.h:36</a></div></div>
<div class="ttc" id="structconnectdata_html_a0c1824e51ef689efcfddaa09a72c788b"><div class="ttname"><a href="structconnectdata.html#a0c1824e51ef689efcfddaa09a72c788b">connectdata::negnpn</a></div><div class="ttdeci">int negnpn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01032">urldata.h:1032</a></div></div>
<div class="ttc" id="structproxy__info_html_ae2cc9c2eb5c4ea0c4b92bf067e391bdc"><div class="ttname"><a href="structproxy__info.html#ae2cc9c2eb5c4ea0c4b92bf067e391bdc">proxy_info::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00752">urldata.h:752</a></div></div>
<div class="ttc" id="strtok_8h_html"><div class="ttname"><a href="strtok_8h.html">strtok.h</a></div></div>
<div class="ttc" id="urldata_8h_html_a56b23efdd8d04b0179b52224a251bcb7"><div class="ttname"><a href="urldata_8h.html#a56b23efdd8d04b0179b52224a251bcb7">FIRSTSOCKET</a></div><div class="ttdeci">#define FIRSTSOCKET</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00480">urldata.h:480</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_ad4ea824bd0fcae61733c900a5cab1e01"><div class="ttname"><a href="config-win32ce_8h.html#ad4ea824bd0fcae61733c900a5cab1e01">stat</a></div><div class="ttdeci">int stat(const char *path, struct stat *buffer)</div></div>
<div class="ttc" id="setup-os400_8h_html_acb58d6261a51ba1d6fd4d00de0872f84"><div class="ttname"><a href="setup-os400_8h.html#acb58d6261a51ba1d6fd4d00de0872f84">u_int32_t</a></div><div class="ttdeci">unsigned long u_int32_t</div><div class="ttdef"><b>Definition:</b> <a href="setup-os400_8h_source.html#l00033">setup-os400.h:33</a></div></div>
<div class="ttc" id="vtls_8h_html_af8e5805a5e7df10119ca90c13a2b1a79"><div class="ttname"><a href="vtls_8h.html#af8e5805a5e7df10119ca90c13a2b1a79">ALPN_HTTP_1_1</a></div><div class="ttdeci">#define ALPN_HTTP_1_1</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00128">vtls.h:128</a></div></div>
<div class="ttc" id="curl_8h_html_ada0bbe252b7b370ef4e135b93b2fe71e"><div class="ttname"><a href="curl_8h.html#ada0bbe252b7b370ef4e135b93b2fe71e">CURL_SOCKET_BAD</a></div><div class="ttdeci">#define CURL_SOCKET_BAD</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00131">curl.h:131</a></div></div>
<div class="ttc" id="structssl__primary__config_html_a7b1be18084f5fa42645c28a34b75d166"><div class="ttname"><a href="structssl__primary__config.html#a7b1be18084f5fa42645c28a34b75d166">ssl_primary_config::verifypeer</a></div><div class="ttdeci">bool verifypeer</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00212">urldata.h:212</a></div></div>
<div class="ttc" id="vtls_8h_html_a9fe9fd14fbe2d9fc29d582a6c4ed0f83"><div class="ttname"><a href="vtls_8h.html#a9fe9fd14fbe2d9fc29d582a6c4ed0f83">Curl_none_init</a></div><div class="ttdeci">int Curl_none_init(void)</div></div>
<div class="ttc" id="connect_8h_html"><div class="ttname"><a href="connect_8h.html">connect.h</a></div></div>
<div class="ttc" id="sendf_8h_html_ae8e06000059e436c9c404603126718d6"><div class="ttname"><a href="sendf_8h.html#ae8e06000059e436c9c404603126718d6">failf</a></div><div class="ttdeci">#define failf</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00048">sendf.h:48</a></div></div>
<div class="ttc" id="vtls_8h_html_a6d4d2d806ff1ab1428629b690f02e964"><div class="ttname"><a href="vtls_8h.html#a6d4d2d806ff1ab1428629b690f02e964">SSL_SET_OPTION</a></div><div class="ttdeci">#define SSL_SET_OPTION(var)</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00136">vtls.h:136</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eae9b72f6323430c824c44182b7649d0d8">CURL_SSLVERSION_TLSv1_2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01978">curl.h:1978</a></div></div>
<div class="ttc" id="sendf_8h_html"><div class="ttname"><a href="sendf_8h.html">sendf.h</a></div></div>
<div class="ttc" id="structssl__connect__data_html_a2de0f5a8b43b4e4550e22b1b8f3870e1"><div class="ttname"><a href="structssl__connect__data.html#a2de0f5a8b43b4e4550e22b1b8f3870e1">ssl_connect_data::connecting_state</a></div><div class="ttdeci">ssl_connect_state connecting_state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00203">urldata.h:203</a></div></div>
<div class="ttc" id="curl__memory_8h_html_aa3f578f8f1eaebf25b2e2313db31cb40"><div class="ttname"><a href="curl__memory_8h.html#aa3f578f8f1eaebf25b2e2313db31cb40">strdup</a></div><div class="ttdeci">#define strdup(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00122">curl_memory.h:122</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_af9cf1bc5edbe4eec056fe773c09d234e"><div class="ttname"><a href="curl__setup__once_8h.html#af9cf1bc5edbe4eec056fe773c09d234e">SOCKERRNO</a></div><div class="ttdeci">#define SOCKERRNO</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00414">curl_setup_once.h:414</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0f8174e66c2e7084ab2aa414509110ce">CURL_SSLVERSION_SSLv2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01974">curl.h:1974</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_a23d7b88872d6ead46c978b567908d587"><div class="ttname"><a href="curl__setup__once_8h.html#a23d7b88872d6ead46c978b567908d587">DEBUGASSERT</a></div><div class="ttdeci">#define DEBUGASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00401">curl_setup_once.h:401</a></div></div>
<div class="ttc" id="urldata_8h_html_a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f"><div class="ttname"><a href="urldata_8h.html#a9607658ec977f6ca435daf26b82f6b3fa83729aeebf5f0a20b00829bc3a6a1e9f">STRING_SSL_PINNEDPUBLICKEY_ORIG</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l01429">urldata.h:1429</a></div></div>
<div class="ttc" id="unit1330_8c_html_a367d241c5c363105ee629417d1dfba75"><div class="ttname"><a href="unit1330_8c.html#a367d241c5c363105ee629417d1dfba75">ptr</a></div><div class="ttdeci">UNITTEST_START char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="unit1330_8c_source.html#l00038">unit1330.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951">CURLcode</a></div><div class="ttdeci">CURLcode</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00457">curl.h:457</a></div></div>
<div class="ttc" id="curl_8h_html_aabc03ec968a2fdccde5c6709f712dd7b"><div class="ttname"><a href="curl_8h.html#aabc03ec968a2fdccde5c6709f712dd7b">CURLINFO</a></div><div class="ttdeci">CURLINFO</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l02498">curl.h:2498</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a9e0c77963cb42831dba8d5ee1840e80b">CURLE_SEND_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00526">curl.h:526</a></div></div>
<div class="ttc" id="namespacedictserver_html_aeb700c49a1a229869c3b36509a6c6c32"><div class="ttname"><a href="namespacedictserver.html#aeb700c49a1a229869c3b36509a6c6c32">dictserver.rc</a></div><div class="ttdeci">def rc</div><div class="ttdef"><b>Definition:</b> <a href="dictserver_8py_source.html#l00153">dictserver.py:153</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a785786e70ed591f03e61a7d0175d417f">CURLE_SSL_PINNEDPUBKEYNOTMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00578">curl.h:578</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8527394a7d1a590228373b95f55a61a7">CURLE_AGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00564">curl.h:564</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da87b97a94af49ac063d21e1818c865468">CURL_SSLVERSION_MAX_TLSv1_3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01990">curl.h:1990</a></div></div>
<div class="ttc" id="config-os400_8h_html_a7a1524cf833450776ffc81c38a78c370"><div class="ttname"><a href="config-os400_8h.html#a7a1524cf833450776ffc81c38a78c370">ENABLE_IPV6</a></div><div class="ttdeci">#define ENABLE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="config-os400_8h_source.html#l00071">config-os400.h:71</a></div></div>
<div class="ttc" id="structconnectdata_html_a91d94af5dfef86510940d658476b61cf"><div class="ttname"><a href="structconnectdata.html#a91d94af5dfef86510940d658476b61cf">connectdata::host</a></div><div class="ttdeci">struct hostname host</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00830">urldata.h:830</a></div></div>
<div class="ttc" id="struct_connect_bits_html_a15d98c2eae880b790963d2b0d15a85dc"><div class="ttname"><a href="struct_connect_bits.html#a15d98c2eae880b790963d2b0d15a85dc">ConnectBits::tls_enable_alpn</a></div><div class="ttdeci">bool tls_enable_alpn</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00440">urldata.h:440</a></div></div>
<div class="ttc" id="urldata_8h_html_a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c"><div class="ttname"><a href="urldata_8h.html#a2ea01ebd139c38e2285c7d2e17a2683fa88a671c415a487b02dbfd68cea24f98c">ssl_connection_complete</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00190">urldata.h:190</a></div></div>
<div class="ttc" id="curl__memory_8h_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="curl__memory_8h.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00124">curl_memory.h:124</a></div></div>
<div class="ttc" id="structhostname_html"><div class="ttname"><a href="structhostname.html">hostname</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00446">urldata.h:446</a></div></div>
<div class="ttc" id="structhostname_html_a9c9ce90bfcab1734f9376c6539d92cdd"><div class="ttname"><a href="structhostname.html#a9c9ce90bfcab1734f9376c6539d92cdd">hostname::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00449">urldata.h:449</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a7934d517b40671313c488ba54c1bf09e">ssl_connect_3</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00183">urldata.h:183</a></div></div>
<div class="ttc" id="unit1304_8c_html_a937d4dd628a8858b443a399410d2600b"><div class="ttname"><a href="unit1304_8c.html#a937d4dd628a8858b443a399410d2600b">result</a></div><div class="ttdeci">UNITTEST_START int result</div><div class="ttdef"><b>Definition:</b> <a href="unit1304_8c_source.html#l00049">unit1304.c:49</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4dacc7128741e309e08d2f9894cef9c76b5">CURL_SSLVERSION_MAX_TLSv1_2</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01989">curl.h:1989</a></div></div>
<div class="ttc" id="namespaceimpacket_1_1nmb_html_ae08ba7342be906ac4e49aa4746c2242d"><div class="ttname"><a href="namespaceimpacket_1_1nmb.html#ae08ba7342be906ac4e49aa4746c2242d">impacket.nmb.strerror</a></div><div class="ttdeci">def strerror(errclass, errcode)</div><div class="ttdef"><b>Definition:</b> <a href="nmb_8py_source.html#l00140">nmb.py:140</a></div></div>
<div class="ttc" id="smooth-gtk-thread_8c_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="smooth-gtk-thread_8c.html#a37d972ae0b47b9099e30983131d31916">j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="smooth-gtk-thread_8c_source.html#l00047">smooth-gtk-thread.c:47</a></div></div>
<div class="ttc" id="unit1308_8c_html_a70a830d3039f37216dde9bcf2460aec2"><div class="ttname"><a href="unit1308_8c.html#a70a830d3039f37216dde9bcf2460aec2">buffer</a></div><div class="ttdeci">char buffer[]</div><div class="ttdef"><b>Definition:</b> <a href="unit1308_8c_source.html#l00048">unit1308.c:48</a></div></div>
<div class="ttc" id="unit1303_8c_html_ac8936188af0c1d2f8b9d0cd25fde43b2"><div class="ttname"><a href="unit1303_8c.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a></div><div class="ttdeci">unsigned int i</div><div class="ttdef"><b>Definition:</b> <a href="unit1303_8c_source.html#l00078">unit1303.c:78</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea196e49e6628c0360cbe00852964fa906">CURL_SSLVERSION_SSLv3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01975">curl.h:1975</a></div></div>
<div class="ttc" id="curl_8h_html_abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74"><div class="ttname"><a href="curl_8h.html#abc5c98fcc1211af2b80116dd6e0a035da2bdca7ce6479378784212fee3a068c74">CURL_HTTP_VERSION_1_1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01926">curl.h:1926</a></div></div>
<div class="ttc" id="form_8d_html_a2ff994e16bf9521154de4cf659a3b689"><div class="ttname"><a href="form_8d.html#a2ff994e16bf9521154de4cf659a3b689">filename</a></div><div class="ttdeci">filename</div><div class="ttdef"><b>Definition:</b> <a href="form_8d_source.html#l00057">form.d:57</a></div></div>
<div class="ttc" id="curl__sasl_8c_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="curl__sasl_8c.html#a7360b55975153b822efc5217b7734e6a">len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="curl__sasl_8c_source.html#l00055">curl_sasl.c:55</a></div></div>
<div class="ttc" id="structconnectdata_html_a4df63a4042ad767671bb3bfd74aa68fc"><div class="ttname"><a href="structconnectdata.html#a4df63a4042ad767671bb3bfd74aa68fc">connectdata::http_proxy</a></div><div class="ttdeci">struct proxy_info http_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00837">urldata.h:837</a></div></div>
<div class="ttc" id="struct_connect_bits_html_af764c68e6af921d2073c498f80741ea4"><div class="ttname"><a href="struct_connect_bits.html#af764c68e6af921d2073c498f80741ea4">ConnectBits::tunnel_proxy</a></div><div class="ttdeci">bool tunnel_proxy</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00405">urldata.h:405</a></div></div>
<div class="ttc" id="curl__printf_8h_html"><div class="ttname"><a href="curl__printf_8h.html">curl_printf.h</a></div></div>
<div class="ttc" id="structssl__connect__data_html_a46d3839ea70923be1efa7f85aba7f6a8"><div class="ttname"><a href="structssl__connect__data.html#a46d3839ea70923be1efa7f85aba7f6a8">ssl_connect_data::state</a></div><div class="ttdeci">ssl_connection_state state</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00202">urldata.h:202</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9eaf516898239e1f4a335ab3c0d019de40e">CURL_SSLVERSION_TLSv1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01973">curl.h:1973</a></div></div>
<div class="ttc" id="inet__pton_8h_html"><div class="ttname"><a href="inet__pton_8h.html">inet_pton.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a8e6bdaad09a5404d9b01acaa93e1a797">CURLE_SSL_CACERT_BADFILE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00555">curl.h:555</a></div></div>
<div class="ttc" id="vtls_8h_html"><div class="ttname"><a href="vtls_8h.html">vtls.h</a></div></div>
<div class="ttc" id="unit1304_8c_html_a82a69fcfe92d9db6dd585ccc532a2ab7"><div class="ttname"><a href="unit1304_8c.html#a82a69fcfe92d9db6dd585ccc532a2ab7">memcpy</a></div><div class="ttdeci">memcpy(filename, filename1, strlen(filename1))</div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951aba5a22c9f705ed27933344be221fe937">CURLE_OUT_OF_MEMORY</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00493">curl.h:493</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a5ffb4b97de06318ffbd19405b18494f9">CURLE_SSL_CERTPROBLEM</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00529">curl.h:529</a></div></div>
<div class="ttc" id="curl__setup__once_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="curl__setup__once_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup__once_8h_source.html#l00327">curl_setup_once.h:327</a></div></div>
<div class="ttc" id="config_8d_html_aea53e62b3bb322f5a6bf4ceb58066a37"><div class="ttname"><a href="config_8d.html#aea53e62b3bb322f5a6bf4ceb58066a37">file</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are r and v.A backslash preceding any other letter is ignored.If the first column of a config line is a the rest of the line will be treated as a comment.Only write one option per physical line in the config file.Specify the filename to config as to make curl read the file from stdin.Note that to be able to specify a URL in the config file</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="config_8d_html_a9fb4830d0cbef7d3cf48425ce59f580a"><div class="ttname"><a href="config_8d.html#a9fb4830d0cbef7d3cf48425ce59f580a">n</a></div><div class="ttdeci">Long separated by or the equals sign.Long option names can optionally be given in the config file without the initial double dashes and if the colon or equals characters can be used as separators.If the option is specified with one or two there can be no colon or equals character between the option and its parameter.If the parameter is to contain the parameter must be enclosed within quotes.Within double the following escape sequences are n</div><div class="ttdef"><b>Definition:</b> <a href="config_8d_source.html#l00011">config.d:11</a></div></div>
<div class="ttc" id="vtls_8h_html_a932726d4856765a766c86e3a3ed29a8f"><div class="ttname"><a href="vtls_8h.html#a932726d4856765a766c86e3a3ed29a8f">SSLSUPP_PINNEDPUBKEY</a></div><div class="ttdeci">#define SSLSUPP_PINNEDPUBKEY</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00031">vtls.h:31</a></div></div>
<div class="ttc" id="connect_8c_html_aed32c0fb99c80a40c097c98a3eb03c74"><div class="ttname"><a href="connect_8c.html#aed32c0fb99c80a40c097c98a3eb03c74">Curl_timeleft</a></div><div class="ttdeci">timediff_t Curl_timeleft(struct Curl_easy *data, struct curltime *nowp, bool duringconnect)</div><div class="ttdef"><b>Definition:</b> <a href="connect_8c_source.html#l00184">connect.c:184</a></div></div>
<div class="ttc" id="config-win32ce_8h_html_af0fac1cea1165b4debec7f686edf3313"><div class="ttname"><a href="config-win32ce_8h.html#af0fac1cea1165b4debec7f686edf3313">EAGAIN</a></div><div class="ttdeci">#define EAGAIN</div><div class="ttdef"><b>Definition:</b> <a href="config-win32ce_8h_source.html#l00444">config-win32ce.h:444</a></div></div>
<div class="ttc" id="select_8h_html_a7e89e8a851eb27402914a0d5beb58d99"><div class="ttname"><a href="select_8h.html#a7e89e8a851eb27402914a0d5beb58d99">SOCKET_READABLE</a></div><div class="ttdeci">#define SOCKET_READABLE(x, z)</div><div class="ttdef"><b>Definition:</b> <a href="select_8h_source.html#l00079">select.h:79</a></div></div>
<div class="ttc" id="vtls_8h_html_afd63787510a375221ab2aba491ef2073"><div class="ttname"><a href="vtls_8h.html#afd63787510a375221ab2aba491ef2073">Curl_none_cert_status_request</a></div><div class="ttdeci">bool Curl_none_cert_status_request(void)</div></div>
<div class="ttc" id="select_8h_html"><div class="ttname"><a href="select_8h.html">select.h</a></div></div>
<div class="ttc" id="strdup_8c_html_a3a3f98ad97deebcb223f165b377f3879"><div class="ttname"><a href="strdup_8c.html#a3a3f98ad97deebcb223f165b377f3879">Curl_saferealloc</a></div><div class="ttdeci">void * Curl_saferealloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="strdup_8c_source.html#l00093">strdup.c:93</a></div></div>
<div class="ttc" id="pinnedpubkey_8d_html_afe9b7efeec45b7ade0025abb3fbff79b"><div class="ttname"><a href="pinnedpubkey_8d.html#afe9b7efeec45b7ade0025abb3fbff79b">connection</a></div><div class="ttdeci">Long or any number of base64 encoded sha256 hashes preceded by sha256 When negotiating a TLS or SSL connection</div><div class="ttdef"><b>Definition:</b> <a href="pinnedpubkey_8d_source.html#l00008">pinnedpubkey.d:8</a></div></div>
<div class="ttc" id="structssl__connect__data_html"><div class="ttname"><a href="structssl__connect__data.html">ssl_connect_data</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00197">urldata.h:197</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c6d961fbef3442f91a0c29191e83256">ssl_connect_2_writing</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00182">urldata.h:182</a></div></div>
<div class="ttc" id="url_8d_html_a1e5cd9496724b33dd938aa59064c8c99"><div class="ttname"><a href="url_8d.html#a1e5cd9496724b33dd938aa59064c8c99">protocol</a></div><div class="ttdeci">Long POP3 or SMTP then that protocol will be otherwise HTTP will be used.Since..guessing can be disabled by setting a default protocol</div><div class="ttdef"><b>Definition:</b> <a href="url_8d_source.html#l00010">url.d:10</a></div></div>
<div class="ttc" id="vtls_8h_html_a92d73bed4c4dd74c727d2fff527182dc"><div class="ttname"><a href="vtls_8h.html#a92d73bed4c4dd74c727d2fff527182dc">CURL_SHA256_DIGEST_LENGTH</a></div><div class="ttdeci">#define CURL_SHA256_DIGEST_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00123">vtls.h:123</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea0227d3edc8c1ee5f0bb41831912ce756">CURL_SSLVERSION_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01972">curl.h:1972</a></div></div>
<div class="ttc" id="vtls_8h_html_ab751ac92e09399d2e4edae147629770a"><div class="ttname"><a href="vtls_8h.html#ab751ac92e09399d2e4edae147629770a">Curl_none_cleanup</a></div><div class="ttdeci">void Curl_none_cleanup(void)</div></div>
<div class="ttc" id="structssl__primary__config_html_af116cf82e957a2ca2f0b39eb0c709d43"><div class="ttname"><a href="structssl__primary__config.html#af116cf82e957a2ca2f0b39eb0c709d43">ssl_primary_config::verifyhost</a></div><div class="ttdeci">bool verifyhost</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00213">urldata.h:213</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af47b7606f9b1ac9d655fe959fdefbd7d">CURLE_SSL_CONNECT_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00505">curl.h:505</a></div></div>
<div class="ttc" id="structconnectdata_html_ada83cbd7d295b87033b7ea635c0a5dd5"><div class="ttname"><a href="structconnectdata.html#ada83cbd7d295b87033b7ea635c0a5dd5">connectdata::send</a></div><div class="ttdeci">Curl_send * send[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00880">urldata.h:880</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a83e9e80af0be0e0a560a5c925cc2e216">ssl_connect_2_reading</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00181">urldata.h:181</a></div></div>
<div class="ttc" id="curl__memory_8h_html"><div class="ttname"><a href="curl__memory_8h.html">curl_memory.h</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951af2fb280cf805aa199f6b63a2a27c318b">CURLE_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00458">curl.h:458</a></div></div>
<div class="ttc" id="darwinssl_8h_html"><div class="ttname"><a href="darwinssl_8h.html">darwinssl.h</a></div></div>
<div class="ttc" id="inet__pton_8c_html_a8d1e996e3cc6d70e844c787b1a8614cc"><div class="ttname"><a href="inet__pton_8c.html#a8d1e996e3cc6d70e844c787b1a8614cc">Curl_inet_pton</a></div><div class="ttdeci">int Curl_inet_pton(int af, const char *src, void *dst)</div><div class="ttdef"><b>Definition:</b> <a href="inet__pton_8c_source.html#l00066">inet_pton.c:66</a></div></div>
<div class="ttc" id="strdup_8h_html"><div class="ttname"><a href="strdup_8h.html">strdup.h</a></div></div>
<div class="ttc" id="_b_l_e_beacon_8h_html_a600930655b7237315b72223c48327ea8"><div class="ttname"><a href="_b_l_e_beacon_8h.html#a600930655b7237315b72223c48327ea8">major</a></div><div class="ttdeci">uint16_t major</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_beacon_8h_source.html#l00084">BLEBeacon.h:84</a></div></div>
<div class="ttc" id="memdebug_8h_html_a795660f73c902cc80ac0fe6cda0dbd1c"><div class="ttname"><a href="memdebug_8h.html#a795660f73c902cc80ac0fe6cda0dbd1c">Curl_safefree</a></div><div class="ttdeci">#define Curl_safefree(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="memdebug_8h_source.html#l00176">memdebug.h:176</a></div></div>
<div class="ttc" id="curl__setup_8h_html"><div class="ttname"><a href="curl__setup_8h.html">curl_setup.h</a></div></div>
<div class="ttc" id="max-time_8d_html_a578487ceabd31e8c8e81291ef6fd4e45"><div class="ttname"><a href="max-time_8d.html#a578487ceabd31e8c8e81291ef6fd4e45">values</a></div><div class="ttdeci">Long this option accepts decimal values</div><div class="ttdef"><b>Definition:</b> <a href="max-time_8d_source.html#l00009">max-time.d:9</a></div></div>
<div class="ttc" id="curl__printf_8h_html_a3e3dfee99c81f563d18ef4626d8886e1"><div class="ttname"><a href="curl__printf_8h.html#a3e3dfee99c81f563d18ef4626d8886e1">aprintf</a></div><div class="ttdeci">#define aprintf</div><div class="ttdef"><b>Definition:</b> <a href="curl__printf_8h_source.html#l00046">curl_printf.h:46</a></div></div>
<div class="ttc" id="unit1652_8c_html_a1d19b0eef3b3acd31be88886a0277c2e"><div class="ttname"><a href="unit1652_8c.html#a1d19b0eef3b3acd31be88886a0277c2e">memset</a></div><div class="ttdeci">memset(input, '\0', sizeof(input))</div></div>
<div class="ttc" id="select_8c_html_a5c7e56fd4476c27a049314f502981f29"><div class="ttname"><a href="select_8c.html#a5c7e56fd4476c27a049314f502981f29">Curl_socket_check</a></div><div class="ttdeci">int Curl_socket_check(curl_socket_t readfd0, curl_socket_t readfd1, curl_socket_t writefd, time_t timeout_ms)</div><div class="ttdef"><b>Definition:</b> <a href="select_8c_source.html#l00145">select.c:145</a></div></div>
<div class="ttc" id="structssl__primary__config_html_ac276158be45d7efe6872bfbfc009b417"><div class="ttname"><a href="structssl__primary__config.html#ac276158be45d7efe6872bfbfc009b417">ssl_primary_config::version</a></div><div class="ttdeci">long version</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00210">urldata.h:210</a></div></div>
<div class="ttc" id="vtls_8h_html_a7ccc438dc80065afa61534a12f49716b"><div class="ttname"><a href="vtls_8h.html#a7ccc438dc80065afa61534a12f49716b">Curl_none_set_engine</a></div><div class="ttdeci">CURLcode Curl_none_set_engine(struct Curl_easy *data, const char *engine)</div></div>
<div class="ttc" id="_b_l_e_beacon_8h_html_a9f280ce3ae5b6cd9346fd7a09ff29168"><div class="ttname"><a href="_b_l_e_beacon_8h.html#a9f280ce3ae5b6cd9346fd7a09ff29168">minor</a></div><div class="ttdeci">uint16_t minor</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_beacon_8h_source.html#l00085">BLEBeacon.h:85</a></div></div>
<div class="ttc" id="strtok_8h_html_abff4e21c5a2026f9982e88f1e686e63a"><div class="ttname"><a href="strtok_8h.html#abff4e21c5a2026f9982e88f1e686e63a">strtok_r</a></div><div class="ttdeci">#define strtok_r</div><div class="ttdef"><b>Definition:</b> <a href="strtok_8h_source.html#l00029">strtok.h:29</a></div></div>
<div class="ttc" id="progress-bar_8d_html_ab8db689d5132c4523a63d67bedf23c8a"><div class="ttname"><a href="progress-bar_8d.html#ab8db689d5132c4523a63d67bedf23c8a">size</a></div><div class="ttdeci">Short more meter.This progress bar draws a single line of shows a percentage if the transfer size is known.For transfers without a known size</div><div class="ttdef"><b>Definition:</b> <a href="progress-bar_8d_source.html#l00006">progress-bar.d:6</a></div></div>
<div class="ttc" id="config-win32_8h_html_a8af93bbb66534e14d651bbb0638ee796"><div class="ttname"><a href="config-win32_8h.html#a8af93bbb66534e14d651bbb0638ee796">ssize_t</a></div><div class="ttdeci">#define ssize_t</div><div class="ttdef"><b>Definition:</b> <a href="config-win32_8h_source.html#l00379">config-win32.h:379</a></div></div>
<div class="ttc" id="structconnectdata_html_a13cc2123ad38902e8ad44e67f10ed7aa"><div class="ttname"><a href="structconnectdata.html#a13cc2123ad38902e8ad44e67f10ed7aa">connectdata::sock</a></div><div class="ttdeci">curl_socket_t sock[2]</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00874">urldata.h:874</a></div></div>
<div class="ttc" id="_b_l_e_eddystone_t_l_m_8h_html_ab22abc2906422da61885ac6c8e6a1a59"><div class="ttname"><a href="_b_l_e_eddystone_t_l_m_8h.html#ab22abc2906422da61885ac6c8e6a1a59">version</a></div><div class="ttdeci">uint8_t version</div><div class="ttdef"><b>Definition:</b> <a href="_b_l_e_eddystone_t_l_m_8h_source.html#l00041">BLEEddystoneTLM.h:41</a></div></div>
<div class="ttc" id="urldata_8h_html_ad073adb2b5b8a2f9ab8eb0dcae415efc"><div class="ttname"><a href="urldata_8h.html#ad073adb2b5b8a2f9ab8eb0dcae415efc">Curl_recv</a></div><div class="ttdeci">ssize_t() Curl_recv(struct connectdata *conn, int sockindex, char *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00110">urldata.h:110</a></div></div>
<div class="ttc" id="structssl__primary__config_html_aaaea4d07233992dd9e14488afa8cd390"><div class="ttname"><a href="structssl__primary__config.html#aaaea4d07233992dd9e14488afa8cd390">ssl_primary_config::version_max</a></div><div class="ttdeci">long version_max</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00211">urldata.h:211</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea769044d53450fd19575f12b2838f54d0">CURL_SSLVERSION_TLSv1_0</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01976">curl.h:1976</a></div></div>
<div class="ttc" id="curl_8h_html_af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5"><div class="ttname"><a href="curl_8h.html#af0691941698240652e0a391394217951a746b63c8123f5bdc10a916f720f2c9e5">CURLE_PEER_FAILED_VERIFICATION</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00531">curl.h:531</a></div></div>
<div class="ttc" id="structconnectdata_html_a4acb6315f331c234b0bdbfd4b1a402e7"><div class="ttname"><a href="structconnectdata.html#a4acb6315f331c234b0bdbfd4b1a402e7">connectdata::ssl_config</a></div><div class="ttdeci">struct ssl_primary_config ssl_config</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00890">urldata.h:890</a></div></div>
<div class="ttc" id="vtls_8h_html_a93de8d8215f8110779b3e2ab9d77dbd3"><div class="ttname"><a href="vtls_8h.html#a93de8d8215f8110779b3e2ab9d77dbd3">Curl_none_engines_list</a></div><div class="ttdeci">struct curl_slist * Curl_none_engines_list(struct Curl_easy *data)</div></div>
<div class="ttc" id="urldata_8h_html_a9f02ef6c16f171ef6fd36b7903e91b41"><div class="ttname"><a href="urldata_8h.html#a9f02ef6c16f171ef6fd36b7903e91b41">Curl_send</a></div><div class="ttdeci">ssize_t() Curl_send(struct connectdata *conn, int sockindex, const void *buf, size_t len, CURLcode *err)</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00103">urldata.h:103</a></div></div>
<div class="ttc" id="unit1652_8c_html_a348cae967f89c4bad8fb37e45a469d1a"><div class="ttname"><a href="unit1652_8c.html#a348cae967f89c4bad8fb37e45a469d1a">msnprintf</a></div><div class="ttdeci">UNITTEST_START msnprintf(input, sizeof(input), &quot;Simple Test&quot;)</div></div>
<div class="ttc" id="unit1398_8c_html_aee5a1edd73e85934dcbe27ccbb1ef1ad"><div class="ttname"><a href="unit1398_8c.html#aee5a1edd73e85934dcbe27ccbb1ef1ad">buf</a></div><div class="ttdeci">char buf[3]</div><div class="ttdef"><b>Definition:</b> <a href="unit1398_8c_source.html#l00032">unit1398.c:32</a></div></div>
<div class="ttc" id="header_8d_html_af039c1a4bf9f7d5ffdd981d66cd3fb2d"><div class="ttname"><a href="header_8d.html#af039c1a4bf9f7d5ffdd981d66cd3fb2d">in</a></div><div class="ttdeci">Long your externally set header will be used instead of the one.This allows you to make even trickier stuff than curl would normally do.You should not replace internally set headers without knowing perfectly well what you re doing.Remove an header by giving a replacement without content on the right side of the as in</div><div class="ttdef"><b>Definition:</b> <a href="header_8d_source.html#l00009">header.d:9</a></div></div>
<div class="ttc" id="sendf_8h_html_a0056494e05c065643a400059b9318270"><div class="ttname"><a href="sendf_8h.html#a0056494e05c065643a400059b9318270">infof</a></div><div class="ttdeci">#define infof</div><div class="ttdef"><b>Definition:</b> <a href="sendf_8h_source.html#l00044">sendf.h:44</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a02630bc60f6cd9c202c67e33784ee7a5">ssl_connect_2</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00180">urldata.h:180</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3659f18972112848e04fec39daf19985">CURL_SSLVERSION_TLSv1_1</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01977">curl.h:1977</a></div></div>
<div class="ttc" id="curl_8h_html_a16af7b253440dadd46a80a4b9fddba4da724f1960f9dd1cfe462c0eca7f4e7da0"><div class="ttname"><a href="curl_8h.html#a16af7b253440dadd46a80a4b9fddba4da724f1960f9dd1cfe462c0eca7f4e7da0">CURL_SSLVERSION_MAX_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01986">curl.h:1986</a></div></div>
<div class="ttc" id="curl_8h_html_a49d83160803f433b12209ed52aafc05f"><div class="ttname"><a href="curl_8h.html#a49d83160803f433b12209ed52aafc05f">CURL_HTTP_VERSION_2</a></div><div class="ttdeci">#define CURL_HTTP_VERSION_2</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01938">curl.h:1938</a></div></div>
<div class="ttc" id="structconnectdata_html_ac9d24fcd15a4c660fa7b6fbf55f6451d"><div class="ttname"><a href="structconnectdata.html#ac9d24fcd15a4c660fa7b6fbf55f6451d">connectdata::port</a></div><div class="ttdeci">long port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00839">urldata.h:839</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1a8c789d7e6cfccfe4cb46894d5e2102f1">ssl_connect_done</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00184">urldata.h:184</a></div></div>
<div class="ttc" id="curl_8h_html_a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d"><div class="ttname"><a href="curl_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea3a20a62139a18a0577154835dc642c0d">CURL_SSLVERSION_TLSv1_3</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l01979">curl.h:1979</a></div></div>
<div class="ttc" id="urldata_8h_html"><div class="ttname"><a href="urldata_8h.html">urldata.h</a></div></div>
<div class="ttc" id="multi-debugcallback_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="multi-debugcallback_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="multi-debugcallback_8c_source.html#l00038">multi-debugcallback.c:38</a></div></div>
<div class="ttc" id="curl_8h_html_a908c5b707ac681212b8f8688cf76689da66f73bb05c1675c012761aa41b1c957e"><div class="ttname"><a href="curl_8h.html#a908c5b707ac681212b8f8688cf76689da66f73bb05c1675c012761aa41b1c957e">CURLSSLBACKEND_DARWINSSL</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00147">curl.h:147</a></div></div>
<div class="ttc" id="memdebug_8h_html"><div class="ttname"><a href="memdebug_8h.html">memdebug.h</a></div></div>
<div class="ttc" id="curl_8h_html_adb5a46d02359d2379dc7e0904c987828"><div class="ttname"><a href="curl_8h.html#adb5a46d02359d2379dc7e0904c987828">curl_socket_t</a></div><div class="ttdeci">int curl_socket_t</div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00130">curl.h:130</a></div></div>
<div class="ttc" id="get_8d_html_a38b0ef81b65f2aee282c8c217a123176"><div class="ttname"><a href="get_8d.html#a38b0ef81b65f2aee282c8c217a123176">data</a></div><div class="ttdeci">Long this option will make all data specified with data</div><div class="ttdef"><b>Definition:</b> <a href="get_8d_source.html#l00005">get.d:5</a></div></div>
<div class="ttc" id="structconnectdata_html"><div class="ttname"><a href="structconnectdata.html">connectdata</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00782">urldata.h:782</a></div></div>
<div class="ttc" id="test1_8c_html_a74bb3debd3b0d3f9c3fe210442b4cacc"><div class="ttname"><a href="test1_8c.html#a74bb3debd3b0d3f9c3fe210442b4cacc">assert</a></div><div class="ttdeci">#define assert(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="test1_8c_source.html#l00202">test1.c:202</a></div></div>
<div class="ttc" id="structhostname_html_aee7d0ff8210c25b87d6fdeacf8ea7939"><div class="ttname"><a href="structhostname.html#aee7d0ff8210c25b87d6fdeacf8ea7939">hostname::dispname</a></div><div class="ttdeci">const char * dispname</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00450">urldata.h:450</a></div></div>
<div class="ttc" id="urldata_8h_html_ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508"><div class="ttname"><a href="urldata_8h.html#ace0075850efad1d17ded7b56129fb3d1aff18b454b42fb95d95e3fd93130a5508">ssl_connect_1</a></div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00179">urldata.h:179</a></div></div>
<div class="ttc" id="unit1602_8c_html_a35af0be900467fedbb610bd6ea65ed78"><div class="ttname"><a href="unit1602_8c.html#a35af0be900467fedbb610bd6ea65ed78">key</a></div><div class="ttdeci">int key</div><div class="ttdef"><b>Definition:</b> <a href="unit1602_8c_source.html#l00056">unit1602.c:56</a></div></div>
<div class="ttc" id="vtls_8h_html_a06f0fb1d7887e2395f579c430c55e9da"><div class="ttname"><a href="vtls_8h.html#a06f0fb1d7887e2395f579c430c55e9da">Curl_none_set_engine_default</a></div><div class="ttdeci">CURLcode Curl_none_set_engine_default(struct Curl_easy *data)</div></div>
<div class="ttc" id="structdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00029">debug.c:29</a></div></div>
<div class="ttc" id="structconnectdata_html_a82d9732a096255f5d8741c4a0ea990eb"><div class="ttname"><a href="structconnectdata.html#a82d9732a096255f5d8741c4a0ea990eb">connectdata::remote_port</a></div><div class="ttdeci">int remote_port</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00840">urldata.h:840</a></div></div>
<div class="ttc" id="vtls_8h_html_a054a6a646a0108d8f91a503d31a21671"><div class="ttname"><a href="vtls_8h.html#a054a6a646a0108d8f91a503d31a21671">Curl_none_close_all</a></div><div class="ttdeci">void Curl_none_close_all(struct Curl_easy *data)</div></div>
<div class="ttc" id="fail-early_8d_html_a188ba6f263db5df5a64e1cc11fb0c098"><div class="ttname"><a href="fail-early_8d.html#a188ba6f263db5df5a64e1cc11fb0c098">options</a></div><div class="ttdeci">Long do not continue it will attempt to operate on each given one by one.By it will ignore errors if there are more URLs given and the last URL s success will determine the error code curl returns.So early failures will be hidden by subsequent successful transfers.Using this curl will instead return an error on the first transfer that independent of the amount of URLs that are given on the command line.This no transfer failures go undetected by scripts and similar.This option is global and does not need to be specified for each use of next.This option does not imply which causes transfers to fail due to the server s HTTP status code.You can combine the two options</div><div class="ttdef"><b>Definition:</b> <a href="fail-early_8d_source.html#l00002">fail-early.d:2</a></div></div>
<div class="ttc" id="curl__memory_8h_html_abc013d1a27cb591a5316801c509c781f"><div class="ttname"><a href="curl__memory_8h.html#abc013d1a27cb591a5316801c509c781f">calloc</a></div><div class="ttdeci">#define calloc(nbelem, size)</div><div class="ttdef"><b>Definition:</b> <a href="curl__memory_8h_source.html#l00126">curl_memory.h:126</a></div></div>
<div class="ttc" id="curl__setup_8h_html_a1c6e64692c9b7c6e7dc70adb398b3115"><div class="ttname"><a href="curl__setup_8h.html#a1c6e64692c9b7c6e7dc70adb398b3115">struct_stat</a></div><div class="ttdeci">#define struct_stat</div><div class="ttdef"><b>Definition:</b> <a href="curl__setup_8h_source.html#l00389">curl_setup.h:389</a></div></div>
<div class="ttc" id="curl__base64_8h_html"><div class="ttname"><a href="curl__base64_8h.html">curl_base64.h</a></div></div>
<div class="ttc" id="curl_8h_html_a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a"><div class="ttname"><a href="curl_8h.html#a48086b496b9853f6b9507af1c7a50acaa9159611119fe5f4912d5875f41dd5f0a">CURLFTPSSL_CCC_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8h_source.html#l00828">curl.h:828</a></div></div>
<div class="ttc" id="vtls_8h_html_ad333981ba88648c413730d21d5418405"><div class="ttname"><a href="vtls_8h.html#ad333981ba88648c413730d21d5418405">SSL_IS_PROXY</a></div><div class="ttdeci">#define SSL_IS_PROXY()</div><div class="ttdef"><b>Definition:</b> <a href="vtls_8h_source.html#l00133">vtls.h:133</a></div></div>
<div class="ttc" id="structconnectdata_html_a3df7eee97914936f17a228eb2cf84eed"><div class="ttname"><a href="structconnectdata.html#a3df7eee97914936f17a228eb2cf84eed">connectdata::data</a></div><div class="ttdeci">struct Curl_easy * data</div><div class="ttdef"><b>Definition:</b> <a href="urldata_8h_source.html#l00786">urldata.h:786</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_e9014474357f0c50c4c87dd9066e36b7.html">curl</a></li><li class="navelem"><a class="el" href="dir_efb6013f246e7f8b3181c5014844a411.html">lib</a></li><li class="navelem"><a class="el" href="dir_c8d0f45061db60a99b5caea59b58f693.html">vtls</a></li><li class="navelem"><a class="el" href="darwinssl_8c.html">darwinssl.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
