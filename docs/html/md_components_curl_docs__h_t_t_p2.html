<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: HTTP/2 with curl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_components_curl_docs__h_t_t_p2.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HTTP/2 with curl </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://www.rfc-editor.org/rfc/rfc7540.txt">HTTP/2 Spec</a> <a href="https://daniel.haxx.se/http2/">http2 explained</a></p>
<h2>Build prerequisites </h2>
<ul>
<li>nghttp2</li>
<li>OpenSSL, libressl, BoringSSL, NSS, GnutTLS, mbedTLS, wolfSSL or Schannel with a new enough version.</li>
</ul>
<h2><a href="https://nghttp2.org/">nghttp2</a> </h2>
<p>libcurl uses this 3rd party library for the low level protocol handling parts. The reason for this is that HTTP/2 is much more complex at that layer than HTTP/1.1 (which we implement on our own) and that nghttp2 is an already existing and well functional library.</p>
<p>We require at least version 1.0.0.</p>
<h2>Over an <a href="http://">http://</a> URL </h2>
<p>If <code>CURLOPT_HTTP_VERSION</code> is set to <code>CURL_HTTP_VERSION_2_0</code>, libcurl will include an upgrade header in the initial request to the host to allow upgrading to HTTP/2.</p>
<p>Possibly we can later introduce an option that will cause libcurl to fail if not possible to upgrade. Possibly we introduce an option that makes libcurl use HTTP/2 at once over <a href="http://">http://</a></p>
<h2>Over an <a href="https://">https://</a> URL </h2>
<p>If <code>CURLOPT_HTTP_VERSION</code> is set to <code>CURL_HTTP_VERSION_2_0</code>, libcurl will use ALPN (or NPN) to negotiate which protocol to continue with. Possibly introduce an option that will cause libcurl to fail if not possible to use HTTP/2.</p>
<p><code>CURL_HTTP_VERSION_2TLS</code> was added in 7.47.0 as a way to ask libcurl to prefer HTTP/2 for HTTPS but stick to 1.1 by default for plain old <a class="el" href="struct_h_t_t_p.html">HTTP</a> connections.</p>
<p>ALPN is the TLS extension that HTTP/2 is expected to use. The NPN extension is for a similar purpose, was made prior to ALPN and is used for SPDY so early HTTP/2 servers are implemented using NPN before ALPN support is widespread.</p>
<p><code>CURLOPT_SSL_ENABLE_ALPN</code> and <code>CURLOPT_SSL_ENABLE_NPN</code> are offered to allow applications to explicitly disable ALPN or NPN.</p>
<h2>SSL libs </h2>
<p>The challenge is the ALPN and NPN support and all our different SSL backends. You may need a fairly updated SSL library version for it to provide the necessary TLS features. Right now we support:</p>
<ul>
<li>OpenSSL: ALPN and NPN</li>
<li>libressl: ALPN and NPN</li>
<li>BoringSSL: ALPN and NPN</li>
<li>NSS: ALPN and NPN</li>
<li>GnuTLS: ALPN</li>
<li>mbedTLS: ALPN</li>
<li>Schannel: ALPN</li>
<li>wolfSSL: ALPN</li>
<li>Secure Transport: ALPN</li>
</ul>
<h2>Multiplexing </h2>
<p>Starting in 7.43.0, libcurl fully supports HTTP/2 multiplexing, which is the term for doing multiple independent transfers over the same physical TCP connection.</p>
<p>To take advantage of multiplexing, you need to use the multi interface and set <code>CURLMOPT_PIPELINING</code> to <code>CURLPIPE_MULTIPLEX</code>. With that bit set, libcurl will attempt to re-use existing HTTP/2 connections and just add a new stream over that when doing subsequent parallel requests.</p>
<p>While libcurl sets up a connection to a <a class="el" href="struct_h_t_t_p.html">HTTP</a> server there is a period during which it doesn't know if it can pipeline or do multiplexing and if you add new transfers in that period, libcurl will default to start new connections for those transfers. With the new option <code>CURLOPT_PIPEWAIT</code> (added in 7.43.0), you can ask that a transfer should rather wait and see in case there's a connection for the same host in progress that might end up being possible to multiplex on. It favours keeping the number of connections low to the cost of slightly longer time to first byte transferred.</p>
<h2>Applications </h2>
<p>We hide HTTP/2's binary nature and convert received HTTP/2 traffic to headers in <a class="el" href="struct_h_t_t_p.html">HTTP</a> 1.1 style. This allows applications to work unmodified.</p>
<h2>curl tool </h2>
<p>curl offers the <code>--http2</code> command line option to enable use of HTTP/2.</p>
<p>curl offers the <code>--http2-prior-knowledge</code> command line option to enable use of HTTP/2 without HTTP/1.1 Upgrade.</p>
<p>Since 7.47.0, the curl tool enables HTTP/2 by default for HTTPS connections.</p>
<h2>curl tool limitations </h2>
<p>The command line tool won't do any HTTP/2 multiplexing even though libcurl supports it, simply because the curl tool is not written to take advantage of the libcurl API that's necessary for this (the multi interface). We have an outstanding TODO item for this and <b>you</b> can help us make it happen.</p>
<p>The command line tool also doesn't support HTTP/2 server push for the same reason it doesn't do multiplexing: it needs to use the multi interface for that so that multiplexing is supported.</p>
<h2><a class="el" href="struct_h_t_t_p.html">HTTP</a> Alternative Services </h2>
<p>Alt-Svc is an extension with a corresponding frame (ALTSVC) in HTTP/2 that tells the client about an alternative "route" to the same content for the same origin server that you get the response from. A browser or long-living client can use that hint to create a new connection asynchronously. For libcurl, we may introduce a way to bring such clues to the application and/or let a subsequent request use the alternate route automatically.</p>
<p><a href="https://tools.ietf.org/html/rfc7838">Detailed in RFC 7838</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
