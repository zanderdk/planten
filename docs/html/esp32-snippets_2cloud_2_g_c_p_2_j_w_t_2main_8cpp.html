<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plante: esp32-snippets/cloud/GCP/JWT/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plante
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;mbedtls/pk.h&gt;</code><br />
<code>#include &lt;mbedtls/error.h&gt;</code><br />
<code>#include &lt;mbedtls/entropy.h&gt;</code><br />
<code>#include &lt;mbedtls/ctr_drbg.h&gt;</code><br />
<code>#include &lt;esp_wifi.h&gt;</code><br />
<code>#include &lt;esp_system.h&gt;</code><br />
<code>#include &lt;esp_event.h&gt;</code><br />
<code>#include &lt;esp_event_loop.h&gt;</code><br />
<code>#include &lt;nvs_flash.h&gt;</code><br />
<code>#include &lt;tcpip_adapter.h&gt;</code><br />
<code>#include &lt;esp_err.h&gt;</code><br />
<code>#include &lt;freertos/FreeRTOS.h&gt;</code><br />
<code>#include &lt;freertos/task.h&gt;</code><br />
<code>#include &lt;apps/sntp/sntp.h&gt;</code><br />
<code>#include &quot;passwords.h&quot;</code><br />
<code>#include &quot;<a class="el" href="base64url_8h_source.html">base64url.h</a>&quot;</code><br />
<code>#include &quot;device1_private_pem.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp__incl.png" border="0" usemap="#esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp" alt=""/></div>
<map name="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp" id="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp">
</map>
</div>
</div>
<p><a href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abce06be17fc37d675118a678a8100a36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html#abce06be17fc37d675118a678a8100a36">app_main</a> ()</td></tr>
<tr class="separator:abce06be17fc37d675118a678a8100a36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4edba451afacd8d9b46c303729ce167"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html#af4edba451afacd8d9b46c303729ce167">createGCPJWT</a> (const char *projectId, uint8_t *privateKey, size_t privateKeySize)</td></tr>
<tr class="separator:af4edba451afacd8d9b46c303729ce167"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1de62cf696bb83a8d1b3b7326aa0ac9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html#ad1de62cf696bb83a8d1b3b7326aa0ac9">run</a> (void *)</td></tr>
<tr class="separator:ad1de62cf696bb83a8d1b3b7326aa0ac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ec5b12a67826c58de4be633750519d"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html#ac0ec5b12a67826c58de4be633750519d">event_handler</a> (void *ctx, system_event_t *event)</td></tr>
<tr class="separator:ac0ec5b12a67826c58de4be633750519d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="abce06be17fc37d675118a678a8100a36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abce06be17fc37d675118a678a8100a36">&#9670;&nbsp;</a></span>app_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void app_main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html#l00172">172</a> of file <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="af4edba451afacd8d9b46c303729ce167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4edba451afacd8d9b46c303729ce167">&#9670;&nbsp;</a></span>createGCPJWT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* createGCPJWT </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>projectId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>privateKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>privateKeySize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a JWT token for GCP. For full details, perform a Google search on JWT. However, in summary, we build two strings. One that represents the header and one that represents the payload. Both are <a class="el" href="class_j_s_o_n.html" title="Top level JSON handler. ">JSON</a> and are as described in the GCP and JWT documentation. Next we base64url encode both strings. Note that is distinct from normal/simple base64 encoding. Once we have a string for the base64url encoding of both header and payload, we concatenate both strings together separated by a ".". This resulting string is then signed using RSASSA which basically produces an SHA256 message digest that is then signed. The resulting binary is then itself converted into base64url and concatenated with the previously built base64url combined header and payload and that is our resulting JWT token. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">projectId</td><td>The GCP project. </td></tr>
    <tr><td class="paramname">privateKey</td><td>The PEM or DER of the private key. </td></tr>
    <tr><td class="paramname">privateKeySize</td><td>The size in bytes of the private key. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A JWT token for transmission to GCP. </dd></dl>

<p class="definition">Definition at line <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html#l00055">55</a> of file <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="ac0ec5b12a67826c58de4be633750519d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ec5b12a67826c58de4be633750519d">&#9670;&nbsp;</a></span>event_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t event_handler </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">system_event_t *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html#l00156">156</a> of file <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="ad1de62cf696bb83a8d1b3b7326aa0ac9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1de62cf696bb83a8d1b3b7326aa0ac9">&#9670;&nbsp;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void run </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html#l00134">134</a> of file <a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b66d65f09a100230911d819a169d69c.html">esp32-snippets</a></li><li class="navelem"><a class="el" href="dir_c51301fb4411848672b4772251f36a91.html">cloud</a></li><li class="navelem"><a class="el" href="dir_b1d09ad5f9e5754f873f4129cdaa6e6c.html">GCP</a></li><li class="navelem"><a class="el" href="dir_8f1e7412b922edbb36e3e67ac22b89b9.html">JWT</a></li><li class="navelem"><a class="el" href="esp32-snippets_2cloud_2_g_c_p_2_j_w_t_2main_8cpp.html">main.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
